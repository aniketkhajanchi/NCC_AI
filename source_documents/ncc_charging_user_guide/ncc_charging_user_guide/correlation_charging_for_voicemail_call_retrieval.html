<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Correlation charging for voicemail call retrieval" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="correlation_charging_for_voicemail_call_retrieval" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Correlation charging for voicemail call retrieval</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="correlation_charging_for_voicemail_call_retrieval">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Correlation charging for voicemail call retrieval</h1>
<div class="body conbody">
        <p class="p">Correlated charging mechanism establishes a correlation between the instances of normal
            outgoing call and the possible network-initiated call originated by the same subscriber.
            The subscriber is not charged for two call instances separately. Correlated charging is
            applied to charge just one leg of the call with highest rate.</p>

        <p class="p">For example, a subscriber is listening to a voicemail message, and has the option to
            automatically call the subscriber who has left a message. If he does that, then a
            network-initiated call is generated from the subscriber to the message originator. This
            is treated as the second call. The existing voicemail retrieval call is treated as the
            first call, which still continues while the second call is in progress. If correlated
            charging is configured, only one of the calls with the highest rate is charged.</p>

        <div class="fig figborder" id="correlation_charging_for_voicemail_call_retrieval__fig_e1g_ws5_zqb">
            <img class="image break" id="correlation_charging_for_voicemail_call_retrieval__image_itg_xs5_zqb" src="../images/correlatedchrg.png" />
        </div>

        <p class="p">The following actions are available in GY_PRE_PROCESSING trigger to configure this
            feature:</p>

        <ul class="ul" id="correlation_charging_for_voicemail_call_retrieval__ul_ogn_zzy_zqb">
            <li class="li"><var class="keyword varname">GY_PRE_PROCESSING.Valid-Call-Correlation</var><p class="p">Usage:
                        <var class="keyword varname">GY_PRE_PROCESSING.Valid-Call-Correlation =
                    VirtualRG_LONG</var></p>
<p class="p">When correlated charging is active for leg 1, NCC
                    creates a virtual MSCC using source contexts populated from the paired leg 2
                    session. The virtual MSCC uses the virtual RG defined for correlated
                    session.</p>
</li>

            <li class="li"><var class="keyword varname">GY_PRE_PROCESSING.Establish-Correlation</var></li>

        </ul>

        <div class="section" id="correlation_charging_for_voicemail_call_retrieval__section_s14_syc_1rb"><h2 class="title sectiontitle">Applying highest rate for leg 1</h2>
            
            <p class="p">During correlated session NCC picks the highest rate from leg 1 (rate 1) and leg 2
                (rate 2), and applies it to leg 1.</p>

            <ul class="ul" id="correlation_charging_for_voicemail_call_retrieval__ul_wjr_gzc_1rb">
                <li class="li">If rate 2 &gt; rate 1: NCC switches to rate 2 at correlation time. Returns back to
                    rate 1 once correlation finishes and leg1 continues.</li>

                <li class="li">If rate 1 ≥ rate 2: rate 1 is applied.</li>

            </ul>

            <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> 
                <ul class="ul" id="correlation_charging_for_voicemail_call_retrieval__ul_y3y_pzc_1rb">
                    <li class="li">Rate comparison is done for normal step cost/quantity value between two
                        rates.</li>

                    <li class="li">No-charge is considered as zero rate.</li>

                    <li class="li">If bucket is applied in one of the legs, the bucket is used for correlated
                        session duration. If bucket is applied to both legs, the leg1 bucket is used
                        first.</li>

                    <li class="li">When switching from rate 1 to rate 2 at correlation time, flat-charge and
                        N-free is not applied again and new rate is applied as soon as N-free of
                        previous rate ends.</li>

                </ul>

            </div>

        </div>

        <div class="section" id="correlation_charging_for_voicemail_call_retrieval__section_zqb_zzc_1rb"><h2 class="title sectiontitle">Applying zero rate for leg 2</h2>
            
            <p class="p">If leg 2 has zero rate, during correlated session NCC picks rate of leg 1 (rate 1).
                Leg 2 remains free of charge (zero rate with original rate2).</p>

        </div>

        <div class="section" id="correlation_charging_for_voicemail_call_retrieval__section_xjm_4xy_zqb"><h2 class="title sectiontitle">Rule example</h2>
            
            <p class="p"><strong class="ph b">Rule to mark leg1 of the call as valid for correlation</strong></p>

            <p class="p">GY_PRE_PROCESSING rule 1</p>

            <pre class="pre codeblock"><code>if
   IMS_SERVICE_INFO.Called-Party-Address = "121"
then
   GY_PRE_PROCESSING.Valid-Call-Correlation ( 999 )
</code></pre>
            <p class="p"><strong class="ph b">Rule to establish correlation from leg 2 of the call</strong></p>

            <p class="p">GY_PRE_PROCESSING rule 2</p>

            <pre class="pre codeblock"><code>
if
   CONVERSION.Match-Regular-Expression ( GyCCR.Service-Information.IMS-Information.Application-Server-Information.Application-Server, "ni-oick=55" ) = "ni-oick=55"
then
   GY_PRE_PROCESSING.Establish-Correlation = BooleanEnum_TRUE</code></pre>
            
        </div>

        <div class="section" id="correlation_charging_for_voicemail_call_retrieval__section_l1h_x1z_zqb"><h2 class="title sectiontitle">CDR</h2>
            
            <p class="p">The field <var class="keyword varname">correlatedCharging</var> is available in CDR for this feature.
                The following values are generated for this tag:</p>

            <ul class="ul" id="correlation_charging_for_voicemail_call_retrieval__ul_sbh_vbz_zqb">
                <li class="li"><var class="keyword varname">leg1</var>: Correlated charging active for leg1.</li>

                <li class="li"><var class="keyword varname">leg2</var>: Correlated charging active for leg2.</li>

            </ul>

        </div>

    </div>
<div class="footer"><hr /><p>Charging User Guide • P556766-DN1000054947-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>