<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="db-restore" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="db_restore" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>db-restore</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="db_restore">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">db-restore</h1>
<div class="body conbody">
        <div class="section" id="db_restore__section_vgh_n5n_mnb"><h2 class="title sectiontitle">Description</h2>
            
            <p class="p">This tool restores the Aerospike database using a previously created backup copy.</p>

            <p class="p">This tool is run on the admincli pod in the <span class="ph">NCC</span> system. Unless you are doing a
                disaster recovery, Nokia recommends that you perform this procedure during off hours
                (non-peak-hours). A separate backup file will be referenced for each namespace.</p>

            <ul class="ul" id="db_restore__ul_v4m_njc_crb">
                <li class="li">Destination sizing must be the same or greater than source sizing.</li>

                <li class="li">Destination should be installed using source Helm Chart (that is, same site ID,
                    same partition ID, same FQDN, different IP address).</li>

            </ul>

        </div>

        <div class="section" id="db_restore__section_y4q_w5n_mnb"><h2 class="title sectiontitle">Syntax</h2>
            
            <div class="p">
                <pre class="pre codeblock"><code>db-restore -d &lt;directory&gt; -n &lt;namespace[,namespace]*&gt; [-f] [-t &lt;threads&gt;][--disable-batch-writes]</code></pre>
            </div>

            <div class="p">
                <table cellpadding="4" cellspacing="0" summary="" id="db_restore__table_pys_y5n_mnb" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap"><span class="table--title-label">Table: </span>Options</span></caption><colgroup><col style="width:33.33333333333333%" /><col style="width:66.66666666666666%" /></colgroup><thead class="thead" style="text-align:left;">
                            <tr class="row">
                                <th class="entry cellrowborder" style="vertical-align:top;" id="d76626e77">Option</th>

                                <th class="entry cellrowborder" style="vertical-align:top;" id="d76626e80">Description</th>

                            </tr>

                        </thead>
<tbody class="tbody">
                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d76626e77 "><code class="ph codeph">No arguments</code></td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d76626e80 ">Displays usage/help information.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d76626e77 "><code class="ph codeph">-h or -?</code></td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d76626e80 ">Displays usage/help information.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d76626e77 "><code class="ph codeph">-d &lt;directory&gt;</code></td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d76626e80 ">Directory containing the backup files. This directory must
                                    already exist.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d76626e77 "><code class="ph codeph">-f</code></td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d76626e80 ">Force execution. If specified, the user is not asked for
                                    confirmation.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d76626e77 "><code class="ph codeph">-n &lt;namespace[,namespace]*&gt;</code></td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d76626e80 ">Namespace list to restore. Allows you to specify the
                                    namespaces to restore.</td>

                            </tr>

                            
                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d76626e77 "><code class="ph codeph">-t &lt;threads&gt;</code></td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d76626e80 ">Number of Aerospike client threads. The default value is
                                        <code class="ph codeph">20</code>.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d76626e77 "><code class="ph codeph">[--disable-batch-writes]</code></td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d76626e80 ">Disables the use of batch writes when restoring records to
                                    the Aerospike cluster.</td>

                            </tr>

                        </tbody>
</table>

            </div>

        </div>

        <div class="section" id="db_restore__section_jwf_nvn_mnb"><h2 class="title sectiontitle">Example</h2>
            
            <div class="p">This is a summary output for this command using the backup files located in the
                    <code class="ph codeph">/tmp/bak</code> directory.<pre class="pre codeblock"><code>[tpaadmin@ig-centralmanagement-0 bin]$ ./db-restore -d /tmp/bak
19:39  db-restore issued at: Thu Oct 29 19:39:47 UTC 2020
19:39
19:39  Backup on ig-centralmanagement-0:
19:39     2020-10-29_19:34:50    ig-aerospike-0.ig-aerospike-service.sps-btel.svc.cluster.local
19:39     2020-10-29_19:34:50    ig-aerospike-1.ig-aerospike-service.sps-btel.svc.cluster.local
19:39     2020-10-29_19:34:50    ig-aerospike-2.ig-aerospike-service.sps-btel.svc.cluster.local
19:39     2020-10-29_19:34:50    ig-aerospike-3.ig-aerospike-service.sps-btel.svc.cluster.local
19:39

This action will replace the local database with the specified
database backup! All database server processes
and application server processes in the local site
will be restarted after this configuration change!

Do you wish to continue? (y/n)y
19:39
19:39  XDR is not configured.
19:39
19:39  Removing 0 namespaces from XDR context
19:39  Truncating namespaces [dsc dsclocal dscglobal  spspd1]
19:39  Truncating namespace dsc
19:39  Truncating namespace dsclocal
19:39  Truncating namespace dscglobal
19:39  Truncating namespace spspd1
19:39
19:39  Starting restore on ig-centralmanagement-0 for ig-aerospike-0.ig-aerospike-service.sps-btel.svc.cluster.local-dsc
19:39  Starting restore on ig-centralmanagement-0 for ig-aerospike-1.ig-aerospike-service.sps-btel.svc.cluster.local-dsc
19:39  Starting restore on ig-centralmanagement-0 for ig-aerospike-2.ig-aerospike-service.sps-btel.svc.cluster.local-dsc
19:39  Starting restore on ig-centralmanagement-0 for ig-aerospike-3.ig-aerospike-service.sps-btel.svc.cluster.local-dsc
19:39  Starting restore on ig-centralmanagement-0 for ig-aerospike-0.ig-aerospike-service.sps-btel.svc.cluster.local-dsclocal
19:39  Starting restore on ig-centralmanagement-0 for ig-aerospike-1.ig-aerospike-service.sps-btel.svc.cluster.local-dsclocal
19:39  Starting restore on ig-centralmanagement-0 for ig-aerospike-2.ig-aerospike-service.sps-btel.svc.cluster.local-dsclocal
19:39  Starting restore on ig-centralmanagement-0 for ig-aerospike-3.ig-aerospike-service.sps-btel.svc.cluster.local-dsclocal
19:39  Starting restore on ig-centralmanagement-0 for ig-aerospike-0.ig-aerospike-service.sps-btel.svc.cluster.local-dscglobal
19:39  Starting restore on ig-centralmanagement-0 for ig-aerospike-1.ig-aerospike-service.sps-btel.svc.cluster.local-dscglobal
19:39  Starting restore on ig-centralmanagement-0 for ig-aerospike-2.ig-aerospike-service.sps-btel.svc.cluster.local-dscglobal
19:39  Starting restore on ig-centralmanagement-0 for ig-aerospike-3.ig-aerospike-service.sps-btel.svc.cluster.local-dscglobal
19:39  Starting restore on ig-centralmanagement-0 for ig-aerospike-0.ig-aerospike-service.sps-btel.svc.cluster.local-spspd1
19:39  Starting restore on ig-centralmanagement-0 for ig-aerospike-1.ig-aerospike-service.sps-btel.svc.cluster.local-spspd1
19:39  Starting restore on ig-centralmanagement-0 for ig-aerospike-2.ig-aerospike-service.sps-btel.svc.cluster.local-spspd1
19:39  Starting restore on ig-centralmanagement-0 for ig-aerospike-3.ig-aerospike-service.sps-btel.svc.cluster.local-spspd1
19:39  Restore for ig-aerospike-1.ig-aerospike-service.sps-btel.svc.cluster.local-spspd1 completed
19:39  Restore for ig-aerospike-2.ig-aerospike-service.sps-btel.svc.cluster.local-spspd1 completed
19:39  Restore for ig-aerospike-2.ig-aerospike-service.sps-btel.svc.cluster.local-dsc completed
19:39  Restore for ig-aerospike-3.ig-aerospike-service.sps-btel.svc.cluster.local-dsc completed
19:39  Restore for ig-aerospike-0.ig-aerospike-service.sps-btel.svc.cluster.local-spspd1 completed
19:39  Restore for ig-aerospike-3.ig-aerospike-service.sps-btel.svc.cluster.local-spspd1 completed
19:39  Restore for ig-aerospike-1.ig-aerospike-service.sps-btel.svc.cluster.local-dscglobal completed
19:39  Restore for ig-aerospike-1.ig-aerospike-service.sps-btel.svc.cluster.local-dsclocal completed
19:39  Restore for ig-aerospike-3.ig-aerospike-service.sps-btel.svc.cluster.local-dscglobal completed
19:39  Restore for ig-aerospike-1.ig-aerospike-service.sps-btel.svc.cluster.local-dsc completed
19:39  Restore for ig-aerospike-2.ig-aerospike-service.sps-btel.svc.cluster.local-dsclocal completed
19:39  Restore for ig-aerospike-0.ig-aerospike-service.sps-btel.svc.cluster.local-dsc completed
19:39  Restore for ig-aerospike-2.ig-aerospike-service.sps-btel.svc.cluster.local-dscglobal completed
19:39  Restore for ig-aerospike-0.ig-aerospike-service.sps-btel.svc.cluster.local-dsclocal completed
19:39  Restore for ig-aerospike-0.ig-aerospike-service.sps-btel.svc.cluster.local-dscglobal completed
19:39  Restore for ig-aerospike-3.ig-aerospike-service.sps-btel.svc.cluster.local-dsclocal completed
19:39
19:39  ig-aerospike-0.ig-aerospike-service.sps-btel.svc.cluster.local
19:39      dsc             Completed
19:39      dsclocal        Completed
19:39      dscglobal       Completed
19:39      spspd1          Completed
19:39  ig-aerospike-1.ig-aerospike-service.sps-btel.svc.cluster.local
19:39      dsc             Completed
19:39      dsclocal        Completed
19:39      dscglobal       Completed
19:39      spspd1          Completed
19:39  ig-aerospike-2.ig-aerospike-service.sps-btel.svc.cluster.local
19:39      dsc             Completed
19:39      dsclocal        Completed
19:39      dscglobal       Completed
19:39      spspd1          Completed
19:39  ig-aerospike-3.ig-aerospike-service.sps-btel.svc.cluster.local
19:39      dsc             Completed
19:39      dsclocal        Completed
19:39      dscglobal       Completed
19:39      spspd1          Completed
19:39
19:39
19:39  SPS DB restore successfully completed from directory [/tmp/bak]
19:39  on this OAME node.
19:39
19:39  db-restore completed at: Thu Oct 29 19:39:56 UTC 2020
19:39
19:39  See [/tmp/bak/DB_BACKUP_*/*.restorelog] for
19:39  detailed output of restore command execution.</code></pre></div>

        </div>

        <div class="section" id="db_restore__section_azy_b1c_crb"><h2 class="title sectiontitle">Post-restore steps</h2>
            
            <div class="p">The db-restore tool works even if there are different <span class="ph">NCC</span> system names in the source and destination environments. However, after restore,
                the imported data contains reference of source <span class="ph">NCC</span> name
                (in SM database). In the destination, it must be changed to match the destination
                    <span class="ph">NCC</span> name. <span class="ph">NCC</span> provides
                two APIs for this purpose to be used in the destination: <ul class="ul" id="db_restore__ul_dcl_3cc_crb">
                    <li class="li">one to change/remove the <span class="ph">NCC</span> name reference,
                        which starts the execution of the process in the background</li>

                    <li class="li">other to verify the status of the background process</li>

                </ul>
For more details about how to use these APIs, refer to the API
                documentation.</div>

            <ol class="ol" id="db_restore__ol_bvq_h1c_crb">
                <li class="li">Run this database query to delete any unused ME system names from the SM
                            database:<p class="p"><span class="keyword cmdname">aql -c "delete from dsc.SmManagedElement where
                            pk='IG1'"</span></p>
</li>

                <li class="li">Change/remove ME system name: Use this API to change the reference of the old ME
                    to the new ME:<div class="fig fignone" id="db_restore__fig_l1j_q1c_crb">
                        <pre class="pre codeblock"><code>https://<strong class="ph b">sm_ip</strong>​​​​​:8443/services/ServiceManager/update/MEReference?oldMEName=<strong class="ph b">oldme</strong>​​​​​&amp;newMEName=<strong class="ph b">newme</strong>​​​​​&amp;failedOnly=true</code></pre>
                    </div>
<p class="p">where:</p>
<ul class="ul" id="db_restore__ul_dd2_2bc_crb">
                        <li class="li"><strong class="ph b">sm_ip</strong>​​​​​: IP address of the IG system. </li>

                        <li class="li"><strong class="ph b">oldme</strong>: The ME system name to be changed.</li>

                        <li class="li"><strong class="ph b">newme</strong>: The new name for the ME system.</li>

                    </ul>
<p class="p">These are some examples of the different ways in which this API can be
                        used:</p>
<ul class="ul" id="db_restore__ul_ik1_psl_1rb">
                        <li class="li">Change ME system name from oldME to newME:
                            <pre class="pre codeblock"><code>https://sm_ip:8443/services/ServiceManager/update/MEReference?oldMEName=<strong class="ph b">ME1</strong>&amp;newMEName=<strong class="ph b">ME2</strong></code></pre></li>

                        <li class="li">Set flag <code class="ph codeph">failedOnly=true</code> to retry any failed entities:
                            <pre class="pre codeblock"><code>https://sm_ip:8443/services/ServiceManager/update/MEReference?oldMEName=<strong class="ph b">ME1</strong>&amp;newMEName=<strong class="ph b">ME2</strong>&amp;failedOnly=true</code></pre></li>

                        <li class="li">Remove ME system name: <p class="p">If there are two MEs in the source and one ME
                                in the destination, then there may be a need to remove one of the ME
                                references from the SM subsystem. To remove an ME system name from
                                entities, do not provide the parameter in the
                            call.</p>
<pre class="pre codeblock"><code>https://sm_ip:8443/services/ServiceManager/update/MEReference?oldMEName=<strong class="ph b">ME1</strong></code></pre></li>

                        <li class="li">Retry removing ME reference in failed entities:
                            <pre class="pre codeblock"><code>https://sm_ip:8443/services/ServiceManager/update/MEReference?oldMEName=<strong class="ph b">ME1</strong>&amp;failedOnly=true</code></pre></li>

                    </ul>
</li>

                <li class="li">Check migration status: Use the following API to get status of the background
                        process.<pre class="pre codeblock"><code>https://sm_ip​​​​​:8443/services/ServiceManager/getStatus/MEReference/<strong class="ph b">ME2</strong></code></pre><p class="p">where
                            ​​​​​<var class="keyword varname">ME2</var> is the new name of the ME (or the name of
                        the old ME if it is being removed).</p>
</li>

            </ol>

        </div>

    </div>
<div class="footer"><hr /><p>Operations, Administration, and Maintenance Guide • P556766-DN1000055092-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>