<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Restoring a backup not listed in BrPolicy history" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="restoring_a_backup_not_listed_in_brpolicy_history" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Restoring a backup not listed in BrPolicy history</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="restoring_a_backup_not_listed_in_brpolicy_history">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Restoring a backup not listed in BrPolicy history</h1>
<div class="body conbody">
        <p class="p">The number of backups stored in the back-end of Backup and Recovery is determined by the
            number specified as the value of the <span class="keyword parmname">maxiCopy</span> parameter at
            deployment time. When a new backup is stored, if the number of backups exceeds
                <span class="keyword parmname">maxiCopy</span> then the oldest backup is deleted, to make space for
            the new one. </p>

        <p class="p">When describing the BrPolicy related to a component, all of the backups stored in the
            back-end are listed in the section named Backup History. Those are the only backup files
            that can be restored. Normally the latest backup is restored, but it is possible to
            restore a different one listed in the backup history, by providing its backup-id.</p>

        <p class="p">If there is the need to restore a backup file that is not among the ones listed in the
            Backup History (which means that it is not stored in the back-end anymore), perform
            these steps:</p>

        <ol class="ol">
            <li class="li">The backup file that is to be restored must have been copied to another location
                before it was deleted from the back-end storage to make space for a more recent
                backup.</li>

            <li class="li">Copy the saved backup file to the back-end following the directory structure
                observed in the back-end, possibly replacing an existing backup file, to keep the
                number of backups consistent with the value of the <span class="keyword parmname">maxiCopy</span>
                parameter.</li>

            <li class="li">Issue a curl command to request Backup and Recovery to reload the backup history. </li>

            <li class="li">Issue a curl command to restore the desired backup using its backup-id.</li>

        </ol>

        <p class="p">For example, a Backup and Recovery back-end is set as local and you have saved an old
            backup of Service Discovery and Configuration that you want to restore.</p>

        <p class="p">Assuming the <span class="keyword parmname">maxiCopy</span> value for Service Discovery and Configuration
            is 3 and you have this in the BrPolicy of Service Discovery and Configuration:</p>

        <pre class="pre codeblock"><code>Status:  
 Backup History:
    20230605020020_e03_LOCAL_ig1_ig-csdc
    20230606020022_e03_LOCAL_ig1_ig-csdc
    20230607020022_e03_LOCAL_ig1_ig-csdc</code></pre>
        <p class="p">You can exec into the mycelery pod and list the backups for Service Discovery and
            Configuration:</p>

        <pre class="pre codeblock"><code>ls /CBUR_REPO/data/ig1/STATEFULSET_ig-csdc
20230605020020  20230606020022  20230607020022 </code></pre>
        <p class="p">You can delete the folder 20230605020020, which includes the backup file, and replace it
            with the folder 20230604020020 with the older backup file that you had previously
            saved.</p>

        <p class="p">At this point, you can exec into the admincli pod and issue this curl request to have
            Backup and Recovery reload the backup history:</p>

        <pre class="pre codeblock"><code># NAMESPACE is the namespace where Backup and Recovery and Service Discovery and Configuration are deployed, 
# for example ig1 and POLICYNAME is the name of the Service Discovery and Configuration BrPolicy, for example ig-csdc
curl -kL --header 'Content-Type: multipart/form-data' \
--header 'Accept: application/json' http://cbur-master-cbur.$NAMESPACE.svc.cluster.local:80/v2/images/$NAMESPACE/$POLICYNAME?force=true</code></pre>
        <p class="p">After executing this command, you can describe the BrPolicy again and confirm that the
            backup history has been updated:</p>

        <pre class="pre codeblock"><code> Status:
  Backup History:
    20230604020020_e03_LOCAL_ig1_ig-csdc
    20230606020022_e03_LOCAL_ig1_ig-csdc
    20230607020022_e03_LOCAL_ig1_ig-csdc </code></pre>
        <p class="p">At this point, you can issue the command to restore the desired backup using its
            backup-id:</p>

        <pre class="pre codeblock"><code># NAMESPACE is the namespace where Backup and Recovery and Service Discovery and Configuration are deployed, for example ig1
# and RELEASENAME is the release name of Service Discovery and Configuration, for example ig-csdc.
curl -vkL --header 'Accept:application/json' -X POST --header 'Content-Type: application/x-www-form-urlencoded' \
  -d 'backup_id=20230604020020_e03_LOCAL_ig1_ig-csdc&amp;volume=&amp;object_type=&amp;object_name='http://cbur-master-cbur.$NAMESPACE.svc.cluster.local:80/v2/helm/release/restore/$NAMESPACE/$RELEASENAME</code></pre>
    </div>
<div class="footer"><hr /><p>Operations, Administration, and Maintenance Guide • P556766-DN1000055092-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>