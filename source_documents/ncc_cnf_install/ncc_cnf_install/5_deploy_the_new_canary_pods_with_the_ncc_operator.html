<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Deploy the new canary pods with the NCC operator" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="_5._deploy_the_new_canary_pods_with_the_ncc_operator" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Deploy the new canary pods with the NCC operator</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="_5._deploy_the_new_canary_pods_with_the_ncc_operator">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Deploy the new canary pods with the <span class="ph">NCC</span> operator</h1>
<div class="body conbody">
    <div class="section"><h2 class="title sectiontitle">Enable canary in the Input Generator</h2>
      
      <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> The <code class="ph codeph">CHF_SOLUTION_VERSION</code> should continue to refer to the existing/old
        release version.</div>

      <ol class="ol">
        <li class="li">Open the <span class="ph filepath">Inputs${TARGET_CHF_SOLUTION_VERSION}.xlsx</span>
          spreadsheet.</li>

        <li class="li">Set these values in the <span class="ph uicontrol">namespace</span> worksheet in the <span class="ph uicontrol">CHF
            Traffic Routing</span> section:<ul class="ul">
            <li class="li">Type: PERCENTFIXED</li>

            <li class="li">Percentage New: 20</li>

            <li class="li">Charging Canary Active: true</li>

          </ul>
</li>

        <li class="li">Save and close the spreadsheet.</li>

      </ol>

      <p class="p">In this example, the canary test uses the routing traffic type
          <code class="ph codeph">PERCENTFIXED</code>. This value is easier to setup as it does not require
        updates to any entity (device, account or group) to participate to the canary test. Using
          <code class="ph codeph">PERCENTFIXED</code> has the effect that the specified percentage of the incoming
        requests are randomly routed to the canary pods.</p>

      <p class="p">If you would rather limit your canary test to affect only a specific set of entities
        (devices, accounts or groups), select the <code class="ph codeph">TESTENTITY</code> type. By doing so,
        only the entities which have the value <code class="ph codeph">Canary Test</code> in their attribute
          <span class="ph uicontrol">Canary Mode</span> are used in the canary test. In other words, only
        requests affecting the entities with the <code class="ph codeph">Canary Test</code> value are routed to
        the canary pods. The attribute <span class="ph uicontrol">Canary Mode</span> for an entity is set
        through the Service Manager GUI.</p>

      <p class="p">A canary test with a routing traffic type of <code class="ph codeph">FRIENDLYENTITY</code> works in a
        similar way, affecting entities which have the <span class="ph uicontrol">Canary Mode</span> attribute
        set to <code class="ph codeph">Canary friendly user</code> or <code class="ph codeph">Canary test</code>.</p>

    </div>

    <div class="section"><h2 class="title sectiontitle">Generate the custom resource</h2>
      
      <p class="p">Run this command to convert your canary spreadsheet into a YAML file:</p>

      <pre class="pre codeblock"><code>docker run -u="${UID}:$(id -g)" -v ${CURRENT_ABSOLUTE_DIRECTORY}:/work --rm ${DOCKER_REPO}chf/oneclick:${TARGET_CHF_SOLUTION_VERSION} oneclick -i Inputs${TARGET_CHF_SOLUTION_VERSION}.xlsx</code></pre>
    <p class="p">Run this command to create the resource:</p>

      <pre class="pre codeblock"><code>docker run -u="${UID}" -v ${CURRENT_ABSOLUTE_DIRECTORY}:/work --rm ${DOCKER_REPO}chf/chf-operator:${TARGET_CHF_SOLUTION_VERSION} python3 /python/customResourceFromYaml.py --inputYamlFile /work/input-generator/inputs.yaml --overridesDirectory /work/input-generator/overrides --elementsToInstall ig1 --mode canary --outputDirectory /work/output</code></pre>
    </div>

    <div class="section"><h2 class="title sectiontitle">Deploy the custom resource</h2>
      
      <p class="p">Run this command to create the custom resource in your cluster:</p>

      <pre class="pre codeblock"><code>kubectl -n ncc-operators apply -f output/chargingfunction-ig1.yaml</code></pre>
      <p class="p">Monitor the status with these commands:</p>

      <pre class="pre codeblock"><code># 1) Watch for new pods with "canary" in their names being created:
kubectl -n ig1 get pods -w
 
# 2) Find the operator pod and tail its log:
kubectl -n ncc-operators logs -f -l spsResourceType=chf-operator
 
# 3) look at the Container Package Management operator custom object status using the "watch" command
watch kubectl -n ncc-operators get profiles.app.csf.nokia.com ig1-profile -o jsonpath={.status}</code></pre>
    </div>

  </div>
<div class="footer"><hr /><p>Installation and Upgrade Guide • P556766-DN1000055103-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>