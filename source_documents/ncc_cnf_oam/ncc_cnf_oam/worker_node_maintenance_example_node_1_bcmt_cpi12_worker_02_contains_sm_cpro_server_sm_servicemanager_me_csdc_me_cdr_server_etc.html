<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Example NODE 1 -bcmt-cpi12-worker-02- contains SM Prometheus server, SM servicemanager , ME csdc , ME cdr server etc." />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="worker_node_maintenance_example_node_1_bcmt_cpi12_worker_02_contains_sm_cpro_server_sm_servicemanager_me_csdc_me_cdr_server_etc" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Example NODE 1 -bcmt-cpi12-worker-02- contains SM Prometheus server, SM servicemanager , ME csdc , ME cdr server etc.</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="worker_node_maintenance_example_node_1_bcmt_cpi12_worker_02_contains_sm_cpro_server_sm_servicemanager_me_csdc_me_cdr_server_etc">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Example NODE 1 -bcmt-cpi12-worker-02- contains SM Prometheus server, SM servicemanager , ME
    csdc , ME cdr server etc.</h1>
<div class="body conbody">
    <div class="section" id="worker_node_maintenance_example_node_1_bcmt_cpi12_worker_02_contains_sm_cpro_server_sm_servicemanager_me_csdc_me_cdr_server_etc__section_w3y_3b1_hpb"><h2 class="title sectiontitle">Check the pods on the current worker node</h2>
      
      <div class="p">
        <pre class="pre codeblock"><code>kubectl get pods --all-namespaces -o wide --field-selector spec.nodeName=bcmt-cpi12-worker-02
NAMESPACE      NAME                                          READY   STATUS    RESTARTS   AGE     IP              NODE                   NOMINATED NODE   READINESS GATES
istio-system   istio-cni-node-w2fgd                          2/2     Running   4          4d2h    172.30.254.14   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
istio-system   istio-prometheus-cpro-node-exporter-2s9nz     1/1     Running   0          4d2h    172.30.254.14   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
kube-system    csi-cinder-nodeplugin-glk82                   2/2     Running   0          6d22h   172.30.254.14   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
kube-system    kube-proxy-vjrgm                              1/1     Running   0          6d22h   172.30.254.14   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
kube-system    local-volume-provisioner-rvqkp                1/1     Running   0          6d22h   192.168.28.0    bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
ncms           bcmt-ip-man-agent-l2fxf                       1/1     Running   0          6d22h   172.30.254.14   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
ncms           bcmt-operator-7qhdm                           1/1     Running   0          6d22h   172.30.254.14   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
ncms           csi-cephfs-manila-nodeplugin-sx6hn            2/2     Running   0          6d22h   172.30.254.14   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
ncms           csi-manila-nodeplugin-dl96x                   4/4     Running   0          6d22h   172.30.254.14   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
ncms           csi-nodeplugin-nfsplugin-9c78b                2/2     Running   0          6d22h   172.30.254.14   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
sps-me         ppme3-cdr-server-2                            4/4     Running   0          2d1h    192.168.28.21   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
sps-me         ppme3btel-me-fluentd-5cb5c456fd-gc7gd         2/2     Running   0          27h     192.168.28.22   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
sps-me         ppme3btel-me-cpro-node-exporter-pgrxs         1/1     Running   0          27h     172.30.254.14   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
sps-me         ppme3cpro-alertmanager-me-1                   3/3     Running   0          3h25m   192.168.28.35   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
sps-me         ppme3kf-sps-me-1                              3/3     Running   0          2d23h   192.168.28.19   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
sps-me         ppme3sps-csdc-2                               3/3     Running   0          2d23h   192.168.28.18   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
sps-rt         pprt4-dr-metrics-exporter-64dc6fcd88-l24px    2/2     Running   0          3h27m   192.168.28.34   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
sps-rt         pprt4btel-rt-fluentd-56dccfcb44-v2glf         2/2     Running   0          27h     192.168.28.23   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
sps-rt         pprt4btel-rt-cpro-node-exporter-6dtb4         1/1     Running   0          27h     172.30.254.14   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
sps-rt         pprt4cpro-alertmanager-rt-1                   3/3     Running   0          27h     192.168.28.24   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
sps-rt         pprt4kf-sps-rt-2                              3/3     Running   0          2d21h   192.168.28.20   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
sps-sm         ppsm2btel-sm-fluentd-85bdc7b4ff-r6dsk         2/2     Running   0          27h     192.168.28.25   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
sps-sm         ppsm2btel-sm-cpro-node-exporter-4shx7         1/1     Running   0          27h     172.30.254.14   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
sps-sm         ppsm2btel-sm-cpro-server-0                    4/4     Running   0          27h     192.168.28.28   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
sps-sm         ppsm2cnot-sm-64c55cf957-8slqt                 3/3     Running   0          27h     192.168.28.26   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
sps-sm         ppsm2cpro-alertmanager-sm-0                   3/3     Running   0          27h     192.168.28.27   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
sps-sm         ppsm2kf-sps-sm-0                              3/3     Running   0          2d23h   192.168.28.16   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
sps-sm         ppsm2sps-csdc-0                               3/3     Running   0          2d23h   192.168.28.17   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
sps-sm         ppsm2sps-sm-servicemanager-694dc4b4d9-lzvl6   2/2     Running   1          2d23h   192.168.28.15   bcmt-cpi12-worker-02   &lt;none&gt;</code></pre>
      </div>

    </div>

    <div class="section" id="worker_node_maintenance_example_node_1_bcmt_cpi12_worker_02_contains_sm_cpro_server_sm_servicemanager_me_csdc_me_cdr_server_etc__section_ojz_kb1_hpb"><h2 class="title sectiontitle">Drain the node and note the results</h2>
      
      <div class="p">
        <pre class="pre codeblock"><code>[root@bcmt-cpi12-control-01 ~]# kubectl drain bcmt-cpi12-worker-02 --delete-local-data=true
node/bcmt-cpi12-worker-02 cordoned
evicting pod "ppsm2sps-sm-servicemanager-694dc4b4d9-lzvl6"
evicting pod "ppme3-cdr-server-2"
evicting pod "ppme3btel-me-fluentd-5cb5c456fd-gc7gd"
evicting pod "ppme3cpro-alertmanager-me-1"
evicting pod "ppme3kf-sps-me-1"
evicting pod "ppme3sps-csdc-2"
evicting pod "pprt4-dr-metrics-exporter-64dc6fcd88-l24px"
evicting pod "pprt4btel-rt-fluentd-56dccfcb44-v2glf"
evicting pod "pprt4cpro-alertmanager-rt-1"
evicting pod "pprt4kf-sps-rt-2"
evicting pod "ppsm2btel-sm-fluentd-85bdc7b4ff-r6dsk"
evicting pod "ppsm2btel-sm-cpro-server-0"
evicting pod "ppsm2cnot-sm-64c55cf957-8slqt"
evicting pod "ppsm2cpro-alertmanager-sm-0"
evicting pod "ppsm2kf-sps-sm-0"
evicting pod "ppsm2sps-csdc-0"
pod/ppme3-cdr-server-2 evicted
pod/ppme3cpro-alertmanager-me-1 evicted
pod/ppsm2sps-csdc-0 evicted
pod/ppsm2btel-sm-cpro-server-0 evicted
pod/ppsm2cpro-alertmanager-sm-0 evicted
pod/pprt4cpro-alertmanager-rt-1 evicted
pod/ppsm2sps-sm-servicemanager-694dc4b4d9-lzvl6 evicted
pod/pprt4-dr-metrics-exporter-64dc6fcd88-l24px evicted
pod/ppme3sps-csdc-2 evicted
pod/ppme3btel-me-fluentd-5cb5c456fd-gc7gd evicted
pod/ppsm2cnot-sm-64c55cf957-8slqt evicted
pod/ppsm2btel-sm-fluentd-85bdc7b4ff-r6dsk evicted
pod/pprt4kf-sps-rt-2 evicted
pod/ppme3kf-sps-me-1 evicted
pod/ppsm2kf-sps-sm-0 evicted
pod/pprt4btel-rt-fluentd-56dccfcb44-v2glf evicted
node/bcmt-cpi12-worker-02 evicted
[root@bcmt-cpi12-control-01 ~]# kubectl get pods --all-namespaces -o wide --field-selector spec.nodeName=bcmt-cpi12-worker-02
NAMESPACE      NAME                                        READY   STATUS    RESTARTS   AGE     IP              NODE                   NOMINATED NODE   READINESS GATES
istio-system   istio-cni-node-w2fgd                        2/2     Running   4          4d2h    172.30.254.14   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
istio-system   istio-prometheus-cpro-node-exporter-2s9nz   1/1     Running   0          4d2h    172.30.254.14   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
kube-system    csi-cinder-nodeplugin-glk82                 2/2     Running   0          6d22h   172.30.254.14   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
kube-system    kube-proxy-vjrgm                            1/1     Running   0          6d22h   172.30.254.14   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
kube-system    local-volume-provisioner-rvqkp              1/1     Running   0          6d22h   192.168.28.0    bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
ncms           bcmt-ip-man-agent-l2fxf                     1/1     Running   0          6d22h   172.30.254.14   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
ncms           bcmt-operator-7qhdm                         1/1     Running   0          6d22h   172.30.254.14   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
ncms           csi-cephfs-manila-nodeplugin-sx6hn          2/2     Running   0          6d22h   172.30.254.14   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
ncms           csi-manila-nodeplugin-dl96x                 4/4     Running   0          6d22h   172.30.254.14   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
ncms           csi-nodeplugin-nfsplugin-9c78b              2/2     Running   0          6d22h   172.30.254.14   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
sps-me         ppme3btel-me-cpro-node-exporter-pgrxs       1/1     Running   0          27h     172.30.254.14   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
sps-rt         pprt4btel-rt-cpro-node-exporter-6dtb4       1/1     Running   0          27h     172.30.254.14   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;
sps-sm         ppsm2btel-sm-cpro-node-exporter-4shx7       1/1     Running   0          27h     172.30.254.14   bcmt-cpi12-worker-02   &lt;none&gt;           &lt;none&gt;</code></pre>
      </div>

    </div>

    <div class="section" id="worker_node_maintenance_example_node_1_bcmt_cpi12_worker_02_contains_sm_cpro_server_sm_servicemanager_me_csdc_me_cdr_server_etc__section_vvh_mb1_hpb"><h2 class="title sectiontitle">Bring node back into operation</h2>
      
      <div class="p">
        <pre class="pre codeblock"><code>kubectl uncordon bcmt-cpi12-worker-02</code></pre>
      </div>

    </div>

    <div class="section" id="worker_node_maintenance_example_node_1_bcmt_cpi12_worker_02_contains_sm_cpro_server_sm_servicemanager_me_csdc_me_cdr_server_etc__section_qpr_m2h_hpb"><h2 class="title sectiontitle">Problems faced during drain</h2>
      
      <p class="p">Since the pods on each node are different and are present in all namespaces, the results of
        each node will be different depending on the type of the pods present on that system.</p>

      <ol class="ol" id="worker_node_maintenance_example_node_1_bcmt_cpi12_worker_02_contains_sm_cpro_server_sm_servicemanager_me_csdc_me_cdr_server_etc__ol_ajc_42h_hpb">
        <li class="li">Since the Prometheus server for SM was present on this node and SM is a singleton pod,
          metrics for SM are lost till the time the SM server is up and running. </li>

        <li class="li">The servicemanager pod was unable to attach volumes for a long time, so Sps-status for
          SM will be down for 5-7 mins.</li>

        <li class="li">CSDC cluster nodes may be unable to attach volumes for a long time, so they may show as
          down for 10 minutes. This has no impact on CSDC functionality.</li>

        <li class="li">The CDR server pod is moved from one node to another. It is unable to attach volumes for
          a long time. During this time, 1% of the CDRs are lost.</li>

      </ol>

    </div>

  </div>
<div class="footer"><hr /><p>Operations, Administration, and Maintenance Guide • P556766-DN1000055092-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>