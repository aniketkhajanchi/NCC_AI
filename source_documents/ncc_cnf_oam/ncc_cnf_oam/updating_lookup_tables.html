<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Updating lookup tables using update_db_table.sh" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="updating_lookup_tables" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Updating lookup tables using update_db_table.sh</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="updating_lookup_tables">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Updating lookup tables using update_db_table.sh</h1>
<div class="body conbody">
        <p class="p">To update lookup tables, a script named <code class="ph codeph">update_db_table.sh</code> may be run,
            which imports data into existing (draft) lookup tables. The datasets to be imported must
            be in CSV format, with a header that contains the same columns, in the same order as the
            lookup table to which the data is imported.</p>

        <p class="p">When updating lookup tables with the script, it may be chosen to clean old data from the
            table before adding new data or to only append the new data to the table. Note that if
            new data is appended, it should made certain the data imported does not breach any
            database unique constraints.</p>

        <p class="p">If any errors occur during the import, the database transaction is rolled back and the
            data in the table is reverted to as it was before executing the script. Beside the
            validation done at database level, the script does not validate the data itself in any
            way. The validation takes place when the draft data is published by the Configuration
            stream.</p>

        <p class="p">The script has been tested with large datasets (1 million rows), and it is performant
            enough for such a task. The dataset may be split into multiple files and the script run
            multiple times concurrently.</p>

        <p class="p">After importing the data, to publish the data to the database, follow the instructions in
                <a class="xref" href="SPS_CDR_Streams_Operation_and_Maintenance_Guide_publishing_lookup_configuration_to_database.html#SPS_CDR_Streams_Operation_and_Maintenance_Guide_publishing_lookup_configuration_to_database">Publishing lookup configuration to database</a> .</p>

        <p class="p"><strong class="ph b">Configuration</strong></p>

        <p class="p">DB connection information must be stored in
                <code class="ph codeph">/opt/comptel/eventlink/.mds.rc</code> file,  on the processing host.</p>

        <p class="p"><strong class="ph b">Usage</strong></p>

        <pre class="pre codeblock"><code>update_db_table.sh -f filename -t db_table_name -d delimiter -C</code></pre>
        <p class="p"><code class="ph codeph">-f</code>: CSV file path </p>

        <p class="p"><code class="ph codeph">-t</code>: DB lookup table name </p>

        <p class="p"><code class="ph codeph">-d</code>: delimiter (optional field). Default=(,) </p>

        <p class="p"><code class="ph codeph">-C</code>: clean up the table before adding new data (optional), if not
            included, the data is appended to the table.</p>

        <p class="p"><strong class="ph b">Example:</strong></p>

        <p class="p">Example lookup table, named LT_EXAMPLE_TABLE, with columns as follows: </p>

        <table cellpadding="4" cellspacing="0" summary="" id="updating_lookup_tables__simpletable_ff5_1pd_ymb" class="simpletable simpletableborder"><col style="width:20%" /><col style="width:20%" /><col style="width:20%" /><col style="width:20%" /><col style="width:20%" /><thead></thead><tbody><tr class="strow">
                <td style="vertical-align:top;" class="stentry">
                    <p class="p">ID (int)</p>

                </td>

                <td style="vertical-align:top;" class="stentry">
                    <p class="p">NAME (varchar)  </p>

                </td>

                <td style="vertical-align:top;" class="stentry">
                    <p class="p">VALUE (varchar)</p>

                </td>

            </tr>
</tbody></table>

        <p class="p">CSV file (<code class="ph codeph">LT_EXAMPLE_DATA.csv</code>):</p>

        <pre class="pre codeblock"><code>ID,NAME,VALUE
1,Field1,Value1
2,Field2,Value2
</code></pre>
        <p class="p">To clean up the old data from the lookup table first and then insert new data: </p>

        <pre class="pre codeblock"><code>update_db_table.sh -f LT_EXAMPLE_DATA.csv -t LT_EXAMPLE_TABLE -C</code></pre>
        <p class="p">To append the lookup table with new data:</p>

        <pre class="pre codeblock"><code>update_db_table.sh -f LT_EXAMPLE_DATA.csv -t LT_EXAMPLE_TABLE</code></pre>
    </div>
<div class="footer"><hr /><p>Operations, Administration, and Maintenance Guide • P556766-DN1000055092-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>