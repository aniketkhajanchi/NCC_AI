<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="NCC mediation and dual running mode" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="ncc_mediation" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>NCC mediation and dual running mode</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="ncc_mediation">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">NCC mediation and dual running mode</h1>
<div class="body conbody">
        <p class="p">With dual running mode, NCC and NCC-mediation can be configured to co-exist in single a
            deployment. Existing external OCS customers can deploy NCC mediation to support rating
            and charging of 5G subscribers, where NCC mediation converts 5G requests (N40/N28) to 4G
            diameter requests before forwarding them to the external OCS. Eventually, this will also
            lead to gradual migration of these subscribers to NCC.</p>

        <p class="p">For a 5G request if the subscriber is found in NCC, then NCC processes the request and
            all related future requests.</p>

        <p class="p">NCC mediation can be controlled by ME application preference <strong class="ph b">Dual Running Mode</strong>
            (refer to <a class="xref" href="system_pref.html">Charging application preferences</a> for details). It is
            disabled by default.</p>

        <ul class="ul" id="ncc_mediation__ul_vql_23z_xsb">
            <li class="li"><strong class="ph b">Dual Running Mode</strong> = 0: If the subscriber is not found in NCC, then the
                N40/N28 call is not redirected to external OCS. </li>

            <li class="li"><strong class="ph b">Dual Running Mode</strong> = 1 or 2: If the subscriber is not found in NCC for the
                N40/N28 request, NCC mediation tries to route the request to other external OCS to
                check if the subscriber belongs to that external OCS.<ul class="ul" id="ncc_mediation__ul_d5m_t3z_xsb">
                    <li class="li">If the subscriber is found at the external OCS, the request is processed and
                        all future related N40/N28 requests are processed in the external OCS. </li>

                    <li class="li">If subscriber is not found in the external OCS as well, then the N40 request
                        is sent to NCC for CDR generation with all relevant 5G tags if <strong class="ph b">Dual
                            Running Mode</strong> = 2, and <strong class="ph b">Support For inbound roaming</strong> = 3 (for
                        generating the CDRs for unknown devices).</li>

                </ul>
</li>

            <li class="li">If <strong class="ph b">Dual Running Mode</strong> ≠ 2 or <strong class="ph b">Support For inbound roaming</strong> ≠ 3, or it is
                an N28 request, then if the subscriber is not found in the external OCS, then the
                request is not sent back to NCC for CDR generation. Rather, the external OCS rejects
                it with <var class="keyword varname">Unknown subscriber</var> error.</li>

            <li class="li">If <strong class="ph b">Dual Running Mode</strong> = 4 and <strong class="ph b">Support For inbound roaming</strong> = 3 then CDR
                is generated for all SMF transactions and incoming calls are converted to 4G
                Diameter and forwarded to external OCS based on 5G parameter charging characteristic
                values.</li>

        </ul>

        <p class="p">For conversion logic of N40/N28 requests to the diameter request sent to external OCS,
            refer to 
            <em class="ph i">Standard Compliance and Interface Reference</em>.</p>

        <div class="section" id="ncc_mediation__section_njn_r23_g5b"><h2 class="title sectiontitle">Sample configuration for Dual Running Mode = 4</h2>
            
            <p class="p">Use mapping table for data provision.</p>

            <p class="p">Add new key [KeyToChargeTag] for charging characteristics values. The tag list takes
                semi-colon as delimiter, for example, 0200;0400 for online, 8500 for offline. </p>

            <table cellpadding="4" cellspacing="0" summary="" id="ncc_mediation__table_yc1_2g3_g5b" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap"><span class="table--title-label">Table: </span>Sample mapping table</span></caption><colgroup><col style="width:16.666666666666664%" /><col style="width:16.666666666666664%" /><col style="width:16.666666666666664%" /><col style="width:16.666666666666664%" /><col style="width:16.666666666666664%" /><col style="width:16.666666666666664%" /></colgroup><thead class="thead" style="text-align:left;">
                        <tr class="row">
                            <th class="entry cellrowborder" style="vertical-align:top;" id="d335409e131">Map name</th>

                            <th class="entry cellrowborder" style="vertical-align:top;" id="d335409e134">Map key</th>

                            <th class="entry cellrowborder" style="vertical-align:top;" id="d335409e137">Map value 1</th>

                            <th class="entry cellrowborder" style="vertical-align:top;" id="d335409e140">Map value 2</th>

                            <th class="entry cellrowborder" style="vertical-align:top;" id="d335409e143">Map value 3</th>

                            <th class="entry cellrowborder" style="vertical-align:top;" id="d335409e147">...</th>

                        </tr>

                    </thead>
<tbody class="tbody">
                        <tr class="row">
                            <td class="entry cellrowborder" rowspan="4" style="vertical-align:top;" headers="d335409e131 ">ExternalOCS</td>

                            <td class="entry cellrowborder" rowspan="3" style="vertical-align:top;" headers="d335409e134 ">KeyToSites</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d335409e137 ">Realm1</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d335409e140 ">Host11</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d335409e143 ">Host12</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d335409e147 ">...</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d335409e137 ">Realm1</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d335409e140 ">Host21</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d335409e143 ">Host22</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d335409e147 ">...</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d335409e137 ">...</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d335409e140 ">...</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d335409e143 ">...</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d335409e147 ">...</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d335409e134 ">KeyToChargeTag</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d335409e137 ">&lt;Charging characteristic value - online&gt;</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d335409e140 ">&lt;Charging characteristic value - offline&gt;</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d335409e143 "> </td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d335409e147 "> </td>

                        </tr>

                    </tbody>
</table>

            <div class="note" id="ncc_mediation__note_twy_bf3_g5b"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> 
                <ul class="ul" id="ncc_mediation__ul_p2q_mf3_g5b">
                    <li class="li">The map name must be <strong class="ph b">ExternalOCS</strong>.</li>

                    <li class="li">Diameter peer/root must be configured appropriately.</li>

                </ul>

            </div>

        </div>

    </div>
<div class="footer"><hr /><p>Charging User Guide • P556766-DN1000054947-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>