<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Service fee updates" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="service_fee_update" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Service fee updates</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="service_fee_update">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Service fee updates</h1>
<div class="body conbody">
        <div class="p">If service fee defined in the loan configuration is updated, then consider the following
                points.<div class="note warning" id="service_fee_update__note_vtk_4dw_ptb"><div class="warningtitle"><img src="../../web/css/../images/warning.svg" title="warning-icon" class="noteicon" />Warning:</div> Service fee update is only
                supported for specific custom scenarios. It is not recommended to change the loan
                parameters. However, in exceptional scenarios if the loan parameters are updated,
                then they become effective immediately or when subscribers opt-in to loan service
                again based on the configuration.</div>
</div>

        <div class="p">Operators can configure whether the service fee that is defined in the loan should be
            effective immediately or when subscribers opt-in to loan service again. The <strong class="ph b">Update
                type</strong> parameter is available in loan definition (in GUI) to configure whether the
            updated service should be effective immediately or on next opt-in. It can be configured
            with the following values:<ul class="ul" id="service_fee_update__ul_k4b_yv3_svb">
                <li class="li">IMMEDIATELY: If service fee is updated after the fee is charged from prepaid
                    balance, then the updated service fee is applied immediately.<div class="note" id="service_fee_update__note_gpf_ytd_4vb"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> The functionality to configure the updated service fee
                        to be effective immediately is applicable to loan of recurrent type, and
                        loan as loan amount. It is not applicable to one time loan and loan as
                        bundle.</div>
</li>

                <li class="li">ON NEXT OPT IN: If service fee is updated after the fee is charged from prepaid
                    balance, then the updated service fee is applied on next opt-in.</li>

            </ul>
</div>

        <div class="note" id="service_fee_update__note_rgm_mwz_tvb"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> By default, <strong class="ph b">Update type</strong> parameter is set to <em class="ph i">ON NEXT
                OPT IN</em>.</div>

        <div class="p">The <strong class="ph b">Update type</strong> parameter is set to <em class="ph i">ON NEXT OPT IN</em> in the following
                scenarios:<ul class="ul" id="service_fee_update__ul_dq2_sns_4tb">
                <li class="li">If loan was used, <strong class="ph b">Service fee paid only if loan used</strong> =
                        <var class="keyword varname">true</var>, and service fee is updated, then old service fee is
                    deducted at the time of loan repayment/opt-out. New service fee is applicable
                    after subscribers opts-in again to loan service.</li>

                <li class="li">If loan was NOT used, <strong class="ph b">Service fee paid only if loan used</strong> =
                        <var class="keyword varname">true</var>, and service fee is updated, then service fee is NOT
                    deducted at the time of loan repayment/opt-out.</li>

                <li class="li">If loan was NOT used, <strong class="ph b">Service fee paid only if loan used</strong> =
                        <var class="keyword varname">false</var>, and service fee is updated, then old service fee
                    is deducted at the time of repayment of loan amount or opt-out. New service fee
                    is applicable after subscriber opts-in again to loan service.</li>

                <li class="li">For recurrent or partial repayment, if loan state is opt-in, then old service
                    fee is applicable. Once the loan is opted out, then new service is
                    applicable.</li>

            </ul>
</div>

        <div class="p">The <strong class="ph b">Update type</strong> parameter is set to <em class="ph i">IMMEDIATELY</em> in the following
                scenarios:<ul class="ul" id="service_fee_update__ul_ojn_y5z_tvb">
                <li class="li">
                    <p class="p">The service fee in the loan is updated with the new service fee, and it is
                        reflected in the total remaining debt of the account. The updated service
                        fee is charged when a new recharge is done on the account or when the loan
                        is opted out.</p>

                </li>

                <li class="li">
                    <p class="p">While creating or updating a loan.</p>

                </li>

                <li class="li"><em class="ph i">updatedServiceFeesApplicability</em> is available in the
                    following APIs:<ul class="ul" id="service_fee_update__ul_azz_htz_tvb">
                        <li class="li"><em class="ph i">/create/Loan</em></li>

                        <li class="li"><em class="ph i">/update/Loan</em></li>

                    </ul>
</li>

            </ul>
</div>

        <p class="p"><strong class="ph b">Correlation Id in EDRs</strong></p>

        <div class="p">NCC generates a correlation identifier in EDRs for lifecycle actions <em class="ph i">Reset Loan
                Action</em> and <em class="ph i">Reset Account Action</em>. Correlation Id is common for lifecycle
            actions executed in a single transaction. If both the actions are configured to be
            executed together on receiving the same event in Account lifecycle, then a common
            correlation Id is available in the EDRs generated for both the actions.<div class="note" id="service_fee_update__note_v4r_th1_5vb"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> Correlation Id functionality is applicable only to <em class="ph i">Reset
                    Loan Action</em> and <em class="ph i">Reset Account Action</em>. However, this functionality is
                a generic implementation and when used with other actions, the behavior is currently
                unpredictable.</div>
</div>

        <div class="section" id="service_fee_update__section_hlk_f34_tvb"><h2 class="title sectiontitle">Examples</h2>
            
            <div class="sectiondiv"><strong class="ph b">Use case 1: Loan service fee is updated with immediate effect. Service
                    fee is updated with Update type parameter set to <em class="ph i">IMMEDIATELY</em> before loan
                    usage. </strong><div class="p"><strong class="ph b">Configuration</strong>:<ol class="ol" id="service_fee_update__ul_izw_j34_tvb">
                        <li class="li"><em class="ph i">Device1</em> is configured with E164 as <var class="keyword varname">3677000011</var>.
                            A subscription is purchased by the device as <em class="ph i">Bundle1</em> with an
                            Account. User is attached to the device.<div class="fig fignone" id="service_fee_update__fig_rvb_5ls_tvb">
                                <img class="image break" id="service_fee_update__image_m2w_5ls_tvb" height="192" src="../images/bundle_lp4.png" width="480" />
                                <img class="image break" id="service_fee_update__image_nz4_wls_tvb" height="192" src="../images/cl_lp4.png" width="288" />
                            </div>
</li>

                        <li class="li">Account balance is configured with main balance of £0.00, and overage
                            limit of 0. User is attached to the Account </li>

                        <li class="li">Create a loan entity IOU with following configuration: <ul class="ul" id="service_fee_update__ul_b2h_r34_tvb">
                                <li class="li">Loan amount = £3, activation fee = £0, and service fee = £
                                    0.45</li>

                            </ul>
<div class="fig fignone" id="service_fee_update__fig_ogq_1ms_tvb">
                                <img class="image break" id="service_fee_update__image_cgc_cms_tvb" height="288" src="../images/loan_iou_lp4.png" width="288" />
                            </div>
</li>

                        <li class="li">Account has a TPG with Absolute From Zero. Loan limit is used as the
                                threshold.<div class="fig fignone" id="service_fee_update__fig_ccl_cms_tvb">
                                <img class="image break" id="service_fee_update__image_cqh_dms_tvb" height="144" src="../images/account_has_tpg.png" width="576" />
                            </div>
</li>

                        <li class="li">Subscriber account is in initial loan state, and the subscriber does not
                            have a loan.<div class="fig fignone" id="service_fee_update__fig_swb_3ms_tvb">
                                <img class="image break" id="service_fee_update__image_tzd_jms_tvb" height="192" src="../images/initial_loan_state.png" width="576" />
                            </div>
</li>

                        <li class="li">Rule is configured in <em class="ph i">LOAN_PREPROCESSING_TRIGGER</em> to reject the
                            loan with custom data eligibility value as not eligible.<div class="fig fignone" id="service_fee_update__fig_uxz_gms_tvb">
                                <img class="image break" id="service_fee_update__image_jht_hms_tvb" height="288" src="../images/LoanPreProcessingRule1.png" width="576" />
                            </div>
</li>

                        <li class="li">Rule is configured in <em class="ph i">LOAN_POSTPROCESSING_TRIGGER</em> to send the
                            notification based on the loan operation. <div class="fig fignone" id="service_fee_update__fig_nvp_dms_tvb">
                                <img class="image break" id="service_fee_update__image_mpt_fms_tvb" height="288" src="../images/LoanPostProcessingRule1.png" width="576" />
                            </div>
</li>

                    </ol>
</div>
<div class="p"><strong class="ph b">Execution</strong>:<ol class="ol" id="service_fee_update__ul_zgq_sj4_tvb">
                        <li class="li">
                            <p class="p">Execute <em class="ph i">Opt-in</em> request through TMF API.</p>

                            <p class="p">Main balance is £ 0.00</p>

                            <p class="p"><strong class="ph b">Result</strong>: <em class="ph i">Opt-In</em> is successful with loan as main balance
                                of £ 3.00. Remaining debt is £ 3.45. Notification for loan
                                    <em class="ph i">Opt-In</em> is generated.</p>

                            <div class="fig fignone" id="service_fee_update__fig_gyj_14s_tvb">
                                <img class="image break" id="service_fee_update__image_lvj_pqs_tvb" height="192" src="../images/after_1st_opt_in.png" width="576" />
                            </div>

                        </li>

                        <li class="li">
                            <p class="p">Main balance of the account is £ 3.00. Update service fee from £ 0.45
                                to £ 0.75 in loan definition with <strong class="ph b">Update type</strong> =
                                    <em class="ph i">IMMEDIATELY</em>.</p>

                            <p class="p"><strong class="ph b">Result</strong>: Service is updated as £ 0.75. Remaining debt is £
                                3.75. </p>

                            <div class="fig fignone" id="service_fee_update__fig_aw1_qqs_tvb">
                                <img class="image break" id="service_fee_update__image_zmv_qqs_tvb" height="192" src="../images/update_service_fee.png" width="576" />
                            </div>

                        </li>

                        <li class="li">
                            <div class="p">Execute <em class="ph i">Opt-Out</em> request using TMF API. Main balance is £
                                    3.00.<div class="fig fignone" id="service_fee_update__fig_vdn_frs_tvb">
                                    <img class="image break" id="service_fee_update__image_wmy_hrs_tvb" height="288" src="../images/opt_out_api.png" width="480" />
                                </div>
</div>

                            <div class="p">After <em class="ph i">Opt-Out</em>, a notification is generated which includes the
                                updated service fee.<div class="fig fignone" id="service_fee_update__fig_b2r_f31_5vb">
                                    <img class="image break" id="service_fee_update__image_igh_g31_5vb" height="96" src="../images/noti_loan.PNG" width="576" />
                                </div>
</div>

                            <p class="p"><strong class="ph b">Result</strong>: Opt-Out is successful with no deduction of service fee
                                since loan is not used. Main balance is £ 0.00 after <em class="ph i">Opt-
                                Out</em>. Notification is sent for the <em class="ph i">Opt-out</em>.</p>

                            <div class="fig fignone" id="service_fee_update__fig_mvd_rqs_tvb">
                                <img class="image break" id="service_fee_update__image_jth_sqs_tvb" height="288" src="../images/after_opt_out.png" width="576" />
                            </div>

                        </li>

                        <li class="li">
                            <p class="p">Execute Opt-in Request again. Main balance is £ 0.00.</p>

                            <p class="p"><strong class="ph b">Result</strong>: <em class="ph i">Opt-In</em> is successful with loan as main balance
                                of £ 3.00. Remaining debt is £ 3.75. Notification for loan
                                    <em class="ph i">Opt-In</em> is generated.</p>

                            <div class="fig fignone" id="service_fee_update__fig_dt4_sqs_tvb">
                                <img class="image break" id="service_fee_update__image_bkh_tqs_tvb" height="288" src="../images/after_2nd_opt_in.png" width="576" />
                            </div>

                        </li>

                        <li class="li">
                            <p class="p">Main balance of the account is £ 3.00. A call is executed to consume
                                1 MB.</p>

                            <p class="p"><strong class="ph b">Result</strong>: Call is executed successfully. Main balance after call
                                consumption is £ 2.0. Loan usage notification is sent to
                                subscriber.</p>

                            <div class="fig fignone" id="service_fee_update__fig_nlq_tqs_tvb">
                                <img class="image break" id="service_fee_update__image_i5h_5qs_tvb" height="288" src="../images/call_consumption.png" width="576" />
                            </div>

                        </li>

                        <li class="li">
                            <p class="p">Execute a recharge with an amount of £ 5.0.</p>

                            <p class="p"><strong class="ph b">Result</strong>: Recharge is successful. Service fee of £ 0.75 is
                                applied as the loan has been used. As the loan is recurrent, the
                                remaining debt is £ 3.75. Main balance is £ 6.25.</p>

                            <div class="fig fignone" id="service_fee_update__fig_fs4_5qs_tvb">
                                <img class="image break" id="service_fee_update__image_mbp_vqs_tvb" height="288" src="../images/after_recharge.png" width="576" />
                            </div>

                        </li>

                    </ol>
</div>
</div>
            <div class="sectiondiv"><strong class="ph b">Use case 2: Loan service fee is updated with immediate effect. Service
                    fee is updated with <em class="ph i">Update type</em> set to <em class="ph i">IMMEDIATELY</em> after loan
                    usage.</strong><div class="p"><strong class="ph b">Configuration</strong>:<ol class="ol" id="service_fee_update__ul_ssq_kl4_tvb">
                        <li class="li"><em class="ph i">Device1</em> is configured with E164 as <var class="keyword varname">3677000011</var>.
                            A subscription is purchased by the device as <em class="ph i">Bundle1</em> with an
                            Account. User is attached to the device </li>

                        <li class="li">Account balance is configured with main balance of £0.00, and overage
                            limit of 0. User is attached to the Account </li>

                        <li class="li">Create a loan entity IOU with following Configuration: <ul class="ul" id="service_fee_update__ul_tsq_kl4_tvb">
                                <li class="li">Loan amount = £3, activation fee = £0, and service fee = £
                                    0.45</li>

                            </ul>
</li>

                        <li class="li">Account has a TPG with Absolute From Zero. Loan limit is used as the
                            threshold.</li>

                        <li class="li">Subscriber account is in initial loan state, and the subscriber does not
                            have a loan.</li>

                        <li class="li">Rule is configured in <em class="ph i">LOAN_PREPROCESSING_TRIGGER</em> to reject the
                            loan with custom data eligibility value as not eligible.</li>

                        <li class="li">Rule is configured in <em class="ph i">LOAN_POSTPROCESSING_TRIGGER</em> to send the
                            notification based on the loan operation. </li>

                    </ol>
</div>
<div class="p"><strong class="ph b">Execution</strong>:<ol class="ol" id="service_fee_update__ul_ccd_ll4_tvb">
                        <li class="li">
                            <p class="p">Execute <em class="ph i">Opt-in</em> request.</p>

                            <p class="p">Main balance is £1.00</p>

                            <p class="p"><strong class="ph b">Result</strong>: <em class="ph i">Opt-In</em> is successful with loan as main balance
                                of £ 4.00. Remaining debt is £ 3.45. Notification for loan
                                    <em class="ph i">Opt-In</em> is generated.</p>

                        </li>

                        <li class="li">
                            <p class="p">Main balance of the account is £4.00. A call is executed to consume
                                £1.20.</p>

                            <p class="p"><strong class="ph b">Result</strong>: Call is executed successfully. Main balance is £ 2.80.
                                Loan usage notification is sent to subscriber.</p>

                        </li>

                        <li class="li">Service fee is update from £ 0.45 to £ 0.75 in loan definition with
                                <strong class="ph b">Update type</strong> = <em class="ph i">IMMEDIATELY</em>.<p class="p"><strong class="ph b">Result</strong>: Service
                                fee is updated as £ 0.75. Remaining debt is £ 3.75. Main balance of
                                the account is £ 2.80.</p>
</li>

                        <li class="li">
                            <p class="p">Execute a recharge with amount as £ 5.0.</p>

                            <p class="p"><strong class="ph b">Result</strong>: Service fee of £ 0.75 is applied as the loan has been
                                used. As the loan is recurrent, the remaining debt is £ 3.75. Main
                                balance is £ 7.05.</p>

                        </li>

                        <li class="li">A call is executed for consuming £4.40.<p class="p"><strong class="ph b">Result</strong>: Call is
                                executed successfully. Main balance after call consumption is £
                                2.65. Loan usage notification is sent to subscriber.</p>
</li>

                        <li class="li">
                            <p class="p">Execute a recharge with an amount as £ 5.0.</p>

                            <p class="p"><strong class="ph b">Result</strong>: Recharge is successful. Service fee of £ 0.75 is
                                applied as the loan has been used. As the loan is recurrent, the
                                remaining debt is £ 3.75. Main balance is £ 6.9.</p>

                        </li>

                    </ol>
</div>
</div>
            <div class="sectiondiv"><strong class="ph b">Use Case 3: Correlation IDs in EDRs for loan reset through lifecycle
                    actions <em class="ph i">Reset Loan Action</em> and <em class="ph i">Reset Account
                        Action</em>.</strong><div class="p"><strong class="ph b">Configuration</strong>:<ol class="ol" id="service_fee_update__ul_pb2_gp4_tvb">
                        <li class="li"><em class="ph i">Device1</em> is configured with E164 as <var class="keyword varname">3677000011</var>.
                            A subscription is purchased by the device as <em class="ph i">Bundle1</em> with an
                            Account. User is attached to the device </li>

                        <li class="li">Account balance is configured with main balance of £0.00, and overage
                            limit of 0. User is attached to the Account </li>

                        <li class="li">Create a loan entity IOU with following Configuration: <ul class="ul" id="service_fee_update__ul_qb2_gp4_tvb">
                                <li class="li">Loan amount = £3, activation fee = £0, and service fee = £
                                    0.45</li>

                            </ul>
</li>

                        <li class="li">Account has a TPG with Absolute From Zero. Loan limit is used as the
                            threshold.</li>

                        <li class="li">Account ahas a PLC attached with reset event. Reset event is configured
                            with lifecycle actions <em class="ph i">Reset Account Action</em>,<em class="ph i">Reset Loan
                                Action</em> and <em class="ph i">Send Notification</em> action.</li>

                        <li class="li">Subscriber account is in initial loan state, and the subscriber does not
                            have a loan.</li>

                        <li class="li">Rule is configured in <em class="ph i">LOAN_PREPROCESSING_TRIGGER</em> to reject the
                            loan with custom data eligibility value as not eligible.</li>

                        <li class="li">Rule is configured in <em class="ph i">LOAN_POSTPROCESSING_TRIGGER</em> to send the
                            notification based on the loan operation. </li>

                    </ol>
</div>
<div class="p"><strong class="ph b">Execution</strong>:<ol class="ol" id="service_fee_update__ul_n1y_mp4_tvb">
                        <li class="li">
                            <p class="p">Execute <em class="ph i">Opt-in</em> request.</p>

                            <p class="p">Main balance is £1.00</p>

                            <p class="p"><strong class="ph b">Result</strong>: <em class="ph i">Opt-In</em> is successful with loan as main balance
                                of £ 4.00. Remaining debt is £ 3.45. Notification for loan
                                    <em class="ph i">Opt-In</em> is generated.</p>

                        </li>

                        <li class="li">
                            <p class="p">Main balance of the account is £4.00. A call is executed to consume
                                £1.20.</p>

                            <p class="p"><strong class="ph b">Result</strong>: Call is executed successfully. Main balance is £ 2.80.
                                Loan usage notification is sent to subscriber.</p>

                        </li>

                        <li class="li">Reset event defined in Account PLC is triggered.<p class="p"><strong class="ph b">Result</strong>:
                                    <em class="ph i">Reset Account Action</em> is triggered with reset value as 0.
                                    <em class="ph i">Reset Loan Action</em> is triggered. <em class="ph i">Send Notification</em>
                                is triggered for reset. Main balance of the subscriber is £ 0, and
                                the remaining debt is cleared.</p>
<p class="p">Correlation identifier is
                                generated in the EDRs for lifecycle actions <em class="ph i">Reset Loan Action</em>
                                and <em class="ph i">Reset Account Action</em>. It is common in EDRs generated for
                                both the actions.</p>
</li>

                    </ol>
</div>
</div>
        </div>

    </div>
<div class="footer"><hr /><p>Charging User Guide • P556766-DN1000054947-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>