<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="topic" />
<meta name="DC.title" content="Mobile number portability" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="ims_charging_mobile_number_portability_support" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Mobile number portability</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="ims_charging_mobile_number_portability_support">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Mobile number portability</h1>
<div class="body">
<p class="p">The <span class="ph uicontrol">CALL_COMMON.Number-Portability-Routing-Information</span> source context attribute provides support for the Mobile Number Portability (MNP) function for IMS, SMS, and MMS calls.</p>

<p class="p">Number portability attribute in <em class="ph i">CALL_COMMON</em> source context is available for the following triggers:</p>
<ul class="ul">
<li class="li"><em class="ph i">APPLICABILITY</em></li>

<li class="li"><em class="ph i">TARIFF</em></li>

<li class="li"><em class="ph i">THRESHOLD</em></li>

</ul>

<p class="p">The value of this attribute is read from the <em class="ph i">Service-Information &gt; IMS-Information &gt; Number-Portability-Routing-Information</em> AVP, and is used without formatting.</p>

<div class="p">Following is an example rule for charging based on number portability.<div class="fig fignone">
<pre class="pre codeblock"><code>if
    CALL_COMMON.Number-Portability-Routing-Information = "33333"
then 
    RATING.No-Charge</code></pre>
</div>
</div>

		<div class="section" id="ims_charging_mobile_number_portability_support__section_ifj_ply_v4b"><h2 class="title sectiontitle">Number portability entity</h2><p class="p">The
			<strong class="ph b">NumberPortability</strong> entity (MNP database) supports the MNP data. This entity can
				be created only using REST API and there is no GUI for this entity. The entity is
				available in dsc namespace at SM and dsclocal at ME.</p>
<p class="p">Following are the
				parameters of this entity:</p>
<ul class="ul" id="ims_charging_mobile_number_portability_support__ul_d4b_1my_v4b">
				<li class="li">routingNumber: Mandatory field<div class="note" id="ims_charging_mobile_number_portability_support__note_n5l_lfw_nvb"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> If this field has a
						rule variable, which gets filled during the call, then it may be null in
						some scenarios (for example, when no value is available from the network).
						To avoid error, it is recommended to use a not-null check as shown in the
						following
						example:<pre class="pre codeblock" id="ims_charging_mobile_number_portability_support__codeblock_qs5_jpx_nvb"><code>CONVERSION.Length-Of-String ( VARIABLES.Get-Variable ("GE164DestinationNumber" ) ) &gt; 0 and 
SPR_GROUP.Group-Name = NUMBER_PORTABILITY.Get-Value ( VARIABLES.Get-Variable ("GE164DestinationNumber"), 3)
3 )</code></pre></div>
</li>

				<li class="li">Info1: Optional field</li>

				<li class="li">Info2: Optional field</li>

				<li class="li">Info3: Optional field</li>

				<li class="li">Info4: Optional field</li>

			</ul>
<div class="note notice"><div class="noticetitle"><img src="../../web/css/../images/notice.svg" title="notice-icon" class="noteicon" />Notice:</div> Consult dimensioning team before using the MNP database.</div>Following APIs are available:<ul class="ul" id="ims_charging_mobile_number_portability_support__ul_f3k_fmy_v4b">
				<li class="li"><strong class="ph b">create</strong>: This API creates a single MNP record at a time if the record
					doesn't exist.</li>

				<li class="li"><strong class="ph b">update</strong>: This API updates a single MNP record at a time if the record
					exists.</li>

				<li class="li"><strong class="ph b">get</strong>: This API retrieves a record based on the routing number.</li>

				<li class="li"><strong class="ph b">delete</strong>: This API deletes a record based on the given routing number if it
					exists</li>

				<li class="li"><strong class="ph b">bulkadd</strong>: This API adds multiple records at a time.</li>

				<li class="li"><strong class="ph b">bulkaddandprovision</strong>: This API adds multiple records and provision records
					at MEs that are provided in the distList parameter.</li>

				<li class="li"><strong class="ph b">bulkprovision</strong>: This API distributes the records at MEs that are provided
					in the <em class="ph i">distList</em> parameter.</li>

				<li class="li"><strong class="ph b">bulkunprovision</strong>: This API removes records at MEs that are provided in the
						<em class="ph i">deleteDistList</em> parameter.</li>

				<li class="li"><strong class="ph b">bulkdelete</strong>: This API removes records in bulk. The records provisioned at
					MEs are removed automatically and once successful, the records get deleted from
					SM.</li>

			</ul>
<p class="p">To export the records of the NumberPortability entity, use db-list tool as
				follows:</p>
<div class="p">
				<pre class="pre codeblock"><code>db-list -l numberPortability</code></pre>
			</div>
<p class="p">To import, use <code class="ph codeph">bulkaddandprovision</code> API and create bulk records
				in a single call.</p>
<p class="p">To provision for the first time, use the bulkadd and
				bulkprovision APIs. </p>
</div>

		<div class="section" id="ims_charging_mobile_number_portability_support__section_hdw_xkc_xrb"><h2 class="title sectiontitle">Redirecting (non-NR) charging sessions to external
			OCS</h2><p class="p">Using the number portability entity (MNP database), operators can configure
				to redirect the (non-NR) Charging Sessions to an external OCS. Routing of charging
				signals (CCR-I, CCR-U, CCR-T) is done based on the information available in MNP
				table. Following configurations are required to enable this:</p>
<ul class="ul" id="ims_charging_mobile_number_portability_support__ul_avs_1vc_xrb">
				<li class="li">Set the application preference <em class="ph i">Dual Running Mode</em> to 3.</li>

				<li class="li">Fill the routingNumber and Info1 of number portability entity as described in
					the following table. The fields Info2, Info3, Info4 can be empty.</li>

			</ul>
<table cellpadding="4" cellspacing="0" summary="" id="ims_charging_mobile_number_portability_support__table_kf1_n4c_xrb" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap"><span class="table--title-label">Table: </span>MNP table</span></caption><colgroup><col style="width:17.391304347826086%" /><col style="width:32.52173913043478%" /><col style="width:50.086956521739125%" /></colgroup><thead class="thead" style="text-align:left;">
						<tr class="row">
							<th class="entry cellrowborder" style="vertical-align:top;" id="d95692e202">Record number</th>

							<th class="entry cellrowborder" style="vertical-align:top;" id="d95692e205">routingNumber</th>

							<th class="entry cellrowborder" style="vertical-align:top;" id="d95692e208">Info1</th>

						</tr>

					</thead>
<tbody class="tbody">
						<tr class="row">
							<td class="entry cellrowborder" style="vertical-align:top;" headers="d95692e202 ">1</td>

							<td class="entry cellrowborder" style="vertical-align:top;" headers="d95692e205 ">Subscriber's MSISDN.</td>

							<td class="entry cellrowborder" style="vertical-align:top;" headers="d95692e208 ">Provide a unique ID (string). This unique ID is then used to
								create another record in the table. It must have integer values
								restricted from 0 to 99.</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="vertical-align:top;" headers="d95692e202 ">2</td>

							<td class="entry cellrowborder" style="vertical-align:top;" headers="d95692e205 ">Provide the unique ID provided in <strong class="ph b">Info1</strong> of record
								1.</td>

							<td class="entry cellrowborder" style="vertical-align:top;" headers="d95692e208 ">Provide the service provider ID, the realm, hosts (up to 10)
								separated with comma and space characters.</td>

						</tr>

					</tbody>
</table>
Multiple pairs of such info can be created in the MNP table. However, ensure
			that the Info1 provided for all subscriber MSISDNs have a corresponding entry (only one)
			in the routingNumber column available in the table.<table cellpadding="4" cellspacing="0" summary="" id="ims_charging_mobile_number_portability_support__table_abh_lrc_xrb" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap"><span class="table--title-label">Table: </span>Example MNP table</span></caption><colgroup><col style="width:19.37984496124031%" /><col style="width:22.480620155038757%" /><col style="width:58.139534883720934%" /></colgroup><thead class="thead" style="text-align:left;">
						<tr class="row">
							<th class="entry cellrowborder" style="vertical-align:top;" id="d95692e262">Record number</th>

							<th class="entry cellrowborder" style="vertical-align:top;" id="d95692e265">routingNumber</th>

							<th class="entry cellrowborder" style="vertical-align:top;" id="d95692e268">Info1</th>

						</tr>

					</thead>
<tbody class="tbody">
						<tr class="row">
							<td class="entry cellrowborder" style="vertical-align:top;" headers="d95692e262 ">1</td>

							<td class="entry cellrowborder" style="vertical-align:top;" headers="d95692e265 ">123465748</td>

							<td class="entry cellrowborder" style="vertical-align:top;" headers="d95692e268 ">1</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="vertical-align:top;" headers="d95692e262 ">2</td>

							<td class="entry cellrowborder" style="vertical-align:top;" headers="d95692e265 ">1</td>

							<td class="entry cellrowborder" style="vertical-align:top;" headers="d95692e268 ">Xphone, realm1, ncc-me1.realm1, host2</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="vertical-align:top;" headers="d95692e262 ">3</td>

							<td class="entry cellrowborder" style="vertical-align:top;" headers="d95692e265 ">762587364576</td>

							<td class="entry cellrowborder" style="vertical-align:top;" headers="d95692e268 ">2</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="vertical-align:top;" headers="d95692e262 ">4</td>

							<td class="entry cellrowborder" style="vertical-align:top;" headers="d95692e265 ">2</td>

							<td class="entry cellrowborder" style="vertical-align:top;" headers="d95692e268 ">Yphone, realm2, host99, host98, host97</td>

						</tr>

					</tbody>
</table>
</div>

		<p class="p">Where Xphone and Yphone are examples of service provider names.</p>

<div class="section" id="ims_charging_mobile_number_portability_support__section_nxx_ydf_5nb"><h2 class="title sectiontitle">Routing number support</h2>
			
			<p class="p">If Recipient-Address/Address-Domain/Domain-Name AVP is present, then content of
				Domain-Name is used to impact rating.</p>

			<p class="p">Else if Recipient-Address/Address-Domain/3GPP-IMSI-MCC-MNC AVP is present, then
				content of 3GPP-IMSI-MCC-MNC AVP is used to impact rating.</p>

			<p class="p">For certain operators, the recepient address is obtained from Recipient-Info AVP
				under MMS-Information.</p>

			<p class="p">The <span class="ph uicontrol">CALL_COMMON.Routing-Number</span> condition is used to fetch the routing
				number. NCC takes the value of routing number from the following AVPs and it is also
				used to fill the CDR tag of number portability routing number. For MO-SMS/MMS call,
				if the Recipient-Address/Address-Domain/Domain-Name AVP is present, then content of
				Domain-Name is used. Else if the Recipient-Address/Address-Domain/3GPP-IMSI-MCC-MNC
				AVP is present then content of 3GPP-IMSI-MCC-MNC AVP is used. Otherwise, the
				following existing behavior is used:</p>

			<ul class="ul" id="ims_charging_mobile_number_portability_support__ul_oxx_ydf_5nb">
				<li class="li">
					<p class="p">For SMS call:
							<em class="ph i">Service-Information/SMS-Information/Recipients/Recipient-Address/Address-Data</em>
					</p>

				</li>

				<li class="li">
					<p class="p">For MMS call:
							<em class="ph i">Service-Information/MMS-Information/Recipient-Address/Address-Data</em>
					</p>

				</li>

				<li class="li">
					<p class="p">For IMS call: <em class="ph i">Service-Information/IMS-Information/Called-Party-Addres</em>
					</p>

				</li>

			</ul>

			<p class="p"><strong class="ph b">Assumption:</strong> The Recipient-Address AVP may appear multiple times. Only the
				first Recipient-Address AVP Number Portability is checked. For
				Recipient-Address/Address-Domain/Domain-Name and
				Recipient-Address/Address-Domain/3GPP-IMSI-MCC-MNC AVP, the number is obtained
				directly without checking the RN parameter (remove prefix ‘+’, remove realm). </p>

			<p class="p">Following are some examples of parsing with the
					<span class="ph uicontrol">CALL_COMMON.Routing-Number</span> attribute:</p>

			<table cellpadding="4" cellspacing="0" summary="" id="ims_charging_mobile_number_portability_support__table_pxx_ydf_5nb" class="table" frame="border" border="1" rules="all"><colgroup><col /><col /></colgroup><thead class="thead" style="text-align:left;">
						<tr class="row">
							<th class="entry cellrowborder" style="vertical-align:top;" id="d95692e403">Input</th>

							<th class="entry cellrowborder" style="vertical-align:top;" id="d95692e406">Output routing number</th>

						</tr>

					</thead>
<tbody class="tbody">
						<tr class="row">
							<td class="entry cellrowborder" style="vertical-align:top;" headers="d95692e403 ">tel:+123610606025;npdi;rn=+12025440000;user=phone</td>

							<td class="entry cellrowborder" style="vertical-align:top;" headers="d95692e406 ">12025440000</td>

						</tr>

						<tr class="row">
							<td class="entry cellrowborder" style="vertical-align:top;" headers="d95692e403 ">
								sip:+917723000006;npdi;rn=1237@ims.mnc872.mcc405.3gppnetwork.org;user=phone</td>

							<td class="entry cellrowborder" style="vertical-align:top;" headers="d95692e406 ">1237</td>

						</tr>

					</tbody>
</table>

			<p class="p"><strong class="ph b">Rule configuration example for MO-SMS/MMS calls</strong></p>

			<p class="p">The rule variable is required to determine call sub-type since only MO call is
				supported when checking the Routing number. </p>

			<img class="image break" id="ims_charging_mobile_number_portability_support__image_a24_xqw_vmb" height="288" src="../images/routing_number1.png" width="576" />
			
			<img class="image break" id="ims_charging_mobile_number_portability_support__image_uhp_yqw_vmb" height="192" src="../images/routing_number2.png" width="384" />
			<p class="p">The routing number is obtained from SMS_CALL_ESTABLISHMENT and MMS_CALL_ESTABLISHMENT
				triggers.</p>

			<img class="image break" id="ims_charging_mobile_number_portability_support__image_bqj_rrw_vmb" height="288" src="../images/routing_number3.png" width="576" />
			
			<img class="image break" id="ims_charging_mobile_number_portability_support__image_byg_srw_vmb" height="288" src="../images/routing_number4.png" width="576" />
			<img class="image break" id="ims_charging_mobile_number_portability_support__image_kqb_wd5_cyb" height="192" src="../images/routing_number5.PNG" width="384" />
			<p class="p">The routing number information for number portability can be within any of the
				following AVPs under IMS-Information in the order of priority: </p>

			<ol class="ol" id="ims_charging_mobile_number_portability_support__ol_ch4_j1r_tnb">
				<li class="li">Number-Portability-Routing-Information: This is used to determine the routing
					number.</li>

				<li class="li">If the Number-Portability-Routing-Information is not present, then the
					Called-Party-Address or Application-Provided-Called-Party-Address AVP is used to
					determine the routing nunber. Firstly, obtain the value from rn tagging
					(rn=xxx), then get the number between ‘+’ and the last character till you
					encounter ‘@’ sign or ‘;’. This is used for actual MNP number.</li>

				<li class="li">If both the Called-Party-Address and Application-Provided-Called-Party-Address
					contains rn parameter, then Called-Party-Address has higher priority.</li>

				<li class="li">If the routing number cannot be determined, then the existing NCC behavior is
					followed.</li>

			</ol>

		</div>

		<div class="example">Example of Called-Party-Address:
				sip:+353870999128;npdi;rn=+35317687@<u class="ph u">ims.vendorname.ie</u>;user=phone</div>

		<p class="p"><strong class="ph b">Rule Configuration example:</strong></p>

		<div class="p">
			<img class="image break" id="ims_charging_mobile_number_portability_support__image_jl4_bdr_tnb" height="288" src="../images/rn_rule_configuration.png" width="576" />
		</div>

</div>
<div class="footer"><hr /><p>Charging User Guide • P556766-DN1000054947-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>