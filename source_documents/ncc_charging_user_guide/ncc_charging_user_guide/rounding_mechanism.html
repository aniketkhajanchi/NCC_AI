<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Configuring rounding mechanism at rate level" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="rounding_mechanism" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Configuring rounding mechanism at rate level</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="rounding_mechanism">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Configuring rounding mechanism at rate level</h1>
<div class="body conbody">
        <p class="p">This feature provides a new rounding mechanism to charge the calls with a configurable
            rate rounding factor at Global or Tariff Rate level. This cost rounding is applicable
            only for monetary resources (that is, main balance and money buckets). This rounding
            mechanism is over and above the existing NCC rounding mechanisms for calculation
            precision and database precision (defined in the application preferences <em class="ph i">Calculation
                Precision</em> and <em class="ph i">DB_PRECISION</em>, see <a class="xref" href="system_pref.html">Charging application preferences</a> for details).</p>

        <p class="p">The cost is rounded to the next decimal place based on the configured rate rounding
            factor (according to the current round-up rounding mechanism, that is
                <var class="keyword varname">CEIL</var>). The tax/discount is applied first to the rate cost, and
            the calculation precision/database precision rounding is performed. After this, the new
            rounding mechanism is applied to round the total call cost (including tax, discount,
            calculation, and database precision).</p>

        <p class="p">The rate rounding factor is applicable only to the cost computed by the rate applied for
                <var class="keyword varname">ON-CALL</var> consumption/deductions. It is not applied on any other
            NCC entities, cost deductions like CC_MONEY/External-Internal REST
            APIs/External-Cost/BOU, or Step Fees, if used for deductions on monetary balance. The
            cost computed for a specific CCR is rounded using the rounding mechanism, and the delta
            cost is adjusted in the next CCR request. The delta cost is adjusted in all the upcoming
            requests till the end of the call. There may be some delta adjustment loss (overcharge)
            in the terminate request due to rate rounding in the previous requests.</p>

        <p class="p">The cost-rounding mechanism is applicable to Voice/VoLTE calls only. It is not applicable
            for Data, SMS, MMS, and 5G calls although there is no change in the existing usage-based
            rounding mechanism. </p>

        <p class="p">When the rate rounding mechanism is applied on spending limit, the rounded cost is
            considered for quota allocation. When rate rounding mechanism is applied with TTC, the
            USU_Before (TTC) is charged according to the new rounding mechanism, and if there is any
            remaining delta cost, then that is used for computation of USU_AFTER (TTC) commit.</p>

        <div class="section" id="rounding_mechanism__section_pq1_cbs_1rb"><h2 class="title sectiontitle">Important points</h2>
            
            <ul class="ul" id="rounding_mechanism__ul_y3t_bxv_zqb">
                <li class="li">Cost rounding is applicable over the tax, discount, database precision, and
                    calculation precision.</li>

                <li class="li">Cost rounding is applicable for the monetary resources (money bucket, or main
                    balance).</li>

                <li class="li">To apply the cost-rounding mechanism on the monetary resource, the monetary
                    balance should have the same decimal precision as the configured rate rounding
                    factor. For example, if <em class="ph i">DB_PRECISION</em> is 5, the rounding mechanism is
                        <var class="keyword varname">CEIL</var>, available balance = 2.33745, and the configured
                    rate rounding factor is 0.01, then the account balance considered for the cost
                    calculated by NCC with this cost-rounding mechanism is 2.33, considered up to
                    2nd decimal place with floor rounding. This is done to avoid any ambiguities in
                    the monetary balance utilization.</li>

                <li class="li">If spending limit is applied with soft stop condition (that is,
                        <var class="keyword varname">Notification-Stop</var> action is applied in threshold), and if
                    the delta cost is remaining, that delta cost is used because user has already
                    paid this delta cost on reaching this soft-stop condition and moving to the next
                    resource.</li>

                <li class="li">If spending limit is applied with hard stop condition (that is,
                        <var class="keyword varname">Notification-Reject/Reject</var> action is applied in
                    threshold), and if there is any delta cost remaining, then that delta cost is
                    not used.</li>

                <li class="li">For call consumption when NCC charging mechanism moves to next resource, before
                    switching to next resource for further reservation, delta cost of previous
                    committed resource (if any) is consumed first, and then remaining quantities are
                    charged from the next available resource.</li>

                <li class="li">If TTC (TTC not supported by client/TTC supported by client) is triggered due to
                    the BCR of the resource that is being consumed in the call, then the
                        <var class="keyword varname">USU_Before</var> (TTC) is charged as per the new rounding
                    mechanism. If there is any remaining delta cost then that is used for the
                    computation of <var class="keyword varname">USU_After</var> (TTC) commit.</li>

                <li class="li">For <var class="keyword varname">Threshold-Rate</var>/<var class="keyword varname">Threshold-Next-Rate</var>, if
                    the threshold is crossed, then the delta cost calculated from the rate
                    configured in the previous threshold is used in the next threshold rate
                    calculations.</li>

                <li class="li">Rate rounding factor is applied individually to the cost computed by the primary
                    rate and secondary rate. Currently, the shared resources are not supported in
                    split charging.</li>

                <li class="li">When the cost-rounding mechanism is applied at Global level for a set of
                    subscribers/devices, then all the associated monetary resources of that device
                    are deducted with the rounded cost of the call usage as per the global rate
                    rounding factor. For example, if the device has purchased two subscriptions from
                    two separate accounts (account balance), if based on device custom data the rate
                    rounding factor is applied globally, then it is applicable for the call usage
                    deduction for both the accounts/monetary buckets.</li>

                <li class="li">When the cost-rounding mechanism is applied at tariff rate level, for a set of
                    subscribers/devices purchasing the subscription that contains that tariff rate,
                    the rate rounding configuration applies the rate rounded cost according to the
                    rate rounding factor to its applied monetary resources.</li>

                <li class="li">It is not recommended to configure the rate rounding factor at both Global and
                    Tariff level. Configure it either at <var class="keyword varname">GY_PRE_PROCESSING</var>
                    (Global) or Tariff level.</li>

                <li class="li">When rate rounding factor is defined at Global level, its configuration is
                    common for all MSCCs in the same request.</li>

            </ul>

            <div class="note caution"><div class="cautiontitle"><img src="../../web/css/../images/caution.svg" title="caution-icon" class="noteicon" />CAUTION:</div> It is not recommended to change the rate rounding factor for the
                devices/subscribers (for example, database Precision, Calculation Precision, Rounding
                Mechanism) applied globally or at tariff rate level, because it impacts the monetary
                consumptions for the ongoing cost calculations for that particular device. If it is
                changed during ongoing calls for the applied devices, it results in precision lost
                credit scenarios for the subscribers/devices.</div>

        </div>

        <div class="section" id="rounding_mechanism__section_nht_sjk_1rb"><h2 class="title sectiontitle">Configuration</h2>
            
            <p class="p">This section describes the rate rounding factor configuration and its
                applicability:</p>

            <ul class="ul" id="rounding_mechanism__ul_fxx_lvq_1rb">
                <li class="li">The rate rounding factor can be configured at the Global level (Charging RSV) or
                    a specific rate level (Tariff) plan.</li>

                <li class="li">The rate rounding factor can be applied in the following triggers.<div class="p"><ul class="ul" id="rounding_mechanism__ul_gxx_lvq_1rb">
                            <li class="li">Tariff rule</li>

                            <li class="li">Charging RSV: <em class="ph i">GY_PRE_PROCESSING</em> trigger rule</li>

                            <li class="li">Charging RSV: <em class="ph i">GY_CREDIT_REQUEST</em> trigger rule</li>

                        </ul>
It is recommended to apply it in only one of the trigger
                    points.</div>
</li>

                <li class="li">If applied for multiple triggers (Global/Tariff), preference is given in the
                    order: Tariff &gt; Gy_Pre_Processing &gt; Gy_Credit_Request.</li>

                <li class="li">For rate rounding to be applicable on monetary resource (main balance or money
                    buckets), the tariff rule should have at least one of the following actions:<ul class="ul" id="rounding_mechanism__ul_vjv_lwq_1rb">
                        <li class="li">Rate</li>

                        <li class="li">Next-Rate</li>

                        <li class="li">Threshold-Rate</li>

                        <li class="li">Threshold-Next-Rate</li>

                    </ul>
</li>

                <li class="li">When the rate rounding factor is defined at Global level, its configuration is
                    common for all the MSCCs in the same request.</li>

                <li class="li">In split charging scenarios, if applied with primary and secondary resources,
                    the rate rounding factor configuration is common for both the resources.</li>

                <li class="li">If the rate rounding factor is defined as a negative value, 0, or less than the
                    database precision/calculation precision (application preferences
                        <em class="ph i">DB_PRECISION</em> and <em class="ph i">Calculation Precision</em>), then it is ignored,
                    and the feature is disabled. <p class="p">For example: If <em class="ph i">DB_PRECISION</em> = 2 (that
                        is, 1/100 = 0.01) and <em class="ph i">Calculation Precision</em> = 5 (that is, 1/100000 =
                        0.00001), then the rate rounding factor should be greater than or equal to
                        0.01. </p>
<p class="p">Examples of rate rounding factor: 0.5, 0.05, 0.1, or
                    0.01.</p>
</li>

            </ul>

            <div class="sectiondiv"><strong class="ph b">Rule configuration</strong></div>
            <div class="p"><strong class="ph b">Charging Logic: Canvas mode</strong><div class="fig fignone" id="rounding_mechanism__fig_hxw_4dt_1rb">
                    <img class="image break" id="rounding_mechanism__image_isy_psr_1rb" height="192" src="../images/rm_config1.png" width="576" />
                </div>
</div>

            <div class="p"><strong class="ph b">Charging logic: Code mode</strong><div class="fig fignone" id="rounding_mechanism__fig_y5c_pdt_1rb">
                    <img class="image break" id="rounding_mechanism__image_rh2_rsr_1rb" height="96" src="../images/rm_config2.png" width="576" />
                </div>
</div>

            <div class="p"><strong class="ph b">Charging RSV: GY_PRE_PROCESSING trigger</strong><div class="fig fignone" id="rounding_mechanism__fig_iqh_pdt_1rb">
                    <img class="image break" id="rounding_mechanism__image_xbx_rsr_1rb" height="96" src="../images/rm_config3.png" width="576" />
                </div>
</div>

            <div class="p"><strong class="ph b">Charging RSV: GY_CREDIT_REQUEST trigger</strong><div class="fig fignone" id="rounding_mechanism__fig_hx4_pdt_1rb">
                    <img class="image break" id="rounding_mechanism__image_klv_ssr_1rb" height="96" src="../images/rm_config4.png" width="576" />
                </div>
</div>

            <p class="p"><strong class="ph b">Application preference for skipping granularity</strong></p>

            <p class="p">To consume monetary resources completely before switching to next resource, set the
                application preference <em class="ph i">GRANULARITY SKIP FOR LOW BALANCE</em> to
                    <var class="keyword varname">true</var> as follows:</p>

            <div class="fig fignone" id="rounding_mechanism__fig_zj1_tjt_1rb">
                <img class="image break" id="rounding_mechanism__image_wwf_5jt_1rb" src="../images/granularity_app_pref.jpg" />
            </div>

            <div class="sectiondiv"><strong class="ph b">Formula used for calculating cost rounding</strong><div class="p">Consider
                        <em class="ph i">NCC_Current_Cost</em> computed from the rate configuration (including tax,
                    discount, calculation, and database precision).<ol class="ol" id="rounding_mechanism__ul_hvv_pwv_zqb">
                        <li class="li">NumberOfSteps = NCC_Current_Cost/ RateRoundingFactor. The result is
                            rounded up to next integer</li>

                        <li class="li">Final Rounded Cost = NumberOfSteps ✕ RateRoundingFactor.</li>

                    </ol>
</div>
</div>
        </div>

        <div class="section" id="rounding_mechanism__section_nql_1bs_1rb"><h2 class="title sectiontitle">Examples</h2>
            
            <p class="p"><strong class="ph b">Example 1: When the rate rounding factor is applied at Global level</strong></p>

            <div class="p"><strong class="ph b">Configuration</strong><ul class="ul" id="rounding_mechanism__ul_u2r_kpq_1rb">
                    <li class="li">Rate configuration<ul class="ul" id="rounding_mechanism__ul_ytb_lpq_1rb">
                            <li class="li">Connection cost = 0.02</li>

                            <li class="li">Charging step1: cost = 0.55; duration = 60; granularity = 0;
                                quantity = 1; stepType = FIXED_COST</li>

                            <li class="li">Charging step2: cost = 0.55; duration = 0; granularity = 0; quantity
                                = 60; stepType = NORMAL</li>

                        </ul>
</li>

                    <li class="li">Define rate rounding factor as 0.1 in the
                            <var class="keyword varname">Gy_PRE_PROCESSING</var> trigger in RSV.</li>

                    <li class="li">Charging from main balance/monetary buckets.</li>

                </ul>
</div>

            <p class="p"><strong class="ph b">Call consumption</strong></p>

            <ol class="ol" id="rounding_mechanism__ol_zzn_rnt_1rb">
                <li class="li">CCR (I) RSU = 60<ul class="ul" id="rounding_mechanism__ul_kt2_5nt_1rb">
                        <li class="li">NCC Cost = 0.02 + 0.55 = 0.57</li>

                        <li class="li">NumberOfSteps = 0.57/0.1 = 5.7 (rounded to 6)</li>

                        <li class="li">RoundedCost = 6 ✕ 0.1 = 0.6</li>

                        <li class="li">Delta Cost = 0.6 – 0.57 = 0.03</li>

                    </ul>
</li>

                <li class="li">CCR (U): USU = 60 =&gt; 0.6 committed<ul class="ul" id="rounding_mechanism__ul_rgl_wnt_1rb">
                        <li class="li">RSU = 60: Adjust delta cost from previous request = 0.03</li>

                        <li class="li">NCC Cost = (60 ✕ 0.55)/60 = 0.55</li>

                        <li class="li">Cost after adjustments = 0.55 – 0.03 = 0.52</li>

                        <li class="li">Apply cost rounding formula on 0.52. The result is 0.6. </li>

                        <li class="li">New delta = 0.6 – 0.52 = 0.08</li>

                    </ul>
</li>

                <li class="li">CCR(T): USU = 60 =&gt; 0.6 committed from resource. <ul class="ul" id="rounding_mechanism__ul_vbx_xnt_1rb">
                        <li class="li">Final delta cost at the end of call is 0.08.</li>

                    </ul>
</li>

            </ol>

            <p class="p"><strong class="ph b">Example 2: When the rate rounding factor is applied at Tariff Rate level</strong></p>

            <div class="p"><strong class="ph b">Configuration</strong><ul class="ul" id="rounding_mechanism__ul_cyj_45q_1rb">
                    <li class="li">Rate configuration<ul class="ul" id="rounding_mechanism__ul_d33_v5q_1rb">
                            <li class="li">Connection cost = 1</li>

                            <li class="li">Charging step: cost = 1.2; duration = 0; granularity = 1;
                                quantity=60; stepType = NORMAL</li>

                        </ul>
</li>

                    <li class="li">Define rate rounding factor as 0.5 in tariff rule.</li>

                    <li class="li">Charging from main balance/monetary buckets.</li>

                </ul>
</div>

            <div class="p"><strong class="ph b">Call consumption</strong><ol class="ol" id="rounding_mechanism__ol_uxj_45q_1rb">
                    <li class="li">CCR (I) RSU = 60<ul class="ul" id="rounding_mechanism__ul_kkq_14t_1rb">
                            <li class="li">NCC Cost = 1+ (1.2 ✕ 60/60) = 2.2</li>

                            <li class="li">NumberOfSteps = 2.2/0.5 = 4.4 (rounded to 5)</li>

                            <li class="li">RoundedCost = 5 ✕ 0.5 = 2.5</li>

                            <li class="li">Delta Cost = 2.5 – 2.2 = 0.3</li>

                        </ul>
</li>

                    <li class="li">CCR (U): USU = 60 =&gt; 2.5 committed<ul class="ul" id="rounding_mechanism__ul_ldk_b4t_1rb">
                            <li class="li">RSU = 60: Adjust delta cost from previous request = 0.3</li>

                            <li class="li">NCC Cost = 60 ✕ 1.2/60 = 1.2</li>

                            <li class="li">Cost after adjustments = 1.2 – 0.3 = 0.9</li>

                            <li class="li">Apply cost rounding formula on 0.9. The result is 1.</li>

                            <li class="li">New delta = 1 – 0.9 = 0.1</li>

                        </ul>
</li>

                    <li class="li">CCR(T): USU = 60 =&gt; 1 committed from resource. <ul class="ul" id="rounding_mechanism__ul_z4t_b4t_1rb">
                            <li class="li">Final delta cost at the end of call is 0.1.</li>

                        </ul>
</li>

                </ol>
</div>

        </div>

    </div>
<div class="footer"><hr /><p>Charging User Guide • P556766-DN1000054947-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>