<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="eCommerce charging APIs" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="id9yz-09126-ug01-pczza-sp1-d1e197602" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>eCommerce charging APIs</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="id9yz-09126-ug01-pczza-sp1-d1e197602">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">eCommerce charging APIs</h1>
<div class="body conbody">
<div class="section">
<p class="p">This feature enables NCC to handle eCommerce rating and charging transactions through HTTP or
                HTTP2 APIs as shown in the following figure:</p>

<div class="fig fignone">
        <img class="image break" src="../images/img9yz-09126-ug01-pczza-sp1-ecommerce_api_framework_default.png" />
      </div>

<p class="p">The HTTP or HTTP2 requests allow conditional charging to be applied based on different parameters, such as <em class="ph i">Merchant ID</em> or <em class="ph i">Call Type</em>. An EDR is generated for an eCommerce API request.</p>

<p class="p">Following parameters are used as conditions in tariff rules or in applicability conditions of counters or charging services to perform conditional charging:</p>
<ul class="ul">
<li class="li">
<p class="p">
<em class="ph i">Merchant ID</em>: This indicates the identifier for a merchant or service provider.</p>

</li>

<li class="li">
<p class="p">
            <em class="ph i">Traffic Type</em>: This indicates the type of traffic used for identifying and
            allowing throttling scenarios.</p>

</li>

<li class="li">
<p class="p">
<em class="ph i">Call Type</em>: This indicates the <var class="keyword varname">E-Commerce</var> call type for eCommerce APIs. The same value is used in applicability conditions or tariff formula as required to differentiate eCommerce calls from other Diameter calls.</p>

</li>

</ul>

<div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> <ol class="ol">
<li class="li">
<p class="p">If eCommerce bundles are subscribed, then they may have a cost, which is debited from the account main balance.</p>

</li>

<li class="li">
<p class="p">While running the <em class="ph i">Direct Debit</em> API, the amount is deleted either from the account main balance or from a money bucket depending on the tariff formula configuration. The selection of money bucket or counter depends on the applicability condition, which is configured using the <em class="ph i">Merchant ID</em>, <em class="ph i">Trafic Type</em>, or <em class="ph i">Call Type</em>.</p>

</li>

</ol>

</div>

<p class="p">This feature uses the HTTP and HTTP2 REST APIs to perform chargeable balance debit and balance query operations:</p>

</div>

</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title2" id="concept_zqt_vxq_t4b"><h2 class="title topictitle2" id="ariaid-title2">UCRemainingBalance API</h2>
<div class="body conbody">
      <div class="section"><p class="p">This API returns account balance and <em class="ph i">distanceToUsage</em> values for a given
          device identified by supplied GPSI. The <em class="ph i">distanceToUsage</em> value is computed as the
          difference between the Usage limit (ULI) and the current counter value for the selected
          cost counter or UC Limit (as applicable).</p>
<div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> The UC limit (if self-counter) always takes precedence over any other cost counter for
              <em class="ph i">distanceToUsageLimit</em> calculation.</div>

        <kbd class="ph userinput">https://&lt;IP&gt;:&lt;PORT&gt;/services/ServiceManager/e-commerce/UCRemainingBalance</kbd>
        <p class="p">For more information, refer to the API documentation.</p>
<p class="p">If this API fails to identify
          the usage control limit or an applicable cost counter in charging service, then it returns
          only the balance amount without any <em class="ph i">distanceToUsageLimit</em>.</p>
<p class="p">If multiple
          counters are applicable, then it returns the account balance along with the response code,
          such as <samp class="ph systemoutput">Multiple Counters Applicable</samp>. If no counters are
          applicable, then it returns only the balance amount and no
          <em class="ph i">distanceToUsageAmount</em>.</p>

        <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> This API always returns other input parameters as result for all
            <samp class="ph systemoutput">OK</samp> scenarios.</div>
</div>

    </div>
</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title3" id="concept_bwb_5xq_t4b"><h2 class="title topictitle2" id="ariaid-title3">Debit Amount API</h2>
<div class="body conbody">
      <div class="section"><p class="p">This API debits the requested amount from the main balance or monetary bucket
          depending on the tariff formula defined in the charging service. It also returns the
          remaining amount of account main balance or monetary bucket after deducting the requested
          amount.</p>
<p class="p">Following is the URI:</p>

        <kbd class="ph userinput">https://&lt;IP&gt;:&lt;PORT&gt;/services/ServiceManager/e-commerce/DebitAmount</kbd>
        <p class="p">For more information, refer to the API documentation.</p>
<p class="p">If there is a <em class="ph i">No
            Charge</em> tariff formula set in a charging service, then it returns the account main
          balance in response. If device has multiple subscription from multiple account, then this
          API debits the amount in the following order:</p>
<p class="p">First, from the first account,
          followed by the second account, and then the third account or further. It returns the
          remaining balance of last account used for debit.</p>
</div>

    </div>
</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title4" id="concept_rgp_rpl_r4b"><h2 class="title topictitle2" id="ariaid-title4">Additional information</h2>
<div class="body conbody">
      <div class="section" id="concept_rgp_rpl_r4b__section_oyj_spl_r4b">
        <p class="p">Following are some important points to note for the eCommerce APIs:</p>

        <ul class="ul" id="concept_rgp_rpl_r4b__ul_pyj_spl_r4b">
          <li class="li">
            <p class="p">These APIs are for direct debit, and not related to ECUR or SCUR calls.</p>

          </li>

          <li class="li">
            <p class="p">These APIs require a different set of attributes to be supported in rules or
              applicability conditions.</p>

          </li>

          <li class="li">
            <p class="p">These APIs are limited only to debit operations.</p>

          </li>

          <li class="li">
            <p class="p">The functionality for <em class="ph i">distanceToAmount</em> in <em class="ph i">UCQueryBalanceAPI</em> is
              applicable only to subscription counters. The <em class="ph i">distanceToAmount</em> is applicable to
              the usage limit defined on a counter.</p>

            <div class="p">
              <div class="note" id="concept_rgp_rpl_r4b__note_qlb_ygx_p5b"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> This is not applicable to any Near-ULI or OLI
                cases.</div>

            </div>

          </li>

          <li class="li">
            <p class="p">Fee related deduction from monetary balance are not accumulated in cost counter.</p>

          </li>

          <li class="li">
            <p class="p">The usage limit within the usage control is configured with a <em class="ph i">Time Of Day</em>
              setting. If any eCommerce API request arrives during the configured <em class="ph i">Time Of Day</em>
              barred setting, then they are rejected with an appropriate error code in response.</p>

          </li>

          <li class="li">
            <p class="p">In eCommerce APIs, the <samp class="ph systemoutput">NOTIFICATION-STOP</samp> or
                <samp class="ph systemoutput">STOP</samp> action is not recommended for UC limit thresholds.
              However, if these actions are configured for eCommerce APIs, then they behave in
              generic manner.</p>

          </li>

          <li class="li">
            <p class="p">The eCommerce API support is limited to as data models and adoptions defined for
              UC.</p>

          </li>

          <li class="li">
            <p class="p">The <strong class="ph b">GPSI</strong> parameter in both (<em class="ph i">UCRemainingBalanceQuery</em> and
                <em class="ph i">DebitAmount</em>) APIs can be any type, such as Ext-ID/MSISDN or MDN. Only
                <strong class="ph b">GPSI</strong> parameter support is required NOT SUPI.</p>

            <p class="p">In case of <span class="keyword cmdname">msisdn-</span>, the input GPSI value is based on the <strong class="ph b">GPSI
                MSISDN Prefix Configuration</strong> under the <em class="ph i">SM Application Preferences</em>.</p>

          </li>

        </ul>

        <p class="p">This feature considers the following assumptions:</p>

        <ul class="ul" id="concept_rgp_rpl_r4b__ul_qyj_spl_r4b">
          <li class="li">
            <p class="p">For eCommerce debit amount calls and limits:</p>

            <p class="p">When the threshold applied on UC limit is configured for hard-stop actions, such as
                <samp class="ph systemoutput">REJECT</samp> or
                <samp class="ph systemoutput">NOTIFICATION-REJECT</samp>, the following actions are taken
              depending on the given conditions:</p>

            <ul class="ul" id="concept_rgp_rpl_r4b__ul_ryj_spl_r4b">
              <li class="li">
                <p class="p">If the debit amount in request is more than the difference between the threshold
                  limit and the current value of resource, then the request is rejected with an
                  error code as <samp class="ph systemoutput">NOT_ENOUGH_CREDIT</samp>.</p>

              </li>

              <li class="li">
                <p class="p">If the debit amount in request is less than the difference between the threshold
                  limit and the current value of resource, then the call is successful.</p>

              </li>

            </ul>

            <p class="p">When the threshold applied on UC limit is configured for soft-stop actions, such as
                <samp class="ph systemoutput">CONTINUE</samp> or
                <samp class="ph systemoutput">NOTIFICATION-STOP</samp>, the following action is taken
              depending on the given condition:</p>

            <ul class="ul" id="concept_rgp_rpl_r4b__ul_syj_spl_r4b">
              <li class="li">
                <p class="p">If the debit amount in request is more than the difference between the threshold
                  limit and the current value of resource, then the call is successful and spend
                  notification is sent.</p>

              </li>

            </ul>

            <div class="p">
              <div class="note" id="concept_rgp_rpl_r4b__note_evq_xgx_p5b"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> This condition is applicable only to <em class="ph i">DebitAmount</em>
                API and not applicable to <em class="ph i">UCRemainingBalance</em> query.</div>

            </div>

          </li>

          <li class="li">
            <p class="p">A bundle with usage control and no charging service returns the response of
                <em class="ph i">UCRemainingBalance</em> from main account balance and <em class="ph i">distanceToUsageAmount</em>
              from the ULI in a usage control counter. However, the <em class="ph i">DebitAmount</em> API is not
              executed successfully (<samp class="ph systemoutput">CHARGING_SERVICE_LIST_EMPTY</samp>) as
              there is no charging service and rating fails to determine from where to charge the
              amount. This means that the charging service is not mandatory for
                <em class="ph i">UCRemainingBalance</em> but is mandatory for <em class="ph i">DebitAmount</em> API.</p>

          </li>

          <li class="li">
            <p class="p">The applicability condition on reference counter is only respected for TOD. The
                <em class="ph i">distanceToUsageAmount</em> is always shown with reference to the ULI of the
              reference counter in UC during a subscription creation and irrespective of whether
              during the actual eCommerce call, the UC meets the applicability criteria or not.</p>

            <p class="p">If it is found that there are multiple applicable subscriptions associated with the
              requesting <em class="ph i">BundleID</em> in an eCommerce call, then the subscription selected is
              according to the current rating logic. Both <em class="ph i">UCRemainingBalance</em> and
                <em class="ph i">DebitAmount</em> APIs work according to that subscription.</p>

          </li>

        </ul>

      </div>

    </div>
</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title5" id="concept_d3r_mpl_r4b"><h2 class="title topictitle2" id="ariaid-title5">Examples</h2>
<div class="body conbody">
      <div class="bodydiv conbodydiv">
        <div class="section" id="concept_d3r_mpl_r4b__section_zfk_md5_pnb">
          <p class="p">Consider the following examples for a better understanding of the eCommerce API
            functionality:</p>

        </div>

        <div class="section" id="concept_d3r_mpl_r4b__section_xzc_nd5_pnb"><h3 class="title sectiontitle">Example 1: Usage limit override for reference counter attached in UC</h3>
          
          <p class="p">
            <strong class="ph b">Prerequisites:</strong>
          </p>

          <ol class="ol" id="concept_d3r_mpl_r4b__ol_yzc_nd5_pnb">
            <li class="li">
              <p class="p">Create a subscription-type counter <var class="keyword varname">PTY00515</var> with <em class="ph i">Usage
                  Limit</em> set as <var class="keyword varname">720</var> and <em class="ph i">Overage Limit</em> set as
                  <var class="keyword varname">10</var> money with cost-type counter.</p>

            </li>

            <li class="li"><p class="p">Create a charging service <var class="keyword varname">E-ComCS00515</var> with selecting the
                above created counter and having tariff configured in such a way that charging is
                done from account main balance when <em class="ph i">Merchant ID</em> condition matches and counter
                is incremented based on the deduction.</p>
<img class="image" id="concept_d3r_mpl_r4b__image_zzc_nd5_pnb" src="../images/img9yz-09126-ug01-pczza-sp1-tariff_formula_1_default.png" /></li>

            <li class="li">
              <p class="p">Create the Usage Control (UC) with reference counter as the counter created in
                  <span class="ph uicontrol">step 1</span> with <em class="ph i">Usage Limit</em> set as
                  <var class="keyword varname">720</var>.</p>

            </li>

            <li class="li"><p class="p">Create a bundle <var class="keyword varname">PlayUnlimited00515</var> having the above charging
                service and usage control.</p>
<img class="image" id="concept_d3r_mpl_r4b__image_a1d_nd5_pnb" src="../images/img9yz-09126-ug01-pczza-sp1-bundle1_default.png" />
            </li>

            <li class="li">
              <p class="p">Create an account and device through <em class="ph i">Account Profile</em> API.</p>

            </li>

            <li class="li">
              <p class="p">Set the account balance as <var class="keyword varname">1000</var>.</p>

            </li>

          </ol>

          <div class="fig fignone" id="concept_d3r_mpl_r4b__fig_b1d_nd5_pnb"><span class="figcap"><span class="fig--title-label">Figure: </span>Account overview before running Direct Debit API</span>
            
            <img class="image break" id="concept_d3r_mpl_r4b__image_c1d_nd5_pnb" src="../images/img9yz-09126-ug01-pczza-sp1-before_account_overview1_default.png" height="105" width="519" />
          </div>

          
          <div class="fig fignone" id="concept_d3r_mpl_r4b__fig_d1d_nd5_pnb"><span class="figcap"><span class="fig--title-label">Figure: </span>Device overview before running Direct Debit API</span>
            
            <img class="image break" id="concept_d3r_mpl_r4b__image_e1d_nd5_pnb" src="../images/img9yz-09126-ug01-pczza-sp1-before_device_overview1_default.png" height="130" width="562" />
          </div>

          
          <p class="p">
            <strong class="ph b">Execution:</strong>
          </p>

          <ol class="ol" id="concept_d3r_mpl_r4b__ol_f1d_nd5_pnb">
            <li class="li">
              <p class="p">Run the <em class="ph i">getUCRemaining balance</em> API with <em class="ph i">GPSI</em> as <var class="keyword varname">device
                  e164</var> and <em class="ph i">bundle_id</em> as above created bundle in <span class="ph uicontrol">step
                  4</span>.</p>

            </li>

            <li class="li">
              <p class="p">Run the direct debit for the GPSI for amount <var class="keyword varname">70</var>.</p>

            </li>

          </ol>

          <p class="p">This example verifies:</p>

          <ul class="ul" id="concept_d3r_mpl_r4b__ul_g1d_nd5_pnb">
            <li class="li">
              <p class="p">The <em class="ph i">getUCRemaining</em> API returns the value of <em class="ph i">distancetoUsageAmount</em> as
                  <var class="keyword varname">750</var> because usage limit is being overridden from counter usage
                limit given in charging service.</p>

            </li>

            <li class="li">
              <p class="p">Counter is incremented by <var class="keyword varname">70</var> given in direct debit request and
                account balance is deducted with the same amount (<var class="keyword varname">70</var>) as given in
                input request.</p>

            </li>

          </ul>

          <div class="fig fignone" id="concept_d3r_mpl_r4b__fig_h1d_nd5_pnb"><span class="figcap"><span class="fig--title-label">Figure: </span>Account overview after running Direct Debit API</span>
            
            <img class="image break" id="concept_d3r_mpl_r4b__image_i1d_nd5_pnb" src="../images/img9yz-09126-ug01-pczza-sp1-after_account_overview1_default.png" height="103" width="519" />
          </div>

          
          <div class="fig fignone" id="concept_d3r_mpl_r4b__fig_j1d_nd5_pnb"><span class="figcap"><span class="fig--title-label">Figure: </span>UC overview after running Direct Debit API</span>
            
            <img class="image break" id="concept_d3r_mpl_r4b__image_k1d_nd5_pnb" src="../images/img9yz-09126-ug01-pczza-sp1-after_uc_overview1_default.png" height="116" width="519" />
          </div>

        </div>

        <div class="section" id="concept_d3r_mpl_r4b__section_srf_c25_pnb"><h3 class="title sectiontitle">Example 2: Usage limit override for self-counter attached in UC</h3>
          
          <p class="p">
            <strong class="ph b">Prerequisites:</strong>
          </p>

          <ol class="ol" id="concept_d3r_mpl_r4b__ol_l1d_nd5_pnb">
            <li class="li">
              <p class="p">Create a subscription-type counter <var class="keyword varname">PTY00516</var> with <em class="ph i">Usage
                  Limit</em> set as <var class="keyword varname">720</var> and <em class="ph i">Overage Limit</em> set as 10 money
                with cost-type counter.</p>

            </li>

            <li class="li">
              <p class="p">Create a charging service with selecting the above created counter and having
                tariff configured in such a way that charging is done from account main balance when
                  <em class="ph i">Merchant ID</em> condition matches and counter is incremented based on the
                deduction.</p>

            </li>

            <li class="li">
              <p class="p">Create the UC with self-counter and <em class="ph i">Usage Limit</em> set as
                  <var class="keyword varname">720</var> having applicability condition is set as:</p>

              <p class="p">
                <kbd class="ph userinput">ECOMMERCE.Merchant-Id = "merchantid1"</kbd>
              </p>

            </li>

            <li class="li">
              <p class="p">Create a bundle <var class="keyword varname">PLAYUNLIMITED00516</var> having the above charging
                service and UC.</p>

            </li>

            <li class="li">
              <p class="p">Create an account and device through <em class="ph i">Account Profile</em> API.</p>

            </li>

            <li class="li">
              <p class="p">Set the account balance as <var class="keyword varname">1000</var>.</p>

            </li>

          </ol>

          <div class="fig fignone" id="concept_d3r_mpl_r4b__fig_m1d_nd5_pnb"><span class="figcap"><span class="fig--title-label">Figure: </span>Account overview before running Direct Debit API</span>
            
            <img class="image break" id="concept_d3r_mpl_r4b__image_n1d_nd5_pnb" src="../images/img9yz-09126-ug01-pczza-sp1-before_account_overview2_default.png" height="123" width="549" />
          </div>

          <div class="fig fignone" id="concept_d3r_mpl_r4b__fig_o1d_nd5_pnb"><span class="figcap"><span class="fig--title-label">Figure: </span>Device overview before running Direct Debit API</span>
            
            <img class="image break" id="concept_d3r_mpl_r4b__image_p1d_nd5_pnb" src="../images/img9yz-09126-ug01-pczza-sp1-before_device_overview2_default.png" height="122" width="537" />
          </div>

          <p class="p">
            <strong class="ph b">Execution:</strong>
          </p>

          <ol class="ol" id="concept_d3r_mpl_r4b__ol_q1d_nd5_pnb">
            <li class="li">
              <p class="p">Run the <em class="ph i">getUCRemaining balance</em> API with <em class="ph i">GPSI</em> as <var class="keyword varname">device
                  e164</var> and <em class="ph i">bundle_id</em> as above created bundle in <span class="ph uicontrol">step
                  4</span>.</p>

            </li>

            <li class="li">
              <p class="p">Run the direct debit for the GPSI for amount <var class="keyword varname">76</var>.</p>

            </li>

          </ol>

          <p class="p">This example verifies:</p>

          <ul class="ul" id="concept_d3r_mpl_r4b__ul_r1d_nd5_pnb">
            <li class="li">
              <p class="p">The <em class="ph i">getUCRemaining</em> API returns the value of <em class="ph i">distancetoUsageAmount</em> as
                  <var class="keyword varname">750</var> because usage limit is being overridden from counter usage
                limit given in charging service.</p>

            </li>

            <li class="li">
              <p class="p">Counter is incremented by <var class="keyword varname">76</var> given in direct debit request and
                account balance is deducted with the same amount (<var class="keyword varname">76</var>) as given in
                input request.</p>

            </li>

          </ul>

          <div class="fig fignone" id="concept_d3r_mpl_r4b__fig_s1d_nd5_pnb"><span class="figcap"><span class="fig--title-label">Figure: </span>Account overview after running Direct Debit API</span>
            
            <img class="image break" id="concept_d3r_mpl_r4b__image_t1d_nd5_pnb" src="../images/img9yz-09126-ug01-pczza-sp1-after_account_overview2_default.png" height="109" width="507" />
          </div>

          <div class="fig fignone" id="concept_d3r_mpl_r4b__fig_u1d_nd5_pnb"><span class="figcap"><span class="fig--title-label">Figure: </span>UC overview after running Direct Debit API</span>
            
            <img class="image break" id="concept_d3r_mpl_r4b__image_v1d_nd5_pnb" src="../images/img9yz-09126-ug01-pczza-sp1-after_uc_overview2_default.png" height="109" width="528" />
          </div>

        </div>

        <div class="section" id="concept_d3r_mpl_r4b__section_u12_125_pnb"><h3 class="title sectiontitle">Example 3: eCommerce API behavior based on TOD defined in UC</h3>
          
          <p class="p">The <span class="ph uicontrol">Usage Limit</span> object in a UC is configured with the Time of
            Day (TOD). Any eCommerce API request that is received during the configured TOD, are
            rejected with an appropriate error code in response.</p>

          <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> The Time of Server (ME) is considered while determining whether TOD is to be barred
            or not.</div>

          <p class="p">
            <strong class="ph b">Prerequisites:</strong>
          </p>

          <ol class="ol" id="concept_d3r_mpl_r4b__ol_w1d_nd5_pnb">
            <li class="li">
              <p class="p">Create a subscription-type counter having <em class="ph i">Usage Limit</em> set as
                  <var class="keyword varname">720</var> and <em class="ph i">Overage Limit</em> set as <var class="keyword varname">10</var> Money
                with cost-type counter.</p>

            </li>

            <li class="li">
              <p class="p">Create a charging service with applicability condition as:</p>

              <p class="p">
                <kbd class="ph userinput">ECOMMERCE.Merchant-Id = "merchantid1"</kbd>
              </p>

            </li>

            <li class="li">
              <p class="p">Select the above created counter in this and tariff is configured in such a way
                that balance is deducted from the account main balance and counter is incremented
                based on the deduction.</p>

            </li>

            <li class="li">
              <p class="p">Create the UC with self-counter with <em class="ph i">Usage Limit</em> set as
                  <var class="keyword varname">750</var> and TOD given as day as <var class="keyword varname">TUESDAY</var> and
                provide some start time and end time.</p>

            </li>

            <li class="li">
              <p class="p">Create a bundle having the above charging service and UC.</p>

            </li>

            <li class="li">
              <p class="p">Create an account and device through <em class="ph i">Account Profile</em> API.</p>

            </li>

            <li class="li">
              <p class="p">Set the account balance as <var class="keyword varname">1000</var>.</p>

            </li>

          </ol>

          <p class="p">
            <strong class="ph b">Execution:</strong>
          </p>

          <ol class="ol" id="concept_d3r_mpl_r4b__ol_x1d_nd5_pnb">
            <li class="li">
              <p class="p">Run the <em class="ph i">getUCRemaining balance</em> API with <em class="ph i">GPSI</em> as <var class="keyword varname">device
                  e164</var> and <em class="ph i">bundle_id</em> as above created bundle in <span class="ph uicontrol">step
                  4</span> at the time between start time and end time being configured in TOD
                under UC.</p>

            </li>

            <li class="li">
              <p class="p">Run the direct debit for the GPSI at the time between start time and end time being
                configured in TOD under UC.</p>

            </li>

          </ol>

          <p class="p">This example verifies:</p>

          <ul class="ul" id="concept_d3r_mpl_r4b__ul_y1d_nd5_pnb">
            <li class="li">
              <p class="p">The <em class="ph i">getUCRemaining</em> API returns an error code as
                  <samp class="ph systemoutput">CALL_REJECTED_DUE_TO_TOD_BARRED</samp> in response.</p>

            </li>

            <li class="li">
              <p class="p">The <em class="ph i">Direct Debit</em> API returns an error code as
                  <samp class="ph systemoutput">CALL_REJECTED_DUE_TO_TOD_BARRED</samp> in response.</p>

            </li>

          </ul>

        </div>

      </div>
    </div>
</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title6" id="concept_ujp_34n_bpb"><h2 class="title topictitle2" id="ariaid-title6">eCommerce API error codes</h2>
<div class="body conbody">
      
      <p class="p">This section describes the error codes available for eCommerce API. The API does not send
        an HTTP error. Rather the error code is present in the API response.</p>

      <table cellpadding="4" cellspacing="0" summary="" id="concept_ujp_34n_bpb__table_m3c_ppn_bpb" class="table" frame="border" border="1" rules="all"><colgroup><col style="width:45.45454545454545%" /><col style="width:54.54545454545454%" /></colgroup><thead class="thead" style="text-align:left;">
            <tr class="row">
              <th class="entry cellrowborder" style="vertical-align:top;" id="d393681e1007"><strong class="ph b">Error code</strong></th>

              <th class="entry cellrowborder" style="vertical-align:top;" id="d393681e1011"><strong class="ph b">Description</strong></th>

            </tr>

          </thead>
<tbody class="tbody">
            <tr class="row">
              <td class="entry cellrowborder" style="vertical-align:top;" headers="d393681e1007 ">RULE_NOT_APPLICABLE</td>

              <td class="entry cellrowborder" style="vertical-align:top;" headers="d393681e1011 ">
                <p class="p">This error occurs when the charging service applicability condition fails and no
                  other charging service is defined.</p>

             </td>

            </tr>

            <tr class="row">
              <td class="entry cellrowborder" style="vertical-align:top;" headers="d393681e1007 ">DEVICE_GPSI_MISSING</td>

              <td class="entry cellrowborder" style="vertical-align:top;" headers="d393681e1011 ">
                <p class="p">This error occurs when the device ID (GPSI) given in the request is not present
                  in the database.</p>

             </td>

            </tr>

            <tr class="row">
              <td class="entry cellrowborder" style="vertical-align:top;" headers="d393681e1007 ">NO_SUBSCRIPTION_ATTACHED_WITH_DEVICE</td>

              <td class="entry cellrowborder" style="vertical-align:top;" headers="d393681e1011 ">
                <p class="p">This error occurs when there is no subscription attached to the given device.</p>

             </td>

            </tr>

            <tr class="row">
              <td class="entry cellrowborder" style="vertical-align:top;" headers="d393681e1007 ">SM_REQUEST_VALIDATION_ERRCODE</td>

              <td class="entry cellrowborder" style="vertical-align:top;" headers="d393681e1011 ">This error occurs when the request validation fails.</td>

            </tr>

            <tr class="row">
              <td class="entry cellrowborder" style="vertical-align:top;" headers="d393681e1007 ">INVALID_CURRENCY_CODE</td>

              <td class="entry cellrowborder" style="vertical-align:top;" headers="d393681e1011 ">
                <p class="p">This error occurs when the <var class="keyword varname">Currency</var> parameter in request is
                  not a valid Currency code.</p>

             </td>

            </tr>

            <tr class="row">
              <td class="entry cellrowborder" style="vertical-align:top;" headers="d393681e1007 ">CURRENCY_CODE_MISMATCH</td>

              <td class="entry cellrowborder" style="vertical-align:top;" headers="d393681e1011 ">
                <p class="p">This error occurs when the <var class="keyword varname">Currency</var> parameter in request does
                  not match with the Global currency set in NCC.</p>

             </td>

            </tr>

            <tr class="row">
              <td class="entry cellrowborder" style="vertical-align:top;" headers="d393681e1007 ">MULTIPLE_COUNTERS_APPLICABLE</td>

              <td class="entry cellrowborder" style="vertical-align:top;" headers="d393681e1011 ">
                <p class="p">This error occurs when there are multiple cost counters applicable to a charging
                  service even after tariff execution.</p>

                <p class="p">Example 1: Two cost subscription counters attached to charging service and both
                  counters added in tariff rule.</p>

                <p class="p">Example 2: One cost counter (C1) and one multi-bundle counter (C2) attached to
                  charging service and cost counter (C1) is added in tariff rule.</p>

                <p class="p">The API returns the amount but not distance to usage. The status is
                    <var class="keyword varname">Success</var>.</p>

             </td>

            </tr>

            <tr class="row">
              <td class="entry cellrowborder" style="vertical-align:top;" headers="d393681e1007 ">CALL_REJECTED_DUE_TO_TOD_BARRED</td>

              <td class="entry cellrowborder" style="vertical-align:top;" headers="d393681e1011 ">
                <p class="p">This error occurs when an eCommerce call lands during the Time of Day (TOD),
                  which was configured to be barred in UCLimit.</p>

                <p class="p">Example: TOD is configured in UC Limit object as Monday 10:00 AM to 10:00 PM. If
                  any ecommerce API is triggered for this UCLimit between this time on any MONDAY,
                  the call is rejected.</p>

             </td>

            </tr>

          </tbody>
</table>

    </div>
</div>
<div class="footer"><hr /><p>Charging User Guide • P556766-DN1000054947-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>