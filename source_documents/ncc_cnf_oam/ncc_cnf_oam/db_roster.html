<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="db-roster" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="db_backup" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>db-roster</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="db_backup">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">db-roster</h1>
<div class="body conbody">
        <div class="section" id="db_backup__section_gkv_c2m_cmb"><h2 class="title sectiontitle">Description</h2>
            
            <p class="p">This tool displays all of the nodes in the local Aerospike database cluster roster.
                The tool also displays whether any of the database partitions are unavailable (or
                dead). Each Aerospike namespace has its data spread across 4,096 partitions. Since
                    <span class="ph">NCC</span> uses a replication factor of two, this means
                that every record normally has two copies in the local cluster. But if a node in
                each of the two Aerospike virtual racks fails before data migration is able to
                complete, then one or more of those partitions of data becomes unavailable and <span class="ph">NCC</span> marks its local database service as out-of-service
                (resulting in this <span class="ph">NCC</span> being marked as down).</p>

            <p class="p">The default view is a summary view indicating some key information and whether any
                partitions are currently unavailable. If yes, then you may choose to re-run the tool
                using the verbose option, to drill down and learn which of the nodes are
                experiencing the failed partitions, for which namespaces.</p>

        </div>

        <div class="section" id="db_backup__section_g3b_d2m_cmb"><h2 class="title sectiontitle">Syntax</h2>
            
            <pre class="pre codeblock"><code>db-roster [-v]</code></pre>
            <div class="p">
                <table cellpadding="4" cellspacing="0" summary="" id="db_backup__table_kmm_45q_cmb" class="table" frame="border" border="1" rules="all"><colgroup><col style="width:33.33333333333333%" /><col style="width:66.66666666666666%" /></colgroup><thead class="thead" style="text-align:left;">
                            <tr class="row">
                                <th class="entry cellrowborder" style="vertical-align:top;" id="d51861e68">Option</th>

                                <th class="entry cellrowborder" style="vertical-align:top;" id="d51861e71">Description</th>

                            </tr>

                        </thead>
<tbody class="tbody">
                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d51861e68 "><code class="ph codeph">-h or -?</code></td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d51861e71 ">Displays usage/help information.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d51861e68 "><code class="ph codeph">-v</code></td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d51861e71 ">Verbose mode. Display the per-node, per-namespace view of the
                                    number of unavailable data partitions. This is recommended if
                                    the summary view indicates unavailable partitions and it is
                                    desired to drill down into more details.</td>

                            </tr>

                        </tbody>
</table>

            </div>

        </div>

        <div class="section" id="db_backup__section_kzh_d2m_cmb"><h2 class="title sectiontitle">Example: summary view</h2>
            
            <div class="p">This example shows the output when the tool is run with no arguments and no node
                failures.<pre class="pre codeblock"><code>./db-roster
Date: Wed Dec  7 20:47:30 UTC 2022

Namespace Name       Dead Partitions           Unavailable Partitions
=====================================================================
Dsc                  0				0
Dscglobal            0				0
Dsclocal             0				0
spspd1               0				0
spsundologs          0				0

nodeName                                                                            failureTimeElapsed         failureTimeStamp
==================================================================================================================================


AEROSPIKE CLUSTER STATUS: UP</code></pre></div>

        </div>

        <div class="section"><h2 class="title sectiontitle">Example: verbose view</h2>
            
            <div class="p">This example shows the output when the tool is run with the -v option on a system
                with four database nodes.<pre class="pre codeblock"><code>./db-roster -v
Date: Wed Dec  7 20:47:11 UTC 2022

Seed:        [('ig-aerospike-service.ig1.svc.cluster.local', 3010, '*.dyn.nesc.nokia.net')]
Config_file: /opt/tpa/users/tpaadmin/.aerospike/astools.conf, /etc/aerospike/astools.conf
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~dsc Namespace Statistics (2022-12-07 20:47:12 UTC)~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                                                                                  Node|dead_partitions|unavailable_partitions
vzwcchf-y-nk-ig-000-ig-aerospike-rk1-0.ig-aerospike-service.ig1.svc.cluster.local:3010|              0|                     0
vzwcchf-y-nk-ig-000-ig-aerospike-rk1-1.ig-aerospike-service.ig1.svc.cluster.local:3010|              0|                     0
vzwcchf-y-nk-ig-000-ig-aerospike-rk2-0.ig-aerospike-service.ig1.svc.cluster.local:3010|              0|                     0
vzwcchf-y-nk-ig-000-ig-aerospike-rk2-1.ig-aerospike-service.ig1.svc.cluster.local:3010|              0|                     0
Number of rows: 4

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~dscglobal Namespace Statistics (2022-12-07 20:47:12 UTC)~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                                                                                  Node|dead_partitions|unavailable_partitions
vzwcchf-y-nk-ig-000-ig-aerospike-rk1-0.ig-aerospike-service.ig1.svc.cluster.local:3010|              0|                     0
vzwcchf-y-nk-ig-000-ig-aerospike-rk1-1.ig-aerospike-service.ig1.svc.cluster.local:3010|              0|                     0
vzwcchf-y-nk-ig-000-ig-aerospike-rk2-0.ig-aerospike-service.ig1.svc.cluster.local:3010|              0|                     0
vzwcchf-y-nk-ig-000-ig-aerospike-rk2-1.ig-aerospike-service.ig1.svc.cluster.local:3010|              0|                     0
Number of rows: 4

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~dsclocal Namespace Statistics (2022-12-07 20:47:12 UTC)~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                                                                                  Node|dead_partitions|unavailable_partitions
vzwcchf-y-nk-ig-000-ig-aerospike-rk1-0.ig-aerospike-service.ig1.svc.cluster.local:3010|              0|                     0
vzwcchf-y-nk-ig-000-ig-aerospike-rk1-1.ig-aerospike-service.ig1.svc.cluster.local:3010|              0|                     0
vzwcchf-y-nk-ig-000-ig-aerospike-rk2-0.ig-aerospike-service.ig1.svc.cluster.local:3010|              0|                     0
vzwcchf-y-nk-ig-000-ig-aerospike-rk2-1.ig-aerospike-service.ig1.svc.cluster.local:3010|              0|                     0
Number of rows: 4

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~spspd1 Namespace Statistics (2022-12-07 20:47:12 UTC)~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                                                                                  Node|dead_partitions|unavailable_partitions
vzwcchf-y-nk-ig-000-ig-aerospike-rk1-0.ig-aerospike-service.ig1.svc.cluster.local:3010|              0|                     0
vzwcchf-y-nk-ig-000-ig-aerospike-rk1-1.ig-aerospike-service.ig1.svc.cluster.local:3010|              0|                     0
vzwcchf-y-nk-ig-000-ig-aerospike-rk2-0.ig-aerospike-service.ig1.svc.cluster.local:3010|              0|                     0
vzwcchf-y-nk-ig-000-ig-aerospike-rk2-1.ig-aerospike-service.ig1.svc.cluster.local:3010|              0|                     0
Number of rows: 4

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~spsundologs Namespace Statistics (2022-12-07 20:47:12 UTC)~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
                                                                                  Node|dead_partitions|unavailable_partitions
vzwcchf-y-nk-ig-000-ig-aerospike-rk1-0.ig-aerospike-service.ig1.svc.cluster.local:3010|              0|                     0
vzwcchf-y-nk-ig-000-ig-aerospike-rk1-1.ig-aerospike-service.ig1.svc.cluster.local:3010|              0|                     0
vzwcchf-y-nk-ig-000-ig-aerospike-rk2-0.ig-aerospike-service.ig1.svc.cluster.local:3010|              0|                     0
vzwcchf-y-nk-ig-000-ig-aerospike-rk2-1.ig-aerospike-service.ig1.svc.cluster.local:3010|              0|                     0
Number of rows: 4

nodeName                                                                              failureTimeElapsed      failureTimeStamp
==================================================================================================================================
vzwcchf-y-nk-ig-000-ig-aerospike-rk1-0.ig-aerospike-service.ig1.svc.cluster.local
vzwcchf-y-nk-ig-000-ig-aerospike-rk1-1.ig-aerospike-service.ig1.svc.cluster.local
vzwcchf-y-nk-ig-000-ig-aerospike-rk2-0.ig-aerospike-service.ig1.svc.cluster.local
vzwcchf-y-nk-ig-000-ig-aerospike-rk2-1.ig-aerospike-service.ig1.svc.cluster.local

AEROSPIKE CLUSTER STATUS: UP
</code></pre></div>

        </div>

        <div class="section"><h2 class="title sectiontitle">Output description</h2>
            
            <p class="p">The output of db-roster may include this information:</p>

            <ul class="ul" id="db_backup__ul_dvp_v2v_tvb">
                <li class="li">A list of database nodes in the current roster of the Aerospike database, sorted
                    in order of ascending Node IDs. If the <code class="ph codeph">-v</code> option is used, all
                    nodes in the roster are listed, otherwise only the failed nodes are listed. For
                    each database node:<ul class="ul" id="db_backup__ul_evp_v2v_tvb">
                        <li class="li">Node: Displays the ID of the node.</li>

                        <li class="li">Failure timestamp: If this roster node is currently down, this timestamp
                            shows the time at which the node was first detected as failed. Format is
                            yyyy-mm-dd hh:mm:ss</li>

                        <li class="li">Failure time elapsed: Similar to failure timestamp, except this
                            indicates how long ago the failure occurred. Format is x hours, y
                            minutes.</li>

                    </ul>
</li>

                <li class="li">Number of Unavailable partitions: An unavailable partition is expected to be a
                    transient state and should eventually recover (once all database nodes recover).
                    The summary view shows the max number reported across the cluster the nodes, for
                    each database namespace. The verbose view shows the actual number reported by
                    each database node, for each database namespace.</li>

                <li class="li">Number of Dead partitions: A dead cluster is due to a more permanent error and
                    may never recover without manual intervention. Intervention may require a
                    non-catastrophic disaster recovery procedure where the traffic is stopped, the
                    cluster is revived, and data is restored from the mate. The summary view shows
                    the max number reported across the cluster the nodes, for each database
                    namespace. The verbose view shows the actual number reported by each database
                    node, for each database namespace.</li>

                <li class="li">Aerospike cluster status: This reflects the current status of the local
                    Aerospike cluster. The possible values are:<ul class="ul" id="db_backup__ul_gvp_v2v_tvb">
                        <li class="li">UP: The local database is up and can service traffic</li>

                        <li class="li">DOWN: The local database is down and this system is therefore not
                            servicing any incoming traffic. Typically, this automatically recovers,
                            including syncing local data with the mates in the network, and then
                            returning to UP.</li>

                        <li class="li">DOWN_DRR: The local database is down and a Disaster Recovery is required
                            before the database can be returned to UP.</li>

                        <li class="li">UNKNOWN: The status of the local database could not be determined.</li>

                    </ul>
</li>

            </ul>

        </div>

    </div>
<div class="footer"><hr /><p>Operations, Administration, and Maintenance Guide • P556766-DN1000055092-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>