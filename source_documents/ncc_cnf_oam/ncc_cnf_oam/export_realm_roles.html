<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Export realm roles and users" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="export_realm_roles" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Export realm roles and users</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="export_realm_roles">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Export realm roles and users</h1>
<div class="body conbody">
        <p class="p">Before you start the migration to SSO/LDAP, these steps can be performed one time to
            export User and Role Management realm roles and users JSON files. The exported realm
            JSON files are used to re-import the roles and users after the migration procedure is
            successfully completed.</p>

        <ol class="ol">
            <li class="li">Create a new custom pre-start script file named
                    <span class="ph filepath">customPreStartScript.yaml</span>.
                <pre class="pre codeblock"><code>customPreStartScript: |
  # Custom script to run before starting servers
  /opt/keycloak/bin/jboss-cli.sh --commands='embed-server --server-config=standalone-ha.xml --std-out=echo,
/system-property=keycloak.migration.action:add(value="export"),
/system-property=keycloak.migration.dir:add(value="/opt/keycloak/export")'</code></pre>
            </li>

            <li class="li">Run this command to Helm upgrade the current User and Role Management version to
                same version.
                <pre class="pre codeblock"><code>helm upgrade -n $NAMESPACE ckey ckey-chart-&lt;version&gt;.tgz --reuse-values -f customPreStartScript.yaml --wait --timeout=1200s</code></pre></li>

            <li class="li">Run this command to copy the files from the CKEY pod to the control node.
                <pre class="pre codeblock"><code>kubectl cp $NAMESPACE/ckey-ckey-0:/opt/keycloak/export ~/tmp/export</code></pre>
                Sample output: <pre class="pre codeblock"><code>/tmp/export:
total 216K
-rw-r--r--. 1 keycloak keycloak 66K Feb 5 21:13 btel-auth-realm.json
-rw-r--r--. 1 keycloak keycloak 2.5K Feb 5 21:13 btel-auth-users-0.json
-rw-r--r--. 1 keycloak keycloak 72K Feb 5 21:13 master-realm.json
-rw-r--r--. 1 keycloak keycloak 902 Feb 5 21:13 master-users-0.json
-rw-r--r--. 1 keycloak keycloak 62K Feb 5 21:13 sps-auth-realm.json
-rw-r--r--. 1 keycloak keycloak 967 Feb 5 21:13 sps-auth-users-0.json</code></pre>
            </li>

            <li class="li">Edit the users JSON files for all realms to contain only the users (accounts of last
                resort) who are eligible to login directly to the application GUIs when the remote
                identity provider is inaccessible.</li>

            <li class="li">Remove other users from the files.</li>

            <li class="li">Copy the <span class="ph filepath">btel-auth-realm.json, sps-auth-realm.json,
                    btel-auth-users-0.json, and sps-auth-users-0.json</span> files to the PC
                where the GUI will be launched to restore the User and Role Management roles and
                users.</li>

        </ol>

    </div>
<div class="footer"><hr /><p>Operations, Administration, and Maintenance Guide • P556766-DN1000055092-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>