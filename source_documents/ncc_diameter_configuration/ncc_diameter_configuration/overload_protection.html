<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Overload" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="id9yz-09126-cn01-tczza-d1e3532" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Overload</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="id9yz-09126-cn01-tczza-d1e3532">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Overload</h1>
<div class="body conbody">
    <p class="p">NCC supports application overload protection. The charging pod monitors its resources for a
      workload in excess of a configured threshold. When the threshold is exceeded, the overload
      condition triggers shedding actions that are configured as part of a profile's message
      filters. The configuration may specify that new messages be discarded or to send a specific
      response. Critical resources are monitored, such as Diameter message processing, and users can
      specify message filters to fine-tune the shedding of requests to specific requirements. For an
      overview of NCC Overload strategy, see the <cite class="cite">Overload protection</cite> section of the
        <cite class="cite">Overview Guide</cite>.</p>

    <p class="p">NCC has three threshold values that are configurable through the Service Manager, as
      follows:</p>

    <ul class="ul" id="id9yz-09126-cn01-tczza-d1e3532__ul_cdb_b54_4xb">
      <li class="li">
        <p class="p">Low threshold</p>

      </li>

      <li class="li">
        <p class="p">High threshold</p>

      </li>

      <li class="li">
        <p class="p">Resource Critical threshold</p>

      </li>

    </ul>

    <p class="p">If the utilization or value of a resource exceeds an upper threshold, the resource and the
      associated charging pod are considered to be overloaded. The overloaded state remains until
      the utilization or value of all monitored resources on the charging pod is less than the
      respective lower threshold of each monitored resource.</p>

    <p class="p">If overload condition continues for a configured duration, then overload is escalated to the
      next highest level so that additional actions are triggered.</p>

    <p class="p">NCC provides the following overload protection functionality:</p>

    <ul class="ul" id="id9yz-09126-cn01-tczza-d1e3532__ul_ddb_b54_4xb">
      <li class="li">
        <p class="p">System monitoring: System status is reported on a per-pod basis. States are classified
          as:</p>

        <ul class="ul" id="id9yz-09126-cn01-tczza-d1e3532__ul_edb_b54_4xb">
          <li class="li">
            <p class="p">Normal-The system is operating normally.</p>

          </li>

          <li class="li">
            <p class="p">Minor-An overload state has been detected.</p>

          </li>

          <li class="li">
            <p class="p">Major-The overload state has continued for a period of time.</p>

          </li>

          <li class="li">
            <p class="p">Critical-The overload state has continued for an extended period of time.</p>

          </li>

          <li class="li">
            <p class="p">Resource Critical-The overload state has reached a level that could stop the
              Application server.</p>

          </li>

        </ul>

      </li>

      <li class="li">
        <p class="p">System reporting: A change to an overload state, or a return to normal, is reported using
          a log entry. Overload states are logged at the WARN level. Return to normal state is
          logged at the INFO level. An "AutoClear" flag is set to "No" for overload related alarms.
          This means that they need to be cleared manually by the operator.</p>

      </li>

      <li class="li">
        <p class="p">Configurable overload protection escalation interval: The overload protection escalation
          interval specifies how long the system can remain in a specific overload state before it
          is escalated to the next higher state, for example, from Minor to Major. The overload
          protection escalation interval is specified globally.</p>

      </li>

    </ul>

    <p class="p">Downstream overload is a configuration that allows NCC to attempt to protect a downstream
      network element from overload. For NCC, on the ingress peer, use the Overload Protection
      Configurations and Overload Protection Profiles. On the egress peer, use the Downstream
      Overload Configurations and Downstream Overload Profiles.</p>

    <div class="section" id="id9yz-09126-cn01-tczza-d1e3532__Thresh"><h2 class="title sectiontitle">Threshold profile parameters</h2>
      
      <div class="p">In the <span class="ph uicontrol">Overload Protection</span> window, select
          <span class="ph uicontrol">PROFILES</span> tab to configure overload threshold profiles. The
        following overload threshold profiles can be created: <ul class="ul" id="id9yz-09126-cn01-tczza-d1e3532__ul_akq_4wy_g5b">
          <li class="li">CPU usage threshold profile</li>

          <li class="li">Latency threshold profile</li>

          <li class="li">Message count threshold profile</li>

        </ul>
</div>

    </div>

    <div class="section" id="id9yz-09126-cn01-tczza-d1e3532__section_ijf_ywy_g5b"><h2 class="title sectiontitle">Queue size and upper threshold utilization</h2>The
      upper thresholds for queue size are based on three things:<ul class="ul" id="id9yz-09126-cn01-tczza-d1e3532__ul_zmg_frk_vnb">
        <li class="li">the value of the "Diameter Request Timeout Duration(ms)"</li>

        <li class="li">the expected processing rate of each Diameter application instance</li>

        <li class="li">the expected normal inbound message rate per Diameter application instance</li>

      </ul>
<p class="p">For example, using the data mentioned above, if the timeout is 2990 milliseconds as
        defined in the application preference: "Diameter Request Timeout Duration(ms)" and the
        Diameter application instances process at most 6000 requests per second, then once there are
        approximately (2.99 * 6,000) = ~18,000 requests in the queue, it becomes unlikely that the
        system will ever catch up and eliminate the backlog. So the upper threshold should be set
        around 18,000. The resource critical threshold should be set at a higher value (but not too
        high) just to protect the system from having too many requests queued in memory. This is
        assuming that when the system is in a resource critical overload it sheds the requests to
        transition to a normal state.</p>
<p class="p">The lower threshold should be set low enough below the
        upper threshold that whatever actions are being taken to shed requests will quickly get the
        system out of overload and back to normal. The normal inbound message rate is a factor in
        these settings in that the difference between the expected rate and the system's maximum
        processing rate gives an indication of how fast the system can potentially recover from a
        backlog.</p>
</div>

    <div class="section"><h2 class="title sectiontitle">Adding the Overload plugin</h2>
      
      <p class="p">Distributed configurations come with a pre-installed overload protection plugin; however,
        you can add the plugin if it is missing from the distributed setups or if you have a
        standalone system by following the steps below. </p>

      <ol class="ol">
        <li class="li">
          <p class="p">Add the Overload plugin in to your tpa.properties file, for example:</p>

          <p class="p">
            <kbd class="ph userinput">dcp.plugins.integrated="systemtype=INTEGRATED%requestsequence=Throttling:Ingres</kbd>
          </p>

          <p class="p">
            <kbd class="ph userinput">Overload Protection:,Rule Engine,system
              Plugin,SPOCSPlugin:%responsesequence=system </kbd>
          </p>

          <p class="p">
            <kbd class="ph userinput">Plugin,Rule Engine:"</kbd>
          </p>

        </li>

        <li class="li">
          <p class="p">Truncate and set the dsclocal.DDMPluginsCfgCont and restart the server. The Overload
            plugin’s entry should appear as below:</p>

          <p class="p">
            <samp class="ph systemoutput">table. select * from dsclocal.DDMPluginsCfgCont</samp>
          </p>

        </li>

      </ol>

    </div>

    
    <div class="section" id="id9yz-09126-cn01-tczza-d1e3532__section_k5y_nmg_qwb"><h2 class="title sectiontitle">Load and overload control</h2>
      
      <p class="p">This feature provides the functionality to enable CHF to include the following headers in
        responses and notifications sent to the SCP:</p>

      <ul class="ul" id="id9yz-09126-cn01-tczza-d1e3532__ul_wn4_4mg_qwb">
        <li class="li"><em class="ph i">3gpp-Sbi-Lci</em> header: <em class="ph i">Load Control Information</em> is included in the messages
          sent to the SCP.</li>

        <li class="li"><em class="ph i">3gpp-Sbi-Oci</em> header: <em class="ph i">Overload Control Information</em> is included in the
          messages sent to the SCP when the CHF is in overload state.</li>

      </ul>

      <p class="p">When this feature is enabled, the CHF sends its current load level in the registration and
        heartbeat transactions sent to the NRF. If the CPU load level changes from the previous load
        sent to NRF by a value configured in the application preference <code class="ph codeph">CPU Load percent (%)
          change for NRF Heartbeat</code> (default value: 10), then the CHF triggers heartbeats
        (PATCH) with load updates to the NRF.</p>

      <div class="sectiondiv"><strong class="ph b">Configuration</strong><div class="p">The following configuration takes effect to enable this
            feature:<ol class="ol" id="id9yz-09126-cn01-tczza-d1e3532__ol_kw5_ymg_qwb">
            <li class="li">
              <div class="p">Configure the application preference <em class="ph i">NF Instance ID</em> as described in the
                  <em class="ph i">Global Configuration Guide</em>.<div class="note" id="id9yz-09126-cn01-tczza-d1e3532__note_nqv_jcm_1yb"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> It is recommended to
                  use the same value provided in <em class="ph i">NF Profile </em>→ <em class="ph i">NF Instance</em>
                  parameter.</div>
</div>

            </li>

            <li class="li">Set the application preference <code class="ph codeph">Load And Overload Reduction Feature</code>
              to <var class="keyword varname">ENABLED</var>.<p class="p">Default value: <var class="keyword varname">DISABLED</var>.</p>
</li>

            <li class="li">
              <div class="p">Configure the <em class="ph i">Overload Reduction Metric</em>. <div class="note" id="id9yz-09126-cn01-tczza-d1e3532__note_jdp_kng_qwb"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> It is
                  mandatory to configure the <em class="ph i">Overload Reduction Metric</em> on CHF. For
                  configuration details, see <a class="xref" href="overload_reduction_matrix.html">Overload reduction metric</a>.</div>
</div>

            </li>

            <li class="li">Configure the application preference <code class="ph codeph">CPU Load percent (%) change for NRF
                Heartbeat</code>.</li>

          </ol>
<div class="note" id="id9yz-09126-cn01-tczza-d1e3532__note_pcj_vng_qwb"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> For details on configuring application preferences, see
              <em class="ph i">Managed Element application preferences</em> section in <em class="ph i">Global Configuration
              Guide</em></div>
</div>
</div>
      <p class="p">Note the following important points about this feature:</p>

      <ul class="ul" id="id9yz-09126-cn01-tczza-d1e3532__ul_zn4_4mg_qwb">
        <li class="li">Only one <em class="ph i">Overload Reduction Metric</em> record per CHF is allowed.</li>

        <li class="li">The application preference <code class="ph codeph">Load And Overload Reduction Feature</code> should
          be set to <em class="ph i">DISABLED</em> prior to deleting the <em class="ph i">Overload Reduction Metric</em> entity. </li>

        <li class="li">This feature does not impact the database (DB) upgrade and In-Service upgrade.</li>

      </ul>

    </div>

  </div>
<div class="footer"><hr /><p>Diameter/HTTP Configuration Guide • P556766-DN1000054969-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>