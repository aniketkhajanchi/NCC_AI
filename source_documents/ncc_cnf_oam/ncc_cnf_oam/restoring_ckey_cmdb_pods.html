<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="task" />
<meta name="DC.title" content="Restoring MariaDB for User and Role Management" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="restoring_ckey_cmdb_pods" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Restoring MariaDB for User and Role Management</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="restoring_ckey_cmdb_pods">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Restoring MariaDB for User and Role Management</h1>
<div class="body taskbody">
        
        <div class="tasklabel"><h2 class="sectiontitle tasklabel"></h2></div><ol class="ol steps"><li class="li step stepexpand">
                <span class="ph cmd">Run this command on the controller node and note the number of User and Role
                    Management pods.</span>
                <div class="itemgroup info">
                    <pre class="pre codeblock"><code>kubectl get sts -n &lt;namespace name&gt; | grep "ckey"
kubectl get pods -n  &lt;namespace name&gt; | grep "ckey"
                
Sample output
[root@ input-generator]# kubectl get sts -n ig1 | grep "ckey"
ckey-ckey                      2/2     48d
ckey-cmdb-mariadb              1/1     5d22h
[root@ input-generator]# kubectl get pods -n ig1 | grep "ckey"
ckey-ckey-0                                      3/3     Running            0          5d22h
ckey-ckey-1                                      3/3     Running            0          5d22h
ckey-cmdb-mariadb-0                              3/3     Running            0          5d22h</code></pre>
                </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Run this command to scale down the User and Role Management pods to 0.</span>
                <div class="itemgroup info">
                    <pre class="pre codeblock"><code>kubectl scale sts &lt;ckey sts name&gt; --replicas=0 -n  &lt;namespace name&gt;

Sample output

[root@ input-generator]# kubectl scale sts ckey-ckey --replicas=0 -n ig1
statefulset.apps/ckey-ckey scaled
[root@ input-generator]# kubectl get pods -n ig1 | grep "ckey"
ckey-ckey-0                                      3/3     Terminating        0          5d22h
ckey-ckey-1                                      3/3     Terminating        0          5d22h
ckey-cmdb-mariadb-0                              3/3     Running            0          5d22h</code></pre>
                </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Run this command on the admincli container to start the restore procedure for
                    MariaDB for User and Role Management.</span>
                <div class="itemgroup info">
                    <pre class="pre codeblock"><code>curl -vkL --header 'Content-Type: application/x-www-form urlencoded' --header 'Accept: application/json' -X POST -d
 'backup_id=&amp;volume=&amp;object_type=&amp;object_name=' http://cbur-master-cbur.
$CBUR_MASTER_NAMESPACE.svc.cluster.local:80/v2/helm/release/restore/
$NAMESPACE/$RELEASENAME?helm_version=3</code></pre>
                </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Run this command on the admincli container to view the status of the
                    request.</span>
                <div class="itemgroup info"><pre class="pre codeblock"><code>curl -v --header 'Accept: application/json' -X GET http://cbur-master cbur.$CBUR_MASTER_NAMESPACE.svc.cluster.local:80/v2/task/7b59914d f521-41552b81b-765a45f85a42</code></pre>
                    By default, the <span class="ph">NCC</span> Backup and Recovery is
                    installed with Celery/Redis to support asynchronous functions. Rest API calls
                    return a taskId which may be used to query the status of the request with
                    another Rest API call.</div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Run this command to scale up the User and Role Management pods to the original
                    number obtained from the first step, once the restore of the ckey-cmdb release
                    is completed successfully.</span>
                <div class="itemgroup info">
                    <pre class="pre codeblock"><code>kubectl  scale sts &lt;ckey sts name&gt; --replicas=&lt;original ckey pods number&gt; -n  &lt;namespace name&gt;

Sample output

[root@nc1706node02 input-generator]# kubectl scale sts ckey-ckey --replicas=2 -n ig1
statefulset.apps/ckey-ckey scaled
[root@nc1706node02 input-generator]# kubectl get pods -n ig1 | grep "ckey"
ckey-ckey-0                                      0/3     Init:0/2           0          4s
ckey-ckey-1                                      0/3     Init:0/2           0          4s
ckey-cmdb-mariadb-0                              3/3     Running            0          5d22h
</code></pre>
                </div>
            </li>
</ol>

    </div>
<div class="footer"><hr /><p>Operations, Administration, and Maintenance Guide • P556766-DN1000055092-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>