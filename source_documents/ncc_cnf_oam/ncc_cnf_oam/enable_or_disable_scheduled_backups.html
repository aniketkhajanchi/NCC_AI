<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Scheduled backups" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="enable_or_disable_scheduled_backups" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Scheduled backups</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="enable_or_disable_scheduled_backups">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Scheduled backups</h1>
<div class="body conbody">
        <p class="p">User and Role Management, <span class="ph">NCC</span> Telemetry, and <span class="ph">NCC</span> components for which backup and restore has been
            enabled, are configured out of the box to periodically perform an automatic backup of
            their vital data, according to a configurable schedule which is set by default to once a
            day at midnight.</p>

        <p class="p">These automatic backups are performed through cronjobs that can be enabled/disabled and
            configured with different schedules through a Helm upgrade. This requires the
                <span class="keyword parmname">autoUpdateCron</span> parameter value set to <code class="ph codeph">true</code>,
            which is the default value, at initial install time.</p>

        <p class="p">Alternatively, enabling or disabling of scheduled backup cronJobs can also be performed
            with a curl command from the admincli container or any other container that supports
            curl commands (example: calm pod) for components which support calling of an <span class="ph">NCC</span> Backup and Recovery Rest API. For more information, see
                <a class="xref" href="default_brpolicy_objects.html">Default NCC Backup and Recovery objects</a></p>

        <div class="section"><h2 class="title sectiontitle">Enabling and disabling scheduled backups with a helm upgrade</h2>
            
            <ol class="ol" id="enable_or_disable_scheduled_backups__ol_ex1_qmy_bnb">
                <li class="li">
                    <p class="p">To enable scheduled backups with a helm upgrade command, run the following
                        command on a control node.</p>

                    <div class="p">
                        <pre class="pre codeblock"><code>helm upgrade &lt;component_name&gt;  &lt;component_chart&gt; -n $NAMESPACE  --set cbur.autoEnableCron=true,cbur.autoUpdateCron=true --reuse-values --no-hooks --wait</code></pre>
                    </div>

                    <div class="p">Where:<ul class="ul" id="enable_or_disable_scheduled_backups__ul_ql1_vmy_bnb">
                            <li class="li"><code class="ph codeph">&lt;component_name&gt;</code> is the name of the
                                component.</li>

                            <li class="li"><code class="ph codeph">&lt;component_chart&gt;</code> is the file name of the
                                component chart file.</li>

                        </ul>
</div>

                    <p class="p">For example, to enable scheduled backups for User and Role Management <span class="ph">NCC</span> Backup and Recovery policy, use the
                        following helm command on a control node.</p>

                    <div class="p">
                        <pre class="pre codeblock"><code>helm upgrade ckey ckey-chart-*.tgz -n $NAMESPACE  --set cbur.autoEnableCron=true,cbur.autoUpdateCron=true --reuse-values --no-hooks --wait</code></pre>
                    </div>

                </li>

                <li class="li">
                    <p class="p">To disable scheduled backups with a helm upgrade command, run the following
                        command on a control node.</p>

                    <div class="p">
                        <pre class="pre codeblock"><code>helm upgrade ckey ckey-chart-*.tgz -n $NAMESPACE  --set cbur.autoEnableCron=false,cbur.autoUpdateCron=true --reuse-values --no-hooks --wait</code></pre>
                    </div>

                    <div class="p">Where:<ul class="ul" id="enable_or_disable_scheduled_backups__ul_o2r_bny_bnb">
                            <li class="li"><code class="ph codeph">&lt;component_name&gt;</code> is the name of the
                                component.</li>

                            <li class="li"><code class="ph codeph">&lt;component_chart&gt;</code> is the file name of the
                                component chart file.</li>

                        </ul>
</div>

                </li>

            </ol>

        </div>

        <div class="section"><h2 class="title sectiontitle">Enabling and disabling scheduled backups with a <span class="ph">NCC</span>
                Backup and Recovery Rest API call</h2>
            
            <p class="p">Two attributes of a BrPolicy are used to determine the desired behavior related to
                the cron job that schedules automatic backups:</p>

            <ul class="ul">
                <li class="li"><code class="ph codeph">autoEnableCron</code>: indicates if the cron job should be
                    automatically created and activated as soon as the BrPolicy is created, at
                    install time. If this value is specified as false then the cronjob will have to
                    be enabled manually later on. If this parameter is changed to true with a helm
                    upgrade, it will only have effect if the parameter
                        <code class="ph codeph">autoUpdateCron</code> in the BrPolicy is set to true.</li>

                <li class="li"><code class="ph codeph">autoUpdateCron</code>: indicates if the cron job should be
                    automatically updated when the changes related to a cronjob for a BrPolicy are
                    modified via a helm upgrade. If this value is set to false during installation,
                    then it has to be set to true during the helm upgrade performed to change the
                    cron job schedules, otherwise the cronjob has to be manually disabled and then
                    re-enabled in order to pick up the changes.</li>

            </ul>

            <p class="p">This table shows the name of the parameters in each component. The out of the box
                value is the value set in the overrides produced by the input generator when the
                Backup and Recovery feature is enabled.</p>

            <table cellpadding="4" cellspacing="0" summary="" id="enable_or_disable_scheduled_backups__table_xhx_4cn_vrb" class="table" width="100%" frame="border" border="1" rules="all"><caption><span class="tablecap"><span class="table--title-label">Table: </span>Component parameters</span></caption><colgroup><col style="width:10%" /><col style="width:10%" /><col style="width:30%" /><col style="width:10%" /><col style="width:30%" /><col style="width:10%" /></colgroup><thead class="thead" style="text-align:left;">
                        <tr class="row">
                            <th class="entry cellrowborder" style="vertical-align:top;" id="d50583e181">Component</th>

                            <th class="entry cellrowborder" style="vertical-align:top;" id="d50583e184">Release name example</th>

                            <th class="entry cellrowborder" style="vertical-align:top;" id="d50583e187">Parameter name for automatic enabling of cron job</th>

                            <th class="entry cellrowborder" style="vertical-align:top;" id="d50583e190">Out of the box value</th>

                            <th class="entry cellrowborder" style="vertical-align:top;" id="d50583e193">Parameter name for automatic update of cron job</th>

                            <th class="entry cellrowborder" style="vertical-align:top;" id="d50583e197">Out of the box value</th>

                        </tr>

                    </thead>
<tbody class="tbody">
                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e181 ">admincli</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e184 ">*-admincli</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e187 ">cbur.autoEnableCron </td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e190 ">true</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e193 ">cbur.autoUpdateCron</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e197 ">true</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e181 ">csdc</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e184 ">*-csdc</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e187 ">cbur.autoEnableCron</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e190 ">true</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e193 ">cbur.autoUpdateCron</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e197 ">false</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e181 ">ckey</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e184 ">ckey</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e187 ">cbur.autoEnableCron</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e190 ">true</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e193 ">cbur.autoUpdateCron</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e197 ">true</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e181 ">cmdb</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e184 ">ckeycmdb</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e187 ">cmdb.cbur.autoEnableCron</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e190 ">true</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e193 ">cmdb.cbur.autoUpdateCron</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e197 ">true</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e181 ">btel cmdb</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e184 ">*-cmdb</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e187 ">cbur.autoEnableCron</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e190 ">true</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e193 ">cbur.autoUpdateCron</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e197 ">true</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e181 ">ss7 cmdb</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e184 ">*- ss7cmdb</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e187 ">cbur.autoEnableCron</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e190 ">true</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e193 ">cbur.autoUpdateCron</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e197 ">false</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e181 ">cpro</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e184 ">*-cpro</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e187 ">server.cbur.autoEnableCron</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e190 ">true</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e193 ">server.cbur.autoUpdateCron</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e197 ">true</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e181 ">gen3gppxml</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e184 ">cpro-gen3gppxml</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e187 ">cbur.autoEnableCron</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e190 ">true</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e193 ">cbur.autoUpdateCron</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e197 ">true</td>

                        </tr>

                    </tbody>
</table>

            <p class="p">Some attributes of a BrPolicy, like the maximum number of copies of backup data to
                keep or the schedules of the cronjob that performs automatic backups, can be
                modified with a helm upgrade of the release that created the BrPolicy, passing the
                proper parameters for the values to be changed.</p>

            <p class="p">This table shows the names of the parameters to use with a helm upgrade to modify
                such values in the desired BrPolicy:</p>

            <table cellpadding="4" cellspacing="0" summary="" id="enable_or_disable_scheduled_backups__table_yhx_4cn_vrb" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap"><span class="table--title-label">Table: </span>BrPolicy parameters</span></caption><colgroup><col style="width:16.666666666666664%" /><col style="width:16.666666666666664%" /><col style="width:33.33333333333333%" /><col style="width:33.33333333333333%" /></colgroup><thead class="thead" style="text-align:left;">
                        <tr class="row">
                            <th class="entry cellrowborder" style="vertical-align:top;" id="d50583e410">Component</th>

                            <th class="entry cellrowborder" style="vertical-align:top;" id="d50583e413">Release name example</th>

                            <th class="entry cellrowborder" style="vertical-align:top;" id="d50583e416">Parameter name for max no of backup copies</th>

                            <th class="entry cellrowborder" style="vertical-align:top;" id="d50583e419">Parameter name for cron job schedules</th>

                        </tr>

                    </thead>
<tbody class="tbody">
                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e410 ">admincli</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e413 ">*-admincli</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e416 ">cbur.maxCopy.</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e419 ">cbur.cronSpec</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e410 ">csdc</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e413 ">*-csdc</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e416 ">cbur.maxiCopy</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e419 ">cbur.cronSpec</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e410 ">ckey</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e413 ">ckey</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e416 ">cbur.maxiCopy</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e419 ">cbur.cronSpec</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e410 ">cmdb</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e413 ">ckey-cmdb</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e416 ">cbur.maxiCopy</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e419 ">cbur.cronSpec</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e410 ">btel cmdb</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e413 ">*-cmdb</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e416 ">cbur.maxiCopy</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e419 ">cbur.cronSpec</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e410 ">ss7 cmdb</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e413 ">*- ss7cmdb</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e416 ">cbur.maxiCopy</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e419 ">cbur.cronSpec</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e410 ">cpro</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e413 ">*-cpro</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e416 ">server.cbur.maxCopy</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e419 ">server.cbur.cronJob</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e410 ">gen3gppxml</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e413 ">cpro-gen3gppxml</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e416 ">cbur.maxCopy</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d50583e419 ">cbur.cronJob</td>

                        </tr>

                    </tbody>
</table>

            <p class="p">Manual enabling/disabling of a scheduled backups cronjob for a BrPolicy which does
                not support autoUpdateCron and autoEnableCron parameters is performed by calling a
                Backup and Recovery Rest API through a curl command from the admincli container.</p>

            <div class="p">
                <ol class="ol" id="enable_or_disable_scheduled_backups__ol_fsg_fny_bnb">
                    <li class="li">
                        <p class="p">Set the following to the appropriate value.</p>

                        <div class="p">
                            <pre class="pre codeblock"><code>NAMESPACE=&lt;namespace&gt;</code></pre>
                        </div>

                        <div class="p">Where,<ol class="ol" type="a" id="enable_or_disable_scheduled_backups__ol_rg3_hny_bnb">
                                <li class="li"><code class="ph codeph">&lt;namespace&gt;</code> is the namespace of the
                                    component to be enabled scheduled backups.</li>

                            </ol>
</div>

                        <p class="p">For example, for a component with namespace
                            <code class="ph codeph">sps-btel-ig</code>:</p>

                        <div class="p">
                            <pre class="pre codeblock"><code>NAMESPACE=sps-btel-ig</code></pre>
                        </div>

                    </li>

                    <li class="li">
                        <p class="p">Find the desired <span class="ph">NCC</span> Backup and Recovery
                            policy name by running the following command on a control node.</p>

                        <div class="p">
                            <pre class="pre codeblock"><code>kubectl get brpolices.cbur.csf.nokia.com -n $NAMESPACE</code></pre>
                        </div>

                        <p class="p">Scheduled backups may be enabled or disabled for specific <span class="ph">NCC</span> Backup and Recovery policies. The
                            following is an example of output which one might expect.</p>

                        <div class="p">
                            <pre class="pre codeblock"><code>#Example output:
# NAME                AGE
# ckey-ckey           23h
# ckey-cmdb-mariadb   23h
# btel-gen3gppxml     162m
# cmdb-mariadb        162m
# cpro-server         162m
# grafana             162m
# sps-btel-sps-admincli   11m
# sps-csdc                11m</code></pre>
                        </div>

                    </li>

                    <li class="li">
                        <p class="p">Use the name of the desired <span class="ph">NCC</span> Backup and
                            restore policy to enable or disable the desired scheduled backup. For
                            example, to indicate <code class="ph codeph">ckey-cmdb-mariadb</code>:</p>

                        <div class="p">
                            <pre class="pre codeblock"><code>BR_POLICY_NAME=ckey-cmdb-mariadb</code></pre>
                        </div>

                    </li>

                    <li class="li">
                        <p class="p">Run the following command in a control node to get information about the
                            current cronJob specifications, whether or not scheduled backups are
                            enabled, and backup history data.</p>

                        <div class="p">
                            <pre class="pre codeblock"><code>kubectl describe brpolices.cbur.csf.nokia.com $BR_POLICY_NAME -n $NAMESPACE</code></pre>
                        </div>

                    </li>

                    <li class="li">
                        <p class="p">Enable scheduled backups for the policy specified in
                                <code class="ph codeph">BR_POLICY_NAME</code> by issuing the following command on
                            the admincli container.</p>

                        <div class="p">
                            <pre class="pre codeblock"><code>NAMESPACE=sps-btel-ig
CBUR_MASTER_NAMESPACE=sps-btel-ig
BR_POLICY_NAME=ckey-cmdb-mariadb
curl -vkL -X PUT "http://cbur-master-cbur.$CBUR_MASTER_NAMESPACE.svc.cluster.local:80/v2/cronjob/$NAMESPACE/$BR_POLICY_NAME?query_from=k8swatcher" -H  "accept: application/json"</code></pre>
                        </div>

                    </li>

                    <li class="li">
                        <p class="p">Disable scheduled backups for the policy specified in
                                <code class="ph codeph">BR_POLICY_NAME</code> by issuing the following command on
                            the admincli container.</p>

                        <div class="p">
                            <pre class="pre codeblock"><code>curl -vkL -X DELETE "http://cbur-master-cbur.$CBUR_MASTER_NAMESPACE.svc.cluster.local:80/v2/cronjob/$NAMESPACE/$BR_POLICY_NAME?query_from=k8swatcher" -H  "accept: application/json"</code></pre>
                        </div>

                    </li>

                    <li class="li">
                        <p class="p">Check the current cronJobs for scheduled backups in the <span class="ph">NCC</span> Backup and Recovery namespace to ensure
                            the desired outcome.</p>

                        <div class="p">
                            <pre class="pre codeblock"><code>kubectl get cronjob -n $CBUR_MASTER_NAMESPACE</code></pre>
                        </div>

                        <p class="p">An example output is given below.</p>

                        <div class="p">
                            <pre class="pre codeblock"><code># This is an example output:
# NAME                         SCHEDULE    SUSPEND   ACTIVE   LAST SCHEDULE   AGE
# ckey-ckey-sps-btel           0 4 * * *   False     0        &lt;none&gt;          46m
# ckey-cmdb-mariadb-sps-btel   0 3 * * *   False     0        &lt;none&gt;          49m</code></pre>
                        </div>

                    </li>

                </ol>

            </div>

        </div>

    </div>
<div class="footer"><hr /><p>Operations, Administration, and Maintenance Guide • P556766-DN1000055092-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>