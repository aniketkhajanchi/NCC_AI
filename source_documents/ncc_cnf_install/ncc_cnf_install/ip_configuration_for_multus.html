<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="task" />
<meta name="DC.title" content="Finding IP addresses to configure in Multus" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="ip_configuration_for_multus" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Finding IP addresses to configure in Multus</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="ip_configuration_for_multus">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Finding IP addresses to configure in Multus</h1>
<div class="body taskbody">
        <div class="section context" id="ip_configuration_for_multus__context_ojz_wq5_1rb"><div class="tasklabel"><h2 class="sectiontitle tasklabel"></h2></div>
            <p class="p">This procedure provides instructions on how to find the IP addresses that you need to
                configure in Multus. The purpose of this procedure is to provide guidance only. Each
                user can have different ways to do the configuration. You might use this procedure
                as reference.</p>

            <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div>  This procedure has been executed and tested with cniVersion: "0.3.1".</div>

        </div>

        <div class="tasklabel"><h2 class="sectiontitle tasklabel"></h2></div><ol class="ol steps" id="ip_configuration_for_multus__steps_pjz_wq5_1rb"><li class="li step stepexpand">
                <span class="ph cmd">Find node interfaces in Kubernetes.</span>
                <div class="itemgroup info">
                    <p class="p">Each node in Kubernetes has two or more interfaces (that is, network
                        adapters) as the following example with the node
                            <code class="ph codeph">nc1870node02</code> shows.</p>

                    <p class="p">Example:</p>

                    <pre class="pre codeblock"><code>FQDN,Interface,IPv4,IPv4 Mask,IPv4 GW,IPv4 Network,IPv6,IPv6 GW,IPv6 Network,Private IP,Private Mask,Private GW,Network,MAC
nc1870node02.tre.nsn-rdnet.net,Network adapter 1,10.10.179.222,255.255.240.0,10.10.176.1,10.10.176.0/20,2a00:8a00:4000:020c:
0000:0000:0111:03db,2A00:8A00:4000:020C:0000:0000:0111:0001,2A00:8A00:4000:020C:
0000:0000:0111:0000/112,,,,VLAN375,00:50:56:a9:56:d5 
,Network adapter 2,10.93.39.118,255.255.240.0,10.93.32.1,10.93.32.0/20,2a00:8a00:4000:020c:
0000:0000:0039:0776,2a00:8a00:4000:020c:0000:0000:0039:0001,2a00:8a00:4000:020c:
0000:0000:0039:0000/112,,,,VLAN394,00:50:56:a9:3d:b8
,Network adapter 3,10.93.69.226,255.255.240.0,10.93.64.1,10.93.64.0/20,2a00:8a00:4000:020c:
0000:0000:0133:05e2,2a00:8a00:4000:020c:0000:0000:0133:0001,2a00:8a00:4000:020c:
0000:0000:0133:0000/112,,,,VLAN396,00:50:56:a9:3d:05
,Network adapter 4,10.93.25.87,255.255.240.0,10.93.16.1,10.93.16.0/20,2a00:8a00:4000:020c:
0000:0000:0030:0957,2A00:8A00:4000:020C:0000:0000:0030:0001,2A00:8A00:4000:020C:
0000:0000:0030:0000/112,,,,VLAN393,00:50:56:a9:e5:06
,Network adapter 5,10.93.53.188,255.255.240.0,10.93.48.1,10.93.48.0/20,2a00:8a00:4000:020c:
0000:0000:0132:05bc,2a00:8a00:4000:020c:0000:0000:0132:0001,2a00:8a00:4000:020c:
0000:0000:0132:0000/112,,,,VLAN395,00:50:56:a9:81:f9
</code></pre>
                    <p class="p">The following shows the interfaces on the <code class="ph codeph">nc1870node02</code>
                        node.</p>

                    <pre class="pre codeblock"><code>[root@nc1870node02 ~]# ip a 
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 00:50:56:a9:e5:06 brd ff:ff:ff:ff:ff:ff
    inet 10.93.25.87/20 brd 10.93.31.255 scope global noprefixroute eth0
       valid_lft forever preferred_lft forever
    inet6 2a00:8a00:4000:20c::30:957/112 scope global noprefixroute
       valid_lft forever preferred_lft forever
    inet6 fe80::250:56ff:fea9:e506/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 00:50:56:a9:56:d5 brd ff:ff:ff:ff:ff:ff
    inet 10.10.179.222/20 brd 10.10.191.255 scope global noprefixroute eth1
       valid_lft forever preferred_lft forever
    inet6 2a00:8a00:4000:20c::111:3db/112 scope global noprefixroute
       valid_lft forever preferred_lft forever
    inet6 fe80::250:56ff:fea9:56d5/64 scope link noprefixroute
       valid_lft forever preferred_lft forever

4: eth2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 00:50:56:a9:81:f9 brd ff:ff:ff:ff:ff:ff
    inet 10.93.53.188/20 brd 10.93.63.255 scope global noprefixroute eth2
       valid_lft forever preferred_lft forever
    inet6 2a00:8a00:4000:20c::132:5bc/112 scope global noprefixroute
       valid_lft forever preferred_lft forever
    inet6 fe80::250:56ff:fea9:81f9/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
5: eth3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 00:50:56:a9:3d:b8 brd ff:ff:ff:ff:ff:ff
    inet 10.93.39.118/20 brd 10.93.47.255 scope global noprefixroute eth3
       valid_lft forever preferred_lft forever
    inet6 2a00:8a00:4000:20c::39:776/112 scope global noprefixroute
       valid_lft forever preferred_lft forever
    inet6 fe80::250:56ff:fea9:3db8/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
6: eth4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 00:50:56:a9:3d:05 brd ff:ff:ff:ff:ff:ff
    inet 10.93.69.226/20 brd 10.93.79.255 scope global noprefixroute eth4
       valid_lft forever preferred_lft forever
    inet6 2a00:8a00:4000:20c::133:5e2/112 scope global noprefixroute
       valid_lft forever preferred_lft forever
    inet6 fe80::250:56ff:fea9:3d05/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
</code></pre>
                </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Choose an interface to be <code class="ph codeph">master</code> in Multus CNI.</span>
                <div class="itemgroup info">
                    <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> Each interface can be considered as <code class="ph codeph">master</code> in Multus
                        CNI.</div>

                    <p class="p">The following is an example of network-attachment-definition (NAD) that shows
                        that each interface belongs to a VALN, which is associated with Virtual
                        IPs.</p>

                    <pre class="pre codeblock"><code>apiVersion: "k8s.cni.cncf.io/v1"
kind: NetworkAttachmentDefinition
metadata:
 name: ipvlan-conf1
 namespace: sps-ig
spec:
 config: '{
  "cniVersion": "0.3.1",
  "type": "ipvlan",
  "master": "eth2",
  "mode": "l2",
  "ipam": {
    "type": "static",
    "routes": [ { "dst": "10.11.148.128/26", "gw": "10.93.48.1" } ],
    "gateway": "10.93.48.1"
  }
}'
</code></pre>
                </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Configure the annotation for the NAD by choosing the Virtual IPs that belong to
                    the master one.</span>
                <div class="itemgroup info">
                    <p class="p">The following example shows Virtual IPs associated with the VLANs,</p>

                    <pre class="pre codeblock"><code>nc1870vip5_01.tre.nsn-rdnet.net,Virtual IP,10.93.53.210,255.255.240.0,10.93.48.1,10.93.48.0/20,2a00:8a00:4000:020c:
0000:0000:0132:05d2,2a00:8a00:4000:020c:0000:0000:0132:0001,2a00:8a00:4000:020c:
0000:0000:0132:0000/112,,,,VLAN395,
nc1870vip5_02.tre.nsn-rdnet.net,Virtual IP,10.93.53.211,255.255.240.0,10.93.48.1,10.93.48.0/20,2a00:8a00:4000:020c:
0000:0000:0132:05d3,2a00:8a00:4000:020c:0000:0000:0132:0001,2a00:8a00:4000:020c:
0000:0000:0132:0000/112,,,,VLAN395,
nc1870vip5_03.tre.nsn-rdnet.net,Virtual IP,10.93.53.212,255.255.240.0,10.93.48.1,10.93.48.0/20,2a00:8a00:4000:020c:
0000:0000:0132:05d4,2a00:8a00:4000:020c:0000:0000:0132:0001,2a00:8a00:4000:020c:
0000:0000:0132:0000/112,,,,VLAN395,
nc1870vip5_04.tre.nsn-rdnet.net,Virtual IP,10.93.53.213,255.255.240.0,10.93.48.1,10.93.48.0/20,2a00:8a00:4000:020c:
0000:0000:0132:05d5,2a00:8a00:4000:020c:0000:0000:0132:0001,2a00:8a00:4000:020c:
0000:0000:0132:0000/112,,,,VLAN395,nc1870vip2_05.tre.nsn-rdnet.net,Virtual 
</code></pre>
                </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Find the IPs by doing mapping as follows:</span>
                <div class="itemgroup info">
                    <p class="p">Worker-node master eth interface -&gt; corresponding VLAN -&gt; corresponding
                        Virtual IPs</p>

                    <p class="p">Example:</p>

                    <pre class="pre codeblock"><code>Eth2 -&gt; VLAN395 -&gt; 10.93.53.210
Eth2 -&gt; VLAN395 -&gt; 10.93.53.211
Eth2 -&gt; VLAN395 -&gt; 10.93.53.212
</code></pre>
                </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Ensure that the annotation has the right format.</span>
                <div class="itemgroup info">Using the example in step 4, the following is the example of
                            annotation.<pre class="pre codeblock"><code>custom:
  deployment:
    annotations:
      k8s.v1.cni.cncf.io/networks: '[{"name": "ipvlan-conf1","ips": ["10.93.54.210/20"],"interface": "macvlan1"},{"name": "ipvlan-conf2","ips": ["10.93.39.140/20"],"interface": "macvlan2"}]'

</code></pre><p class="p"><strong class="ph b">Expected
                            output</strong></p>
<p class="p">The following shows that after successful deployment,
                        interfaces are added in
                    pod</p>
<pre class="pre codeblock"><code>eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500 
        inet 192.168.44.158  netmask 255.255.255.255  broadcast 0.0.0.0
        ether fa:fa:5b:6a:18:4e  txqueuelen 0  (Ethernet)
        RX packets 469  bytes 1770656 (1.6 MiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 401  bytes 173799 (169.7 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

macvlan1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet 10.93.53.210  netmask 255.255.255.255  broadcast 10.93.53.210
        ether 00:50:56:a9:78:83  txqueuelen 0  (Ethernet)
        RX packets 6  bytes 360 (360.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

macvlan2: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
        inet 10.93.39.140  netmask 255.255.255.255  broadcast 10.93.39.140
        ether 00:50:56:a9:65:29  txqueuelen 0  (Ethernet)
        RX packets 26  bytes 8294 (8.0 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 81  bytes 12351 (12.0 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 81  bytes 12351 (12.0 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</code></pre></div>
                <div class="itemgroup info">
                    <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> The peer/destination gateway needs to be mentioned in CNI for the peer
                        network reachability. In similar way, at peer machine, for peer to pod
                        network reachability, routes and gateways need to be added.</div>

                </div>
            </li>
</ol>

    </div>
<div class="footer"><hr /><p>Installation and Upgrade Guide • P556766-DN1000055103-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>