<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Trigger attribute support for 5G calls" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="id9yz-09126-ug01-pczza-sp1-d1e26182" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Trigger attribute support for 5G calls</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="id9yz-09126-ug01-pczza-sp1-d1e26182">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Trigger attribute support for 5G calls</h1>
<div class="body conbody">
        <p class="p">This section provides information about the support for the <var class="keyword varname">Trigger</var>
            AVP in NCC for 5G calls for both MSCC level and root level.</p>

        <p class="p">NCC call controller supports <var class="keyword varname">Trigger</var> AVP in CCA for 5G, via rules.
            This support is available for Gy interface. The <var class="keyword varname">Trigge</var> AVP is
            supported for both de-centralized and centralized calls. This AVP comes into picture
            only if some quantity is reserved and granted in CCA.</p>

<div class="section"><h2 class="title sectiontitle">Trigger AVP</h2>
<p class="p">The Trigger AVP is of type Grouped and holds a single trigger type and other trigger information.
                The presence of the Trigger AVP without any <em class="ph i">Trigger-Type</em> AVP in a CCA allows
                OCS to disable all the triggers. The presence of the Trigger AVP in the CCR
                identifies the event(s) triggering the CCR.</p>

</div>

<div class="section"><h2 class="title sectiontitle">Trigger-Type AVP</h2>
<p class="p">The <em class="ph i">Trigger-Type</em> AVP is of type Enumerated and indicates a single re-authorisation event
                type. When included in the Credit Control Answer command, the <em class="ph i">Trigger-Type</em>
                AVP indicates the events that shall cause the credit control client to re-authorize
                the associated quota. The client shall not re-authorize the quota when events which
                are not included in the Trigger AVP occur. When included in the Credit Control
                Request command, it indicates the specific event which caused the re-authorisation
                request of the <em class="ph i">Reporting-Reason</em> with value
                    <var class="keyword varname">RATING_CONDITION_CHANGE</var> associated.</p>

</div>

<div class="section"><h2 class="title sectiontitle">Trigger-Category AVP</h2>
<p class="p">This AVP indicates whether the charging data generated for the trigger lead to a charging event
                towards NCC immediately or not. The valid values are described in the following
                table:</p>

<table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><colgroup><col /><col /></colgroup><thead class="thead" style="text-align:left;">
                        <tr class="row">
                            <th class="entry cellrowborder" style="vertical-align:top;" id="d100390e90">
                                <p class="p">Trigger category</p>

                           </th>

                            <th class="entry cellrowborder" style="vertical-align:top;" id="d100390e96">
                                <p class="p">Description</p>

                           </th>

                        </tr>

                    </thead>
<tbody class="tbody">
                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d100390e90 ">TriggerCategory_IMMEDIATE_REPORT</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d100390e96 ">The charging data generated for a trigger leads to charging
                                event towards NCC immediately.</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d100390e90 ">TriggerCategory_DEFERRED_REPORT</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d100390e96 ">The charging data generated for a trigger does not lead to a
                                charging event towards NCC.</td>

                        </tr>

                    </tbody>
</table>

</div>

<div class="section"><h2 class="title sectiontitle">Trigger arming</h2><p class="p">Adding triggers to a response is called arming. This is
                done by selecting any <var class="keyword varname">triggerType</var> except for
                    <var class="keyword varname">NCHF_DISARMING</var>. In this case triggers are sent in response at
                the selected level.</p>
<p class="p">There are a number of mid-session service events
                (triggers), which affect the rating of the current service usage, for example,
                end-user QoS changes or location updates. Some of these services can be
                enabled/disabled. For such events, when allocating resources NCC may instruct to
                update the unit upon a number of different session-related triggers that can affect
                the rating conditions. NCC instructs to monitor for such events by using the Trigger
                element containing a single trigger type. Once the triggers are armed then these
                triggers remain in effect until other triggers are not armed.</p>
<p class="p"><strong class="ph b">Example of
                    armed triggers in response</strong></p>
<p class="p">Root level:
                </p>
<pre class="pre codeblock"><code>{"invocationTimeStamp":"2020-07-27T09:05:23Z","invocationSequenceNumber":0,"triggers":[{"triggerType":"QUOTA_THRESHOLD","triggerCategory":"IMMEDIATE_REPORT","timeLimit":2100,"volumeLimit":1,"volumeLimit64":123,"maxNumberOfccc":1234},{"triggerType":"VALIDITY_TIME","triggerCategory":"IMMEDIATE_REPORT","timeLimit":32100,"volumeLimit":31,"volumeLimit64":3123,"maxNumberOfccc":31234}],"multipleUnitInformation":[{"ratingGroup":5,"resultCode":"SUCCESS","grantedUnit":{"totalVolume":5368709120},"validityTime":"10","quotaHoldingTime":10}]}</code></pre><p class="p">MSCC
                level:</p>
<pre class="pre codeblock"><code>{"invocationTimeStamp":"2020-07-27T09:07:24Z","invocationSequenceNumber":0,"multipleUnitInformation":[{"ratingGroup":5,"resultCode":"SUCCESS","grantedUnit":{"totalVolume":5368709120},"triggers":[{"triggerType":"OTHER_QUOTA_TYPE","triggerCategory":"IMMEDIATE_REPORT","timeLimit":2100,"volumeLimit":1,"volumeLimit64":123,"maxNumberOfccc":1234},{"triggerType":"GFBR_GUARANTEED_STATUS_CHANGE","triggerCategory":"IMMEDIATE_REPORT","timeLimit":32100,"volumeLimit":31,"volumeLimit64":3123,"maxNumberOfccc":31234}],"validityTime":"10","quotaHoldingTime":10}]}</code></pre>The
            following figure provides an example scenario for arming 5G triggers at MSCC level.<div class="fig fignone" id="id9yz-09126-ug01-pczza-sp1-d1e26182__fig_ycm_bxz_wmb"><span class="figcap"><span class="fig--title-label">Figure: </span>Example: Rule for trigger arming</span>
                
                <img class="image break" id="id9yz-09126-ug01-pczza-sp1-d1e26182__image_zcm_bxz_wmb" height="240" src="../images/trig_arming_5g.jpg" width="576" />
            </div>
</div>

<div class="section"><h2 class="title sectiontitle">Trigger disarming</h2><p class="p">Disarming can be done when the Triggers element is
                present without any trigger type in a response message. This allows NCC to disable
                all the triggers that were armed in a previous Trigger element of the same service
                usage/rating group.</p>
<p class="p">Removing triggers from a response is called as disarming.
                This is done by selecting the <var class="keyword varname">triggerType</var> as
                    <var class="keyword varname">NCHF_DISARMING</var>. In this case, an empty trigger list is sent
                to SMF, which indicates disarming of all triggers at the selected
                    level.</p>
<div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> <var class="keyword varname">NCHF_DISARMING</var> is a custom trigger type and
                is not present in the specification for the <var class="keyword varname">triggerType</var> enum. It
                is provided for configuring trigger disarming.</div>
<p class="p"><strong class="ph b">Example of disarmed
                    triggers in response</strong></p>
<p class="p">Root level:
                </p>
<pre class="pre codeblock"><code>{"invocationTimeStamp":"2020-07-22T14:01:28Z","invocationSequenceNumber":0,"triggers":[],"multipleUnitInformation":[{"ratingGroup":5,"resultCode":"SUCCESS","grantedUnit":{"totalVolume":5368709120},"validityTime":"10","quotaHoldingTime":10}]}</code></pre><p class="p">MSCC
                level:</p>
<pre class="pre codeblock"><code>{"invocationTimeStamp":"2020-07-27T09:14:08Z","invocationSequenceNumber":0,"multipleUnitInformation":[{"ratingGroup":5,"resultCode":"SUCCESS","grantedUnit":{"totalVolume":5368709120},"triggers":[],"validityTime":"10","quotaHoldingTime":10}]}</code></pre>The
            following figure provides an example scenario for disarming 5G triggers at MSCC
                level.<div class="fig fignone" id="id9yz-09126-ug01-pczza-sp1-d1e26182__fig_kwr_hxz_wmb"><span class="figcap"><span class="fig--title-label">Figure: </span>Example: Rule for trigger disarming</span>
                
                <img class="image break" id="id9yz-09126-ug01-pczza-sp1-d1e26182__image_lwr_hxz_wmb" height="192" src="../images/trig_disarming_5g.jpg" width="576" />
            </div>
</div>

        <div class="section" id="id9yz-09126-ug01-pczza-sp1-d1e26182__section_ad3_lvv_5mb"><h2 class="title sectiontitle">Configuring triggers in response</h2>
            
            <p class="p"><strong class="ph b">Application preference</strong></p>

            <p class="p">To enable trigger in response, the application preference, <var class="keyword varname">Trigger Feature
                    Supported</var> must be set to <var class="keyword varname">true</var>. If it is set to
                    <var class="keyword varname">false</var>, then the triggers are not sent in the response, even
                if configured in rule.</p>

            <table cellpadding="4" cellspacing="0" summary="" id="id9yz-09126-ug01-pczza-sp1-d1e26182__table_gdd_1d1_xmb" class="table" frame="border" border="1" rules="all"><colgroup><col /><col /><col /></colgroup><thead class="thead" style="text-align:left;">
                        <tr class="row">
                            <th class="entry cellrowborder" style="vertical-align:top;" id="d100390e237">
                                <p class="p">Trigger Feature Supported</p>

                           </th>

                            <th class="entry cellrowborder" style="vertical-align:top;" id="d100390e243">
                                <p class="p">And...</p>

                           </th>

                            <th class="entry cellrowborder" style="vertical-align:top;" id="d100390e249">
                                <p class="p">Then</p>

                           </th>

                        </tr>

                    </thead>
<tbody class="tbody">
                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d100390e237 ">False</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d100390e243 ">-</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d100390e249 ">No change</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d100390e237 ">True</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d100390e243 ">Trigger Received in CCR-U is armed</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d100390e249 ">No change</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d100390e237 ">True</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d100390e243 ">Trigger Received in CCR-U is NOT armed</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d100390e249 ">Ignores the triggered Value received in the request, takes the
                                appropriate value from database (last request) and continue with existing
                                logic.</td>

                        </tr>

                    </tbody>
</table>

            <p class="p"><strong class="ph b">Rule</strong></p>

            <p class="p">In rules, configure <em class="ph i">Arm-Nchf-Trigger</em> attribute. It has the following
                parameters:</p>

            <ul class="ul" id="id9yz-09126-ug01-pczza-sp1-d1e26182__ul_lcv_bwv_5mb">
                <li class="li">TriggerLevel <p class="p">The values can be <var class="keyword varname">root</var> or
                            <var class="keyword varname">mscc</var>. Trigger type must be considered while adding
                        this input.</p>
</li>

                <li class="li">NCHFTriggerType</li>

                <li class="li">TriggerCategory</li>

                <li class="li">TimeLimit <em class="ph i">(optional)</em></li>

                <li class="li">VolumeLimit <em class="ph i">(optional)</em></li>

                <li class="li">VolumeLimit64 <em class="ph i">(optional)</em></li>

                <li class="li">MaxNumberOfCCC <em class="ph i">(optional)</em></li>

            </ul>

        </div>

        <div class="section" id="id9yz-09126-ug01-pczza-sp1-d1e26182__section_fjr_twz_wmb"><h2 class="title sectiontitle">Consider the following points for NCHF triggers</h2>
            
            <ul class="ul" id="id9yz-09126-ug01-pczza-sp1-d1e26182__ul_bpk_h55_5mb">
                <li class="li">For an N40 initial/update request, NCHF triggers can be present in both request
                    and response.</li>

                <li class="li">
                    <p class="p">When sending a trigger list in the request, the
                            <code class="ph codeph">triggerCategory</code> must be sent. If it is not available,
                        then an error AVP is returned in response. Refer to the following
                        example:</p>

                    <div class="p">
                        <pre class="pre codeblock"><code>{"invocationTimestamp":"2020-07-27T14:07:05Z","invocationResult":{"error":{"type":"http:\/\/135.249.88.102:8081\/nchf-convergedcharging\/v1\/chargingdata\/N40-sps-me-b988747c-a282-4491-b5f7-679968eaa955\/update","title":"Attribute missing","status":400,"detail":"triggerCategory is not present at UsedUnitContainer level in 5G UPDATE_REQUEST","instance":"sps-me\/sps102\/N40-sps-me-b988747c-a282-4491-b5f7-679968eaa955","cause":"MANDATORY_IE_MISSING"}},"invocationSequenceNumber":1}</code></pre>
                    </div>

                </li>

                <li class="li">In requests, NCHF triggers are used in rules with <em class="ph i">NCHF_CHARGING_MESSAGE</em>
                    source context.</li>

                <li class="li">In responses, NCHF triggers can be sent at two levels (that is,
                        <var class="keyword varname">root</var> or <var class="keyword varname">MSCC</var>).<div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div>  Arming or
                        disarming of triggers at root level disables all the changes accepted at
                        MSCC level.</div>
<ul class="ul" id="id9yz-09126-ug01-pczza-sp1-d1e26182__ul_nrv_wx5_5mb">
                        <li class="li">Root level: <em class="ph i">NCHF_CHARGING_CALL_ESTABLISHMENT</em> and
                                <em class="ph i">NCHF_CHARGING_CALL_MODIFICATION</em> triggers are configured at
                            root level. .<div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> In this configuration, while arming the trigger, the
                                    <var class="keyword varname">triggerLevel</var> is set as
                                    <var class="keyword varname">root</var>.</div>
</li>

                        <li class="li">MSCC level: <em class="ph i">RATING_POST_PROCESSING</em> trigger is configured at MSCC
                                level.<div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> In this configuration, while arming the trigger, the
                                    <var class="keyword varname">triggerLevel</var> is set as
                                    <var class="keyword varname">mscc</var></div>
</li>

                    </ul>
</li>

            </ul>

        </div>

</div>
<div class="footer"><hr /><p>Charging User Guide • P556766-DN1000054947-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>