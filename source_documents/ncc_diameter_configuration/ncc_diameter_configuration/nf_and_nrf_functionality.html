<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="NF and NRF functionality" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="nf_and_nrf_functionality" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>NF and NRF functionality</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="nf_and_nrf_functionality">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">NF and NRF functionality</h1>
<div class="body conbody">
        <p class="p">Network Repository Function (NRF) offers <code class="ph codeph">Nnrf_NFManagement</code> and
                <code class="ph codeph">Nnrf_NFDiscovery</code> services.</p>

        <p class="p">NCC offers the following services with NRF to other network functions:</p>

        <ul class="ul" id="nf_and_nrf_functionality__ul_bwc_35w_xnb">
            <li class="li"><a class="xref" href="#nf_and_nrf_functionality__nfreg">NFRegister</a></li>

            <li class="li"><a class="xref" href="#nf_and_nrf_functionality__nfdr">NFDeregister</a></li>

            <li class="li"><a class="xref" href="#nf_and_nrf_functionality__NFUpdate">NFUpdate</a></li>

            <li class="li"><a class="xref" href="#nf_and_nrf_functionality__NFHeartbeat">NFHeartbeat</a></li>

            <li class="li"><a class="xref" href="#nf_and_nrf_functionality__section_gft_ftx_1qb">NF Probe</a></li>

            <li class="li"><a class="xref" href="#nf_and_nrf_functionality__section_ufx_hg5_hwb">NF Discovery</a></li>

        </ul>

        <p class="p">To enable these services, set the application preference <em class="ph i">NRF: Feature Enabled</em> to
                <var class="keyword varname">true</var> and ensure that the site status must be
                <var class="keyword varname">UP</var>, and at least one NRF Server Set is associated with the NF
            Profile. For more information on <em class="ph i">NRF: Feature Enabled</em> application preference, see
                <em class="ph i">Policy application preferences</em>.</p>

        <p class="p"><strong class="ph b">NCC NF components to handle communication with NRF</strong></p>

        <ul class="ul" id="nf_and_nrf_functionality__ul_xxx_mtw_xnb">
            <li class="li"><em class="ph i">NF-C</em>: It is a controller module on OAME nodes. It the main module of the
                    <em class="ph i">NF</em> feature handler on NCC. The <em class="ph i">NF-C</em> decides when a message such as
                    <em class="ph i">NFRegister</em>, <em class="ph i">NFHeartbeat</em>, <em class="ph i">NFDeregister</em>, <em class="ph i">NFUpdate</em> is
                to be triggered toward the NRF. The <em class="ph i">NF-C</em> never sends the message directly to
                the NRF, instead <em class="ph i">NF-C</em> communicates using Kafka broker with one of the
                    <em class="ph i">NF-H</em> to send the message to the NRF.</li>

            <li class="li"><em class="ph i">NF-H</em>: It is a handler module on Diameter <em class="ph i">app</em> nodes. It is the worker
                module that interacts with the NRF over the <em class="ph i">Nnrf</em> interface. The requests
                toward NRF are routed through the core IOH <em class="ph i">(IOH-C)</em>.</li>

        </ul>

        <p class="p">The NF handler reports the response from the NRF back to the NF controller, which then
            takes appropriate action based on the response code and the message.</p>

        <div class="section" id="nf_and_nrf_functionality__nfreg"><h2 class="title sectiontitle">NFRegister</h2>
            
            <p class="p">This operation is used to register the following:</p>

            <ul class="ul" id="nf_and_nrf_functionality__ul_ayx_mtw_xnb">
                <li class="li">
                    <p class="p">Services associated to an existing NF instance.</p>

                </li>

                <li class="li">
                    <p class="p">A network function in the NRF by providing the NF profile of the requesting
                        network function to the NRF, and the NRF indicates the requesting network
                        function as available to be discovered by other network functions.</p>

                </li>

            </ul>

            <p class="p">The network function (NF) service consumer sends a <code class="ph codeph">PUT</code> request to
                the resource URI representing the NF instance. The URI is determined by the NF
                instance. The variable <var class="keyword varname">{nfInstanceID}</var> represents an identifier
                which is provided by the NF service consumer that is globally unique inside the PLMN
                of the NRF where the NF is being registered.</p>

            <p class="p">All NF profiles are registered in the same NRF server within a NRF server set.</p>

        </div>

        <div class="section" id="nf_and_nrf_functionality__nfdr"><h2 class="title sectiontitle">NFDeregister</h2>
            
            <p class="p">This operation removes the profile of a network function previously registered in the
                NRF.</p>

            <p class="p">It is executed by deleting a given resource identified by an NF <em class="ph i">Instance ID.</em>
                The operation is invoked by issuing a <code class="ph codeph">DELETE</code> request on the URI
                representing the specific NF instance.</p>

        </div>

        <div class="section" id="nf_and_nrf_functionality__NFUpdate"><h2 class="title sectiontitle">NFUpdate</h2>
            
            <p class="p">An NF Update message is triggered for an NF profile on the following events:</p>

            <ul class="ul" id="nf_and_nrf_functionality__ul_byx_mtw_xnb">
                <li class="li">
                    <p class="p">An NF profile that is in registered state on an NRF server is updated through
                        SM/REST</p>

                </li>

                <li class="li">
                    <p class="p">A sub-object of an NF profile, which is in registered state on an NRF server,
                        is updated through SM/REST. The sub object can be one of:</p>

                    <ul class="ul" id="nf_and_nrf_functionality__ul_cyx_mtw_xnb">
                        <li class="li">NF service</li>

                        <li class="li">CHFInfo</li>

                    </ul>

                </li>

            </ul>

            <p class="p">NCC does not support NF update requests with HTTP method as <var class="keyword varname">PATCH</var>.
                3GPP specifications allow for NF update message to be of type
                    <var class="keyword varname">PATCH</var> (send only partially updated fields of the NF profile
                to NRF) or PUT (send the complete NF profile) but NCC supports the <em class="ph i">PUT</em> method
                only for NF Update functionality.</p>

            <p class="p">The NF update for an NF profile is sent on the NRF server on which the NF profile is
                registered. If that NRF server is not currently in use, then the NF update logs an
                    <em class="ph i">ERROR</em> message and returns that is, no NF update message is sent out to
                the NRF. An alarm is also raised in this case.</p>

            <p class="p">If an NF update fails (including the retries), then it is not tried again. To
                retrigger the NF update, the NF profile is updated again from SM/REST.</p>

        </div>

        <div class="section" id="nf_and_nrf_functionality__NFHeartbeat"><h2 class="title sectiontitle">NFHeartbeat</h2>
            
            <p class="p">A daemon thread on the <em class="ph i">NF-C</em> keeps track of the <em class="ph i">NFHeartbeat</em> message that
                is sent to a <em class="ph i">NFProfile</em>. <em class="ph i">NFHeartbeat</em> is sent to all registered
                    <em class="ph i">NFProfiles</em>.</p>

            <p class="p">The <em class="ph i">NFstatus</em> sent in the <em class="ph i">NFHeartbeat</em> requests are picked up from the
                    <em class="ph i">NFstatus</em> set in the <em class="ph i">NFProfile</em> of the NF.</p>

            <table cellpadding="4" cellspacing="0" summary="" id="nf_and_nrf_functionality__table_dyx_mtw_xnb" class="table" width="100%" frame="border" border="1" rules="all"><colgroup><col style="width:48.54368932038835%" /><col style="width:51.45631067961165%" /></colgroup><thead class="thead" style="text-align:left;">
                        <tr class="row">
                            <th class="entry cellrowborder" style="vertical-align:top;" id="d26515e306">
                                <p class="p">If...</p>

                            </th>

                            <th class="entry cellrowborder" style="vertical-align:top;" id="d26515e312">
                                <p class="p">Then...</p>

                            </th>

                        </tr>

                    </thead>
<tbody class="tbody">
                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d26515e306 ">
                                <p class="p">The <em class="ph i">NFstatus</em> in the <em class="ph i">NFProfile</em> is set to
                                        <var class="keyword varname">REGISTERED</var></p>

                            </td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d26515e312 ">
                                <p class="p">The NRF heartbeat is sent with a status
                                        <var class="keyword varname">REGISTERED</var>.</p>

                            </td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d26515e306 ">
                                <p class="p">The status is set to <var class="keyword varname">SUSPENDED</var> or
                                        <var class="keyword varname">UNDISCOVERABLE</var></p>

                            </td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d26515e312 ">
                                <p class="p">The NRF heartbeat is sent with status
                                        <var class="keyword varname">UNDISCOVERABLE</var>.</p>

                            </td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d26515e306 ">
                                <p class="p">The number of failed <em class="ph i">NFHeartbeats</em> for any of the
                                    registered <em class="ph i">NFProfile</em> reaches the <em class="ph i">failed NRF heartbeat
                                        threshold</em> of the NRF server to which the
                                        <em class="ph i">NFProfiles</em> are registered</p>

                                <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> This is applicable only if the applicable preference <em class="ph i">NRF:
                                        Switchover on Probe Failure</em> is
                                    <var class="keyword varname">false</var>.</div>

                            </td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d26515e312 ">The <em class="ph i">inUse</em> flag is set to <var class="keyword varname">False</var>
                                indicating that the NRF server has failed and a server switch is
                                required. Also, no server is set to <em class="ph i">inUse</em> and the
                                registration daemon thread initiates the switch. </td>

                        </tr>

                    </tbody>
</table>

            <p class="p">An alarm is raised when the failed NRFheartbeat count reaches the failed NRF
                heartbeat threshold. The <em class="ph i">number of retries</em> configured in the NRF server
                object is not used for the <em class="ph i">NFHeartbeat</em> message, that is the
                    <em class="ph i">NFHeartbeat</em> is not retried until its next interval.</p>

            <p class="p">The duration between the two <em class="ph i">NFHeartbeats</em> for a <em class="ph i">NFProfile</em> is defined by
                the NRF in response to the following:</p>

            <ul class="ul" id="nf_and_nrf_functionality__ul_eyx_mtw_xnb">
                <li class="li"><em class="ph i">NFRegister</em> response</li>

                <li class="li"><em class="ph i">NFHeartbeat</em> response</li>

                <li class="li"><em class="ph i">NFUpdate</em> response</li>

            </ul>

            <p class="p"> In response to the NF registration request, <em class="ph i">NFHeartbeat</em> or <em class="ph i">NFUpdate</em>
                request from NCC for a particular <em class="ph i">NFProfile</em>, the NRF sends a NRF heartbeat
                timer. The default value of five seconds is used. If the value of the returned timer
                is 0 or the response is not received, then NCC does not send any heartbeats toward
                the NRF for that <em class="ph i">NFProfile.</em>
            </p>

        </div>

        <div class="section" id="nf_and_nrf_functionality__section_gft_ftx_1qb"><h2 class="title sectiontitle">NF Probe</h2>
            
            <p class="p">NF probe is a NFProfileRetrieval message (HTTP GET) that checks if the NRF server is
                able to serve registered NF profile to service consumers. Following are some
                important points about NF probe:</p>

            <ul class="ul" id="nf_and_nrf_functionality__ul_n5f_htx_1qb">
                <li class="li">Probe is applicable for primary NRF server in each NRF server set.</li>

                <li class="li">If a NRF server set is not linked with any NF profile, then probe is not sent to
                    its primary NRF server.</li>

                <li class="li">As a given NRF server can be primary in only one NRF server set, there can be
                    only one probe task for it.</li>

            </ul>

        </div>

        <div class="section" id="nf_and_nrf_functionality__section_ufx_hg5_hwb"><h2 class="title sectiontitle">NF Discovery</h2>
            
            <div class="sectiondiv"><p class="p">The <code class="ph codeph">Nnrf_NFDiscovery</code> service allows a Network Function
                    (NF) instance to discover the services offered by other NF instances by querying
                    the local NRF. NF Service sends an http GET request to the resource URI NF
                    instances collection resource. </p>
<p class="p">The input filter criteria for the
                    discovery request is included in query parameters. These query parameters can be
                    defined in NF Discovery. If query parameters are not defined, then the following
                    query parameters are passed as a filter criteria by default: </p>
<ul class="ul" id="nf_and_nrf_functionality__ul_efq_kqf_hwb">
                    <li class="li"><code class="ph codeph">requester-nf-type</code>: as CHF</li>

                    <li class="li"><code class="ph codeph">target-nf-type</code>: set on the basis of N40/N28 request</li>

                    <li class="li"><code class="ph codeph">target-nf-set-id</code>: as received in header of N40/N28
                        request</li>

                </ul>
<p class="p">The preference for sending NF Discovery is decided as follows:</p>
If NRF
                Server Set is provided in the NF Discovery object, then the server preference is as
                    follows:<ol class="ol" id="nf_and_nrf_functionality__ol_upy_wrf_hwb">
                    <li class="li">In-use server of an NRF Server Set.</li>

                    <li class="li">Primary server of an NRF Server Set.</li>

                </ol>
If NF Discovery object is not configured, or NRF Server Set is not provided,
                then an NRF Server is randomly picked from the database, and the server preference
                is as follows:<ol class="ol" id="nf_and_nrf_functionality__ol_dr3_xrf_hwb">
                    <li class="li">In-use server of the selected NRF Server Set.</li>

                    <li class="li">Primary server of the selected NRF Server Set.</li>

                </ol>
<p class="p">The response from the NRF Server includes a list of NF instances which is a
                    list of all the NF Profiles of network functions that match the input filter
                    criteria as provided in the discovery request.</p>
<p class="p">It also includes an
                    argument validity period. The validity period denotes time in seconds. It is the
                    time for which the discovery result is considered valid. The time at which the
                    corresponding discovery request is sent to the NRF Server to refresh the
                    discovery cache entry is based on the validity period. If the NF Discovery
                    object is created, updated, or deleted, then the cache is invalidated. That is,
                    the validity period is updated so that the next discovery query is sent afresh
                    instead of picking up the cached result.</p>
<div class="p">The cached results are also
                    stored in the database in <code class="ph codeph">NFDiscoveryResponseCache</code>. A daemon
                    thread on the NF-H synchronizes the NF-H discovery cache with the database. It
                    also clears the cache when the application preference <code class="ph codeph">NRF: Discovery
                        Cache Audit Time to Live (minutes)</code> has elapsed after the validity
                    period for any entry is over.<div class="note" id="nf_and_nrf_functionality__note_gjw_wsf_hwb"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> If an entry in the NF
                        Discovery cache (the result of previously discovered NF Discovery query) is
                        past its validity time, and an attempt to re-discover the Network Functions
                        (NFs) based on the discovery query parameters fails, then the cache
                        continues to hold the entry. The cache is only deleted when the application
                        preference <code class="ph codeph">NRF: Discovery Cache Audit Time to Live
                            (minutes)</code> has also elapsed after the validity period is
                        over.</div>
</div>
</div>
        </div>

        <div class="section" id="nf_and_nrf_functionality__section_i2b_qvb_5rb"><h2 class="title sectiontitle">Custom header in NRF messages</h2>
            
            <p class="p">If the application preference <var class="keyword varname">Include Custom Headers in Outbound
                    Messages</var> is enabled (set to <var class="keyword varname">ENABLE</var>), then the
                following custom headers are applicable:</p>

            <ul class="ul" id="nf_and_nrf_functionality__ul_eys_hyb_5rb">
                <li class="li"><var class="keyword varname">3gpp-Sbi-Message-Priority</var>: The value is taken from
                    application preference <var class="keyword varname">Message Priority for Message
                        Initiation</var>.</li>

                <li class="li"><var class="keyword varname">User-Agent</var>: The value is created from a combination of
                    NF-Type, NF-Instance Id, and NF FQDN (as configured in the local site).<p class="p">For
                        example, if <var class="keyword varname">NF-Type</var> = <var class="keyword varname">CHF</var>,
                            <var class="keyword varname">NF-Instance Id =
                        56185f64-5717-4562-b3fc-2c963f66afa3</var>, and <var class="keyword varname">NF FQDN =
                            &lt;IP configured in local site&gt;</var></p>
<p class="p">Then the value will be
                            <var class="keyword varname">CHF-56185f64-5717-4562-b3fc-2c963f66afa3
                            10.75.108.154</var>.</p>
</li>

            </ul>

        </div>

        <div class="section" id="nf_and_nrf_functionality__section_tyx_mtw_xnb"><h2 class="title sectiontitle">Response code handling</h2>
            
            <p class="p">The following table describes the response code handling from flows, such as
                    <em class="ph i">NFRegister</em>, <em class="ph i">NFDeregister</em>, <em class="ph i">NFUpdate</em>, <em class="ph i">HeartBeat</em>, and
                    <em class="ph i">NFProbe</em>.</p>

            <table cellpadding="4" cellspacing="0" summary="" id="nf_and_nrf_functionality__table_uyx_mtw_xnb" class="table" width="100%" frame="border" border="1" rules="all"><colgroup><col style="width:33.42105263157895%" /><col style="width:26.31578947368421%" /><col style="width:40.26315789473684%" /></colgroup><thead class="thead" style="text-align:left;">
                        <tr class="row">
                            <th class="entry cellrowborder" style="vertical-align:top;" id="d26515e649">Flow</th>

                            <th class="entry cellrowborder" style="vertical-align:top;" id="d26515e652">Method</th>

                            <th class="entry cellrowborder" style="vertical-align:top;" id="d26515e655">Response code</th>

                        </tr>

                    </thead>
<tbody class="tbody">
                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d26515e649 "><em class="ph i">NFRegister</em></td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d26515e652 ">PUT </td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d26515e655 ">
                                <p class="p">2xx</p>

                                <p class="p">4xx</p>

                                <p class="p">5xx</p>

                            </td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d26515e649 "><em class="ph i">NFDeregister</em></td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d26515e652 ">DELETE </td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d26515e655 ">
                                <p class="p">204</p>

                                <p class="p">4xx</p>

                                <p class="p">5xx</p>

                            </td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d26515e649 "><em class="ph i">NFUpdate</em></td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d26515e652 ">PUT </td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d26515e655 ">
                                <p class="p">200</p>

                                <p class="p">4xx</p>

                                <p class="p">5xx</p>

                            </td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d26515e649 "><em class="ph i">HeartBeat</em></td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d26515e652 ">PATCH </td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d26515e655 ">
                                <p class="p">200</p>

                                <p class="p">204</p>

                                <p class="p">4xx</p>

                                <p class="p">5xx</p>

                            </td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d26515e649 "><em class="ph i">Probe</em></td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d26515e652 ">GET</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d26515e655 ">
                                <p class="p">2xx</p>

                                <p class="p">3xx</p>

                                <p class="p">4xx</p>

                                <p class="p">5xx</p>

                            </td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d26515e649 "><em class="ph i">NF Discovery</em></td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d26515e652 ">GET</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d26515e655 ">
                                <p class="p">200</p>

                                <p class="p">3xx</p>

                                <p class="p">4xx </p>

                                <p class="p">5xx</p>

                            </td>

                        </tr>

                    </tbody>
</table>

        </div>

    </div>
<div class="footer"><hr /><p>Diameter/HTTP Configuration Guide • P556766-DN1000054969-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>