<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Configuration for access through SFTP server" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="configuration_and_access_through_sftp_server" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Configuration for access through SFTP server</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="configuration_and_access_through_sftp_server">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Configuration for access through SFTP server</h1>
<div class="body conbody">
        <p class="p">Downstream systems can retrieve CDRs and EDRs generated by NCC from its SFTP pod. If NCC
            is deployed at multiple sites, each site exposes its own SFTP pod.</p>

        <p class="p">By default, the SFTP pod is available on port <var class="keyword varname">2222</var> on the Kubernetes
            edge node.</p>

        <p class="p">The default username is <var class="keyword varname">sftp</var>, the password can be obtained by running
            the following snippet:</p>

        <pre class="pre codeblock"><code>cat &gt; ./private_key.pem &lt;&lt;EOF
-----BEGIN PRIVATE KEY-----
MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDIZwtKEonscz+I
nKzP4aJlCSKYFsRQwONqUQsCwmqfuPDUu9CNd8lHhQ7zXi2ZesD8Mj4cEa5TTLOL
EvwlhjTBNENWpFpRZaUB8uhYvWY71aom+dnRtJpR5/bPHpd2HPYxCr4DBYbBB1Ot
d6w6uiOZeZj4y9hoR8/gcfCVXudTJ/EPXK6BacHUdsTcv0wdm49dp49dbPwjb4bu
fr66peFrlklgg1oOXSr35AIb3+Wdo/d670BvwWiAVWYibA9yEj2rh76wGjcfPBIg
aIdCzxRTbElinDzuvbgqdDV7OsVh5r17GJGomsmlFbb8QxJ8GiNlBm6nHfegz4L2
kNyHH1OhAgMBAAECggEAV008h8pHt3AFb3gBeJYs7qLqJSNV5nABIiGoEE2tsWMZ
1zLyiY5zauq2NqMCbmghhjxE/mldbgBt/toIajhq5vfjle0HQ4pqNc0iFvZ7gPl1
pIEXuNlamO/afyQui0/WmEq7uAlCSPjuJRWLPBI2y/dDAq+a2OLf1kEMs6WiVIC+
kuToXGrCFG3Rh+aka/kUDqhuHgXOOBMY8h9hE1GRQGloo/hV0riQfHBVqAsOatD0
INzwO2qs5XNFVWhxxPjJ0h+Q373V15kiEehl3xzanaZ1Pi6eCzYBm/V7wdHL7OL/
6BPWhTxS6rPB78f9c0IJMKkQAO/OqVSiUZLl7giTmQKBgQDkXTtw2zhNeA3GA/5p
XfYZdEhgKoPTaBqMcp6sgN1nptfS8djEbadnXFVnkg1KnjW25m+8DzUTxWxS3eMg
0eGpXnyOOmKMT4THdAMk5n1DqtNAc11vZeJVVvFOzSA3GveksrEOo3y6pMvIXB2w
uwMI2J97pesd7/imjM9ZbDn67wKBgQDgp43DRwKkznfBTTY0FtffCjQehEaJUoj1
WA8r759d+MyDVP6tIQnOrngvnaH71uy14mjNtC6AF5Iy16m0NCvtbAnIE09sf2tP
hihgaQckgsjRzSez2v3h9O3yypqe7l7MEmHST+Rv4uhi6QKiO1RJ4vJboOE4jGw7
WdaI2nTabwKBgQDL6AupS7VMRwRVaT+DqeiS9eeiJpQq8muyOK5B7ZbEdI+FxXj+
e8LcYe/IWPsRQ49Gzx+51gJYsxF0NLgXmBBdAQdKoAtaqa4vwgEEs+Hpx+B1Tg2B
6IFeHhG9gR9g1O2G3B+IqKY4qelj8Ax6v6GIBpTw/UehJaLqZBTJDf//dQKBgQDg
F6L8YLANb3rbkkZ4TTUGYio9KpslzfOaMD3qCLvCxDRU6Qql7ifXSAfRD3+ONASp
JfB/CLW9xkVqe9/nRodu7G8Radm3E58ak2thSEL8s4zYYrmw2ciYhXZ50onL8WEU
VV3IqTLoPMKsL1wWMfJRRZWVuvQOMVyhE2tB1g/r9wKBgCpg2ecy7JWHQPfEJq5d
+fjPbqj6j2UNDv0S1Mswz7dsN5UOe7WvlNPM6VH0kZhwLdwws7VVppAH7Fka2GVt
Gd4x9b3g+XyLvN+54INS2hzq6RAcPME7xrOeVeRH4srYyKZ/1YWo5VV8TNXTylRx
uhNZnt92sHsSdJzqOhXphXll
-----END PRIVATE KEY-----
EOF
cat &gt; encrypted_password.txt &lt;&lt;EOF
kwt6JiT3idthwvfhKO1eTaBcHcVfd5sDvFSbiUzO5UKXepXF0n6tWmo6LyYUIYOYj
+saG6xy2hiryTGlGn9NobaldXjXdd9L/jmOvQMn4prcAl3Y/2wmK6fSDIjQfcIlhN
c9VX3d2rYAJusPtNeA/89uJJHp3LU2hXhcbZIB06AjANQd6PNW1Zw4Nk1St7W8Y35
JhP+r5lypsXVOt26QJ/ifZTo4dGw1S64WmlI9BdyxT9BekUoq6I+hbDJKLbivMLFc
w7NK/hZpJ2oOVKJ8tsc9i4dOI5PSojtWadNrndJ4S313YcCCiUaw1lH9tPmXoAl4n
K4ZeyWHlLLDTn5ztw==
EOF
base64 -d &lt; encrypted_password.txt | openssl rsautl -decrypt -inkey ./private_key.pem</code></pre>
    </div>
<div class="topic concept nested1" aria-labelledby="ariaid-title2" id="concept_o2s_3hs_dpb"><h2 class="title topictitle2" id="ariaid-title2">Configuring custom username, password, or key-based authentication</h2>
<div class="body conbody">
            <p class="p">SFTP service is implemented based on proftpd, an sftp module solution, and it
                supports both password and key (ssh) based authentication for a single user (named
                    <var class="keyword varname">sftp</var> by default). Password authentication is enabled by
                default, and is used internally to store created CDR files. Password can be managed
                from Helm values of <var class="keyword varname">dr</var> subchart, by changing
                    <var class="keyword varname">sftp.authentication.passwd.passwd</var>. For security reasons,
                password input is obfuscated with encryption (rsa keypair). Thus, an rsa keypair
                needs to be generated, for example, with following command:</p>

            <pre class="pre codeblock"><code>openssl genrsa -out private.pem 2048 openssl rsa <kbd class="ph userinput">-in</kbd> private.pem -outform PEM -pubout -out public.pem</code></pre>
            <p class="p">You can validate your keypair by running the following command in shell:</p>

            <pre class="pre codeblock"><code>echo <kbd class="ph userinput">"MyPassword01!"</kbd> | openssl rsautl -encrypt -pubin -inkey public.pem | openssl rsautl -decrypt -inkey private.pem</code></pre>
            <p class="p">This should print out the initial input "MyPassword01!".</p>

            <p class="p">Then you can generate your own <var class="keyword varname">sftp.authentication.passwd.passwd</var>
                field with following command:</p>

            <pre class="pre codeblock"><code>echo <kbd class="ph userinput">"mypassword"</kbd> | openssl rsautl -encrypt -pubin -inkey public.pem -out &gt; (base64 -w0)</code></pre>
            <p class="p">Note that the output may be a multiline string, but this field must be put into helm
                values as single line. Then, the
                    <var class="keyword varname">sftp.authentication.passwd.rsaKey</var> field needs to be set to
                the contents of <var class="keyword varname">private.pem</var> (not <var class="keyword varname">public.pem</var>),
                as is, in multiline format. The <var class="keyword varname">passwd</var> field can be changed via
                    <var class="keyword varname">helm upgrade</var>.</p>

            <p class="p">For client key authentication simply set
                    <var class="keyword varname">sftp.authentication.key.clientPublicKey</var> to
                    <var class="keyword varname">rfc4716</var> format (can be generated from ssh key with, for
                example, <kbd class="ph userinput">ssh-keygen -e -f ~/.ssh/id_rsa.pub</kbd>) of your public
                ssh key. The field can be also be changed via <var class="keyword varname">helm upgrade</var>.</p>

            <p class="p">Additionally, NCC supports injection of server private key via
                    <var class="keyword varname">sftp.authentication.key.serverPrivateKey</var>. Such key can be
                generated via the following command:</p>

            <pre class="pre codeblock"><code>ssh-keygen -t rsa -b 4096 -m pem -N '' -f id_rsa</code></pre>
            <p class="p">If left undefined, the sftp pod will generate an rsa key when it first starts up and
                it will persist this generated key in the persistent volume. However, this field can
                be later set/changed via helm upgrade as well.</p>

            <div class="note caution"><div class="cautiontitle"><img src="../../web/css/../images/caution.svg" title="caution-icon" class="noteicon" />CAUTION:</div> Credential changes via helm upgrade cause sftp pod to restart so
                that changes can take effect.</div>

        </div>
</div>
<div class="footer"><hr /><p>CDR/EDR Reference • P556766-DN1000055014-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>