<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="db-backup" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="db_backup" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>db-backup</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="db_backup">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">db-backup</h1>
<div class="body conbody">
        <div class="section" id="db_backup__section_gkv_c2m_cmb"><h2 class="title sectiontitle">Description</h2>
            
            <p class="p">This tool creates a backup copy of the Aerospike database so that it may be restored
                later if there are unforeseen situations (such as database corruption or other
                severe scenarios) whereby the database needs to be restored back to a previous
                version.</p>

            <p class="p">Nightly backups can be achieved by scheduling db-backup to run on a scheduled
                interval (for example, each night during the maintenance window).</p>

            <div class="p">This tool is run on the admincli pod. Unless you are doing a disaster recovery, you
                should perform this procedure during off hours (non-peak-hours). A separate backup
                file is created for each namespace, with inline compression (gzip) performed as the
                file is created to reduce the amount of disk space required for these backups. All
                namespaces and data sets are backed up.<div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> db-backup terminates if the cluster
                    changes during the backup (for example, if a database node goes down).
                    </div>
<div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> Do not run this command during the transition window from daylight
                    saving time to standard time. </div>
</div>

        </div>

        <div class="section" id="db_backup__section_g3b_d2m_cmb"><h2 class="title sectiontitle">Syntax</h2>
            
            <div class="p">
                <pre class="pre codeblock"><code>db-backup -d &lt;directory&gt; -n &lt;namespace[,namespace]*&gt; [-f] [-h] [-b] [-t &lt;threads&gt;]</code></pre>
            </div>

            <div class="p">
                <table cellpadding="4" cellspacing="0" summary="" id="db_backup__table_kmm_45q_cmb" class="table" frame="border" border="1" rules="all"><colgroup><col style="width:33.33333333333333%" /><col style="width:66.66666666666666%" /></colgroup><thead class="thead" style="text-align:left;">
                            <tr class="row">
                                <th class="entry cellrowborder" style="vertical-align:top;" id="d65376e69">Option</th>

                                <th class="entry cellrowborder" style="vertical-align:top;" id="d65376e72">Description</th>

                            </tr>

                        </thead>
<tbody class="tbody">
                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d65376e69 "><code class="ph codeph">No arguments</code></td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d65376e72 ">Displays usage/help information.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d65376e69 "><code class="ph codeph">-h or -?</code></td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d65376e72 ">Displays usage/help information.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d65376e69 "><code class="ph codeph">-d &lt;directory&gt;</code></td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d65376e72 ">Output directory for the backup files. This directory should
                                    already exist.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d65376e69 "><code class="ph codeph">-f</code></td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d65376e72 ">Force execution. If specified, the user is not asked for
                                    confirmation.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d65376e69 "><code class="ph codeph">-n &lt;namespace[,namespace]*&gt;</code></td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d65376e72 ">Namespace list to backup. Allows you to specify the
                                    namespaces to backup.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d65376e69 "><code class="ph codeph">-b &lt;true | false&gt;</code></td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d65376e72 ">Before timestamp field included in backup. When this value is
                                    set to <code class="ph codeph">true</code>, the backup execution time is
                                    considered as the before timestamp and the backup is done only
                                    for the data that is updated before that timestamp. The default
                                    value is <code class="ph codeph">true</code>.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d65376e69 "><code class="ph codeph">-t &lt;threads&gt;</code></td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d65376e72 ">Specifies the number of processing threads that are used for
                                    the backup. Depending on the number of available CPU cores, a
                                    high number of threads can cause failure.</td>

                            </tr>

                        </tbody>
</table>

            </div>

        </div>

        <div class="section" id="db_backup__section_kzh_d2m_cmb"><h2 class="title sectiontitle">Example</h2>
            
            <div class="p">Details of the backup operation can be found in the backup log file, in the specified
                backup directory.<pre class="pre codeblock"><code>$ ./db-backup -d /opt/tpa/users/tpaadmin/username
                    
13:12  db-backup issued at: Wed Feb  9 13:12:09 UTC 2022
13:12
13:12  Creating a database backup to [/opt/tpa/users/tpaadmin/username]

This action will create a backup of the local database in the directory:
/opt/tpa/users/tpaadmin/username
on this pod.

ATTENTION: The original database backup file will be removed if it exists.

Do you wish to continue? (y/n)y
13:12  Starting backup on ppig-admincli-75f8d7c47f-pffxx for ppig-aerospike-rk1-0.ig-aerospike-service.sps-ig.svc.cluster.local-dsc
13:12  Starting backup on ppig-admincli-75f8d7c47f-pffxx for ppig-aerospike-rk1-1.ig-aerospike-service.sps-ig.svc.cluster.local-dsc
13:12  Starting backup on ppig-admincli-75f8d7c47f-pffxx for ppig-aerospike-rk2-0.ig-aerospike-service.sps-ig.svc.cluster.local-dsc
13:12  Starting backup on ppig-admincli-75f8d7c47f-pffxx for ppig-aerospike-rk2-1.ig-aerospike-service.sps-ig.svc.cluster.local-dsc
13:12  Starting backup on ppig-admincli-75f8d7c47f-pffxx for ppig-aerospike-rk1-0.ig-aerospike-service.sps-ig.svc.cluster.local-dsclocal
13:12  Starting backup on ppig-admincli-75f8d7c47f-pffxx for ppig-aerospike-rk1-1.ig-aerospike-service.sps-ig.svc.cluster.local-dsclocal
13:12  Starting backup on ppig-admincli-75f8d7c47f-pffxx for ppig-aerospike-rk2-0.ig-aerospike-service.sps-ig.svc.cluster.local-dsclocal
13:12  Starting backup on ppig-admincli-75f8d7c47f-pffxx for ppig-aerospike-rk2-1.ig-aerospike-service.sps-ig.svc.cluster.local-dsclocal
13:12  Starting backup on ppig-admincli-75f8d7c47f-pffxx for ppig-aerospike-rk1-0.ig-aerospike-service.sps-ig.svc.cluster.local-dscglobal
13:12  Starting backup on ppig-admincli-75f8d7c47f-pffxx for ppig-aerospike-rk1-1.ig-aerospike-service.sps-ig.svc.cluster.local-dscglobal
13:12  Backup for ppig-aerospike-rk1-0.ig-aerospike-service.sps-ig.svc.cluster.local-dsclocal completed
13:12  Backup for ppig-aerospike-rk2-1.ig-aerospike-service.sps-ig.svc.cluster.local-dsc completed
13:12  Backup for ppig-aerospike-rk2-1.ig-aerospike-service.sps-ig.svc.cluster.local-dsclocal completed
13:12  Backup for ppig-aerospike-rk1-1.ig-aerospike-service.sps-ig.svc.cluster.local-dscglobal completed
13:12  Backup for ppig-aerospike-rk2-0.ig-aerospike-service.sps-ig.svc.cluster.local-dsclocal completed
13:12  Backup for ppig-aerospike-rk1-1.ig-aerospike-service.sps-ig.svc.cluster.local-dsclocal completed
13:12  Backup for ppig-aerospike-rk1-1.ig-aerospike-service.sps-ig.svc.cluster.local-dsc completed
13:12  Backup for ppig-aerospike-rk1-0.ig-aerospike-service.sps-ig.svc.cluster.local-dsc completed
13:12  Backup for ppig-aerospike-rk1-0.ig-aerospike-service.sps-ig.svc.cluster.local-dscglobal completed
13:12  Backup for ppig-aerospike-rk2-0.ig-aerospike-service.sps-ig.svc.cluster.local-dsc completed
13:12  Starting backup on ppig-admincli-75f8d7c47f-pffxx for ppig-aerospike-rk2-0.ig-aerospike-service.sps-ig.svc.cluster.local-dscglobal
13:12  Starting backup on ppig-admincli-75f8d7c47f-pffxx for ppig-aerospike-rk2-1.ig-aerospike-service.sps-ig.svc.cluster.local-dscglobal
13:12  Starting backup on ppig-admincli-75f8d7c47f-pffxx for ppig-aerospike-rk1-0.ig-aerospike-service.sps-ig.svc.cluster.local-spspd1
13:12  Starting backup on ppig-admincli-75f8d7c47f-pffxx for ppig-aerospike-rk1-1.ig-aerospike-service.sps-ig.svc.cluster.local-spspd1
13:12  Starting backup on ppig-admincli-75f8d7c47f-pffxx for ppig-aerospike-rk2-0.ig-aerospike-service.sps-ig.svc.cluster.local-spspd1
13:12  Starting backup on ppig-admincli-75f8d7c47f-pffxx for ppig-aerospike-rk2-1.ig-aerospike-service.sps-ig.svc.cluster.local-spspd1
13:12  Backup for ppig-aerospike-rk1-1.ig-aerospike-service.sps-ig.svc.cluster.local-spspd1 completed
13:12  Backup for ppig-aerospike-rk2-0.ig-aerospike-service.sps-ig.svc.cluster.local-dscglobal completed
13:12  Backup for ppig-aerospike-rk2-1.ig-aerospike-service.sps-ig.svc.cluster.local-spspd1 completed
13:12  Backup for ppig-aerospike-rk2-1.ig-aerospike-service.sps-ig.svc.cluster.local-dscglobal completed
13:12  Backup for ppig-aerospike-rk1-0.ig-aerospike-service.sps-ig.svc.cluster.local-spspd1 completed
13:12  Backup for ppig-aerospike-rk2-0.ig-aerospike-service.sps-ig.svc.cluster.local-spspd1 completed
13:12
13:12  ppig-aerospike-rk1-0.ig-aerospike-service.sps-ig.svc.cluster.local
13:12      dsc             Completed
13:12      dsclocal        Completed
13:12      dscglobal       Completed
13:12      spspd1          Completed
13:12  ppig-aerospike-rk1-1.ig-aerospike-service.sps-ig.svc.cluster.local
13:12      dsc             Completed
13:12      dsclocal        Completed
13:12      dscglobal       Completed
13:12      spspd1          Completed
13:12  ppig-aerospike-rk2-0.ig-aerospike-service.sps-ig.svc.cluster.local
13:12      dsc             Completed
13:12      dsclocal        Completed
13:12      dscglobal       Completed
13:12      spspd1          Completed
13:12  ppig-aerospike-rk2-1.ig-aerospike-service.sps-ig.svc.cluster.local
13:12      dsc             Completed
13:12      dsclocal        Completed
13:12      dscglobal       Completed
13:12      spspd1          Completed
13:12
13:12  SPS DB backup completed into directory [/opt/tpa/users/tpaadmin/username]
13:12  on this pod.
13:12
13:12  See [/opt/tpa/users/tpaadmin/username/DB_BACKUP_*/*.backuplog] for
13:12  detailed output of backup command execution.
13:12
13:12  db-backup completed at: Wed Feb  9 13:12:21 UTC 2022</code></pre></div>

            <div class="p">
                <table cellpadding="4" cellspacing="0" summary="" id="db_backup__table_gvw_r3h_knb" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap"><span class="table--title-label">Table: </span>Output Explanation</span></caption><colgroup><col style="width:50%" /><col style="width:50%" /></colgroup><thead class="thead" style="text-align:left;">
                            <tr class="row">
                                <th class="entry cellrowborder" style="text-align:left;vertical-align:top;" id="d65376e188">Line</th>

                                <th class="entry cellrowborder" style="text-align:left;vertical-align:top;" id="d65376e191">Description</th>

                            </tr>

                        </thead>
<tbody class="tbody">
                            <tr class="row">
                                <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d65376e188 ">
                                    <code class="ph codeph">db-backup issued at: Wed Feb 9 13:12:09 UTC
                                        2022</code>
                                </td>

                                <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d65376e191 ">Date and time at which the command was executed.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d65376e188 ">
                                    <code class="ph codeph">13:12</code>
                                </td>

                                <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d65376e191 ">Timestamp.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d65376e188 ">
                                    <code class="ph codeph">Creating a database backup to
                                        [/opt/tpa/users/tpaadmin/username]</code>
                                </td>

                                <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d65376e191 ">Indicates the backup directory is being created.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d65376e188 ">
                                    <code class="ph codeph">This action will create a backup of the local database
                                        in the directory:</code>
                                </td>

                                <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d65376e191 "> </td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d65376e188 ">
                                    <code class="ph codeph">/opt/tpa/users/tpaadmin/username</code>
                                </td>

                                <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d65376e191 ">Indicates the location of the backup directory.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d65376e188 ">
                                    <code class="ph codeph">ATTENTION: The original database backup file will be
                                        removed if it exists.</code>
                                </td>

                                <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d65376e191 ">Attention message.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d65376e188 "><code class="ph codeph">Do you wish to continue? (y/n)y</code></td>

                                <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d65376e191 ">Question to continue.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d65376e188 ">
                                    <code class="ph codeph">13:12 Starting backup on ppig-admincli-75f8d7c47f-pffxx
                                        for
                                        ppig-aerospike-rk1-0.ig-aerospike-service.sps-ig.svc.cluster.local-dsc</code>
                                </td>

                                <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d65376e191 ">Indicates the backup process has begun. For each backup, a
                                    new message like this will be presented.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d65376e188 ">
                                    <code class="ph codeph">13:12 Backup for
                                        ppig-aerospike-rk1-0.ig-aerospike-service.sps-ig.svc.cluster.local-dsclocal
                                        completed</code>
                                </td>

                                <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d65376e191 ">Indicates the backup process has completed. For each backup,
                                    a new message like this will be presented.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d65376e188 ">
                                    <pre class="pre codeblock"><code>13:12  SPS DB backup completed into directory [/opt/tpa/users/tpaadmin/username]
13:12  on this pod.</code></pre>
                                </td>

                                <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d65376e191 ">Indicates the database backup has finished. Also lists the
                                    output directory of the backup files.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d65376e188 ">
                                    <pre class="pre codeblock"><code>13:12  See [/opt/tpa/users/tpaadmin/username/DB_BACKUP_*/*.backuplog] for
13:12  detailed output of backup command execution.</code></pre>
                                </td>

                                <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d65376e191 ">Indicates where to find logs for the backup process.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d65376e188 ">
                                    <code class="ph codeph">13:12 db-backup completed at: Wed Feb 9 13:12:21 UTC
                                        2022</code>
                                </td>

                                <td class="entry cellrowborder" style="text-align:left;vertical-align:top;" headers="d65376e191 ">Indicates the db-backup tool has completed its
                                    process.</td>

                            </tr>

                        </tbody>
</table>

            </div>

        </div>

    </div>
<div class="footer"><hr /><p>Operations, Administration, and Maintenance Guide • P556766-DN1000055092-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>