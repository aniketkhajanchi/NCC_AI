<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Pre-rating simulation" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="pre_rating_simulation" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Pre-rating simulation</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="pre_rating_simulation">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Pre-rating simulation</h1>
<div class="body conbody">
        <div class="section" id="pre_rating_simulation__section_bfq_qz5_xnb">
            <p class="p">Using pre-rating simulation the operator can know the rate and the charging service
                selected by tariff processor in advance on some specific categories of charging
                services and use the result during normal rating. The secondary rate, that is, the
                next rate can also be returned in the result.</p>

            <p class="p">Consider the scenario of a subscriber who has one or more base tariffs (charging
                services with rates, low priority), with no additional package, or the additional
                package has exhausted. In this case, the base tariffs are considered and evaluated
                during pre-rating simulation. The result from pre-rating simulation can be used
                during normal rating.</p>

            <p class="p">For secondary rate, consider a scenario where a subscriber has a 40 GB bundle that is
                applicable for both home and roaming. The counter FUP is subscribed and the
                configured threshold for FUP is 24 GB. When data session starts in roaming, the
                counter FUP at 25 GB (threshold limit reached), then Next-Rate is allowed. Data
                session is rejected and notification is sent to subscriber. When the configured
                threshold for FUP limit is reached, the <var class="keyword varname">Block-Next-Rate</var> action is
                not used and the secondary rate can be applied. See <a class="xref" href="#FUPscenarios">FUP scenarios</a> for more information.</p>

            <p class="p">Pre-Rating simulation feature is enhanced to return the secondary rate
                    (<em class="ph i">Next-Rate</em>).</p>

            <p class="p">The <code class="ph codeph">CALL_COMMON.Pre-Rating-Simulation-Next-Rate</code> variable is
                available in the<code class="ph codeph"> source context CALL_COMMON</code>. It contains the value
                of the secondary rate (<em class="ph i">Next-Rate</em>).</p>

            <div class="note" id="pre_rating_simulation__note_rc2_jxg_ptb"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> Pre-Rating Simulation is not executed for usageType
                    <em class="ph i">Wholesale</em>. It only runs for usage type <em class="ph i">Normal</em>.</div>

        </div>

    </div>
<div class="topic concept nested1" aria-labelledby="ariaid-title2" id="concept_vfk_mxl_r4b"><h2 class="title topictitle2" id="ariaid-title2">Configuration</h2>
<div class="body conbody">
            <div class="section" id="concept_vfk_mxl_r4b__section_vls_nxl_r4b"><h3 class="title sectiontitle">Result context</h3>
                
                <p class="p">The following result context is provided to enable pre-rating simulation:</p>

                <p class="p"><var class="keyword varname">GY_PRE_PROCESSING.Pre-Rating-Simulation-Enabled-For-Categories = [
                        "Category-Pre-Rate-1", "Category-Pre-Rate-2" ]</var></p>

                <p class="p">The list of categories eligible for pre-rating processing are provided in the
                    attribute <var class="keyword varname">Pre-Rating-Simulation-Enabled-For-Categories</var>. If
                    this result context attribute is configured and has some values, then pre-rating
                    simulation is done before tariff processing. After this the tariff processing is
                    done the result context can be used in applicability or tariff rules.</p>

            </div>

            <div class="section" id="concept_vfk_mxl_r4b__section_ac1_rz5_xnb"><h3 class="title sectiontitle">Source context</h3>
                
                <p class="p"><var class="keyword varname">CALL_COMMON.Pre-Rating-Simulation-CS</var> (with the selected
                    charging service)</p>

                <p class="p"><var class="keyword varname">CALL_COMMON.Pre-Rating-Simulation-Rate</var> (with the selected
                    rate)</p>

                <p class="p"><var class="keyword varname">CALL_COMMON.Pre-Rating-Simulation-Next-Rate</var> (with the selected
                    rate)</p>

            </div>

        </div>
</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title3" id="concept_wvt_lxl_r4b"><h2 class="title topictitle2" id="ariaid-title3">Example</h2>
<div class="body conbody">
            <div class="section" id="concept_wvt_lxl_r4b__section_rld_fpg_znb">
                <p class="p">For pre-rating simulation it is assumed that subscriber has one or more
                    underlying tariffs (that is, Charging Services with rates, low priority), which
                    define the basic behaviour when subscriber does not buy any package or his
                    package is already depleted. These underlying tariffs are considered and
                    evaluated during pre-rating simulation. Therefore, the result from pre-rating
                    simulation can be used during normal rating call flow. See the following
                    scenarios:</p>

                <ul class="ul" id="concept_wvt_lxl_r4b__ul_m3d_gqg_znb">
                    <li class="li">Bucket is not applicable when specific underlying tariff is provisioned:
                            <p class="p">Applicability condition of bucket check whether
                                <var class="keyword varname">CALL_COMMON.Pre-Rating-Simulation-CS</var> (selected
                            Charging Service in pre-rating simulation) is not equal to specific
                            tariff.</p>
</li>

                    <li class="li">
                        <p class="p">Bucket can be deducted by rounded call units (for example, kB or MB). It
                            might be desired (especially for voice calls) that bucket granularity
                            follows granularity of rate of underlying tariff.</p>

                        <p class="p"><var class="keyword varname">CALL_COMMON.Pre-Rating-Simulation-Rate</var> (selected rate
                            from pre-rating simulation) is used to control granularity of
                            bucket.</p>

                    </li>

                    <li class="li">
                        <p class="p">High-priority tariff have specific rates for selected traffic; however,
                            other traffic follow rates of underlying tariff:</p>

                        <p class="p"><var class="keyword varname">CALL_COMMON.Pre-Rating-Simulation-Rate</var> (selected rate
                            from pre-rating simulation) is used in tariff formula to charge the
                            call.</p>

                    </li>

                    <li class="li">
                        <p class="p">Cost bucket grants free credit to the subscriber, but it follows rate of
                            underlying tariff and not any other high-priority tariffs:</p>

                        <p class="p"><var class="keyword varname">CALL_COMMON.Pre-Rating-Simulation-Rate</var> (selected rate
                            from pre-rating simulation) is used in tariff formula to charge the call
                            with this rate from subscription cost bucket.</p>

                    </li>

                    <li class="li"><var class="keyword varname">CALL_COMMON.Pre-Rating-Simulation-Next-Rate</var> contains the
                        value of secondary rate. </li>

                </ul>

            </div>

        </div>
</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title4" id="FUPscenarios"><h2 class="title topictitle2" id="ariaid-title4">FUP scenarios</h2>
<div class="body conbody">
            <div class="section" id="FUPscenarios__section_dqx_hxl_r4b"><h3 class="title sectiontitle">Example 1: FUP limit not reached</h3>
                
                <p class="p">A subscriber has a 40 GB bundle applicable to home and roaming. The counter FUP
                    is subscribed and it is 14 GB. When a subscriber starts a data session while
                    roaming and counter FUP is at 14 GB, that is, below threshold limit, then
                        <var class="keyword varname">Block-Next-Rate</var> is applied and session is allowed. </p>

            </div>

            <div class="section" id="FUPscenarios__section_v2c_jxl_r4b"><h3 class="title sectiontitle">Example 2: FUP limit with two bundles</h3>
                
                <p class="p">A subscriber has a 40 GB bundle (Bundle A) applicable to home and roaming. The
                    bundle (Bundle A) has a FUP limit at 20GB. The Bundle B has a 10 GB home and
                    roaming bucket. The counter FUP is subscribed and Counter Scope is set to
                        <var class="keyword varname">Multi-Bundle</var> or <var class="keyword varname">SELF</var>. When a
                    subscriber starts a data session while roaming and counter FUP is at 25 GB, that
                    is, threshold limit is reached, then <var class="keyword varname">Next-Rate</var> is allowed,
                    session is rejected and a notification is sent to subscriber. </p>

            </div>

            <div class="section" id="FUPscenarios__section_u2g_kxl_r4b"><h3 class="title sectiontitle">Example 3: Additional add-on to allow use of data again</h3>
                
                <p class="p">The data session gets blocked when the bundle is exhausted. To continue using
                    data session, a subscriber can buy additional bundle. Consider that a subscriber
                    has a 40 GB bundle (Bundle A) applicable to home and roaming. The bundle (Bundle
                    A) has a FUP limit at 20 GB. The Bundle B has a 10 GB home and roaming bucket.
                    The counter FUP is subscribed and Counter Scope is set to
                        <var class="keyword varname">Multi-Bundle</var> or <var class="keyword varname">SELF</var>. When a
                    subscriber starts a data session while roaming and counter FUP is at 25 GB, that
                    is, threshold limit is reached, then <var class="keyword varname">Next-Rate</var> is allowed,
                    session is rejected and a notification is sent to subscriber. When a new bundle,
                    Bundle C is subscribed, the data session is allowed.</p>

            </div>

        </div>
</div>
<div class="footer"><hr /><p>Charging User Guide • P556766-DN1000054947-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>