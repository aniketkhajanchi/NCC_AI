<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Nchf_ConvergedCharging AMF (N41) interface" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="n41" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Nchf_ConvergedCharging AMF (N41) interface</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="n41">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Nchf_ConvergedCharging AMF (N41) interface</h1>
<div class="body conbody">
        <div class="section" id="n41__section_wnz_lwz_ysb"><h2 class="title sectiontitle">Post Event Charging over HTTP from AMF</h2>
            
            <p class="p">Post Event Charging (PEC) generates the CDR after the call has occurred. It does not
                perform rating and charging.</p>

            <p class="p"><strong class="ph b">Identification of 5G PEC call</strong></p>

            <ul class="ul" id="n41__ul_mzc_cjn_vrb">
                <li class="li">If the request has the <em class="ph i">OneTimeEvent</em> as <em class="ph i">true</em>, and
                        <em class="ph i">OneTimeEventType</em> as PEC, then it is a PEC call. </li>

                <li class="li">NCC supports PEC call for both known and unknown devices.</li>

                <li class="li">For a known and unknown device, success PEC CDR is generated with AMF Charging
                    HTTP parameters (<em class="ph i">RegistrationChargingInfo</em>,
                        <em class="ph i">N2ConnectionChargingInfo</em>, <em class="ph i">LocationReportingChargingInfo</em>).</li>

            </ul>

            <p class="p"><strong class="ph b">Important points</strong></p>

            <ul class="ul" id="n41__ul_qrr_scx_vrb">
                <li class="li">Rules are not supported for a PEC call except for the Inbound Roamer Agreement
                    scenario. For details on this scenario, refer to <a class="xref" href="offl_cdr_gen_for_inb_roam.html#offline_cdr_generation_for_inbound_roaming__table_f3z_rkn_p4b">Support for Inbound Roaming</a>.</li>

                <li class="li">If any AMF HTTP parameter (<em class="ph i">RegistrationChargingInfo</em>,
                        <em class="ph i">N2ConnectionChargingInfo</em>, <em class="ph i">LocationReportingChargingInfo</em>) is
                    present in the request and the value of <em class="ph i">roamerInOut</em> HTTP parameter in
                    each AMF HTTP parameter is <em class="ph i">IN_BOUND</em>, then the Inbound Roamer agreement is
                    checked.</li>

                <li class="li">If any one of AMF Charging HTTP parameters are present with the value as
                        <em class="ph i">OUT_BOUND</em>, then the Inbound Roamer agreement is not validated.</li>

                <li class="li">It is a rare scenario where NCC receives all three AMF HTTP parameters in a
                    single request.</li>

                <li class="li">When the Inbound Roamer agreement is not valid for an unknown device, an error
                    PEC CDR is generated with the error code 403. This CDR includes information
                    about the AMF Charging HTTP parameters (<em class="ph i">RegistrationChargingInfo</em>,
                        <em class="ph i">N2ConnectionChargingInfo</em>, <em class="ph i">LocationReportingChargingInfo</em>).</li>

            </ul>

        </div>

        <div class="section" id="n41__section_mwz_5vm_vrb"><h2 class="title sectiontitle">IEC (without MUU) over HTTP from AMF</h2>IEC
            provides rating, credit checks, balance management and CDR generation. The following
            events can be charged with an IEC call:<ul class="ul" id="n41__ul_jlw_2xm_vrb">
                <li class="li">Registration charging event</li>

                <li class="li">N2Connection charging event</li>

                <li class="li">Mobility charging event</li>

            </ul>
<p class="p"><strong class="ph b">Identification of 5G IEC call</strong></p>
<ul class="ul" id="n41__ul_mvf_x3n_vrb">
                <li class="li">
                    <p class="p">If the request has <em class="ph i">OneTimeEvent</em> as <var class="keyword varname">true</var> and
                            <em class="ph i">OneTimeEventType</em> as IEC, then it is considered as an IEC
                        call.</p>

                </li>

                <li class="li">The request consists of the <em class="ph i">RegistrationChargingInformation</em>,
                        <em class="ph i">LocationReportingChargingInformation</em>, and
                        <em class="ph i">N2ConnectionChargingInformation</em>. </li>

                <li class="li">If MUU is not received in the request, a dummy MUU is created in the request
                    message.</li>

                <li class="li">The dummy MUU is set to a pre-configured rating group whose information is taken
                    from the application preference <span class="ph uicontrol">Default AMF Charging
                    RGs</span>.</li>

                <li class="li"><span class="ph uicontrol">Default AMF Charging RGs</span> is a string, which consists of
                    comma-separated rating group values. The default value is [NA,NA,NA]. The first,
                    second, and third values correspond to the
                        <em class="ph i">RegistrationChargingInformation</em>,
                        <em class="ph i">N2ConnectionChargingInformation</em>, and
                        <em class="ph i">LocationReportingChargingInformation</em> respectively. <div class="note" id="n41__note_uy5_sfn_vrb"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> It is not mandatory to add all the values for the
                        application preference.</div>
</li>

                <li class="li">If the value for a rating group is NA, then the information corresponding to
                    that value is not processed in the call even if it is present in the request.
                    For example: If the request message has <em class="ph i">registrationChargingInformation</em>,
                    but the value of <span class="ph uicontrol">Default AMF Charging RGs</span> is [NA,2,3],
                    then the <em class="ph i">registrationChargingInformation</em> is not processed in the call.
                        <div class="note" id="n41__note_rwy_b2n_vrb"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> NCC processes only the first three values
                        (comma-separated) of this application preference. </div>
</li>

                <li class="li">The values of the application preference <span class="ph uicontrol">Default AMF Charging
                        RGs</span> can be configured based on the events to be charged. For
                    example: If the value is set to [2, NA, NA], then only the registration charging
                    event is considered for charging.</li>

                <li class="li">The buckets for charging the events should be of type <em class="ph i">unit</em>. <div class="note" id="n41__note_wdw_jzm_vrb"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> If the bucket type is not <em class="ph i">unit</em>, then the
                            <var class="keyword varname">Rating failed</var> error occurs.</div>
</li>

            </ul>
</div>

        <div class="section" id="n41__section_bv4_nwz_ysb"><h2 class="title sectiontitle">IEC over HTTP from
                    AMF</h2><p class="p"><strong class="ph b">Decentralized</strong></p>
<p class="p">Decentralized calls work like normal
                NCHF (5G) charging calls.</p>
<p class="p"><strong class="ph b">Centralized</strong></p>
<p class="p">Requests received without
                RSU or with empty RSU are treated as centralized calls.</p>
In centralized 5G calls
            for AMF nodes, the slice size is charged only in <var class="keyword varname">SERVICE_SPECIFIC</var>
            unit (from the corresponding charging services) if the requests consist of added
                <var class="keyword varname">chargingInformation</var>. AMF specific rules must be provided in
            slicing profile. <div class="fig fignone" id="n41__fig_ff2_hkr_vsb">
                <a href="../images/5g_ecur_nef_amf.png" class="image"><img class="image break scalefit" id="n41__image_lb1_3kr_vsb" src="../images/5g_ecur_nef_amf.png" /></a>
            </div>
<p class="p">For 5G calls, allocation of units (during reservation) happen in all-or-nothing
                mode. That is, either the entire RSU is allocated (if available from all applicable
                resources), or user gets nothing (if not available in all applicable resources) and
                the error <em class="ph i">Not Enough Credit</em> is returned.</p>
<p class="p">For IEC AMF Calls, slice
                reduction logic works similar to the SMS (Diameter) call.</p>
</div>

        <div class="section" id="n41__section_vvp_xcl_zsb"><h2 class="title sectiontitle">Single CDR</h2>
            
            <p class="p">If <var class="keyword varname">Enable-Single-CDR</var> is present in
                    <var class="keyword varname">NCHF_CHARGING_CALL_ESTABLISHMENT</var> then a single CDR is
                generated on call termination. For this, single CDR must be configured in rules as
                follows:</p>

            <div class="fig fignone" id="n41__fig_a1n_mkr_vsb">
                <img class="image break" id="n41__image_hpv_3m5_cyb" height="192" src="../images/NCHF_Call_est_2.PNG" width="576" />
            </div>

        </div>

        <div class="section" id="n41__section_r4q_sxk_zsb"><h2 class="title sectiontitle">Common behavior for AMF/NEF</h2>
            
            <div class="p">Note the following points about updating the result code in 5G charging calls for AMF
                and NEF node functionality:<ul class="ul" id="n41__ul_n51_vxk_zsb">
                    <li class="li">Result code and root result code are not updated.</li>

                    <li class="li">If all the MUU(s) fail with same reason/result code in the response, then
                        the failed result code (of MUU) is set in the root result code.</li>

                    <li class="li">If in response all MUU(s) fail with different reason/result code in the
                        response, then <em class="ph i">RATING_FAILED</em> (that is, result code
                            <var class="keyword varname">4012</var>) is set in the root result code.</li>

                </ul>
<div class="note" id="n41__note_sr4_pyk_zsb"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> 
                    <ul class="ul" id="n41__ul_wnr_czk_zsb">
                        <li class="li">Currently, only a single UUC is supported for IEC charging for
                            AMF/NEF.</li>

                        <li class="li">Rating and charging for the rest is done as normal N40 Nchf calls.</li>

                    </ul>

                </div>
</div>

            <p class="p"><strong class="ph b">Additional information:</strong></p>

            <div class="p">Note the following points about updating the result code in OneTimeEvent/IEC in 5G
                charging calls:<ul class="ul" id="n41__ul_qm5_3v4_zsb">
                    <li class="li">Result code and root result code are not updated.</li>

                    <li class="li">If all the MUU(s) fail with same reason/result code in the response, then
                        the failed result code (of MUU) is set in the root result code.</li>

                    <li class="li">If in response all MUU(s) fail with different reason/result code in the
                        response, then <em class="ph i">RATING_FAILED</em> (that is, result code
                            <var class="keyword varname">4012</var>) is set in the root result code.</li>

                </ul>
</div>

        </div>

    </div>
<div class="footer"><hr /><p>Charging User Guide • P556766-DN1000054947-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>