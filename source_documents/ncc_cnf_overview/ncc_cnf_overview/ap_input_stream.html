<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Kafka disposition log collector stream" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="ap_input_stream" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Kafka disposition log collector stream</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="ap_input_stream">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Kafka disposition log collector stream</h1>
<div class="body conbody">
        <p class="p">Kafka disposition log collector stream is responsible for processing the records that AP
            handler stream has failed to process. The stream consists of one node, Assume Positive
            Nchf Decoder Node, which picks up Assume Positive Nchf HTTP JSON messages from the
            'disposition' Kafka topic. The node then decodes the records, extracts headers and JSON
            messages from HTTP requests and converts them into NCC internal format (readable
            format).</p>

        <p class="p">Kafka disposition log collector stream can be scheduled to run as required, by performing
            the following two steps:</p>

        <ul class="ul" id="ap_input_stream__ul_vzh_z5f_wpb">
            <li class="li">By editing the execution schedule of Assume Positive Nchf Decoder Node in CGF
                UI</li>

            <li class="li">By setting Assume Positive Nchf Decoder Node node parameter
                    <code class="ph codeph">SingleExecutionTime</code>. The parameter defines how long (in
                seconds) the Kafka disposition log collector stream polls records from the
                'disposition' topic at a time.</li>

        </ul>

        <p class="p">The number of records polled by the stream can be limited via node parameter
                <code class="ph codeph">ConsumerMaxPollRecords</code>, which sets the upper limit to the maximum
            number of records to be polled per second.</p>

        <p class="p">The following is an example snippet of an input file received by Kafka disposition log
            collector stream:</p>

        <pre class="pre codeblock"><code>Failed to receive a response from the CHF Lookup server. The HTTP client threw an error:
Expected a com.google.gson.JsonObject but was com.google.gson.JsonPrimitive
Response JSON: [No response could be served as there are no stub mappings in this WireMock instance.] 
POST: http://localhost:32800/nchf-convergedcharging/v1/chargingdata/imsi-951847623
Content-Type: application/json
Content-Length: 10

{
"subscriberIdentifier": "imsi-951847623",
"nfConsumerIdentification": {
"nodeFunctionality": "SMF",
"nFName": "123e4567-e89b-12d3-a456-426655440000",
"nFIPv4Address": "1.2.3.4",
"nFIPv6Address": "2001:db8:0:0:1:0:0:1",
"nFFqdn": null,
"nFPLMNID": {
"mcc": 310,
"mnc": 210
}
},
"invocationTimeStamp": "2017-07-21T17:32:28Z",
"invocationSequenceNumber": "1",
"oneTimeEvent": "true",
......
}
</code></pre>
        <p class="p">The following shows an example input file snippet converted into NCC internal format
            (output generated by Kafka disposition log collector stream):</p>

        <pre class="pre codeblock"><code>RECORD
F apDispositionRecord true
F error_response_code 400
F error_message The CHF server 'localhost:32800' responded that an error occurred:400 Bad Request
F POST http://localhost:32800/nchf-convergedcharging/v1/chargingdata/imsi-951847623
B headers
F Content-Type application/json
F Content-Length 10
.
F subscriberIdentifier imsi-951847623
B nfConsumerIdentification
F nodeFunctionality SMF
F nFName 123e4567-e89b-12d3-a456-426655440000
F nFIPv4Address 1.2.3.4
F nFIPv6Address 2001:db8:0:0:1:0:0:1
F nFFqdn {{!!NULL!!}}
B nFPLMNID
F mcc 310
F mnc 210
.
.
F invocationTimeStamp 2017-07-21T17:32:28Z
F invocationSequenceNumber 1
F oneTimeEvent true
</code></pre>
    </div>
<div class="footer"><hr /><p>Overview Guide • P556766-DN1000054925-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>