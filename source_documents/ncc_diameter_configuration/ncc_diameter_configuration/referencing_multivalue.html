<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Referencing multi-value AVPs" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="id9yz-09126-cn01-tczza-d1e9024" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Referencing multi-value AVPs</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="id9yz-09126-cn01-tczza-d1e9024">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Referencing multi-value AVPs</h1>
<div class="body conbody">
                                <p class="p">The Diameter protocol specifies that multiple instances of an AVP
                                                may occur within a single message. An AVP that is
                                                defined as multi-valued may itself be a container
                                                for one or more AVPs. Further, an AVP might be
                                                single-valued but due to a multi-valued parent
                                                ancestor, may appear multiple times within the
                                                message. In general, the multiplicity of the
                                                multi-value AVPs is often unbounded. As a result,
                                                multi-value Diameter messages may be arbitrarily
                                                complex in terms of the number of and location of
                                                the occurrence of particular AVPs. </p>

                                <p class="p">For example, consider the case of the Rx AAR message; it contains
                                                an AVP Media-Component-Description, which is
                                                multi-valued and of type grouped. This AVP contains,
                                                among other AVPs, a multi-valued, grouped
                                                Media-Sub-Component AVP that in turn contains a
                                                multi-valued Flow-Description AVP.</p>

                                <p class="p">NCC simplifies the process of referencing multi-value AVPs by
      providing the capability to organize indices, and multi-value actions/attributes. These
      features provide the flexibility and convenience that allow you to write a message filter that
      checks whether any of the Flow-Description AVPs (from the Rx AAR message above) has a
      particular value or matches a specific pattern. </p>

                                <p class="p">The following sections provide information about multi-value AVP
                                                support:</p>

                                <ul class="ul" id="id9yz-09126-cn01-tczza-d1e9024__ul_ejh_snn_qxb">
                                                <li class="li">
                                                  <p class="p">Read and write indices</p>

                                                </li>

                                                <li class="li">
                                                  <p class="p">Multi-value actions/attributes</p>

                                                </li>

                                </ul>

<div class="section"><h2 class="title sectiontitle">Read and write indices</h2>
<p class="p">NCC provides independent read and write indices that allow you to write message filters to
        iterate through fixed-size and unbounded collections of AVPs and evaluate conditions at
        specific locations. You can read, write, and modify the value at a specific location. In
        addition, you can use the read and write indices to copy a value to any location within a
        Diameter message, including a newly created AVP.</p>

<p class="p">You can manage the indices by configuring the action attributes provided by NCC. These actions
        are dynamically loaded by NCC and can be present in the source context and/or the result
        context for each Diameter AVP. The table below describes the basic actions that can be
        configured to manage the read and write indices. </p>

<table cellpadding="4" cellspacing="0" summary="" class="table" width="100%" frame="border" border="1" rules="all"><caption><span class="tablecap"><span class="table--title-label">Table: </span>Index management action attributes</span></caption><colgroup><col /><col /></colgroup><thead class="thead" style="text-align:left;">
<tr class="row">
<th class="entry cellrowborder" style="vertical-align:top;" id="d34580e78">
<p class="p">Action name</p>

</th>

<th class="entry cellrowborder" style="vertical-align:top;" id="d34580e84">
<p class="p">Purpose</p>

</th>

</tr>

</thead>
<tbody class="tbody">
<tr class="row">
<td class="entry cellrowborder" style="vertical-align:top;" headers="d34580e78 "> Read-Index </td>

<td class="entry cellrowborder" style="vertical-align:top;" headers="d34580e84 "> Allows you to specify the index from which to read a
                                single value. The Read-Index attribute is available as both a source
                                and result context, for AVPs that are multi-valued themselves. You
                                can set the read indices to return a sub-set of values from the
                                Diameter message. </td>

</tr>

<tr class="row">
<td class="entry cellrowborder" style="vertical-align:top;" headers="d34580e78 "> Write-Index </td>

<td class="entry cellrowborder" style="vertical-align:top;" headers="d34580e84 "> Allows you to specify the index at which to write a
                                value. The Write-Index attribute is available as both a source and
                                result context, for AVPs that are multi-valued themselves. </td>

</tr>

<tr class="row">
<td class="entry cellrowborder" style="vertical-align:top;" headers="d34580e78 "> Clear-Read-Indices </td>

<td class="entry cellrowborder" style="vertical-align:top;" headers="d34580e84 ">
<p class="p">Allows you to clear the Read-Index cache maintained by NCC. The cache is automatically cleared
                  for public rule table invocations.</p>

<p class="p">The action uses the following syntax:</p>

<p class="p">&lt;Context&gt;.Clear-Read-Indices</p>

<p class="p">The &lt;context&gt; can be any NCC message context. For example,
                                    GxCCA.Clear-Read-Indices will clear the Read-Index cache for the
                                    GxCCA message.</p>

</td>

</tr>

<tr class="row">
<td class="entry cellrowborder" style="vertical-align:top;" headers="d34580e78 "> Clear-Write-Indices </td>

<td class="entry cellrowborder" style="vertical-align:top;" headers="d34580e84 ">
<p class="p">Allows you to clear the Write-Index cache maintained by NCC. The cache is automatically cleared
                  for public rule table invocations.</p>

<p class="p">The action uses the following syntax:</p>

<p class="p">&lt;Context&gt;.Clear-Write-Indices</p>

<p class="p">The &lt;context&gt; can be any NCC message context. For example,
                                    GxCCA.Clear-Write-Indices will clear the Write-Index cache for
                                    the GxCCA message.</p>

</td>

</tr>

</tbody>
</table>

<p class="p">Read and write indices are cleared before a message filter is invoked. However, changes made to the indices persist for the duration of the processing of the associated filter. This includes processing message filters invoked either directly or indirectly from that filter. </p>

<p class="p">Once NCC completes processing a message filter and prepares to evaluate the next filter, any read
        and write indices that have been explicitly set using message filters are automatically
        cleared. You can also write filters to clear the read and/or the write index, if
        required.</p>

<p class="p">When associated with single-valued operations (that is, accessing a single-valued attribute or using the common action types), the read and write indices have implicit defaults of zero. </p>

</div>

<div class="section"><h2 class="title sectiontitle">Multi-value actions/attributes</h2>
<p class="p">NCC provides several attributes/actions to support multi-value AVP manipulation. These
        action/attributes are dynamically loaded by NCC and can be available in the source and/or
        result contexts. </p>

<p class="p">They offer an enhanced toolset that allows you to write message filters to:</p>
<ul class="ul">
<li class="li">
<p class="p">indicate whether the message filter should affect a particular instance or all instances of an AVP</p>

</li>

<li class="li">
<p class="p">indicate the indices of each AVP that you wish subsequent actions to be performed on</p>

</li>

</ul>

<p class="p">The following attribute naming convention is used in the table below to describe the actions/attributes, and to define the referential scope of the message filter (single-value or multi-value).</p>

<pre class="pre codeblock"><code>&lt;App-Cmd&gt;[.&lt;Ancestor-AVP-Name&gt;]*.AVP-Name</code></pre>
<p class="p">where:</p>

<p class="p">-&lt;App-Cmd&gt; is the message context name</p>

<p class="p">-&lt;Ancestor-AVP-Name&gt; is the zero or more ancestor/parent AVPs</p>

<p class="p">-AVP-Name is the leaf AVP</p>

<p class="p">-for example: RxAAR.Media-Component-Description.Media-Type</p>

<table cellpadding="4" cellspacing="0" summary="" class="table" width="100%" frame="border" border="1" rules="all"><caption><span class="tablecap"><span class="table--title-label">Table: </span>NCC attributes/actions to support multi-value AVPs </span></caption><colgroup><col /><col /><col /></colgroup><thead class="thead" style="text-align:left;">
<tr class="row">
<th class="entry cellrowborder" style="vertical-align:top;" id="d34580e231">
<p class="p">AVP type</p>

</th>

<th class="entry cellrowborder" style="vertical-align:top;" id="d34580e237">
<p class="p">Attribute/Action</p>

</th>

<th class="entry cellrowborder" style="vertical-align:top;" id="d34580e243">
<p class="p">Description</p>

</th>

</tr>

</thead>
<tbody class="tbody">
<tr class="row">
<td class="entry cellrowborder" style="vertical-align:top;" headers="d34580e231 "> single-value </td>

<td class="entry cellrowborder" style="vertical-align:top;" headers="d34580e237 ">
                                &lt;App-Cmd&gt;[.&lt;Ancestor-AVP-Name&gt;]*.AVP-Name </td>

<td class="entry cellrowborder" style="vertical-align:top;" headers="d34580e243 ">
<p class="p">Refer to the AVP by its name to access one instance of that
                                    AVP.</p>

<p class="p">For example, to refer to one instance of the Flow-Description
                                    AVP, use: Media-Component-Description. Media-Sub-Component.
                                    Flow-Description.</p>

</td>

</tr>

<tr class="row">
<td class="entry cellrowborder" style="vertical-align:top;" headers="d34580e231 "> multi-value </td>

<td class="entry cellrowborder" style="vertical-align:top;" headers="d34580e237 ">
                                &lt;App-Cmd&gt;[.&lt;Ancestor-AVP-Name&gt;]*.AVP-Name[] </td>

<td class="entry cellrowborder" style="vertical-align:top;" headers="d34580e243 ">
<p class="p">The "[]" notation at the end of an attribute name indicates that
                                    the attribute returns a collection of values. Use it to access a
                                    collection of AVPs.</p>

<p class="p">By default, all the values from the message are returned, but a
                                    subset of values can be returned by setting relevant read
                                    indices.</p>

</td>

</tr>

<tr class="row">
<td class="entry cellrowborder" style="vertical-align:top;" headers="d34580e231 "> multi-value </td>

<td class="entry cellrowborder" style="vertical-align:top;" headers="d34580e237 ">
                                &lt;App-Cmd&gt;[.&lt;Ancestor-AVP-Name&gt;]*.AVP-Name.Total-Number-Of-Values </td>

<td class="entry cellrowborder" style="vertical-align:top;" headers="d34580e243 ">
<p class="p">Use it to return the total number of values of a particular AVP
                                    across all instances of its ancestor AVPs by applying the
                                    Read-Index. Read indices can be set to return a number
                                    representing a subset of values of a given AVP from a Diameter
                                    message.</p>

<p class="p">For example, Parent.Child.Grandchild.Total-Number-Of-Values will
                                    return the total number of children and grandchildren for all
                                    instances of Parent. Read-Index can be applied at all three
                                    levels of the AVP.</p>

<p class="p">To find the number of Flow-Description AVPs that exist in all of
                                    the Media-Sub-Components of all of the
                                    Media-Component-Descriptions of the current Rx AAR message being
                                    processed, use: Media-Component-Description.
                                    Media-Sub-Component.
                                    Flow-Description.Total-Number-Of-Values.</p>

</td>

</tr>

<tr class="row">
<td class="entry cellrowborder" style="vertical-align:top;" headers="d34580e231 "> single-value </td>

<td class="entry cellrowborder" style="vertical-align:top;" headers="d34580e237 ">
                                &lt;App-Cmd&gt;[.&lt;Ancestor-AVP-Name&gt;]*.AVP-Name.Read-Index </td>

<td class="entry cellrowborder" style="vertical-align:top;" headers="d34580e243 "> The index from which to read a single value for AVPs
                                that are multi-valued themselves. The Read-Index determines which
                                value will be returned. </td>

</tr>

<tr class="row">
<td class="entry cellrowborder" style="vertical-align:top;" headers="d34580e231 "> single-value </td>

<td class="entry cellrowborder" style="vertical-align:top;" headers="d34580e237 ">
                                &lt;App-Cmd&gt;[.&lt;Ancestor-AVP-Name&gt;]*.AVP-Name.Write-Index </td>

<td class="entry cellrowborder" style="vertical-align:top;" headers="d34580e243 ">
<p class="p">The index at which to write a single value for AVPs that are
                                    multi-valued themselves. </p>

<p class="p">The Write-Index affects the following common action types as
                                    follows:</p>

<ul class="ul">
<li class="li">
<p class="p">Add action-Determines where a value is aSPSd</p>

</li>

<li class="li">
<p class="p">Set action-Determines the value to be set</p>

</li>

<li class="li">
<p class="p">Remove-Value action-Write-Index of the leaf AVP
                                            determines the value to remove</p>

</li>

<li class="li">
<p class="p">Remove-Determines the AVP to remove</p>

</li>

</ul>

</td>

</tr>

</tbody>
</table>

</div>

</div>
<div class="footer"><hr /><p>Diameter/HTTP Configuration Guide • P556766-DN1000054969-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>