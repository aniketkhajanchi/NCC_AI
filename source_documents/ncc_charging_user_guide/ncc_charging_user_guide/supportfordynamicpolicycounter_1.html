<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Dynamic policy counter" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="supportfordynamicpolicycounter_0" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Dynamic policy counter</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="supportfordynamicpolicycounter_0">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Dynamic policy counter</h1>
<div class="body conbody">
        <div class="section" id="supportfordynamicpolicycounter_0__section_tw1_tfy_tmb">
            <p class="p">This feature enables the use of Diameter Sy interface to transfer Quality of Service
                (QoS) information by using the dynamic value of policy counter identifier (such as,
                    <var class="keyword varname">PC_&lt;RG&gt;_&lt;APN&gt;_&lt;Framed-IP-Address&gt;</var>).</p>

            <p class="p">The dynamic value of policy counter identifier can be determined by the dynamic
                values of specific parameters received in the Gy CCR request. For example:</p>

            <ul class="ul" id="supportfordynamicpolicycounter_0__ul_ty5_qnx_tmb">
                <li class="li">
                    <p class="p"><var class="keyword varname">&lt;RG&gt;</var>- Rating Group</p>

                </li>

                <li class="li">
                    <p class="p"><var class="keyword varname">&lt;APN&gt;</var>- Access Point Name retrieved from the
                            <em class="ph i">Called-Station-Id</em> AVP</p>

                </li>

                <li class="li">
                    <p class="p"><var class="keyword varname">&lt;Framed-IP-Address&gt;</var>- which is retrieved from the
                            <em class="ph i">Framed-IP-Address</em> AVP and it can either be an IPv4 or IPv6
                        address</p>

                </li>

            </ul>

            <p class="p">The policy counter status can be <var class="keyword varname">HIGH</var> or <var class="keyword varname">LOW</var>
                depending on the bucket or counter from which reservation is done.</p>

            <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> A dynamic policy counter should only be configured as a virtual counter on the
                    resource-based counter of a device.</div>

        </div>

        <div class="section" id="supportfordynamicpolicycounter_0__section_rxk_sf2_ymb"><h2 class="title sectiontitle">Resource-based counter enhancement</h2>
            
            <p class="p">For a resource-based counter, the SNR is sent based on the resource used for maximum
                reservation. Threshold is applied with configuration <var class="keyword varname">Absolute From
                    Start</var> and value <var class="keyword varname">0</var> to process the <em class="ph i">Counter
                    Signalling State</em> in every reservation.</p>

            <p class="p">Following are the context variables added to resource-based counters to determine the
                states based on the given configurations:</p>

            <table cellpadding="4" cellspacing="0" summary="" id="supportfordynamicpolicycounter_0__table_vwn_yf2_ymb" class="table" frame="border" border="1" rules="all"><colgroup><col style="width:37.453183520599254%" /><col style="width:62.546816479400746%" /></colgroup><thead class="thead" style="text-align:left;">
                        <tr class="row">
                            <th class="entry cellrowborder" style="vertical-align:top;" id="d75451e124">Name of context variable</th>

                            <th class="entry cellrowborder" style="vertical-align:top;" id="d75451e127">Description</th>

                        </tr>

                    </thead>
<tbody class="tbody">
                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d75451e124 "><em class="ph i">Reserve-Entity-Name</em></td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d75451e127 ">Name of the entity (which can be <var class="keyword varname">BucketDef Id</var>,
                                    <var class="keyword varname">CounterDef Id</var>, or
                                    <var class="keyword varname">AccountId</var>) from which the maximum reservation
                                has taken place.</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d75451e124 "><em class="ph i">Reserve-Entity-Type</em></td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d75451e127 ">Type of entity (<var class="keyword varname">ENTITY_BUCKET</var>,
                                    <var class="keyword varname">ENTITY_ACCOUNT</var>, or
                                    <var class="keyword varname">NOCHARGE</var>) from which the maximum reservation
                                has taken place.</td>

                        </tr>

                    </tbody>
</table>

        </div>

        <div class="section" id="supportfordynamicpolicycounter_0__section_pkn_w4x_tmb"><h2 class="title sectiontitle">Recommended configuration for this feature</h2>
            
            <p class="p">Configure the following ME application preferences to enable this feature:</p>

            <ul class="ul" id="supportfordynamicpolicycounter_0__ul_y3r_1px_tmb">
                <li class="li">
                    <p class="p">Set <em class="ph i">Virtual Policy Counter Support</em> to
                            <var class="keyword varname">BUCKET_COUNTER</var>.</p>

                </li>

                <li class="li">
                    <p class="p">Set <em class="ph i">Default Signalling State Value</em> to <var class="keyword varname">HIGH</var>.</p>

                </li>

                <li class="li">
                    <p class="p">Set <em class="ph i">Dynamic Policy Counter Identifier</em> to
                        <var class="keyword varname">ENABLED</var>.</p>

                    <p class="p">If the <em class="ph i">Dynamic Policy Counter Identifier</em> is set as
                            <var class="keyword varname">ENABLED</var>, then an Sy session is created without any
                        policy counter information as the <em class="ph i">Dynamic Policy Counter Name</em> is not
                        available at the time of Sy session creation.</p>

                    <ul class="ul" id="supportfordynamicpolicycounter_0__ul_lnf_4jy_tmb">
                        <li class="li">
                            <p class="p">NCC does not send policy counter information in SLA and instead sends
                                the following error code 4241, which states <var class="keyword varname">Sy
                                    Experimental-Result-Code =
                                    DIAMETER_ERROR_NO_AVAILABLE_POLICY_COUNTERS</var>.</p>

                        </li>

                        <li class="li">
                            <p class="p">In case of SLR intermediate call, NCC sends an error code 4241, which
                                states <var class="keyword varname">Sy Experimental-Result-Code =
                                    DIAMETER_ERROR_NO_AVAILABLE_POLICY_COUNTERS</var>.</p>

                        </li>

                    </ul>

                </li>

            </ul>

            <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> If this feature is used for both charging and policy components, then also set
                    the <em class="ph i">Sy Accept SNR for Failed Session</em> policy application preference as
                        <var class="keyword varname">true</var> apart from the preceding policy application
                    preferences.</div>

            <p class="p">Once, the Gy session is established and first quota is granted, NCC sends an SNR only
                for low QoS scenarios. In case of high QoS scenario, NCC does not send an SNR as
                default QoS applied at the beginning of the session is also high QoS.</p>

            <p class="p">The default signalling state is derived from the <em class="ph i">Default Signalling State
                    Value</em> in the system property and it is set to <var class="keyword varname">HIGH</var> for
                dynamic policy counter.</p>

            <ul class="ul" id="supportfordynamicpolicycounter_0__ul_lsq_4ky_tmb">
                <li class="li">For first call, when policy counter state is <var class="keyword varname">HIGH</var> but not
                    already present in the database, NCC saves the dynamic policy counter with
                    default signalling state set as <var class="keyword varname">HIGH</var> and does not send out
                    any SNR.</li>

                <li class="li">For first call, when policy counter state is <var class="keyword varname">LOW</var> but not
                    already present in the database, NCC saves the dynamic policy counter with
                    signalling state as <var class="keyword varname">LOW</var> and also sends out an SNR.</li>

                <li class="li">For subsequent calls, when policy counter state is different from the previous
                    SNR state sent out, then NCC sends out a new SNR and saves the policy counter
                    state in database.</li>

                <li class="li">For subsequent calls, when policy counter state is same as the previous SNR
                    state, no changes are performed and no SNR is sent out.</li>

                <li class="li">In case of subscription renewal through lifecycle, the buckets and counter gets
                    reset. SNR is not sent at the time of subscription renewal as there is no
                    corresponding Gy request that defines the parameters of the dynamic policy
                    counter name.</li>

            </ul>

            
            <p class="p">Follow this recommended configuration to understand the working of this feature:</p>

            <ol class="ol" id="supportfordynamicpolicycounter_0__ol_apd_sqx_tmb">
                <li class="li">
                    <p class="p">Create three bundles; <var class="keyword varname">UBD1</var>, <var class="keyword varname">UBD2</var>, and
                            <var class="keyword varname">UBD3</var>.</p>

                </li>

                <li class="li">Each bundle has two charging services, one for bucket consumption and the other
                    one for non-policy counter consumption, such as:</li>

                <li class="li">
                    <ol class="ol" type="a" id="supportfordynamicpolicycounter_0__ol_tmc_zqx_tmb">
                        <li class="li">
                            <p class="p">For bundle <var class="keyword varname">UBD1</var>:</p>

                            <ul class="ul" id="supportfordynamicpolicycounter_0__ul_idl_brx_tmb">
                                <li class="li">
                                    <p class="p"><var class="keyword varname">CSBucket1</var> with tariff as
                                            <var class="keyword varname">Rating.Bucket-Selection =
                                        "Bucket1"</var>.</p>

                                </li>

                                <li class="li">
                                    <p class="p"><var class="keyword varname">CSCounter1</var> with tariff as</p>

                                    <p class="p"><var class="keyword varname">RATING.Counter-Selection = “CSCounter1"</var>
                                        and</p>

                                    <p class="p"><var class="keyword varname">RATING.No-Charge</var></p>

                                </li>

                            </ul>

                        </li>

                        <li class="li">
                            <p class="p">For bundle <var class="keyword varname">UBD2</var>:</p>

                            <ul class="ul" id="supportfordynamicpolicycounter_0__ul_hjh_rrx_tmb">
                                <li class="li">
                                    <p class="p"><var class="keyword varname">CSBucket2</var> with tariff as
                                            <var class="keyword varname">Rating.Bucket-Selection =
                                        "Bucket2"</var>.</p>

                                </li>

                                <li class="li">
                                    <p class="p"><var class="keyword varname">CSCounter2</var> with tariff as</p>

                                    <p class="p"><var class="keyword varname">RATING.Counter-Selection = “CSCounter2"</var>
                                        and</p>

                                    <p class="p"><var class="keyword varname">RATING.No-Charge</var></p>

                                </li>

                            </ul>

                        </li>

                        <li class="li">
                            <p class="p">For bundle <var class="keyword varname">UBD3</var>:</p>

                            <ul class="ul" id="supportfordynamicpolicycounter_0__ul_t34_vrx_tmb">
                                <li class="li">
                                    <p class="p"><var class="keyword varname">CSBucket3</var> with tariff as
                                            <var class="keyword varname">Rating.Bucket-Selection = "Bucket3"</var>,
                                        and no charging service for counter consumption.</p>

                                </li>

                            </ul>

                        </li>

                    </ol>

                </li>

                <li class="li">
                    <p class="p">Configure the following thresholds to send notification at a required time
                        frame or data consumption:</p>

                    <img class="image break" id="supportfordynamicpolicycounter_0__image_csx_jtx_tmb" src="../images/configimage1.PNG" height="284" width="636" />
                    
                    <img class="image break" id="supportfordynamicpolicycounter_0__image_lyt_ltx_tmb" src="../images/configimage2.PNG" height="286" width="413" />
                </li>

                <li class="li">
                    <p class="p">Configure the threshold to send QoS notification through Sy interface by
                        sending the dynamic policy counter ID and status at the time of
                        reservation.</p>

                    <p class="p">The following figure states an example of configuring threshold on a
                        resource-based device counter:</p>

                    <img class="image break" id="supportfordynamicpolicycounter_0__image_i3b_k5x_tmb" src="../images/thresholdondevicecounter.PNG" height="424" width="636" />
                    <p class="p">Here, the <em class="ph i">Reserve-Entity-Type</em> describes the type of entity from which
                        maximum reservation has taken place, and this can have one of the 3 values;
                            <var class="keyword varname">ENTITY_BUCKET</var>, <var class="keyword varname">ENTITY_ACCOUNT</var>, or
                            <var class="keyword varname">NOCHARGE</var>.</p>

                    <p class="p">As shown in the figure below, the following rule variables are created under
                            <var class="keyword varname">THRESHOLD</var> trigger from respective parameters of Gy
                        CCR request:</p>

                    <img class="image break" id="supportfordynamicpolicycounter_0__image_dlw_jvx_tmb" src="../images/dpcrulesandvariables.PNG" height="283" width="743" />
                    <p class="p">Create the <var class="keyword varname">DPC_Identifier</var> by concatenating the
                            <var class="keyword varname">DPC_APN</var>, <var class="keyword varname">DPC_FramedIP</var>, and
                            <var class="keyword varname">DPC_RG</var>:</p>

                    <img class="image break" id="supportfordynamicpolicycounter_0__image_wt1_4vx_tmb" src="../images/dpcidentifier.PNG" height="214" width="535" />
                </li>

                <li class="li">
                    <p class="p">Configure the complex map as <var class="keyword varname">LOW</var> for policy counter
                        status:</p>

                    <img class="image break" id="supportfordynamicpolicycounter_0__image_m3f_1wx_tmb" src="../images/dpccounterstatus.PNG" height="156" width="547" />
                    <p class="p"><strong class="ph b">QoS variable</strong>:</p>

                    <img class="image break" id="supportfordynamicpolicycounter_0__image_rlf_mwx_tmb" src="../images/qosvariable.PNG" height="240" width="537" />
                    <p class="p">The <var class="keyword varname">LOW</var> PC status can be send using the QoS variable:</p>

                    <img class="image break" id="supportfordynamicpolicycounter_0__image_uch_xwx_tmb" src="../images/qosvariableconfig.PNG" height="186" width="535" />
                </li>

                <li class="li">
                    <p class="p"><em class="ph i">(Optional)</em> Configure the following quota management (slicing
                        profile) configuration:</p>

                    <img class="image break" id="supportfordynamicpolicycounter_0__image_i5s_4xx_tmb" src="../images/slicingprofileconfig1.PNG" height="178" width="447" />
                </li>

            </ol>

        </div>

        <div class="section" id="supportfordynamicpolicycounter_0__section_ak1_jzx_tmb"><h2 class="title sectiontitle">Examples</h2>
            
            <p class="p">Consider the following example for a better understanding of this feature:</p>

            <div class="sectiondiv">
                <p class="p"><strong class="ph b">Example 1:</strong> Subscriber, which is already at a <var class="keyword varname">LOW</var> state
                    at the beginning of the data session switches to high QoS during a data
                    session</p>

                <p class="p"><strong class="ph b">Call processing</strong>:</p>

                <ol class="ol" id="supportfordynamicpolicycounter_0__ol_wpj_kly_tmb">
                    <li class="li">
                        <p class="p">After recieving SLR, NCC does not send any policy counter information in
                            SLA and instead, it sends the error code 4241, which states <var class="keyword varname">Sy
                                Experimental-Result-Code =
                                DIAMETER_ERROR_NO_AVAILABLE_POLICY_COUNTERS</var>.</p>

                    </li>

                    <li class="li">
                        <p class="p">The <var class="keyword varname">LOW</var> PC status is send out in the SNR at the
                            initiation of session.</p>

                    </li>

                    <li class="li">
                        <p class="p">Suppose a bundle renewal takes place and the bucket entity is again
                            reinstated and data  consumption can again be initiated from bucket as
                            bucket has sufficient balance.</p>

                        <img class="image break" id="supportfordynamicpolicycounter_0__image_ylh_3my_tmb" src="../images/uc3image.PNG" height="303" width="531" />
                    </li>

                </ol>

                <p class="p"><strong class="ph b">Result:</strong></p>

                <p class="p">Verify that NCC sends out an SNR stating with status as <var class="keyword varname">HIGH</var>
                    after the bucket balance is refilled and the data session continues with
                    reserving data from bucket balance.</p>

            </div>
        </div>

    </div>
<div class="footer"><hr /><p>Charging User Guide • P556766-DN1000054947-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>