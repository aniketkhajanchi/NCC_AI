<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Allow threshold profile groups to be updated for devices previously subscribed to a bundle" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="allow_threshold_profile_group_to_be_updated_for_devices_previously_subscribed_to_a_bundle" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Allow threshold profile groups to be updated for devices previously subscribed to a bundle</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="allow_threshold_profile_group_to_be_updated_for_devices_previously_subscribed_to_a_bundle">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Allow threshold profile groups to be updated for devices previously subscribed to a
        bundle</h1>
<div class="body conbody">
        <div class="note caution"><div class="cautiontitle"><img src="../../web/css/../images/caution.svg" title="caution-icon" class="noteicon" />CAUTION:</div> When a rule is created, modified, removed, or loaded, it takes a
            minimum of 30 seconds to load the RSV. For any action that updates the rules (for
            example, a TPG value is updated from 10 to 20, an action is updated, or a Tariff Rule
            action is modified), the changes take effect after ~30 seconds. Operators must wait for
            this time interval (30 seconds), to consider the change for feature
            implementation/execution.</div>

        <div class="section" id="allow_threshold_profile_group_to_be_updated_for_devices_previously_subscribed_to_a_bundle__section_ehp_3rm_pnb">
            <p class="p">This feature supports the ability to update thresholds defined within a Threshold
                Profile Group (TPG) in a counter, bucket, account, and Aggregate View (AV), which
                further applies to devices or groups to already attached TPGs. The thresholds can be
                updated in the following means:</p>

            <ul class="ul" id="allow_threshold_profile_group_to_be_updated_for_devices_previously_subscribed_to_a_bundle__ul_iyg_qsm_pnb">
                <li class="li">
                    <p class="p">Changing the threshold values for existing thresholds.</p>

                </li>

                <li class="li">
                    <p class="p">Removing an existing threshold.</p>

                </li>

                <li class="li">
                    <p class="p">Adding new thresholds.</p>

                </li>

                <li class="li">
                    <p class="p">Adding or modifying threshold conditions and actions in rule</p>

                </li>

            </ul>

            <p class="p">For example:</p>

            <p class="p">Suppose there is a counter with <em class="ph i">ULI</em> set as <var class="keyword varname">5 GB</var> and
                    <em class="ph i">OLI</em> set as <var class="keyword varname">2 GB</var>. <var class="keyword varname">Threshold1</var> is
                applied at 50% for ULI notifiication and <var class="keyword varname">Threshold2</var> is applied at
                100% for OLI notification, such as when counter value is <var class="keyword varname">2.5 GB</var>
                and <var class="keyword varname">7 GB</var> respectively, the ULI or OLI notification can be
                sent.</p>

            <p class="p">However, as per this feature, if <var class="keyword varname">Threshold1</var> value is changed to
                25% for ULI notification and <var class="keyword varname">Threshold2</var> value is changed to 50%
                for OLI notification action, then whenever the next Gy request is received (and as
                per the current counter value), a notification is sent at <var class="keyword varname">1.25 GB</var>
                and <var class="keyword varname">6 GB</var> for ULI and OLI notifications, respectively.</p>

            <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> The TPG updates take effect only for those entities (which can be bucket, account,
                counter, or AV) that were a part of the current Diameter call when the next event is
                received from the network so that the impact is distributed over the time instead of
                overloading many updates all at the same time.</div>

        </div>

    </div>
<div class="topic concept nested1" aria-labelledby="ariaid-title2" id="concept_kt2_lfm_r4b"><h2 class="title topictitle2" id="ariaid-title2">Additional information</h2>
<div class="body conbody">
            <div class="section" id="concept_kt2_lfm_r4b__section_oxb_jrm_pnb">
                <p class="p">Consider the following points for this feature:</p>

                <ul class="ul" id="concept_kt2_lfm_r4b__ul_oqz_ytm_pnb">
                    <li class="li">
                        <p class="p">This feature is applicable to Gy/Sy, NCHF, and VoLte/IMS calls.</p>

                    </li>

                    <li class="li">
                        <p class="p">Any parallel updates in RSV with an entity containing rule should not be
                            executed in the same time window.</p>

                    </li>

                    <li class="li">
                        <p class="p">The TPG definition is instantly updated but the update to RSV might take
                            some sync up time.</p>

                    </li>

                    <li class="li">Once threshold definitions are updated, SNR actions defined in them are
                        immediately picked for the policy counters on which threshold profile group
                        is attached. For other actions, thresholds are evaluated only after rule
                        engine or RSV is updated with the new threshold rules. Default time to start
                        reloading of rules or RSV is 30 seconds.</li>

                    <li class="li">
                        <p class="p">The usage type counters are considered for update to SNR related and
                            policy counter state.</p>

                    </li>

                    <li class="li">
                        <p class="p">If the counters for resource type and threshold are applied to those
                            counters with values other than zero, then it does not send the updated
                            SNR policy counter state.</p>

                    </li>

                    <li class="li">
                        <p class="p">This feature supports the change in threshold value of type provisioning
                            as well. For example, if threshold of type is provisioned with a value
                            as <var class="keyword varname">10</var> and applied on a bucket resource with a current
                            value as <var class="keyword varname">7</var>, then a user can update the value from
                                <var class="keyword varname">10</var> to <var class="keyword varname">5</var>, which means using
                            provisioning when a bucket value is updated to <var class="keyword varname">5</var>, the
                            provisioning threshold is executed and the configured notification is
                            evaluated.</p>

                    </li>

                    <li class="li">
                        <p class="p">The usage limit (ULI) can also be applied to counter resources with
                            application of threshold (TPG) of percentage type. The execution of ULI
                            is as per the threshold applied on the ULI and further, the update as
                            well.</p>

                        <p class="p">For example, suppose a ULI of <var class="keyword varname">5 GB</var> is applied on
                            counter and a threshold of <var class="keyword varname">100%</var> is applied on the ULI
                            to receive a notification on consumption of <var class="keyword varname">5 GB</var>. Now
                            as per this feature, if threshold value is updated to
                                <var class="keyword varname">50%</var>, then when the next Gy request is received,
                            the notification is sent out as per threshold value
                                <var class="keyword varname">50%</var>, which means, if counter value is
                                <var class="keyword varname">2.5 GB</var>, then a notification is sent to the
                            user.</p>

                    </li>

                </ul>

            </div>

        </div>
</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title3" id="concept_xtf_jfm_r4b"><h2 class="title topictitle2" id="ariaid-title3">Examples</h2>
<div class="body conbody">
            <p class="p">Consider the following examples for better understanding of this feature:</p>

            <div class="bodydiv conbodydiv">
                <div class="section" id="concept_xtf_jfm_r4b__section_vtl_k25_pnb"><h3 class="title sectiontitle">Example 1: Behavior in case of Absolute thresholds</h3>
                    
                    <p class="p">This example enables us to understand the behavior of this feature in case of
                        absolute thresholds.</p>

                    <p class="p"><strong class="ph b">Preconditions:</strong></p>

                    <ol class="ol" id="concept_xtf_jfm_r4b__ol_psy_5xn_qnb">
                        <li class="li">
                            <p class="p">Subscribe a device to a bundle with a single unlimited counter
                                defined as a policy counter, which is mapped to an external policy
                                counter ID.</p>

                        </li>

                        <li class="li">
                            <p class="p">Include the threshold profile group in the bundle's counter, which
                                further consists of a single absolute (throttling) threshold at
                                    <var class="keyword varname">10 GB</var>.</p>

                            <p class="p">If the threshold value remains less than <var class="keyword varname">10 GB</var>,
                                then the associated policy counter ID has a policy counter status of
                                    <var class="keyword varname">1</var>; whereas, if the data usage reaches the
                                absolute threshold value or exceeds it, then the policy counter
                                status changes to <var class="keyword varname">2</var>.</p>

                        </li>

                        <li class="li">
                            <p class="p">There are currently active Gy and Sy sessions for the device.</p>

                        </li>

                        <li class="li">
                            <p class="p">Considering that the current usage of counter is <var class="keyword varname">9.8
                                    GB</var>, the associated policy counter has a policy counter
                                status of <var class="keyword varname">1</var>.</p>

                        </li>

                    </ol>

                    <p class="p"><strong class="ph b">Execution of call:</strong></p>

                    <ol class="ol" id="concept_xtf_jfm_r4b__ol_fcq_qxn_qnb">
                        <li class="li">
                            <p class="p">A CCR-U is received for the device reporting usage of <var class="keyword varname">200
                                    MB</var>. This causes the counter value to reach the
                                    <var class="keyword varname">10 GB</var> absolute threshold triggering an SNR to
                                be sent reporting a new policy counter status of
                                    <var class="keyword varname">2</var> for the associated policy counter ID.</p>

                        </li>

                        <li class="li">
                            <p class="p">Due to a temporary disaster condition, the TPG associated with the
                                bundle is updated to change the absolute value for the single
                                threshold from <var class="keyword varname">10 GB</var> to <var class="keyword varname">20 GB</var>.
                                No action is taken for any existing data flows until new
                                transactions are received from the network.</p>

                        </li>

                        <li class="li">
                            <p class="p">Another CCR-U is received reporting usage of <var class="keyword varname">1 GB</var>,
                                which brings the usage of counter to <var class="keyword varname">11 GB</var>. The
                                CHF detects that the TPG associated with the subscribed bundle's
                                counter has changed and the previous version is now out of date.
                                Therefore, the updated TPG is loaded and the system detects that the
                                PC status for the policy counter associated with the counter whose
                                value is <var class="keyword varname">11 GB</var> is changed because usage is now
                                below the single threshold, so an SNR is generated for the
                                associated policy counter ID with a PC status of
                                    <var class="keyword varname">1</var>.</p>

                        </li>

                        <li class="li">The TPG used for the bundle is again updated, and this time adding a de
                            prioritization threshold at 5 GB with a PC status of
                                <var class="keyword varname">U1</var>. Again, no other action is taken for existing
                            data flows until subsequent transactions are received.</li>

                        <li class="li">An update profile API is invoked to change the BCR date of the account
                            funding the bundle of the device, so that the next BCR date occurs on an
                            earlier date. This in turn, triggers the CHF to send an RAR for the
                            active Gy session.</li>

                        <li class="li">A CCR-U is received in response to the RAR sent in the previous step
                            reporting an additional 500 MB of usage so that the counter value is
                            updated to 11.5 GB. At this point, the CHF detects that the TPG for the
                            bundle subscribed to the device has been updated and loads the new TPG
                            version, which in turn, results in the system detecting that the policy
                            counter status has changed due to the addition of the new
                            de-prioritization threshold triggering another SNR with a PC status value
                            of <var class="keyword varname">U1</var> for the associated policy counter ID.</li>

                        <li class="li">The disaster condition is resolved and the TPG is again updated to
                            change the originally defined threshold back from 20 GB to 10 GB.</li>

                        <li class="li">
                            <p class="p">An initial <em class="ph i">Nchf_SpendingLimitControl_Create</em> transaction is
                                received, which triggers the CHF to detect whether TPG of the
                                subscribed bundle has been updated, then the system reloads the
                                latest version of TPG. As the current value of the counter is above
                                the original threshold, this triggers an SNR with a policy counter
                                status value of <var class="keyword varname">2</var> for the policy counter ID
                                associated with the counter for the previously active Sy session,
                                and the same policy counter ID and policy counter status value of
                                    <var class="keyword varname">2</var> is returned in the response to the
                                    <em class="ph i">Nchf_SpendingLimitControl_Subscribe</em> transaction as
                                well.</p>

                        </li>

                    </ol>

                </div>

                <div class="section" id="concept_xtf_jfm_r4b__section_f3k_pmr_rnb"><h3 class="title sectiontitle">Example 2: Behavior in case of Percentage thresholds</h3>
                    
                    <p class="p"><strong class="ph b">Preconditions:</strong></p>

                    <ol class="ol" id="concept_xtf_jfm_r4b__ol_dpb_smr_rnb">
                        <li class="li">
                            <p class="p">Subscribe a device to a bundle with a single counter with a defined
                                counter usage limit of 10 GB.</p>

                        </li>

                        <li class="li">
                            <p class="p">Map the counter to a policy counter.</p>

                        </li>

                        <li class="li">
                            <p class="p">Include the TPG in the bundle, which has a single threshold for 100%
                                of the counter ULI. When usage is less than 100% of the counter ULI,
                                the associated policy counter ID has a policy counter status of
                                    <var class="keyword varname">1</var>. Whereas, when usage reaches or exceeds
                                100% of the defined usage limit, the PC status changes to
                                    <var class="keyword varname">2</var>.</p>

                        </li>

                        <li class="li">
                            <p class="p">There are currently active Gy and Sy sessions for the device.</p>

                        </li>

                        <li class="li">
                            <p class="p">The current usage of the counter is <var class="keyword varname">6 GB</var>, so the
                                associated policy counter has a policy counter status of
                                    <var class="keyword varname">1</var>.</p>

                        </li>

                    </ol>

                    <p class="p"><strong class="ph b">Execution of call:</strong></p>

                    <ol class="ol" id="concept_xtf_jfm_r4b__ol_hfx_qmr_rnb">
                        <li class="li">The TPG associated with the bundle is updated to add a new threshold at
                            50% of the counter’s defined usage limit – with an associated PC status
                            value of <var class="keyword varname">U1</var>. No action is taken for any existing data
                            flows until new transactions are received from the network.</li>

                        <li class="li">A CCR-U is received reporting usage of 500 MB bringing the counter’s
                            usage to 6.5 GB. The CHF detects that the TPG associated with the
                            subscribed bundle has changed, which in turn, results in the system
                            loading the new version of the TPG. As the counter’s current usage is
                            now greater than the new 50% threshold (= <var class="keyword varname">5 GB</var> given
                            the counter’s <var class="keyword varname">10 GB</var> usage limit) an SNR is generated
                            for the associated policy counter ID with a PC status of
                                <var class="keyword varname">U1</var>.</li>

                        <li class="li">The TPG used for the bundle is again updated – this time to change the
                            threshold value added in the first step from 50% to 75% of the counter
                            limit.</li>

                        <li class="li">Another CCR-U is received – reporting an additional 500 MB of usage so
                            that the counter value is updated to 7 GB. At this point, the CHF
                            detects that the TPG for the bundle subscribed to the device has been
                            updated and loads the new TPG version, which in turn, results in the
                            system detecting that the current counter’s value is now below the first
                            threshold (75% =&gt; 7.5 GB) and triggering an SNR with a policy counter
                            status of <var class="keyword varname">1</var> for the policy counter ID associated with
                            the counter.</li>

                    </ol>

                </div>

            </div>
        </div>
</div>
<div class="footer"><hr /><p>Charging User Guide • P556766-DN1000054947-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>