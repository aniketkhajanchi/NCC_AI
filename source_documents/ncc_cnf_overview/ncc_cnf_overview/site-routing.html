<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Site routing" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="id9YZ-09018-UG00-PCZZA-d1e8646" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Site routing</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="id9YZ-09018-UG00-PCZZA-d1e8646">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Site routing</h1>
<div class="body conbody">
        <p class="p">To ensure consistent transactions and avoid race conditions in the network that could
            result in incorrect results from multiple ME subsystems operating on transactions for
            the same device simultaneously, the NCC strategy is to serialize all transactions
            through a home ME subsystem assigned for each particular device, group, or account.</p>

        <p class="p">When an ME subsystem receives an incoming message, the first action is to determine
            whether this local ME subsystem is the currently active home ME subsystem for the
            subscriber/device in the message, or whether this message needs to be forwarded to a
            different ME subsystem that is the current active home. This processing and logic is
            referred to as site routing.</p>

        <div class="p">This figure shows site routing and the data replication within each NCC system and across
            the geographically redundant NCC systems in the network deployment. <div class="fig fignone" id="id9YZ-09018-UG00-PCZZA-d1e8646__fig_hts_jt5_cmb"><span class="figcap"><span class="fig--title-label">Figure: </span>Site routing and data replication between ME subsystems</span>
                
                <img class="image imagecenter break" id="id9YZ-09018-UG00-PCZZA-d1e8646__image_its_jt5_cmb" src="images/cnf_overview_site-routing-and-data-replication.GIF" height="198" width="498" />
            </div>

        </div>

        <p class="p">Site routing allows routing decisions that are made within geo-redundant ME subsystems to
            be persisted. The task of site routing is performed by the Site Routing plug-in. When a
            4G Diameter or 5G HTTP/2 message is received, some part of that message is extracted for
            routing and might be stored in the NCC database for future use. The message is checked
            to see whether it has reached the appropriate site and if so, the message is processed.
            If it has not reached the appropriate site, the message is checked to see whether it can
            be forwarded. The message can be forwarded to the primary site or the secondary site if
            the primary site is down. </p>

        <p class="p">If the incoming message is a 4G message received over Diameter, then the message is
            forwarded or site-routed to the currently active site for that subscriber also over 4G /
            Diameter. Similarly, if the incoming message is a 5G message received over HTTP2, then
            the message is forwarded or site-routed also over 5G / HTTP2.</p>

        <p class="p">Site routing decisions can be based solely on the parameters extracted from the incoming
            message and the mapping tables of the current active home ME subsystem, or NCC can be
            configured to enable an optional feature that stores session mapping records and uses
            them, rather than only the current message parameters, for site routing of later
            messages in that same session. This session mapping feature is enabled by default.</p>

        <p class="p">Session mapping records might include all applicable information for the network and are
            automatically created or deleted by the ME subsystem. These records include sufficient
            data to identify the primary ME and the secondary ME subsystem. Any cause of missing
            mapping records results in an error response, for example, replication falling behind,
            failed replication, or inadvertently deleted records. Session mapping records are
            deleted when a session ends. If for some reason that fails, the mapping is audited
            out.</p>

        <p class="p">Turning off the session mapping option for site routing reduces the amount of data stored
            in the local system as well as the volume of replicated data with the mate system.</p>

        <p class="p">Site routing logic is provided with the help of the Site Routing plug-in. This is an
            application plug-in that runs in the charging pod that gets invoked for incoming CHF
            messages. The Site Routing plug-in is in the request sequence chain before the Charging
            plugins.</p>

        <p class="p">Successful routing depends on the timely replication of mapping records, so it is
            imperative to troubleshoot and correct lagging XDR replication to ensure proper message
            routing. For more information about site routing, see the <cite class="cite">Operation,
                Administration, and Maintenance Guide </cite> in the NCC documentation set.</p>

    </div>
<div class="footer"><hr /><p>Overview Guide • P556766-DN1000054925-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>