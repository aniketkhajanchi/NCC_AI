<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Allow bundle addition to accounts with insufficient balance" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="allow_bundles_to_be_added_to_accounts_with_insufficient_balance_to_fund_their_subscription_fee" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Allow bundle addition to accounts with insufficient balance</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="allow_bundles_to_be_added_to_accounts_with_insufficient_balance_to_fund_their_subscription_fee">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Allow bundle addition to accounts with insufficient balance</h1>
<div class="body conbody">
        <div class="section" id="allow_bundles_to_be_added_to_accounts_with_insufficient_balance_to_fund_their_subscription_fee__section_rlj_kvp_v4b">
            <p class="p">Now the OCS subscribers can subscribe to bundles or subscriptions without having
                enough balance in their accounts to pay for them. The bundles or subscriptions are
                added to the subscribers account but are not active, instead they are placed in the
                suspended lifecycle state. This feature can be controlled by the application
                preference <em class="ph i">Subscription Creation On Insufficient Balance</em>.</p>

            <p class="p">When additional funds are added to the subscriber’s account and if there is enough
                balance, then the added bundle or bundles are moved to the <em class="ph i">Active</em> lifecycle
                state and the requisite funds are deducted from the balance of the subscriber.</p>

            <p class="p">This feature allows a OCS subscriber to subscribe or purchase a new bundle or
                subscription when they have insufficient funds in their account. Purchased bundles
                are put in the configured lifecycle state for insufficient funds (this can be in the
                    <em class="ph i">Suspended</em> lifecycle state) and when there is enough balance to fund all
                bundles in the configured state then the bundles are moved into the <em class="ph i">Active</em>
                lifecycle state.</p>

            <p class="p">When bundles or subscriptions are added, any discount available for the bundle or the
                subscription must be considered before deducting the funds for the subscription. </p>

        </div>

        <div class="section" id="allow_bundles_to_be_added_to_accounts_with_insufficient_balance_to_fund_their_subscription_fee__section_zqc_hbt_w4b"><h2 class="title sectiontitle">Subscription creation</h2>
            
            <ul class="ul" id="allow_bundles_to_be_added_to_accounts_with_insufficient_balance_to_fund_their_subscription_fee__ul_arc_hbt_w4b">
                <li class="li">As per the existing implementation during subscription creation and after
                    primarily validations, the account balance is checked to see if it is enough to
                    deduct bundle fee or to do a fee override after considering all the applicable
                    discounts. If not, then the request is rejected. In the current feature, before
                    rejection the new system flag is checked and if it is set, then the logic
                    proceeds further and the subscription is created.</li>

                <li class="li">A new attribute (<em class="ph i">barredDueToInsufficientFund</em>) needs to be added in the
                    subscription instance to indicate that this subscription is suspended due to
                    insufficient balance.</li>

                <li class="li">As per the last steps of subscription creation, an event is triggered so that it
                    transfers the subscription <em class="ph i">Active</em> state to <em class="ph i">Suspended/Inactive</em>
                    state as per the lifecycle configuration. The <em class="ph i">NotEnoughFunds</em> event must
                    be configured in the lifecycle to transfer from <em class="ph i">Active</em> state to
                        <em class="ph i">Suspended/Inactive</em> state. This lifecycle configuration is mandatory
                    for the feature to work. This configuration is done in any lifecycle Entity
                    (ELC) or Periodic (PLC).<div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> <em class="ph i">Activation Time</em> specifies the time when the
                        subscription was first activated. If activation time is not provided, the
                        subscription remains activated and this field uses the current time. In this
                        scenario, subscription activation is governed either by lifecycle
                        configuration and account or present status of device entities. As in this
                        case, the subscription remains activated and it fails due to insufficient
                        balance.</div>
</li>

                <li class="li">For example, following is the suggested configuration of Lifecycle (ELC) for
                    this event:</li>

            </ul>

            <div class="fig fignone" id="allow_bundles_to_be_added_to_accounts_with_insufficient_balance_to_fund_their_subscription_fee__fig_brc_hbt_w4b"><span class="figcap"><span class="fig--title-label">Figure: </span>Example: Existing NotEnoughFunds event</span>
                
                <a href="../images/Notenoughfunds_event.png" class="image"><img class="image break scalefit" id="allow_bundles_to_be_added_to_accounts_with_insufficient_balance_to_fund_their_subscription_fee__image_crc_hbt_w4b" src="../images/Notenoughfunds_event.png" height="302" width="720" /></a>
            </div>

            <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> If a new flag is enabled but lifecycle is not configured as suggested, then it is
                possible that subscription gets created in the Active state without any fee
                deduction.</div>

        </div>

        <div class="section" id="allow_bundles_to_be_added_to_accounts_with_insufficient_balance_to_fund_their_subscription_fee__section_rpc_hbt_w4b"><h2 class="title sectiontitle">Account recharge or subscription activation</h2>
            
            <ul class="ul" id="allow_bundles_to_be_added_to_accounts_with_insufficient_balance_to_fund_their_subscription_fee__ul_spc_hbt_w4b">
                <li class="li">When the account is credited with positive balance, then an event
                        <em class="ph i">AccountRechargeEvent</em> is triggered which is broadcasted to all the
                    linked subscriptions.</li>

                <li class="li">If a new discount is added to the Device, thereby making the account balance
                    sufficient for subscription fee deduction, then the Trigger API in the Lifecycle
                    module can be used to trigger <var class="keyword varname">AccountRechargeEvent</var>,
                    configured in lifecycle of that account or specific subscription. For more
                    details on using the API, refer to the Swagger API documentation.</li>

                <li class="li">Following transition needs to be defined in Life-cycle:<div class="fig fignone" id="allow_bundles_to_be_added_to_accounts_with_insufficient_balance_to_fund_their_subscription_fee__fig_tpc_hbt_w4b"><span class="figcap"><span class="fig--title-label">Figure: </span>Event:AccountRechargedEvent</span>
                        
                        <a href="../images/Accountrechargedevent.png" class="image"><img class="image break scalefit" id="allow_bundles_to_be_added_to_accounts_with_insufficient_balance_to_fund_their_subscription_fee__image_upc_hbt_w4b" src="../images/Accountrechargedevent.png" height="305" width="720" /></a>
                    </div>
<div class="p">
                        <div class="fig fignone" id="allow_bundles_to_be_added_to_accounts_with_insufficient_balance_to_fund_their_subscription_fee__fig_vpc_hbt_w4b"><span class="figcap"><span class="fig--title-label">Figure: </span>Event:ChargeFeeActionSuccessEvent</span>
                            
                            <a href="../images/Chargefeeactionsuccessevent.png" class="image"><img class="image break scalefit" id="allow_bundles_to_be_added_to_accounts_with_insufficient_balance_to_fund_their_subscription_fee__image_wpc_hbt_w4b" src="../images/Chargefeeactionsuccessevent.png" height="218" width="720" /></a>
                        </div>

                    </div>
</li>

            </ul>

        </div>

    </div>
<div class="topic concept nested1" aria-labelledby="ariaid-title2" id="concept_sxs_4vp_v4b"><h2 class="title topictitle2" id="ariaid-title2">Additional information</h2>
<div class="body conbody">
            <p class="p">Following are some important points to note for this functionality:</p>

            <ul class="ul" id="concept_sxs_4vp_v4b__ul_ddf_zts_w4b">
                <li class="li">Currently the profile APIs and the discount feature is not supported to Group.
                    So for this feature is limited to the device only with respect to discount.</li>

                <li class="li">The insufficient balance feature is applicable only if the bundle fee or fee
                    override is configured. It is not applicable if <em class="ph i">ChargefeeAction</em> is
                    configured in the initial state of Lifecycle attached with the bundle to deduct
                    subscription purchase fee.</li>

                <li class="li">
                    <p class="p">At the time of recharge of suspended subscription, <em class="ph i">ChargefeeAction</em>
                        prorate configuration is not applied on the bundle purchase fee. Prorate
                        configuration is applicable at the time of subscription creation. Also tax,
                        if configured, is considered from bundle or account, not from the Charge fee
                        action.</p>

                </li>

                <li class="li">Currently if a subscription is in a suspended state because of the insufficient
                    state, and if a discount of 100% is added, then the subscription is not moved to
                    the Active state as discount addition does not trigger any event.</li>

                <li class="li">Reset Subscription Action and Renew Subscription Action is not allowed for
                    subscription barred due to insufficient funds.</li>

                <li class="li">If BOU Subscription is barred due to insufficient funds, then this subscription
                    must not be activated on a session call.</li>

                <li class="li">If feature flag is on while creating the subscription and the <em class="ph i">Account
                        Recharge Event feature</em> flag is set to <var class="keyword varname">off</var>, then the
                    subscription fee is deducted from account irrespective of feature flag. On
                    successful deduction, subscription state is moved to Active from Suspended.</li>

                <li class="li">The suspended subscription can only be activated during the recharge event for
                    this feature configuration.</li>

                <li class="li">If multiple subscriptions are in a suspended state, and the recharge account has
                    only enough funds for one subscription activation, then a random subscription is
                    picked for activation, and at present no priority is considered or
                    implemented.</li>

            </ul>

        </div>
</div>
<div class="footer"><hr /><p>Charging User Guide • P556766-DN1000054947-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>