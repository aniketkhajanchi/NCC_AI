<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Log level configuration at deployment" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="log_level_changes_at_deployment" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Log level configuration at deployment</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="log_level_changes_at_deployment">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Log level configuration at deployment</h1>
<div class="body conbody">
        <div class="p">By default, <span class="ph">NCC</span> utilizes a default log4j file which contains default log level
            configurations. While the default <code class="ph codeph">log4j.xml</code> file will enable a
            successful deployment, a custom log4j file may instead by included as an optional input.
            Using a custom log4j file at deployment enables for log level configuration during
            initialization of the application and proffers the following benefits.<ul class="ul" id="log_level_changes_at_deployment__ul_yqw_z11_ynb">
                <li class="li">Total control over logging</li>

                <li class="li">Log level configurations</li>

                <li class="li">Log formatting configurations</li>

                <li class="li">Log level configurations for classes during initialization of the
                    application</li>

                <li class="li">Changes performed at runtime without pod restart</li>

            </ul>
</div>

        <div class="section" id="log_level_changes_at_deployment__section_ams_k21_ynb"><h2 class="title sectiontitle">Specifying a custom log4j.xml file</h2>
            
            <p class="p">While the specifics of creating a custom log4j file are unique for each deployment
                architecture, there are several common ways of providing a custom log4j file in
                input to the helm upgrade command. The following are a few methods of specifying a
                custom log4j file.</p>

            <p class="p"><strong class="ph b">Using --set-file</strong></p>

            <p class="p">A custom log4j file may be specified with the optional helm upgrade command flag
                    <code class="ph codeph">--set-file</code>.</p>

            <div class="p">
                <pre class="pre codeblock"><code>helm upgrade --set-file global.applicationLog4jConfiguration=&lt;path_to_custom_log4j&gt;</code></pre>
            </div>

            <p class="p">Where <code class="ph codeph">&lt;path_to_custom_log4j&gt;</code> defines the file path and name of
                the aforementioned custom <code class="ph codeph">log4j.xml</code> file. For example, to specify a
                log4j file named <code class="ph codeph">mylog4j.xml</code> in the <code class="ph codeph">/temp</code>
                directory, use the following command.</p>

            <div class="p">
                <pre class="pre codeblock"><code>helm upgrade --set-file global.applicationLog4jConfiguration=/tmp/mylog4j.xml</code></pre>
            </div>

            <p class="p"><strong class="ph b">Embedding within a dedicated values.yaml</strong></p>

            <p class="p">A custom log4j file may be specified by embedding the file within a dedicated
                    <code class="ph codeph">values.yaml</code> file that utilizes preserve-values. In this
                scenario, the <code class="ph codeph">values.yaml</code> file does not contain all of the
                information required for deployment; instead, it only contains enough information to
                institute a custom <code class="ph codeph">log4j.xml</code> file.</p>

            <div class="p">
                <pre class="pre codeblock"><code>helm upgrade --reuse-values -f &lt;path_to_custom_values&gt;</code></pre>
            </div>

            <p class="p">Where <code class="ph codeph">&lt;path_to_custom_values&gt;</code> defines the file path and name of
                the aforementioned dedicated <code class="ph codeph">values.yaml</code> file. For example, to
                specify a <code class="ph codeph">values.yaml</code> file named
                    <code class="ph codeph">mySmallValues.yaml</code>, use the following command.</p>

            <div class="p">
                <pre class="pre codeblock"><code>helm upgrade --reuse-values -f mySmallValues.yaml</code></pre>
            </div>

            <p class="p"><strong class="ph b">Embedding within a cumulative values.yaml</strong></p>

            <p class="p">A custom log4j file may be specified by embedding the file within a cumulative
                    <code class="ph codeph">values.yaml</code> file. Custom log4j configurations are added the
                cumulative values.yaml file with the following format.</p>

            <div class="p">
                <pre class="pre codeblock"><code>&lt;scope&gt;:
  applicationLog4jMonitorInterval: "&lt;interval&gt;"
  applicationLog4jConfiguration: &lt;app_config&gt;
  alarmLog4j2Configuration: &lt;alarm_config&gt;</code></pre>
            </div>

            <div class="p">Where:<ul class="ul" id="log_level_changes_at_deployment__ul_odm_xh1_ynb">
                    <li class="li"><code class="ph codeph">&lt;scope&gt;</code> defines the scope of the log level
                        configurations. To indicate the changes should be made to all pods, set this
                        value to <code class="ph codeph">global</code>. To indicate the changes should be made
                        only to a specific pod-type, set this value to the name of that specific
                        pod-type.</li>

                    <li class="li"><code class="ph codeph">&lt;interval&gt;</code> is the application log4j monitoring interval
                        in seconds.</li>

                    <li class="li"><code class="ph codeph">&lt;app_config&gt;</code> contains the content of the custom log4j
                        file which defines the application level full log4j configuration.</li>

                    <li class="li"><code class="ph codeph">&lt;alarm_config&gt;</code> contains the content of the custom log4j
                        file which defines the alarm level full log4j configuration.</li>

                </ul>
</div>

            <p class="p">As an example, a custom log4j file which is characterized by a scope
                    <code class="ph codeph">global</code>, <code class="ph codeph">applicationLog4jMonitorInterval</code> of 30
                seconds, and accompanying application and alarm log4j configurations might be added
                as follows in the <code class="ph codeph">values.yaml</code> file.</p>

            <div class="p">
                <pre class="pre codeblock"><code>global:
    applicationLog4jMonitorInterval: "30"
    applicationLog4jConfiguration: |
      &lt;?xml version="1.0" encoding="UTF-8"?&gt;
      &lt;!DOCTYPE log4j:configuration SYSTEM "log4j.dtd"&gt;
      &lt;log4j:configuration xmlns:log4j="http://jakarta.apache.org/log4j/"
                         debug="false"&gt;
   
          &lt;!-- Format the logs in the CLOG Unified Logging format.
             The intent is that this is formatted for use with Unified Logging. --&gt;
          &lt;appender name="UnifiedLoggingAppender" class="org.apache.log4j.FileAppender"&gt;
            &lt;errorHandler class="org.apache.log4j.helpers.OnlyOnceErrorHandler"/&gt;
            &lt;!-- We need to output directly to the container's stdout for Fluentd
                 to get it. So we're going right to the proc to do that. --&gt;
            &lt;param name="File" value="/proc/1/fd/1"/&gt;
           
            &lt;layout class="com.alcatel.tpapps.common.server.logging.log4jappenders.UnifiedLoggingFormat"&gt;
            &lt;/layout&gt;
            &lt;filter class="com.alcatel.tpapps.common.utils.AddMDCFilter"/&gt;
   
          &lt;/appender&gt;

          &lt;root&gt;
            &lt;level value="INFO" /&gt;
            &lt;appender-ref ref="UnifiedLoggingAppender"/&gt;
          &lt;/root&gt;

      &lt;/log4j:configuration&gt;
    alarmLog4j2Configuration: |
      &lt;?xml version="1.0" encoding="UTF-8"?&gt;
      &lt;Configuration status="INFO" monitorInterval="30"&gt;
        &lt;Appenders&gt;
   
            &lt;File name="ULOG_CONSOLE" fileName="/proc/1/fd/1"&gt;
                &lt;PatternLayout alwaysWriteExceptions="false" pattern="%msg%n"/&gt;
            &lt;/File&gt;
   
        &lt;/Appenders&gt;
        &lt;Loggers&gt;
           &lt;Root level="INFO"&gt;
                &lt;AppenderRef ref="ULOG_CONSOLE"/&gt;
           &lt;/Root&gt;
        &lt;/Loggers&gt;
      &lt;/Configuration&gt;</code></pre>
            </div>

            <p class="p">Once the custom log4j file has been defined in the <code class="ph codeph">values.yaml</code>, the
                changes may be initialized by passing to the helm initialize command.</p>

            <div class="p">
                <pre class="pre codeblock"><code>helm install -f &lt;path_to_values&gt; sps-repo/sps</code></pre>
            </div>

            <p class="p">Where <code class="ph codeph">&lt;path_to_values&gt;</code> defines the path and name of the
                cumulative <code class="ph codeph">values.yaml</code> file. For example, to use a cumulative
                    <code class="ph codeph">values.yaml</code> which is named
                    <code class="ph codeph">override_values.yaml</code>, use the following command.</p>

            <div class="p">
                <pre class="pre codeblock"><code>helm install -f override_values.yaml sps-repo/sps</code></pre>
            </div>

            <p class="p">An example log4j <code class="ph codeph">values.yaml</code> file is available in the application
                source files.</p>

        </div>

    </div>
<div class="footer"><hr /><p>Operations, Administration, and Maintenance Guide • P556766-DN1000055092-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>