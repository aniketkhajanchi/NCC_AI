<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="task" />
<meta name="DC.title" content="Configuring a namespace" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="preparing_for_sps_cnf_installation" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Configuring a namespace</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="preparing_for_sps_cnf_installation">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Configuring a namespace</h1>
<div class="body taskbody">
        <div class="section context"><div class="tasklabel"><h2 class="sectiontitle tasklabel"></h2></div>
            <p class="p">This procedure provides instructions on how to configure a namespace. In this
                procedure, you create a namespace, custom resource definitions (CRDs) for Backup and
                Recovery, RBAC resources, service entries, and other objects. In addition, if the
                system is ME or IG, you configure the outgoing Diameter TLS.</p>

            <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> 
                <p class="p">All calls to the external Web SSO, external TCP, and external HTTP services
                    require a service entry, which is a special exception rule offered by Istio. You
                    need to create a service entry for each HTTP external service, the external Web
                    SSO service, and the TCP external service. This applies to these calls in <span class="ph">NCC</span>:</p>

                <ul class="ul" id="preparing_for_sps_cnf_installation__ul_d1j_knb_xlb">
                    <li class="li">SM calls to access ME HTTP/SOAP API (heartbeat and provisioning)</li>

                    <li class="li">SM calls to access Web SSO APIs</li>

                    <li class="li">ME calls to access SM HTTP/SOAP API (heartbeat and device
                        notifications)</li>

                    <li class="li">IG calls to access IG external HTTP/SOAP API (heartbeat, provisioning, and
                        device notification)</li>

                    <li class="li">any other outbound connection initiated by <span class="ph">NCC</span> such as outbound
                        Diameter-peer or outbound LDAP request</li>

                </ul>

                <p class="p">For more information about service entries, see Istio documentation.</p>

            </div>

            <p class="p">The outgoing Diameter TLS is done as either regular TLS or TLS in open state. The
                regular TLS means that a TLS connection is established before any Diameter requests.
                In this case, TLS is managed by Istio and <span class="ph">NCC</span> only deals with a non-secure
                configuration. When you use TLS in open state, the connection to the peer is first
                established in a non-secure way on a non-secure port, and then it is upgraded to TLS
                after the CER/CEA exchange based on the value of the Inband-Security-ID AVP.
                Currently in <span class="ph">NCC</span> this is valid only when the Diameter peer is a SurePay D-Router. In
                this case, TLS is managed by <span class="ph">NCC</span>.</p>

        </div>

        <div class="tasklabel"><h2 class="sectiontitle tasklabel"></h2></div><ol class="ol steps"><li class="li step stepexpand">
                <span class="ph cmd">Ensure that you are in the system directory, and then initialize the variables
                    by entering:</span>
                <div class="itemgroup info">
                    <pre class="pre codeblock"><code>cd output/SITENAME
. site.conf</code></pre>
                </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Log in to the control node as root.</span>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">If you install Backup and Recovery, before you create CRDs, ensure that you
                    have the roles that allow the access to these resources:</span>
                <div class="itemgroup info">
                    <pre class="pre codeblock"><code>- apiGroups:
  - cbur.csf.nokia.com
  resources:
  - brhooks
  - brpolices
  verbs:
  - get
  - list
  - delete
  - create
  - watch
  - patch
  - update
- apiGroups:
  - cbur.csf.nokia.com
  resources:
  - brpolices/status
  verbs:
  - get
  - list
  - update
  - watch
  - patch
</code></pre>
                </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Create a namespace, service account, and extra objects as follows:</span>
                <div class="itemgroup info">
                    <ul class="ul" id="preparing_for_sps_cnf_installation__ul_zt2_21q_wnb">
                        <li class="li">To use the script, ensure that this script works with your environment
                            and enter: <pre class="pre codeblock"><code>./examples/configure-namespace.sh
                            </code></pre> This script creates a namespace
                            with Istio injection. <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> To execute the script for all
                                namespaces at once,
                                enter:<pre class="pre codeblock"><code>./staticfiles/examples/configure-namespace.sh
</code></pre></div>
</li>

                        
                        
                    </ul>

                </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">If the system is an ME or IG that is connected to the remote peer, configure
                    outgoing Diameter TLS with regular TLS or TLS in open state using these examples
                    as templates:</span>
                <div class="itemgroup info"><div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> When you configure the Diameter Peer in the SM GUI, the protocol must be
                        set: <ul class="ul" id="preparing_for_sps_cnf_installation__ul_sfb_5fk_wnb">
                            <li class="li">If you are using regular TLS, then the protocol must be set to
                                    <span class="keyword parmname">TCP</span>.</li>

                            <li class="li">If you are using TLS in open state, then the protocol must be set to
                                    <span class="keyword parmname">TLS</span>.</li>

                        </ul>
</div>
The following is an example of the configuration of a TLS
                    outbound Diameter to a specific IP address with port 3868 when regular TLS is
                    used.<pre class="pre codeblock"><code># Edit to suit your needs:
REMOTE_DIAMETER_PEER='diameter.example.com'
IP_ADDRESS='10.20.30.40'
# Increment for each diameter peer:
PEER_NUMBER='1'

cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: networking.istio.io/v1alpha3
kind: ServiceEntry
metadata:
  name: tls-diameter-${PEER_NUMBER}
  namespace: $NAMESPACE
spec:
  exportTo:
  - .
  hosts:
  - "$REMOTE_DIAMETER_PEER"
  addresses:
  - $IP_ADDRESS/32
  ports:
  - number: 3868
    name: tcp-diameter
    protocol: TCP
  - number: 5868
    name: tcp-diameter-secure
    protocol: TCP
  endpoints:
  - address: $IP_ADDRESS
  location: MESH_EXTERNAL
  resolution: STATIC
---
apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: tls-diameter-${PEER_NUMBER}
  namespace: $NAMESPACE
spec:
  exportTo:
  - .
  hosts:
  - $REMOTE_DIAMETER_PEER
  tcp:
  - match:
    - port: 3868
    route:
    - destination:
        host: $REMOTE_DIAMETER_PEER
        port:
          number: 5868
---
apiVersion: networking.istio.io/v1alpha3
kind: DestinationRule
metadata:
  name: tls-diameter-${PEER_NUMBER}
  namespace: $NAMESPACE
spec:
  exportTo:
  - .
  host: "$REMOTE_DIAMETER_PEER"
  trafficPolicy:
    portLevelSettings:
    - port:
        number: 5868
      tls:
        mode: SIMPLE
EOF</code></pre>The following is an example of the configuration of a TLS
                    outbound Diameter to a specific IP address with port 3868 when TLS in open state
                    is used.<div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> When you use TLS in open state, another secret must be created. To
                        perform TLS termination for incoming HTTPS traffic or incoming TLS Diameter
                        traffic, the Gateway resource needs to be configured with a
                    secret.</div>
<pre class="pre codeblock"><code># Edit to suit your needs:
REMOTE_DIAMETER_PEER='diameter.example.com'
IP_ADDRESS='10.20.30.40'
# Increment for each diameter peer:
PEER_NUMBER='1'

cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: networking.istio.io/v1alpha3
kind: ServiceEntry
metadata:
  name: tls-diameter-${PEER_NUMBER}
  namespace: $NAMESPACE
spec:
  exportTo:
  - .
  hosts:
  - "$REMOTE_DIAMETER_PEER"
  addresses:
  - $IP_ADDRESS/32
  ports:
  - number: 3868
    name: tcp-diameter
    protocol: TCP
  endpoints:
  - address: $IP_ADDRESS
  location: MESH_EXTERNAL
  resolution: STATIC
EOF</code></pre></div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Return to the working directory by entering:</span>
                <div class="itemgroup info">
                    <pre class="pre codeblock"><code>cd ..</code></pre>
                </div>
            </li>
</ol>

    </div>
<div class="footer"><hr /><p>Installation and Upgrade Guide • P556766-DN1000055103-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>