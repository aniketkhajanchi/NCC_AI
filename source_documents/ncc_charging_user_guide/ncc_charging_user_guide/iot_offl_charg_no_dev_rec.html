<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Support for IoT devices with offline charging where no specific device record exists" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="iot_offl_charg_no_dev_rec" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Support for IoT devices with offline charging where no specific device record exists</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="iot_offl_charg_no_dev_rec">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Support for IoT devices with offline charging where no specific device record
        exists</h1>
<div class="body conbody">
        <p class="p">This feature enables the charging of devices that are provided using the session-based
            interface from the SMF in offline mode, where it is required to both generate a CDR and
            apply rating to the request in order to ascertain a rated CDR output with a cost. </p>

        <p class="p">This cost may not be charged to an explicit end user, but instead may reflect a wholesale
            cost, or a cost to the OTT provider of the device, such that NCC is then able to provide
            rated outputs for unknown device inputs.</p>

        <p class="p">The following flow diagram shows an example on how this can be implemented, where the CHF
            decides whether to invoke rating or not before invoking the CGF (DR) for CDR generation.</p>

        <div class="fig fignone" id="iot_offl_charg_no_dev_rec__fig_zc3_swz_vsb">
            <a href="../images/chrg_iot.png" class="image"><img class="image break scalefit" id="iot_offl_charg_no_dev_rec__image_h5r_twz_vsb" src="../images/chrg_iot.png" /></a>
        </div>

        <div class="section" id="iot_offl_charg_no_dev_rec__section_ey2_pxz_vsb"><h2 class="title sectiontitle">Identification of IoT call</h2>
            
            <p class="p">Following are the steps to identify if received requests from SMF/AMF/NEF is IoT
                devices call.</p>

            <ul class="ul" id="iot_offl_charg_no_dev_rec__ul_cmt_4xz_vsb">
                <li class="li">For input request, first the Device is identified. If it is not found and the
                    call is not of inbound or assume positive type, then
                        <var class="keyword varname">DEVICE_NOT_FOUNT</var> trigger is executed.</li>

                <li class="li">In <var class="keyword varname">DEVICE_NOT_FOUNT</var> trigger, a rule is configured to read a
                    complex map and match one of its key with the received 5G
                    create/update/terminate request parameters like
                        <var class="keyword varname">Subscription-Id</var> (SUPI, GPSI, ..etc) or other request
                    parameters like MCC/MNC. If a match is found, <var class="keyword varname">CALL_RESULT</var>
                    result context is set to one of the complex map keys that stores <var class="keyword varname">Device
                        Profile</var> name. This way an unknown device is mapped to a
                        <var class="keyword varname">Device Profile</var>.</li>

                <li class="li">If <var class="keyword varname">Device Profile</var> mapping is found, then the call is treated
                    as IoT device call. On the basis of the output (Device Profile/CDR_type) of
                    mapping rule, IoT call is processed as offline <var class="keyword varname">UNRATED/RATED</var>
                    call.</li>

            </ul>

        </div>

        <div class="section"><h2 class="title sectiontitle">Configuration</h2><p class="p">The following figure shows an example configure
                mapping table for mapping IMSI range to Device Profile (Global Group).</p>
<div class="fig fignone" id="iot_offl_charg_no_dev_rec__fig_fh5_4d1_wsb">
                <a href="../images/iot_map.png" class="image"><img class="image break scalefit" id="iot_offl_charg_no_dev_rec__image_ntp_pd1_wsb" src="../images/iot_map.png" /></a>
            </div>
<div class="fig fignone" id="iot_offl_charg_no_dev_rec__fig_btd_ym1_wsb">
                <a href="../images/iot_map2.png" class="image"><img class="image break scalefit" id="iot_offl_charg_no_dev_rec__image_e25_td1_wsb" src="../images/iot_map2.png" /></a>
            </div>
<p class="p">The following action attributes are used to configure this feature:</p>
<ul class="ul" id="iot_offl_charg_no_dev_rec__ul_atr_h21_wsb">
                <li class="li">CALL_RESULT.CDR-Type = CDRType_RATED</li>

                <li class="li">CALL_RESULT.Device-Profile = "GlobalGroup1"</li>

            </ul>
The following figure shows an example of rule configuration:<div class="fig fignone" id="iot_offl_charg_no_dev_rec__fig_spk_vd1_wsb">
                <a href="../images/iot_rule.png" class="image"><img class="image break scalefit" id="iot_offl_charg_no_dev_rec__image_yf5_wd1_wsb" height="288" src="../images/iot_rule.png" width="576" /></a>
            </div>
</div>

        <div class="section" id="iot_offl_charg_no_dev_rec__section_cg2_bh1_wsb"><h2 class="title sectiontitle">CDR for IoT devices with offline charging</h2>
            
            <p class="p">Refer to section <em class="ph i">IoT devices with offline charging</em> in <em class="ph i">CDR/EDR Reference</em>
                for more information.</p>

        </div>

        <div class="section" id="iot_offl_charg_no_dev_rec__section_u3s_kf1_wsb"><h2 class="title sectiontitle">Error scenarios</h2>
            
            <p class="p">At root level, result code is Success. At MUI level, the error codes appear as
                described in the following table:</p>

            <table cellpadding="4" cellspacing="0" summary="" id="iot_offl_charg_no_dev_rec__table_fjt_1g1_wsb" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap"><span class="table--title-label">Table: </span>Error result code at MUI level in IoT call</span></caption><colgroup><col style="width:57.264957264957275%" /><col style="width:42.73504273504274%" /></colgroup><thead class="thead" style="text-align:left;">
                        <tr class="row">
                            <th class="entry cellrowborder" style="vertical-align:top;" id="d71836e152">Scenario</th>

                            <th class="entry cellrowborder" style="vertical-align:top;" id="d71836e155">Result code</th>

                        </tr>

                    </thead>
<tbody class="tbody">
                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d71836e152 ">If device profile (Group) is found but it has no subscriptions
                                attached or the attached subscriptions are in barred state.</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d71836e155 ">END_USER_SERVICE_DENIED</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d71836e152 ">If device profile (Group) is attached with subscription, but no
                                rate was identified in tariff rule.</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d71836e155 ">RATING_FAILED</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d71836e152 ">Group is attached with subscription, rate is identified in tariff
                                rule, but identified rate has type different than the requested type
                                (USU type).</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d71836e155 ">END_USER_SERVICE_DENIED</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d71836e152 ">Group is attached with subscription, rate is identified in tariff
                                rule, but Bucket provided in rate is non-monetary bucket.</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d71836e155 ">RATING_FAILED</td>

                        </tr>

                    </tbody>
</table>

        </div>

        <div class="section" id="iot_offl_charg_no_dev_rec__section_xfc_n21_wsb"><h2 class="title sectiontitle">Limitations</h2>
            
            <ul class="ul" id="iot_offl_charg_no_dev_rec__ol_zgh_n21_wsb">
                <li class="li">Requests from IoT Device come only through N40 interface in session-based
                    charging requests (NCHF_CC_Create/Update/Delete).</li>

                <li class="li">All requests (Create/Update/Release) contain the information (for example, imsi,
                    supi), which is needed to map the incoming sensor to a device profile.</li>

                <li class="li">If assume positive is enabled for customer, then this feature is not used.
                    Rather assume positive behavior is used.</li>

                <li class="li">Global group hierarchy is not traversed for finding the bundles and charging
                    services. Only the subscriptions that are attached directly to global group
                    (device profile) are considered.</li>

                <li class="li">Tariff output only for <var class="keyword varname">Rate</var> is considered to calculate the
                    call cost for rated offline CDRs.</li>

                <li class="li">Only a single pass is traversed to calculate the call cost for rated offline
                    CDRs.</li>

                <li class="li">IoT device calls are not supported in NCHF-Router environment.</li>

            </ul>

        </div>

    </div>
<div class="footer"><hr /><p>Charging User Guide • P556766-DN1000054947-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>