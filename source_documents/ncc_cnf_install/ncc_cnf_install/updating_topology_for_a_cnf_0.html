<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="task" />
<meta name="DC.title" content="Updating topology when adding a networked 1+1 ME subsystem pair" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="updating_topology_for_a_cnf_0" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Updating topology when adding a networked 1+1 ME subsystem pair</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="updating_topology_for_a_cnf_0">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Updating topology when adding a networked 1+1 ME subsystem pair</h1>
<div class="body taskbody">
        <div class="section context" id="updating_topology_for_a_cnf_0__context_ds2_tqf_1qb"><div class="tasklabel"><h2 class="sectiontitle tasklabel"></h2></div>
            <div class="note" id="updating_topology_for_a_cnf_0__note_p4k_fxz_gqb"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> If a btel-load upgrade is not performed, then you must update the
                valid redirect URIs for new ME subsystems once finished with the SM topology
                upgrade. This step is required to access btel-auth clients like OpenSearch Dashboard
                or Metrics Viewer for accessing the UI of the new ME subsystems. For more
                information, refer to <a class="xref" href="update_valid_redirect_uris_for_new_mes.html">Update valid redirect URIs for new ME subsystems</a>.</div>

            <p class="p">This procedure provides instructions on how to update topology for any system or <span class="ph">NCC</span> Telemetry instance in the deployment when you add a
                networked 1+1 ME pair to the deployment.</p>

            <p class="p">In this procedure, btel-load upgrade clears all of the users, roles, passwords, and
                other entities, that are created after <span class="ph">NCC</span>
                installation. So any post-configuration of User and Role Management users, roles,
                passwords, and other such entities completed after the installation, must be
                completed again manually.</p>

            <p class="p">If there are no additional User and Role Management users, roles, passwords, and
                other entities, then upgrade them with btel-load. This preserves the default entries
                created during the installation.</p>

            <p class="p">If someone changed the password in the <span class="ph filepath">Input.xls</span> file for
                example, the Metrics Viewer admin or OpenSearch Dashboard admin, then before
                installing the <span class="ph">NCC</span> system component, then manually set
                the password in the <span class="ph filepath">Input.xls</span> file.</p>

            <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> Administrators must maintain their history of users, roles, passwords and so on of
                the User and Role Management loader so that they keep information updated in the
                    <span class="ph filepath">Input.xlsx</span> file before installation.</div>

        </div>

        <div class="tasklabel"><h2 class="sectiontitle tasklabel"></h2></div><ol class="ol steps" id="updating_topology_for_a_cnf_0__steps_es2_tqf_1qb"><li class="li step stepexpand">
                <span class="ph cmd">Create new service entries in this namespace by entering:</span>
                <div class="itemgroup info">
                    <pre class="pre codeblock"><code>kubectl -n &lt;&lt;namespace&gt;&gt; apply -f &lt;&lt;path to resources service entries&gt;&gt;/serviceentries.yaml</code></pre>
                </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">If you are using the split chart, do the following:</span>
                <div class="itemgroup info">
                    <ol class="ol" type="a" id="updating_topology_for_a_cnf_0__ol_dsd_ddb_1qb">
                        <li class="li">If your deployment has shared <span class="ph">NCC</span> Telemetry
                            design, follow the procedure in <a class="xref" href="helm_installation_using_printed_commands.html">Installing Helm charts manually</a> to obtain the
                            commands and update the topology for all of the Helm charts in <span class="ph">NCC</span> Telemetry. This example shows the
                            output.<pre class="pre codeblock" id="updating_topology_for_a_cnf_0__codeblock_izb_hyb_rwb"><code>helm upgrade --install -n &lt;&lt;namespace&gt;&gt; chf-deployment-manager-setup &lt;&lt;path to charts tgz&gt;&gt;/chf-deployment-manager-chart-&lt;&lt;release-build&gt;&gt;.tgz -f &lt;&lt;path to charts for override file&gt;&gt;/chf-deployment-manager-setup.yaml
helm upgrade --install -n &lt;&lt;namespace&gt;&gt; cbur-crds &lt;&lt;path to charts tgz&gt;&gt;/cbur-crds-chart-&lt;&lt;release-build&gt;&gt;.tgz -f &lt;&lt;path to charts for override file&gt;&gt;/cbur-crds.yaml
helm upgrade --install -n &lt;&lt;namespace&gt;&gt; cvea-btel &lt;&lt;path to charts tgz&gt;&gt;/cvea-chart-&lt;&lt;release-build&gt;&gt;.tgz -f &lt;&lt;path to charts for override file&gt;&gt;/cvea.yaml
helm upgrade --install -n &lt;&lt;namespace&gt;&gt; chf-resource &lt;&lt;path to charts tgz&gt;&gt;/chf-resource-chart-&lt;&lt;release-build&gt;&gt;.tgz -f &lt;&lt;path to charts for override file&gt;&gt;/chf-resource.yaml
helm upgrade --install -n &lt;&lt;namespace&gt;&gt; chf-test-certs &lt;&lt;path to charts tgz&gt;&gt;/chf-test-certs-chart-&lt;&lt;release-build&gt;&gt;.tgz -f &lt;&lt;path to charts for override file&gt;&gt;/chf-test-certs.yaml
helm upgrade --install -n &lt;&lt;namespace&gt;&gt; chf-credentials &lt;&lt;path to charts tgz&gt;&gt;/chf-credentials-chart-&lt;&lt;release-build&gt;&gt;.tgz -f &lt;&lt;path to charts for override file&gt;&gt;/chf-credentials.yaml
helm upgrade --install -n &lt;&lt;namespace&gt;&gt; cbur-master &lt;&lt;path to charts tgz&gt;&gt;/cbur-chart-&lt;&lt;release-build&gt;&gt;.tgz -f &lt;&lt;path to charts for override file&gt;&gt;/cbur.yaml
helm upgrade --install -n &lt;&lt;namespace&gt;&gt; kiali-btel-init &lt;&lt;path to charts tgz&gt;&gt;/cist-kiali-init-chart-&lt;&lt;release-build&gt;&gt;.tgz -f &lt;&lt;path to charts for override file&gt;&gt;/cist-kiali-init.yaml
helm upgrade --install -n &lt;&lt;namespace&gt;&gt; btel-btel-cmdb &lt;&lt;path to charts tgz&gt;&gt;/cmdb-chart-&lt;&lt;release-build&gt;&gt;.tgz -f &lt;&lt;path to charts for override file&gt;&gt;/btel-cmdb.yaml --timeout 600s
helm upgrade --install -n &lt;&lt;namespace&gt;&gt; kiali-btel-server &lt;&lt;path to charts tgz&gt;&gt;/cist-kiali-server-1.13-chart-&lt;&lt;release-build&gt;&gt;.tgz -f &lt;&lt;path to charts for override file&gt;&gt;/cist-kiali-1.13.yaml
helm upgrade --install -n &lt;&lt;namespace&gt;&gt; btel-btel-crmq &lt;&lt;path to charts tgz&gt;&gt;/crmq-chart-&lt;&lt;release-build&gt;&gt;.tgz -f &lt;&lt;path to charts for override file&gt;&gt;/btel-crmq.yaml --timeout 1200s
helm upgrade --install -n &lt;&lt;namespace&gt;&gt; btel-btel-bssc-fluentd &lt;&lt;path to charts tgz&gt;&gt;/bssc-fluentd-chart-&lt;&lt;release-build&gt;&gt;.tgz -f &lt;&lt;path to charts for override file&gt;&gt;/btel-bssc-fluentd.yaml --timeout 1200s
helm upgrade --install -n &lt;&lt;namespace&gt;&gt; btel-btel-cpro &lt;&lt;path to charts tgz&gt;&gt;/cpro-chart-&lt;&lt;release-build&gt;&gt;.tgz -f &lt;&lt;path to charts for override file&gt;&gt;/btel-cpro.yaml --timeout 1200s
helm upgrade --install -n &lt;&lt;namespace&gt;&gt; cpro-gen3gppxml &lt;&lt;path to charts tgz&gt;&gt;/cpro-gen3gppxml-chart-&lt;&lt;release-build&gt;&gt;.tgz -f &lt;&lt;path to charts for override file&gt;&gt;/btel-cpro-gen3gppxml.yaml --timeout 1200s
helm upgrade --install -n &lt;&lt;namespace&gt;&gt; btel-btel-cnot &lt;&lt;path to charts tgz&gt;&gt;/cnot-chart-&lt;&lt;release-build&gt;&gt;.tgz -f &lt;&lt;path to charts for override file&gt;&gt;/btel-cnot.yaml --timeout 1200s
helm upgrade --install -n &lt;&lt;namespace&gt;&gt; btel-btel-bssc-indexsearch &lt;&lt;path to charts tgz&gt;&gt;/bssc-indexsearch-chart-&lt;&lt;release-build&gt;&gt;.tgz -f &lt;&lt;path to charts for override file&gt;&gt;/btel-bssc-indexsearch.yaml --timeout 1200s
helm upgrade --install -n &lt;&lt;namespace&gt;&gt; calm &lt;&lt;path to charts tgz&gt;&gt;/calm-chart-&lt;&lt;release-build&gt;&gt;.tgz -f &lt;&lt;path to charts for override file&gt;&gt;/btel-calm.yaml --timeout 1200s
helm upgrade --install -n &lt;&lt;namespace&gt;&gt; cpro-grafana &lt;&lt;path to charts tgz&gt;&gt;/cpro-grafana-chart-&lt;&lt;release-build&gt;&gt;.tgz -f &lt;&lt;path to charts for override file&gt;&gt;/btel-cpro-grafana.yaml --timeout 1200s
helm upgrade --install -n &lt;&lt;namespace&gt;&gt; btel-btel-bssc-dashboards &lt;&lt;path to charts tgz&gt;&gt;/bssc-dashboards-chart-&lt;&lt;release-build&gt;&gt;.tgz -f &lt;&lt;path to charts for override file&gt;&gt;/btel-bssc-dashboards.yaml --timeout 1200s
helm upgrade --install -n &lt;&lt;namespace&gt;&gt; btel-btel-bssc-indexmgr &lt;&lt;path to charts tgz&gt;&gt;/bssc-indexmgr-chart-&lt;&lt;release-build&gt;&gt;.tgz -f &lt;&lt;path to charts for override file&gt;&gt;/btel-bssc-indexmgr.yaml --timeout 1200s
helm upgrade --install -n &lt;&lt;namespace&gt;&gt; chf-deployment-manager-teardown &lt;&lt;path to charts tgz&gt;&gt;/chf-deployment-manager-chart-&lt;&lt;release-build&gt;&gt;.tgz -f &lt;&lt;path to charts for override file&gt;&gt;/chf-deployment-manager-teardown.yaml --timeout 900s</code></pre></li>

                        <li class="li">Using the Helm charts and YAML files that are created with the new
                                MEs:<ol class="ol" type="i" id="updating_topology_for_a_cnf_0__ol_by2_ndz_2qb">
                                <li class="li">If this system is SM:<ol class="ol" id="updating_topology_for_a_cnf_0__ol_fsd_ddb_1qb">
                                        <li class="li">Follow the procedure in <a class="xref" href="helm_installation_using_printed_commands.html">Installing Helm charts manually</a> to obtain the SM commands and upgrade the Helm charts
                                            for the SM system except the sps-load chart.<div class="note" id="updating_topology_for_a_cnf_0__note_v4w_zxb_rwb"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> This is not required if your
                                                deployment uses shared <span class="ph">NCC</span>
                                                Telemetry.</div>
<div class="note" id="updating_topology_for_a_cnf_0__note_w4w_zxb_rwb"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> Do not
                                                execute <code class="ph codeph">helm upgrade</code> of the
                                                btel-load chart, if additional users, roles,
                                                password, or other such entities were configured on
                                                User and Role Management. </div>
If you did not
                                            create additional users, roles, passwords, and other
                                            such entities on User and Role Management and your
                                            deployment does not have shared <span class="ph">NCC</span> Telemetry, then
                                            enter:<pre class="pre codeblock" id="updating_topology_for_a_cnf_0__codeblock_x4w_zxb_rwb"><code>helm upgrade --install -n &lt;&lt;namespace&gt;&gt; btel-load &lt;&lt;path to keycloak config loader chart&gt;&gt;/keycloak-config-loader-chart-&lt;&lt;release-build&gt;&gt;.tgz -f &lt;&lt;path to keycloak config btel yaml file&gt;&gt;/keycloak-config-btel.yaml --wait</code></pre></li>

                                    </ol>
</li>

                                <li class="li">If this system is ME:<ol class="ol" id="updating_topology_for_a_cnf_0__ol_y4w_zxb_rwb">
                                        <li class="li">Follow the procedure in <a class="xref" href="helm_installation_using_printed_commands.html">Installing Helm charts manually</a> to obtain the ME commands and upgrade the Helm charts
                                            for the ME subsystem.</li>

                                    </ol>
</li>

                                <li class="li">If this system is IG:<ol class="ol" id="updating_topology_for_a_cnf_0__ol_vf1_fty_2qb">
                                        <li class="li">Follow the procedure in <a class="xref" href="helm_installation_using_printed_commands.html">Installing Helm charts manually</a> to obtain the IG commands and upgrade the Helm charts
                                            for the IG system except the sps-load chart. </li>

                                    </ol>
</li>

                            </ol>
</li>

                    </ol>

                    <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> 
                        <ul class="ul" id="updating_topology_for_a_cnf_0__ul_nyy_x2b_1qb">
                            <li class="li">During helm upgrade, when the new topology is added to the existing
                                components, traffic might be impacted. As pods deletion and creation
                                occurs, restart of pods from init step happens automatically.</li>

                            <li class="li">In production or live traffic running, to avoid traffic impact,
                                there is option to isolate traffic from the Load Balancer to block
                                traffic. During a maintenance window, one cluster topology upgrade
                                can be done at time.</li>

                        </ul>

                    </div>

                </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">When the pods are <code class="ph codeph">UP</code> and <code class="ph codeph">RUNNING</code>, check the
                    pod status by entering:</span>
                <div class="itemgroup info">
                    <ol class="ol" type="a" id="updating_topology_for_a_cnf_0__ol_l11_nbc_1qb">
                        <li class="li">Enter:<pre class="pre codeblock"><code>Kubectl get pods -n &lt;&lt;namespace&gt;&gt;</code></pre></li>

                        <li class="li"> When all the pods are up and running, run these commands to check the
                            overall system health:<ul class="ul" id="updating_topology_for_a_cnf_0__ul_x1m_wdz_2qb">
                                <li class="li">
                                    <pre class="pre codeblock"><code>kubectl exec -it &lt;&lt;admincli&gt;&gt; -n &lt;&lt;namespace&gt;&gt; -c &lt;application_main_container&gt; -- /opt/tpa/bin/sps-status</code></pre>
                                </li>

                                <li class="li">
                                    <pre class="pre codeblock"><code>kubectl exec -it &lt;&lt;admincli&gt;&gt; -n &lt;&lt;namespace&gt;&gt; -c &lt;application_main_container&gt; -- /opt/tpa/bin/network-status</code></pre>
                                </li>

                                <li class="li">
                                    <pre class="pre codeblock"><code>kubectl exec -it &lt;&lt;admincli&gt;&gt; -n &lt;&lt;namespace&gt;&gt; -c &lt;application_main_container&gt; -- /opt/tpa/bin/network-status -p</code></pre>
                                </li>

                                <li class="li">
                                    <pre class="pre codeblock"><code>kubectl exec -it &lt;&lt;admincli&gt;&gt; -n &lt;&lt;namespace&gt;&gt; -c &lt;application_main_container&gt; -- /opt/tpa/bin/xdr-status</code></pre>
                                </li>

                                <li class="li">
                                    <pre class="pre codeblock"><code>kubectl exec -it &lt;&lt;admincli&gt;&gt; -n &lt;&lt;namespace&gt;&gt; -c &lt;application_main_container&gt; -- /opt/tpa/bin/db-stats -c -s all</code></pre>
                                </li>

                            </ul>
</li>

                    </ol>

                    <p class="p"><strong class="ph b">Expected output</strong></p>

                    <p class="p">All pods are running without any issue and all the post upgrade jobs are
                        completed. </p>

                    <p class="p">If the status is not healthy, then stop and investigate, do not roll back. Do
                        not proceed until all pods are running without any issue and all the post
                        upgrade jobs are completed.</p>

                </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">For each SM and each new ME, verify the vital services as follows:</span>
                <div class="itemgroup info">
                    <ul class="ul" id="updating_topology_for_a_cnf_0__ul_xzw_vgb_1qb">
                        <li class="li">Vital services are <code class="ph codeph">UP</code>.</li>

                        <li class="li">Heartbeat is <code class="ph codeph">UP</code> and <code class="ph codeph">IN_SERVICE</code>.</li>

                        <li class="li">db-stats is healthy.</li>

                        <li class="li">xdr-status is healthy.</li>

                        <li class="li">No critical alarms are observed on the log viewer.</li>

                    </ul>

                </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">If XDR status does not show all the destination sites, follow this procedure:
                        <a class="xref" href="verifying_xdr.html">Verifying XDR</a>.</span>
            </li>
</ol>

    </div>
<div class="footer"><hr /><p>Installation and Upgrade Guide • P556766-DN1000055103-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>