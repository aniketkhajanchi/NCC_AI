<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Parsing of Kafka messages" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="SPS_CDR_Streams_Stream_Overview_parsing_of_kafka_messages" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Parsing of Kafka messages</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="SPS_CDR_Streams_Stream_Overview_parsing_of_kafka_messages">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Parsing of Kafka messages</h1>
<div class="body conbody">
    <p class="p">CG Kafka Collector Node performs different decoding, conversion and validation of the input
      records, depending on the input stream type.</p>

    <p class="p">Three levels of decoding and validation of Kafka messages is performed in the Kafka input
      stream when receiving CDRs and EDRs from NCC.</p>

    <div class="section"><h2 class="title sectiontitle">Google Protocol Buffer message decoding</h2>
      
      <p class="p">Protocol buffers are Google's language-neutral, platform-neutral, extensible mechanism for
        serializing structured data. They are mainly used for documenting the messages that are
        transferred over Apache Kafka, providing information about the number of records in a given
        message and version. The first validation makes sure that correctly formatted protocol
        buffer messages with proper data payload are received. Validation errors at this stage cause
        the record to be filtered out from Apache Kafka, so it will not be reprocessed by another
        consumer. A warning is raised to indicate this.</p>
</div>

    <div class="section"><h2 class="title sectiontitle">ASN.1 BER message decoding</h2>
      
      <p class="p">Once the protocol buffer message is decoded, the payload is an ASN.1 encoded message.
        Communication protocols describe the sequence, content, and encoding of messages exchanged
        between computers communicating with each other. ASN.1 is a language for describing the
        content and the encoding of such messages. The ASN.1 description defines the content (i.e.
        fields, data type, mandatory/optional) that a message can contain. The selected encoding
        rule is used for converting the message to a format that will be transferred over the
        network. In this case, Basic Encoding Rule (BER) is used. The second validation makes sure
        that a correctly formatted ASN.1 payload is received. Validation errors at this stage cause
        the record to be filtered out from Apache Kafka, so that it will not be reprocessed by
        another consumer. A warning is raised to indicate this.</p>
</div>

    <div class="section"><h2 class="title sectiontitle">Conversion to CGF (DR) internal event record (ASCII) format</h2>
      
      <p class="p">Once the ASN.1 message has been decoded, it is converted into CGF (DR) internal event
        record format (ASCII). Although the NCC ASN.1 definition specifies all fields as
        OctetString, all the field names and values are essentially strings. To make the data human
        readable throughout the processing, the data is converted from hexadecimal format to
        standard UTF8 string. The converted record is stored as such to the database.</p>

      <p class="p">CDRs are identified using the recordType field. The different record types that should be
        handled as CDRs are configurable via node parameter
        <code class="ph codeph">ChargingRecordTypes</code>.</p>

      <p class="p">When saving a CDR into the database, CG Kafka Collector Node extracts all the fields that
        it finds that have been configured in the <code class="ph codeph">SessionIdFields</code> node parameter,
        concatenates the values and uses the concatenated value as Session-Id when saving to the
        database. If the result of the concatenation is empty or none of the fields are found, CG
        Kafka Collector Node handles the CDR as an EDR and generates a Session-Id.</p>

      <p class="p">CG Kafka Collector Node also extracts the record number for the record within the session
        from the fields configured with node parameter <code class="ph codeph">SequenceNumberFields</code>. The
        first one found is used, and if no field is found, default value 0 is used.</p>

      <p class="p">EDRs do not have any session ID fields. For such events, CG Kafka Collector Node generates
        an MD5 hash value out of the record to be used as an identifier when storing the record into
        the database. Record number value 0 is used.</p>

      <p class="p">If some errors occur during the conversion or hash generation, the record is filtered out
        from Apache Kafka, so that it is not reprocessed by another consumer. A warning is raised to
        indicate this.</p>
</div>

  </div>
<div class="footer"><hr /><p>Overview Guide • P556766-DN1000054925-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>