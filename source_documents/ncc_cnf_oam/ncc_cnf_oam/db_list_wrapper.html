<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="db-list-wrapper" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="db_list_wrapper" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>db-list-wrapper</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="db_list_wrapper">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">db-list-wrapper</h1>
<div class="body conbody">
        <p class="p">This tool provides a way to run the <code class="ph codeph">db-list</code> tool on admincli pod and
            collect the dump and move it back to the host. It can be found in the
                <span class="ph filepath">/opt/tpa/bin</span> directory of the admincli pod. Copy the script to
            your controller node or any jump server of Kubernetes cluster. The script can then be
            run either manually or configured in crontab.</p>

        <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> This tool is to be run on the jump server/control node (it cannot be run from inside
            any <span class="ph">NCC</span> pod). This tool uses kubectl commands and assumes
            that the terminal has access to the <span class="ph">NCC</span> Kubernetes
            cluster.</div>

        <div class="section"><h2 class="title sectiontitle">Syntax</h2>
            
            <pre class="pre codeblock"><code>db-list-wrapper.sh [-a &lt;arguments&gt;] [-d ] [-h] [-k &lt;kubeconfig&gt;] [-l &lt;file&gt;] [-n &lt;namespace&gt; ][-o &lt;directory&gt;] [-O &lt;directory on pod&gt;] [-p]</code></pre>
        </div>

        <div class="section"><h2 class="title sectiontitle">Options and usage </h2>
            
            <code class="ph codeph">no arguments</code>
            <p class="p">When no argument is provided, this tool runs with default values of -a, -O, and
                -o.</p>

            <code class="ph codeph">-n &lt;namespace&gt;</code>
            <p class="p">Use this option to set the name space for the admincli pod. The tool internally finds
                the admincli pod and its container to run commands. </p>
<pre class="pre codeblock" id="db_list_wrapper__codeblock_szr_tvb_rvb"><code>db-list-wrapper.sh -n &lt;namespace&gt;</code></pre>
            <p class="p"><code class="ph codeph">-a "&lt;arguments&gt;"</code></p>
<p class="p">Use this option to pass on arguments to
                the db-list tool. The -o &lt;dir&gt;" option of db-list is not allowed to be part of
                argument of -a. This can be set via -O option of db-list-wrapper.sh tool.</p>
<p class="p">The
                options should be in double quotes. For example -a <code class="ph codeph">"-l devices -q 10
                    -r"</code>. The default value is "-l devices". It supports multiple formats.
                With -l, -i and -a of db-list tool supporting multiple choices, it is needed to
                support such multiple choices without running db-list-wrapper.sh multiple times.
                db-list-wrapper.sh gives such flexibility to input multiple objects at once
                separated by delimiter semicolon. Only one option can have multiple
                    arguments.</p>
<pre class="pre codeblock"><code>Example: db-list-wrapper.sh -a "-l devices:users:sessions -d 2 -r 4096 -t 12 -f 10
runs the  db-list tool for these three scenarios and collect output:

db-list -d 2 -r 4096 -t 12 -f 10 -l devices
db-list-d 2 -r 4096 -t 12 -f 10 -l users
db-list -d 2 -r 4096 -t 12 -f 10 -l sessions

db-list-wrapper.sh -n &lt;namespace&gt; -a &lt;arguments&gt;

Example: db-list-wrapper.sh -n sps-me -a "-l devices:accounts:groups"
//This sets up the device, account and group listing in the db-list tool.</code></pre><p class="p"><code class="ph codeph">-d</code></p>
<p class="p">This
                option enables debug mode and saves the debug
                    logs.</p>
<pre class="pre codeblock"><code>Example: db-list-wrapper.sh -n &lt;namespace&gt; -d</code></pre><p class="p"><code class="ph codeph">-h</code></p>
<p class="p">This
                option displays the help information for the
                    tool.</p>
<pre class="pre codeblock"><code>db-list-wrapper.sh -h</code></pre><p class="p"><code class="ph codeph">-k
                    &lt;kubeconfig&gt;</code></p>
<p class="p">This option is used to provide the location of
                the kubeconfig file which is used by the Command Line Interface (CLI) of the
                Kubernetes cluster to execute its command. This option is required for OpenShift
                clusters. If the CLI fails to find this file, the location must be provided.</p>
<pre class="pre codeblock"><code>db-list-wrapper.sh -n &lt;namespace&gt; -k &lt;kubeconfig location&gt;</code></pre>
            <p class="p"><code class="ph codeph">-l &lt;file&gt;</code></p>

            <p class="p">Use this option to provide a file name which will hold the logs of the tool. If not
                provided, the tool creates a log file named <span class="ph filepath">db-list-wrapper.log</span>
                in the directory set by the -o option.</p>

            <pre class="pre codeblock"><code>db-list-wrapper.sh -n &lt;namespace&gt; -l &lt;fileName&gt;</code></pre>
            <p class="p"><code class="ph codeph">-o | --outDir &lt;directory&gt;</code>
            </p>
<p class="p">Use this option to set the output directory for logs and other output files
                copied from the admincli pod. The default location is the
                    <span class="ph filepath">db-list-wrapper</span> directory in the current directory. </p>
<pre class="pre codeblock"><code>db-list-wrapper.sh -n &lt;namespace&gt; -o &lt;directory&gt;</code></pre>
            <code class="ph codeph">-O | --outDirPod &lt;directory on pod&gt;</code>
            <div class="p">Use this option to set the output directory to save files on the admincli pod. The
                default location is the <span class="ph filepath">/tmp/db-list-wrapper</span> directory on the
                admincli pod. It is basically the -o &lt;dir&gt; option of the db-list tool. <div class="note" id="db_list_wrapper__note_mxk_nvn_1yb"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> If the directory already exists, then this tool copies all
                    contents from it to the -o &lt;dir&gt; location and finally deletes the directory
                    set via -O &lt;dir&gt;. So, refrain from using either already existing directories
                    or directories like /tmp, /root, and so on for which there is no
                    permission.</div>
<pre class="pre codeblock"><code>db-list-wrapper.sh -n &lt;namespace&gt; -O &lt;directory on pod&gt;</code></pre></div>

            <code class="ph codeph">-p</code>
            <p class="p">This option enables the OpenShift cluster's CLI <code class="ph codeph">oc</code>. The default is
                    <code class="ph codeph">kubectl</code>.</p>

            <code class="ph codeph">db-list-wrapper.sh -n &lt;namespace&gt; -p</code>
        </div>

        <div class="section"><h2 class="title sectiontitle">Example: Scheduling multiple dumps in the crontab of the control node</h2>
            
            <ol class="ol">
                <li class="li">On the control node make a copy of the script from the admincli pod. 
                    <pre class="pre codeblock"><code>kubectl cp sps-igig-admincli-886f7c77f-8svgd:opt/tpa/bin/db-list-wrapper.sh ./db-list-wrapper.sh -n sps-ig -c sps-igig-admincl</code></pre>
                </li>

                <li class="li">On the control edit the crontab to:<ol class="ol" type="a" id="db_list_wrapper__ol_ybj_dm2_xrb">
                        <li class="li">Grant executable permission to the tool.
                            <pre class="pre codeblock"><code>chmod a+x db-list-wrapper.sh</code></pre>
                        </li>

                        <li class="li">Edit the crontab on the control node.
                            <pre class="pre codeblock"><code>crontab -e</code></pre>
                        </li>

                        <li class="li">Schedule the data dumps in the crontab as needed. <p class="p">For example, run
                                these commands to schedule mid-nightly dumps of devices, accounts,
                                groups, and Charging Services on two namespaces (sps-ig1 and
                                sps-ig2). This command schedules the execution of the db-list tool
                                in the crontab of a control node or jump server.</p>

                            
                            <pre class="pre codeblock"><code>0 0 * * * /root/db-list-wrapper.sh -k /root/.kube/config -n sps-ig1 -a "-l devices:accounts:groups:generic(dsclocal,ChargingService) -q 100000 -r 2048"
0 0 * * * /root/db-list-wrapper.sh -k /root/.kube/config -n sps-ig2 -a "-l devices:accounts:groups:generic(dsclocal,ChargingService) -q 100000 -r 2048"</code></pre>
                            
                            <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> When working on OpenShift, the <code class="ph codeph">-k</code> option is
                                mandatory.</div>
</li>

                        <li class="li">Save and exit the crontab. The dumps are now scheduled.</li>

                    </ol>
</li>

            </ol>

        </div>

    </div>
<div class="footer"><hr /><p>Operations, Administration, and Maintenance Guide • P556766-DN1000055092-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>