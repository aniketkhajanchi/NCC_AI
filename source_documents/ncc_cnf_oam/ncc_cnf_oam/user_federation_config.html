<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="LDAP user federation configuration" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="user_federation_config" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>LDAP user federation configuration</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="user_federation_config">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">LDAP user federation configuration</h1>
<div class="body conbody">
        <div class="section" id="user_federation_config__section_tmj_knr_llb"><h2 class="title sectiontitle">Overview of user federation in the User and Role Management GUI</h2>
            
            <p class="p">NCC supports User and Role Management functionality for LDAP with remote
                authentication systems such as Active Directory. When a user logs in, User and role
                Management looks into its own internal user store to find the user. If it cannot
                find the user there, it iterates over every User Storage provider that is configured
                for the realm until it finds a match. Data from the external store is mapped into a
                common user model that is consumed by the User and Role Management runtime.</p>

            <p class="p">In the <span class="ph uicontrol">User and Role Management Admin GUI</span>, navigate to
                    <span class="ph uicontrol">Users &gt; Lookup &gt; View all users</span> and select a user to see
                the status of that user. The attribute LDAP_ID, if present, indicates the user is
                from LDAP. Other attributes, like User Temporarily Locked and Email Verified can be
                modified here if the user has problems with login.</p>

            <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> A fully configured <span class="ph">NCC</span> system contains three realms.
                This configuration must be completed on each realm.</div>

            <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> The configuration is normally done with the Input Generator spreadsheet to
                generate Helm charts. The information in this topic describes the settings that are
                done via the Helm installation, when configured for user federation.</div>

            <p class="p">The information for all realms to integrate with LDAP that is described in this topic
                is an example LDAP integration. Your configuration settings may differ for your LDAP
                installation.</p>

        </div>

        <div class="section"><h2 class="title sectiontitle">Realm settings</h2>
            
            <p class="p">The sps-auth realm is configured during installation to integrate User and Role
                Management with the SM subsystem. You must make changes to the realm configuration
                for LDAP integration. Similar updates are needed for the btel-auth realm and the
                &lt;element&gt;-dr-cdr realm.</p>

            <div class="p">Select <span class="ph uicontrol">Realm Settings</span> in the left navigation, then click on
                the <span class="ph uicontrol">Login</span> tab and verify these settings: <ul class="ul" id="user_federation_config__ul_c1d_yhw_t5b">
                    <li class="li"><span class="ph uicontrol">Verify email: OFF</span></li>

                    <li class="li"><span class="ph uicontrol">Forgot password: OFF</span>
                    </li>

                </ul>
</div>

        </div>

        <div class="section"><h2 class="title sectiontitle">Input Generator additions</h2>
            
            <div class="p">Two sections are included the <span class="ph uicontrol">Common</span> worksheet of
                    <span class="ph filepath">Inputs.xlsx</span>: <ul class="ul">
                    <li class="li"><span class="ph uicontrol">LDAP - Authentication</span>, and</li>

                    <li class="li"><span class="ph uicontrol">LDAP - Authorization</span>. </li>

                </ul>
</div>

            <div class="p">Field notes: <ul class="ul">
                    <li class="li"><span class="ph uicontrol">LDAP-Authentication: Enable:</span> - This field is mutually
                        exclusive of the SSO option for server overlapping purposes.</li>

                    <li class="li"><span class="ph uicontrol">LDAP-Authorization: Enable:</span> - This field is used when
                        you define groups in your LDAP server to define roles. If you want to use
                        another option for roles, leave the value as <span class="keyword parmname">false</span> and
                        configure directly with the User and Role Management GUI after
                        installation.</li>

                    <li class="li"><span class="ph uicontrol">Connection ports:</span> Configures outgoing connections in
                        User and Role Management to use insecure transport, for example
                            <code class="ph codeph">ldap</code> protocol 10389, and Istio proxies the connection
                        to secure <code class="ph codeph">ldaps</code> protocol with TLS toward an external port
                        (typically on 636 or 10636) as configured in the Input Generator
                        spreadsheet, depending on what port your LDAP server listens on.</li>

                </ul>
</div>

            <p class="p">This information describe the configuration as it appears in the User and Role
                Management GUI for verification and needed updates. For instructions on migrating an
                existing geo-redundant installation to integrate LDAP, see <a class="xref" href="sso_migration.html">SSO/LDAP migration</a>.</p>

        </div>

        <div class="section" id="user_federation_config__section_sbq_v4r_llb"><h2 class="title sectiontitle">User federation configuration and settings</h2>
            
            <p class="p">Log in to the <span class="ph uicontrol">User and Role Management GUI</span> as the admin user,
                click on <span class="ph uicontrol">User Federation</span> from the left navigation, and choose
                    <span class="ph uicontrol">ldap</span> from the list.</p>
<div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> All of the below configuration only needs to be done on one
                side of an SM pair. The configuration database is replicated so it takes effect on
                both sites.</div>

            <div class="p">Configuration details may vary depending on how your server is configured. This table
                is an example configuration for integration with the LDAP server. <table cellpadding="4" cellspacing="0" summary="" id="user_federation_config__table_otf_1pr_llb" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap"><span class="table--title-label">Table: </span>User federation LDAP settings</span></caption><colgroup><col style="width:25%" /><col style="width:25%" /><col style="width:50%" /></colgroup><thead class="thead" style="text-align:left;">
                            <tr class="row">
                                <th class="entry cellrowborder" style="vertical-align:top;" id="d21280e186">Name</th>

                                <th class="entry cellrowborder" style="vertical-align:top;" id="d21280e189">Value</th>

                                <th class="entry cellrowborder" style="vertical-align:top;" id="d21280e192">Note</th>

                            </tr>

                        </thead>
<tbody class="tbody">
                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e186 ">Priority</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e189 ">1</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e192 ">1 is highest. User and Role Management internally-defined
                                    users are higher than any externally defined users. </td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e186 ">Import users</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e189 ">ON</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e192 ">User and Role Management imports the user on first access and
                                    synchronizes periodically.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e186 ">Sync Registrations</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e189 ">OFF</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e192 ">NCC does not write to this LDAP store.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e186 ">Vendor</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e189 ">Other</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e192 ">For ActiveDirectory integration, choose Active Directory
                                    here.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e186 ">Edit Mode</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e189 ">READ_ONLY</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e192 ">This is the only mode tested.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e186 ">Username LDAP attribute</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e189 ">cn</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e192 ">The ldap attribute mapped to SM login name</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e186 ">RDN LDAP attribute</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e189 ">cn</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e192 ">The ldap attribute used to lookup this unique user</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e186 ">UUID LDAP attribute</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e189 ">cn</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e192 ">The ldap attribute that uniquely identifies this user</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e186 ">User Object Class</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e189 ">inetOrgPerson</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e192 ">The schema used for describing user records in the LDAP
                                    store</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e186 ">Connection URL</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e189 ">ldap://ldapfqdn.com:10389</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e192 ">
                                    <p class="p">The URL consists of a protocol, FQDN, and port number.</p>

                                    <p class="p">In NCC:</p>

                                    <ul class="ul" id="user_federation_config__ul_nvv_zkw_t5b">
                                        <li class="li">protocol must be ldap</li>

                                        <li class="li">port number must be 10389</li>

                                        <li class="li">only FQDN is allowed, raw IP is not supported</li>

                                    </ul>

                                    <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> NCC upgrades the connection to ldaps (TLS) and a port
                                        number as configured in the Input Generator.</div>

                                </td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e186 ">Users DN</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e189 ">ou=people,dc=internal,dc= users,dc=root</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e192 ">The directory hierarchy where users are located in the LDAP
                                    store</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e186 ">Bind Type</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e189 ">simple</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e192 ">how to authenticate to the LDAP server</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e186 ">Bind DN</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e189 ">cn=Directory Manager</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e192 ">privileged user name for authenticating to LDAP
                                    server</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e186 ">Bind Credential</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e189 ">***</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e192 ">privileged user password</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e186 ">Search Scope</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e189 ">One Level</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e192 "> </td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e186 ">Validate Password Policy</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e189 ">OFF</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e192 ">Related to update which is not currently supported for NCC
                                    integration</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e186 ">Connection Pooling</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e189 ">ON</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e192 "> </td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e186 ">Connection Timeout</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e189 ">10000</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e192 "> </td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e186 ">Read Timeout</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e189 ">10000</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e192 "> </td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e186 ">Pagination</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e189 ">ON</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e192 "> </td>

                            </tr>

                        </tbody>
</table>
</div>

        </div>

        <div class="section" id="user_federation_config__section_vbs_s5r_llb"><h2 class="title sectiontitle">User federation mappers for users</h2>
            
            <p class="p">This part of the configuration is supported in the Input Generator via the
                    <span class="ph uicontrol">LDAP - Authorization</span> section of the
                    <span class="ph uicontrol">Common</span> worksheet. This is a manual alternative for the
                User and Role Management configuration.</p>

            <div class="p">Mappers can be created for LDAP attributes, to convert them when User and Role
                Management imports user information. Do not change the existing default mappers as
                these result in LDAP attributes being injected into the User and Role Management
                token. The username that is displayed in the GUI is of the most significance.<ul class="ul" id="user_federation_config__ul_op5_t5r_llb">
                    <li class="li">last name</li>

                    <li class="li">email</li>

                    <li class="li">modify date</li>

                    <li class="li">first name</li>

                    <li class="li">username</li>

                    <li class="li">creation date</li>

                </ul>
</div>

        </div>

        <div class="section" id="user_federation_config__section_m4w_x5r_llb"><h2 class="title sectiontitle">User Federation Mappers for roles</h2>
            
            <div class="p">There are multiple options for user-to-role mapping.<ul class="ul" id="user_federation_config__ul_zvr_y5r_llb">
                    <li class="li">LDAP groups (defined in LDAP)</li>

                    <li class="li"><span class="ph uicontrol">memberOf</span> attribute in user record (defined in
                        LDAP)</li>

                    <li class="li">Default role (defined in User and Role Management)</li>

                </ul>

            </div>

            <p class="p">If a default role is configured in User and Role Management, nothing else must be
                done in the LDAP server. A single role is assigned by User and Role Management to
                any users that are authenticated from a particular LDAP store.</p>

        </div>

        <div class="section" id="user_federation_config__section_d12_hvr_llb"><h2 class="title sectiontitle">LDAP groups</h2>
            
            <div class="p">A mapper is created for importing roles from LDAP and stored there as groups. The
                import is done from User and Role Management by querying LDAP for what groups a
                given user is a member of. Typically, groups in LDAP are defined as groupOfNames or
                groupOfUniqueNames, where the group object contains multiple attributes, one for
                each member. This configuration tells User and Role Management how to query the
                group and extract the username for membership. The group name becomes the role name
                in User and Role Management. This table describes the configuration details. <table cellpadding="4" cellspacing="0" summary="" id="user_federation_config__table_mlr_lvr_llb" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap"><span class="table--title-label">Table: </span>User Federation &gt; ldap &gt; LDAP Mappers: Create</span></caption><colgroup><col style="width:25%" /><col style="width:25%" /><col style="width:50%" /></colgroup><thead class="thead" style="text-align:left;">
                            <tr class="row">
                                <th class="entry cellrowborder" style="vertical-align:top;" id="d21280e552">Name</th>

                                <th class="entry cellrowborder" style="vertical-align:top;" id="d21280e555">Value</th>

                                <th class="entry cellrowborder" style="vertical-align:top;" id="d21280e558">Note</th>

                            </tr>

                        </thead>
<tbody class="tbody">
                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e552 ">Name</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e555 ">smroles</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e558 "> </td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e552 ">Mapper Type</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e555 ">role-ldap-mapper</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e558 "> </td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e552 ">LDAP Roles DN</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e555 ">ou=groups,dc=internal,dc= users,dc=root</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e558 ">Identifies the parent node where groups are to be found for
                                    this realm. Under this node should be a group entry for each
                                    role. <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> This is the only field that has a unique value per
                                        realm. For example: for btel-auth this value could be
                                            <span class="keyword parmname">ncc-btel-roles</span>.</div>
</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e552 ">RoleName LDAP Attribute</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e555 ">cn</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e558 ">What attribute to use for the role name: Using
                                        <span class="keyword parmname">cn</span> here takes the group name itself.
                                    You can also define another attribute to use within the record.
                                    For example: <span class="keyword parmname">organizationName </span>(o) or
                                        <span class="keyword parmname">businessCategory</span> which are part of the
                                    groupOf*Names schemas, or you can define your own LDAP schema
                                    extension. This can be better in that you can omit populating
                                    this attribute for groups that are not associated with <span class="ph">NCC</span> roles. If you use the
                                        <span class="keyword parmname">cn</span> attribute and a generic group DN,
                                    then all groups to which the user is a member become roles in
                                    User and Role Management by group name, regardless of whether
                                    the group membership is relevant to NCC. This would only be a
                                    problem in the unlikely event of an overlap in role names
                                    between applications.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e552 ">Role Object Classes</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e555 ">groupOfUniqueNames</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e558 ">What schema is used to define the group (could also be
                                    groupOfNames)</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e552 ">Membership LDAP Attribute</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e555 ">uniqueMember</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e558 ">What attribute in the group object identifies a
                                    member</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e552 ">Membership Attribute Type</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e555 ">DN</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e558 ">How to interpret the member data value (for example: contains
                                    a fully qualified Distinguished Name)</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e552 ">Membership User LDAP Attribute</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e555 ">cn</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e558 ">Unused</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e552 ">Mode</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e555 ">READ_ONLY</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e558 "> </td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e552 ">User Roles Retrieve Strategy</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e555 ">LOAD_ROLES_BY_ MEMBER_ATTRIBUTE</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e558 ">use the group object itself and process the membership
                                    list</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e552 ">Member-Of LDAP Attribute</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e555 ">memberOf</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e558 ">Unused</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e552 ">Use Realm Roles Mapping</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e555 ">ON</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e558 "> </td>

                            </tr>

                        </tbody>
</table>
 For the btel-auth and &lt;site&gt;-dr-cdr realms, create a similar mapper. The
                only difference is the LDAP Roles DN field which is set to pull from a different
                LDAP group. For example: cn=ncc-btel-roles,ou=groups,dc=root or
                cn=ncc-dr-roles,ou=groups,dc=root.</div>

        </div>

        <div class="section"><h2 class="title sectiontitle">LDAP groups to User and Role Management roles</h2>
            
            <div class="p">The minimum set of roles (and hence LDAP groups) for <span class="ph">NCC</span>
                are described in this table. <table cellpadding="4" cellspacing="0" summary="" class="table" frame="border" border="1" rules="all"><colgroup><col style="width:20%" /><col style="width:20%" /><col style="width:60%" /></colgroup><thead class="thead" style="text-align:left;">
                            <tr class="row">
                                <th class="entry cellrowborder" style="vertical-align:top;" id="d21280e756">Realm</th>

                                <th class="entry cellrowborder" style="vertical-align:top;" id="d21280e759">Role</th>

                                <th class="entry cellrowborder" style="vertical-align:top;" id="d21280e762">Purpose</th>

                            </tr>

                        </thead>
<tbody class="tbody">
                            <tr class="row">
                                <td class="entry cellrowborder" rowspan="2" style="vertical-align:top;" headers="d21280e756 ">sps-auth</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e759 ">administrator</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e762 ">API authentication super user - no restrictions</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e759 ">selective-provisioning</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e762 ">When provisioning, the GUI prompts the user to choose
                                        <span class="ph uicontrol">Managed Element</span> sites. Otherwise, the
                                    data is sent to all ME subsystems.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" rowspan="6" style="vertical-align:top;" headers="d21280e756 ">btel-auth</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e759 ">kibanauser</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e762 ">User role to map to Searchguard role sg_kibana_user for
                                    access to OpenSearch and visualizations</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e759 ">belkadmin</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e762 ">Administrative role to map to Searchguard role sg_all_access
                                    for all data access in OpenSearch</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e759 ">read_alarm_role</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e762 ">Internal role to view alarm data</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e759 ">update_alarm_role</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e762 ">Internal role to update alarm data</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e759 ">ack_alarm_role</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e762 ">Internal role to acknowledge alarm data</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e759 ">clear_alarm_role</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e762 ">Internal role to clear alarm data</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e756 ">&lt;element&gt;-dr-cdr</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e759 ">dr-admin-role</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e762 ">Call Gateway Function (Data Refinery) - full access to GUI /
                                    REST APIs.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" rowspan="3" style="vertical-align:top;" headers="d21280e756 ">
                                    
                                    <p class="p">RCMS</p>

                                    
                                </td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e759 ">RMS_GROUP_&lt;group name&gt;</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e762 ">
                                    <p class="p">The &lt;group name&gt; must already in the RMS system or be
                                        created in the RMS system. After RMS installation, the ADMIN
                                        group should already be created in the RMS system for the
                                        rcmsadmin user. Other groups can be created by the rcmsadmin
                                        user after login. </p>

                                    <p class="p">This role is for RMS login authorization.</p>

                                </td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e759 ">RMS_ROLE_USER</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e762 ">
                                    <p class="p">Configure this as the default role mapping for all RMS users. </p>

                                    <p class="p">This role is for RMS login authentication.</p>

                                </td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" colspan="2" style="vertical-align:top;" headers="d21280e759 d21280e762 ">Note: both RMS_GROUP_&lt;group
                                    name&gt; and RMS_ROLE_USER must be created and mapped
                                    correctly.</td>

                            </tr>

                        </tbody>
</table>
</div>

            <p class="p">In Service Manager, additional API authentication roles can be defined, each with
                different sets of permissions. When an API-authentication role is created in SM, it
                is automatically created in User and Role Management. To associate an LDAP-based
                user with that role, a corresponding group must be defined in LDAP, and the user
                added as a member of that group.</p>

            <p class="p"><strong class="ph b">MVNO Roles for <span class="ph">NCC</span> Charging ServiceManager</strong></p>

            <p class="p">If the service provider enables the MVNO feature, additional roles are created in the
                sps-auth realm. These roles must be mapped similarly to LDAP groups. The roles
                are:</p>

            <ul class="ul" id="user_federation_config__ul_zbn_txb_55b">
                <li class="li">serviceprovider-&lt;mvnoname&gt; : a role for each MVNO service provider - a user
                    can have one or more of these roles.</li>

                <li class="li">serviceprovider-all : special role that allows a user to act on behalf of any
                    MVNO user.</li>

            </ul>

            <p class="p"><strong class="ph b"><span class="keyword parmname">memberOf</span> attribute in user record</strong></p>

            <p class="p">Users in LDAP are organized into groups as before, but the LDAP server automatically
                populates a <span class="keyword parmname">memberOf</span> attribute in the user record to indicate
                group membership. This is supported by Microsoft Active Directory. With this option,
                User and Role Management does not have to query the LDAP server separately for group
                membership, as it is in the user record directly. User and Role Management assigns
                roles based on all groups of which the user is a member.</p>

            <p class="p">You can configure this option by changing this field: <span class="keyword parmname">User Roles Retrieve
                    Strategy: GET_ROLES_FROM_USER_MEMBEROF_ATTRIBUTE</span></p>

            <p class="p"><strong class="ph b">Default role</strong></p>

            <div class="p">If you are not able to configure LDAP groups, users can still authenticate and be
                given default roles. One way is by using a User and Role Management static
                configuration. To do this, navigate to <span class="ph uicontrol">User Federation &gt; [myldap] &gt; LDAP
                    Mappers: Create</span> and configure these fields: <ul class="ul">
                    <li class="li">Name: defaultRole</li>

                    <li class="li">Mapper Type: hardcoded-ldap-role-mapper</li>

                    <li class="li">Role: administrator (or other desired common role) </li>

                </ul>
</div>

        </div>

        <div class="section"><h2 class="title sectiontitle">User federation mapper for groups - btel-auth realm</h2>
            
            <p class="p">The Metrics Viewer application authorizes based on User and Role Management group
                names rather than roles. An additional mapper must be configured.</p>

            <table cellpadding="4" cellspacing="0" summary="" id="user_federation_config__table_p3g_3dc_55b" class="table" frame="border" border="1" rules="all"><caption><span class="tablecap"><span class="table--title-label">Table: </span>LDAP groups to User and Role Management groups</span></caption><colgroup><col style="width:20%" /><col style="width:20%" /><col style="width:60%" /></colgroup><thead class="thead" style="text-align:left;">
                        <tr class="row">
                            <th class="entry cellrowborder" style="vertical-align:top;" id="d21280e996">Realm</th>

                            <th class="entry cellrowborder" style="vertical-align:top;" id="d21280e999">Group</th>

                            <th class="entry cellrowborder" style="vertical-align:top;" id="d21280e1002">Purpose</th>

                        </tr>

                    </thead>
<tbody class="tbody">
                        <tr class="row">
                            <td class="entry cellrowborder" rowspan="2" style="vertical-align:top;" headers="d21280e996 ">btel-auth</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e999 ">GrafanaAdmin</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1002 ">Administrative role to map to the Metrics Viewer internal role
                                called <span class="keyword parmname">Admin</span> to access all data in the Metrics
                                Viewer</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e999 ">GrafanaEditor</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1002 ">Administrative role to map to the Metrics Viewer internal role
                                called <span class="keyword parmname">Editor</span> to access editorial data in the
                                Metrics Viewer</td>

                        </tr>

                    </tbody>
</table>

            <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> These group names are case-sensitive.</div>

            <p class="p">Groups are mapped in almost identical manner to roles.</p>

            <p class="p">Navigate to <span class="ph uicontrol">User Federation &gt; [myldap] &gt; Mappers &gt; Create</span> and
                configure these fields:</p>

            <table cellpadding="4" cellspacing="0" summary="" id="user_federation_config__table_q3g_3dc_55b" class="table" frame="border" border="1" rules="all"><colgroup><col style="width:20%" /><col style="width:20%" /><col style="width:60%" /></colgroup><thead class="thead" style="text-align:left;">
                        <tr class="row">
                            <th class="entry cellrowborder" style="vertical-align:top;" id="d21280e1066">Name</th>

                            <th class="entry cellrowborder" style="vertical-align:top;" id="d21280e1069">Value</th>

                            <th class="entry cellrowborder" style="vertical-align:top;" id="d21280e1072">Note</th>

                        </tr>

                    </thead>
<tbody class="tbody">
                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1066 ">Name</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1069 ">smgroups</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1072 "> </td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1066 ">Mapper Type</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1069 ">group-ldap-mapper</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1072 "> </td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1066 ">LDAP Groups DN</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1069 ">ou=ncc-btel-groups,ou=groups,dc=root</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1072 ">Identifies the parent node where groups are to be found for this
                                realm. Under this node should be an ldap-group entry for each User
                                and Role Management-group. (Though it is possible to combine the
                                groups and roles under one parent node in LDAP, it results in
                                superfluous groups and roles getting created, so ideally keep them
                                separate in LDAP.)</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1066 ">Group Name LDAP Attribute</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1069 ">cn</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1072 ">What attribute to use for the role name: Using
                                    <span class="keyword parmname">cn</span> here takes the group name itself. You
                                can also define another attribute to use within the record, for
                                example: <span class="keyword parmname">businessCategory</span>, which is part of the
                                groupOf*Names schemas, or you can define your own LDAP schema
                                extension.</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1066 ">Group Object Classes</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1069 ">groupOfUniqueNames</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1072 ">Schema that is used to define the group (could also be
                                    <span class="keyword parmname">groupOfNames</span>)</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1066 ">Membership LDAP Attribute</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1069 ">uniqueMember</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1072 ">Attribute in the group object that identifies a member</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1066 ">Membership Attribute Type</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1069 ">DN</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1072 ">How to interpret the member data value (for example, fully
                                qualified Distinguished Name)</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1066 ">Membership User LDAP Attribute</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1069 ">cn</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1072 ">unused</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1066 ">Mode</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1069 ">READ_ONLY</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1072 "> </td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1066 ">User Roles Retrieve Strategy</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1069 ">LOAD_GROUPS_BY_MEMBER_ATTRIBUTE</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1072 ">use the group object itself and process the membership
                                list</td>

                        </tr>

                        <tr class="row">
                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1066 ">Member-Of LDAP Attribute</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1069 ">memberOf</td>

                            <td class="entry cellrowborder" style="vertical-align:top;" headers="d21280e1072 ">unused</td>

                        </tr>

                    </tbody>
</table>

            <div class="p">This figure shows the recommended organization of groups in LDAP for mapping cleanly
                to User and Role Management, in which each <span class="ph">NCC</span> realm
                has its own sub-tree of the LDAP hierarchy where only groups that are related to
                that realm are defined. <div class="fig fignone"><span class="figcap"><span class="fig--title-label">Figure: </span>Group organization in LDAP</span>
                    
                    <img class="image break" src="../images/ncc_oam_ldap_group_org.png" />
                </div>

            </div>

        </div>

        
        <div class="section"><h2 class="title sectiontitle">Group organization options in LDAP</h2>
            
            <p class="p">These are the LDAP group organization options:</p>

            <ul class="ul">
                <li class="li">Each <span class="ph">NCC</span> realm has its own DN under which group
                    records are defined only pertaining to that realm. This is the recommended
                    approach and is the default configuration done via Input Generator/Helm
                    installation.</li>

                <li class="li">Define groups in LDAP anywhere in the hierarchy, but in the
                    keycloak-role-mapper, designate an attribute other than the RDN to be mapped to
                    the role name. In LDAP, only define this attribute for groups that are relevant
                    to <span class="ph">NCC</span> authentication. <ul class="ul" id="user_federation_config__ol_n3l_x3h_hvb">
                        <li class="li">Advantage: no need to create additional directory hierarchy in
                            LDAP.</li>

                        <li class="li">Disadvantage: for groups that are not relevant to <span class="ph">NCC</span> and which do not have the
                                <span class="keyword parmname">group name</span> attribute, the User and Role
                            Management auth token includes a role <span class="keyword parmname">null</span> which
                                <span class="ph">NCC</span> ignores but may be problematic
                            elsewhere.</li>

                    </ul>
</li>

                <li class="li">Define groups in LDAP anywhere in the hierarchy, and use the RDN as the
                    attribute to map to the User and Role Management role. <ul class="ul">
                        <li class="li">Advantage: simplest.</li>

                        <li class="li">Disadvantage: the User and Role Management token includes roles for all
                            LDAP groups for which the user is a member, even those that do not
                            pertain to <span class="ph">NCC</span>. The non-<span class="ph">NCC</span> roles are ignored but it may be
                            confusing when inspecting the token.</li>

                    </ul>
</li>

            </ul>

        </div>

        <div class="section" id="user_federation_config__section_cks_zvr_llb"><h2 class="title sectiontitle">Client mapper - sps-auth realm</h2>
            
            <div class="p">Create a hard-coded attribute to inform the GUI that user information is read only
                and cannot be modified by <span class="ph">NCC</span>. This is communicated to
                the GUI through the userInfo data that the GUI fetches at login time, from the User
                and Role Management server. Navigate to: <span class="ph uicontrol">Clients &gt; Client ID spssm &gt;
                    Mappers (tab) &gt; Create</span> and configure these fields:<ul class="ul" id="user_federation_config__ul_vz4_2wr_llb">
                    <li class="li">name: readonly</li>

                    <li class="li">Mapper Type: hardcoded claim</li>

                    <li class="li">Token Claim Name: readonly</li>

                    <li class="li">Claim value: true</li>

                    <li class="li">Claim JSON Type: Boolean</li>

                    <li class="li">Add to ID token: OFF</li>

                    <li class="li"> Add to access token: OFF</li>

                    <li class="li">Add to userinfo: ON</li>

                </ul>
</div>

        </div>

        <div class="section"><h2 class="title sectiontitle">LDAP server configuration</h2>
            
            <p class="p">Role mapping</p>

            <p class="p">If a default role is configured in User and Role Management, nothing else must be
                done in the LDAP server.</p>

            <p class="p">If a default role is not defined, you must create a group for each role. The group
                name should be the role name. The groups should be located in the directory tree to
                match the configuration of the mapper in User and Role Management. For example,
                create a group named <span class="keyword parmname">smprovisioners</span> in LDAP with a member
                    <span class="keyword parmname">smuser1</span>. When <span class="keyword parmname">smuser1</span> logs into SM,
                the role <span class="keyword parmname">smprovisioners</span> is assigned to that user. This role
                must also be setup in SM with appropriate permissions.</p>

            <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> Locally defined users such as the default <span class="keyword parmname">smadmin</span> user work
                as before, after LDAP integration is enabled. User and Role Management checks for
                locally-defined users before searching LDAP.</div>

            <p class="p">LDAP Connection</p>

            <p class="p">When a user is created, User and Role Management first reads the user from external
                servers. If a user is found in any of the connected external servers, User and Role
                Management displays an error saying "user already exists". If the external servers
                are unreachable or User and Role Management is not able to authenticate the user for
                any reason (for example, LDAP password expiration), then User and Role Management
                does not allow user creation.</p>

            <p class="p">In this case, the LDAP configuration must be changed to ensure that User and Role
                Management is able to connect and authenticate the servers. Alternatively, the
                external server can be disabled temporarily, from the User and Role Management GUI,
                and local users can be configured.</p>

        </div>

        <div class="section"><h2 class="title sectiontitle">Usage notes</h2>
            
            <p class="p">Multiple Realms, Common User Database, Separate Role Mapping</p>

            <p class="p">Without LDAP, users are local to each ream. With LDAP configured for authentication
                and authorization, users are essentially common but the role assignment is still
                separate (because of the way groups are organized in LDAP). This means any user
                could login to any <span class="ph">NCC</span> realm and be authenticated, but
                they may not have assigned roles that would allow them to do much of anything. The
                enforcement of roles to allowed behaviors is defined by the various applications. In
                Service Manager, if you do not have one of the roles configured in SM, it logs you
                out immediately. In Metrics Viewer, for example, you remain logged in but have
                limited access.</p>

            <p class="p"><strong class="ph b">Synchronization of users between LDAP and User and Role Management</strong></p>

            <div class="p">User and Role Management imports user information from LDAP the first time the user
                authenticates on the realm, including the role mapping. With the default User and
                Role Management configuration, the user information (most importantly role mapping)
                is accessed locally only, so changes to role mapping in LDAP is not noticed. User
                and Role Management can be configured to synchronize user data against LDAP. In the
                User and Role Management GUI, under <span class="ph uicontrol">Realm Management &gt; User
                    Federation</span>, open the <span class="ph uicontrol">Sync Settings</span> section
                and configure the fields as desired: <ul class="ul">
                    <li class="li"><span class="ph uicontrol">Periodic Full Sync: ON</span></li>

                    <li class="li"><span class="ph uicontrol">Periodic Changed Users Sync: ON</span></li>

                    <li class="li">None (both fields set to <span class="ph uicontrol">OFF</span>)</li>

                </ul>
</div>

            <p class="p">For more information on LDAP, see the external documentation <a class="xref" href="https://www.keycloak.org/docs/latest/server_admin/#_ldap" target="_blank" rel="noopener noreferrer">Lightweight Directory Access Protocol (LDAP) and Active Directory</a>.</p>

            <p class="p">Call Flow, Flowchart, Sequence Diagram, and Pseudo code</p>

            <div class="p">This figure shows an example message flow for user <span class="keyword parmname">klop</span> who is
                logging in for the first time to SM and is authenticated by using LDAP, with role
                mapping based on LDAP group membership. <div class="fig fignone"><span class="figcap"><span class="fig--title-label">Figure: </span>LDAP call flow</span>
                    
                    <img class="image break" src="../images/ncc_oam_ldap_call_flow.png" />
                </div>

            </div>

        </div>

    </div>
<div class="footer"><hr /><p>Operations, Administration, and Maintenance Guide • P556766-DN1000055092-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>