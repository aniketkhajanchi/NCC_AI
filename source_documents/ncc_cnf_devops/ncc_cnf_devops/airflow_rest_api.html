<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Airflow automation suite REST API" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="airflow_rest_api" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Airflow automation suite REST API</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="airflow_rest_api">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Airflow automation suite REST API</h1>
<div class="body conbody">
        <p class="p">Here is given an example about triggering, monitoring and extracting the report for the
            PerformanceChargingSuite test automation suite. The same can be applied to any other
            test automation suite.</p>

        <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> To be able to run the test suite, the test automation DAGs need to be already
            generated in the Airflow UI (by setting the variables in <span class="ph menucascade"><span class="ph uicontrol">Admin</span><abbr title="and then"> → </abbr><span class="ph uicontrol">Variables</span></span>. For more information, see <a class="xref" href="enabling_dag_execution.html">Enabling DAG execution</a>.</div>

        <div class="section" id="airflow_rest_api__section_q5d_r23_zpb"><h2 class="title sectiontitle">Triggering PerformanceChargingSuite</h2>
            
            <p class="p"><strong class="ph b">Endpoint</strong>:</p>

            <p class="p"><code class="ph codeph">POST /api/experimental/dags/&lt;DAG_ID&gt;/dag_runs</code></p>

            <p class="p">where, for automation tests, <code class="ph codeph">&lt;DAG_ID&gt;</code> is the suite name.</p>

            <p class="p"><strong class="ph b">Request</strong>:</p>

            <p class="p"><code class="ph codeph">curl -X POST
                    http://xxx.xxx.xxx.xxx/api/experimental/dags/PerformanceChargingSuite/dag_runs
                    -H 'Cache-Control: no-cache' -H 'Content-Type: application/json' -d
                    '{"conf":"{\"key\":\"value\"}"}'</code></p>

            <p class="p"><strong class="ph b">Response</strong>:</p>

            <pre class="pre codeblock"><code>{
  "message": "Created &lt;DagRun PerformanceChargingSuite @ 2019-03-07 19:18:53+00:00: manual__2019-03-07T19:18:53+00:00, externally triggered: True&gt;"
}</code></pre>
        </div>

        <div class="section" id="airflow_rest_api__section_rty_3k3_zpb"><h2 class="title sectiontitle">Monitoring PerformanceChargingSuite</h2>
            
            <p class="p"><strong class="ph b">Endpoint</strong>:</p>

            <p class="p"><code class="ph codeph">GET
                    /api/experimental/dags/&lt;DAG_ID&gt;/dag_runs/&lt;string:execution_date&gt;/tasks/&lt;TASK_ID&gt;</code></p>

            <p class="p">Extract the DAG execution date from the Trigger response. In the triggering example
                above, the execution date is 2019-03-07T19:18:53+00:00. This is used in querying
                Airflow to check the task state. If the response shows the task state as
                <em class="ph i">none</em>, <em class="ph i">running</em>, <em class="ph i">scheduled</em> or <em class="ph i">queued</em>, the DAG is running.
                The other possible states are <em class="ph i">failed</em> and <em class="ph i">success</em>.</p>

            <p class="p">REST API call differs depending on whether the e-mail notification is configured or
                not:</p>

            <ul class="ul" id="airflow_rest_api__ul_x5h_cm3_zpb">
                <li class="li"><em class="ph i">e-mail notification is not configured</em><p class="p">In this case,
                            <code class="ph codeph">&lt;TASK_ID&gt;</code> is CheckPerformanceChargingSuitestats
                        (following pattern 'Check' + suitename +
                            'stats').</p>
<p class="p"><strong class="ph b">Request</strong>:</p>
<p class="p"><code class="ph codeph">curl -X GET
                            http://xxx.xxx.xxx.xxx/api/experimental/dags/PerformanceChargingSuite/dag_runs/2019-03-07T19:18:53+00:00/tasks/CheckPerformanceChargingSuitestats
                            -H 'Cache-Control: no-cache' -H 'Content-Type:
                            application/json'</code></p>
<p class="p"><strong class="ph b">Response</strong>:</p>
<pre class="pre codeblock"><code>{
  "dag_id": "PerformanceChargingSuite",
  "duration": "1.983084",
  "end_date": "2019-03-07 19:21:32.817509+00:00",
  "execution_date": "2019-03-07 19:18:53+00:00",
  "executor_config": "{}",
  "hostname": "bss-sps-production-sps-instantiate-v2892-sps-19-0-r1-sps-19-0-i",
  "job_id": "3",
  "max_tries": "0",
  "operator": "PythonOperator",
  "pid": "29309",
  "pool": "None",
  "priority_weight": "2",
  "queue": "default",
  "queued_dttm": "2019-03-07 19:21:28.902674+00:00",
  "start_date": "2019-03-07 19:21:30.834425+00:00",
  "state": "failed",
  "task_id": "CheckPerformanceChargingSuitestats",
  "test_mode": "False",
  "unixname": "root"
}</code></pre></li>

                <li class="li"><em class="ph i">e-mail notification is configured</em><p class="p">In this case,
                            <code class="ph codeph">&lt;TASK_ID&gt;</code> is
                        CheckPerformanceChargingSuiteStatsAndSendEmail (following pattern 'Check' +
                        suitename +
                            'StatsAndSendEmail').</p>
<p class="p"><strong class="ph b">Request</strong>:</p>
<p class="p"><code class="ph codeph">bash-4.2# curl
                            -X GET
                            http://xxx.xxx.xxx.xxx/api/experimental/dags/PerformanceChargingSuite/dag_runs/2019-06-14T16:24:14+00:00/tasks/CheckPerformanceChargingSuiteStatsAndSendEmail
                            -H 'Cache-Control: no-cache' -H 'Content-Type:
                            application/json'</code></p>
<p class="p"><strong class="ph b">Response</strong>:</p>
<pre class="pre codeblock"><code>{
  "dag_id":"PerformanceChargingSuite",
  "duration":"4.88262",
  "end_date":"2019-06-14 17:38:15.028036+00:00",
  "execution_date":"2019-06-14 16:24:14+00:00",
  "executor_config":"{}",
  "hostname":"maestro-19.3-155-dual",
  "job_id":"42","max_tries":"0",
  "operator":"PythonOperator",
  "pid":"651","pool":"None",
  "priority_weight":"2",
  "queue":"default",
  "queued_dttm":"2019-06-14 17:38:08.047322+00:00",
  "start_date":"2019-06-14 17:38:10.145416+00:00",
  "state":"success",
  "task_id":"CheckPerformanceChargingSuiteStatsAndSendEmail",
  "test_mode":"False",
  "unixname":"root"
}</code></pre></li>

            </ul>

        </div>

        <div class="section" id="airflow_rest_api__section_ddz_mn3_zpb"><h2 class="title sectiontitle">Extracting/viewing the report</h2>
            
            <p class="p">It is possible to extract and view the report as an HTML file, and view the test run
                history either date wise or test suite wise.</p>

            <ul class="ul" id="airflow_rest_api__ul_tgs_lp3_zpb">
                <li class="li"><em class="ph i">extracting and viewing the report as an HTML
                            file</em><p class="p"><strong class="ph b">Request</strong>:</p>
<p class="p"><code class="ph codeph">curl -X GET -L
                            http://xxx.xxx.xxx.xxx/admin/automationreports/PerformanceChargingSuite/latest/report.html</code></p>
<p class="p"><strong class="ph b">Response</strong>:</p>
<p class="p">The
                        HTML file is printed to the console.</p>
</li>

                <li class="li"><em class="ph i">viewing the test run history date wise</em><p class="p">It is possible to view the test
                        run history for all dates or only for a specific date:</p>
<ul class="ul" id="airflow_rest_api__ul_n5l_1q3_zpb">
                        <li class="li"><strong class="ph b">Endpoint</strong>
                            <em class="ph i">All Dates</em>:<p class="p"><code class="ph codeph">GET
                                    /admin/automationreports/summary</code></p>
<p class="p"><strong class="ph b">Request</strong>:</p>
<p class="p"><code class="ph codeph">curl
                                    -X GET
                                    http://xxx.xxx.xxx.xxx/admin/automationreports/summary</code></p>
<p class="p"><strong class="ph b">Response</strong>:</p>
<pre class="pre codeblock"><code>{
    "2019-08-03 21:00:40": {
        "OOBPolicySuite": {
            "app_log": "sps_logs_OOBPolicySuite.tar.gz",
            "pcap": "pcap_traces_OOBPolicySuite.tar.gz",
            "report": "report.html",
            "report_zip": "test_suite_report_OOBPolicySuite.tar.gz"
        }
    },
    "2019-08-03 21:02:17": {
        "OOBChargingSuite": {
            "app_log": "",
            "pcap": "",
            "report": "report.html",
            "report_zip": "test_suite_report_OOBChargingSuite.tar.gz"
        }
    },
    "2019-08-04 21:00:47": {
        "OOBPolicySuite": {
            "app_log": "sps_logs_OOBPolicySuite.tar.gz",
            "pcap": "pcap_traces_OOBPolicySuite.tar.gz",
            "report": "report.html",
            "report_zip": "test_suite_report_OOBPolicySuite.tar.gz"
        }
    },
    "2019-08-04 21:02:49": {
        "OOBChargingSuite": {
            "app_log": "",
            "pcap": "",
            "report": "report.html",
            "report_zip": "test_suite_report_OOBChargingSuite.tar.gz"
        }
    }
}</code></pre></li>

                        <li class="li"><strong class="ph b">Endpoint</strong>
                            <em class="ph i">Specific Date</em>:<p class="p"><code class="ph codeph">GET
                                    /admin/automationreports/summary?date=&lt;string:execution_date&gt;</code></p>
<p class="p"><strong class="ph b">Request</strong>:</p>
<p class="p"><code class="ph codeph">curl
                                    -X GET
                                    http://xxx.xxx.xxx.xxx/admin/automationreports/summary?date=2019-08-04
                                    21:02:49</code></p>
<p class="p"><strong class="ph b">Response</strong>:</p>
<pre class="pre codeblock"><code>{
    "OOBChargingSuite": {
        "app_log": "",
        "pcap": "",
        "report": "report.html",
        "report_zip": "test_suite_report_OOBChargingSuite.tar.gz"
    }
}</code></pre></li>

                    </ul>
</li>

                <li class="li"><em class="ph i">viewing the test run history suite wise</em><p class="p">It is possible to view the test
                        run history for a specific suite, and also for a specific suite and
                        date:</p>
<ul class="ul" id="airflow_rest_api__ul_xm4_xr3_zpb">
                        <li class="li"><strong class="ph b">Endpoint</strong>
                            <em class="ph i">Specific Suite</em>:<p class="p"><code class="ph codeph">curl -X GET
                                    http://xxx.xxx.xxx.xxx/admin/automationreports/summary?suite_name=OOBChargingSuite</code></p>
<p class="p"><strong class="ph b">Request</strong>:</p>
<p class="p"><code class="ph codeph">curl
                                    -X GET
                                    http://xxx.xxx.xxx.xxx/admin/automationreports/summary?date=2019-08-04
                                    21:02:49</code></p>
<p class="p"><strong class="ph b">Response</strong>:</p>
<pre class="pre codeblock"><code>{
    "2019-08-03 21:02:17": {
            "app_log": "",
            "pcap": "",
            "report": "report.html",
            "report_zip": "test_suite_report_OOBChargingSuite.tar.gz"
    },
    "2019-08-04 21:02:49": {
            "app_log": "",
            "pcap": "",
            "report": "report.html",
            "report_zip": "test_suite_report_OOBChargingSuite.tar.gz"
        }
}</code></pre></li>

                        <li class="li"><strong class="ph b">Endpoint</strong>
                            <em class="ph i">Specific Suite And Date</em>:<p class="p"><code class="ph codeph">GET
                                    /admin/automationreports/summary?suite_name=&lt;SUITE_NAME&gt;&amp;date=&lt;string:execution_date&gt;</code></p>
<p class="p"><strong class="ph b">Request</strong>:</p>
<p class="p"><code class="ph codeph">curl
                                    -X GET
                                    http://xxx.xxx.xxx.xxx/admin/automationreports/summary?suite_name=OOBChargingSuite&amp;date=2019-08-04
                                    21:02:49</code></p>
<p class="p"><strong class="ph b">Response</strong>:</p>
<pre class="pre codeblock"><code>{
 "app_log": "",
 "pcap": "",
 "report": "report.html",
 "report_zip": "test_suite_report_OOBChargingSuite.tar.gz"
}</code></pre></li>

                    </ul>
</li>

            </ul>

        </div>

    </div>
<div class="footer"><hr /><p>DevOps Guide • P556766-DN1000055058-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>