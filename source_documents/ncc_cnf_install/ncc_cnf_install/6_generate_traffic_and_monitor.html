<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Generate and monitor traffic" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="_6._generate_traffic_and_monitor" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Generate and monitor traffic</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="_6._generate_traffic_and_monitor">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Generate and monitor traffic</h1>
<div class="body conbody">
    <p class="p">Use a typical CRUD traffic for testing servicemanager and provisioning. Use N40 traffic for
      testing charging and notification.</p>

    <div class="section"><h2 class="title sectiontitle">Monitoring traffic with Kiali</h2>
      
      <div class="p"><ol class="ol">
          <li class="li">Open the Kiali console. <p class="p">The URL is in the format
                <span class="ph filepath">https://&lt;FQDN_TLS/kiali-SITE_TYPE/&gt;</span>.</p>
</li>

          <li class="li">Click on <span class="ph uicontrol">Graph</span>.</li>

          <li class="li">Select the namespace.</li>

          <li class="li">Monitor the traffic going to the original pod compared to the canary pod.</li>

        </ol>
</div>

    </div>

    <div class="section"><h2 class="title sectiontitle">Monitoring traffic with Prometheus/Metrics Viewer</h2>
      
      <p class="p">Add additional graphs in the Metrics Viewer web console. These are some example queries you
        can use to drive the graphs:</p>

      <pre class="pre codeblock"><code># Measure HTTP latency for all running instances
avg (http_average_latency_last_interval{ Status=~"20.*"}) by (instance)
 
# Measure HTTP rate for all running instances
sum by (instance)(http_rate)</code></pre>
      <p class="p">Servicemanager canary testing with CRUD traffic:</p>

      <pre class="pre codeblock"><code># To monitor Istio requests to servicemanager pods
rate(istio_requests_total{source_app=~".*ig-servicemanager.*",destination_service_name="istio-ingressgateway",response_code="200"}[3m])
 
# To monitor CPU usage of servicemanager pods
rate(container_cpu_usage_seconds_total{container=~".*ig-servicemanager.*"}[3m])
 
# To monitor memory usage of servicemanager pods
jvm_memory_pool_bytes_used{job="kubernetes-istio-secure-endpoints",kubernetes_namespace=~".*.*",app=~".*ig-servicemanager.*",pool="G1 Old Gen"}
 
# To monitor Istio CPU usage of servicemanager pods
rate(container_cpu_usage_seconds_total{name=~".*k8s_istio-proxy.*-servicemanager.*"}[5m])</code></pre>
      <p class="p">Charging canary testing with N40 5G traffic:</p>

      <pre class="pre codeblock"><code># To monitor 5G Success Rate - Podwise
sum(http_3gpp_inbound_rate{Status=~"20*"}) by (kubernetes_pod_name)
 
# To monitor 4G diameter inbound count
sum by (Result, app_kubernetes_io_instance,instance)(diameter_inbound_count)
 
# To monitor 4G diameter inbound latency
avg(diameter_inbound_average_latency_last_interval) by (RequestType,instance)
 
# To monitor CPU usage of charging pods
rate(container_cpu_usage_seconds_total{container=~".*charging.*"}[3m])
 
# To monitor memory usage of charging pods
jvm_memory_pool_bytes_used{job="kubernetes-istio-secure-endpoints",kubernetes_namespace=~".*.*",app=~".*ig-charging.*",pool="G1 Old Gen"}
 
# To monitor Istio CPU usage of charging pods
rate(container_cpu_usage_seconds_total{name=~".*k8s_istio-proxy.*-charging.*"}[5m])</code></pre>
    </div>

  </div>
<div class="footer"><hr /><p>Installation and Upgrade Guide • P556766-DN1000055103-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>