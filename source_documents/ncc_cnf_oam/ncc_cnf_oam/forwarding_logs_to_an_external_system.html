<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Forwarding logs to an external system" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="forwarding_logs_to_an_external_system" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Forwarding logs to an external system</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="forwarding_logs_to_an_external_system">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Forwarding logs to an external system</h1>
<div class="body conbody">
        <p class="p"><span class="ph">NCC</span> Telemetry can forward logs to multiple external
            locations. This functionality is achieved by using the <span class="ph uicontrol">Additional Fluentd
                Destinations</span> field of the SM/ME/IG namespace <span class="ph uicontrol">BTEL</span>
            section in the Input Generator spreadsheet. The field accepts one or more configuration
            file names that are separated by a comma or space.</p>

        <p class="p">The configuration files must be placed in the
                <span class="ph filepath">overrides/externalConfiguration/</span> directory of the Input
            Generator. After generating the charts and Helm installation, a secured channel is
            created for the external Kafka communication.</p>

        <div class="section"><h2 class="title sectiontitle">Secure communication to external Kafka</h2>
            
            <p class="p">Logs from Fluentd must be sent to an external Kafka by using a secure TCP with TLS
                mode as SIMPLE.</p>

            <p class="p">A service entry and destination rule must be created for the communication to take
                place between Kafka and Fluentd. You must provide the FQDN, protocol, and Kafka port
                in the Input Generator spreadsheet of the BTEL namespace under the
                    <span class="ph uicontrol">Service Entries</span> section. The port value must be in this
                format: <span class="keyword parmname">PROTOCOL/PORT&gt;PORT</span>.</p>

            <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> The service entry details in the Input Generator spreadsheet must be added each
                time regardless of the type of communication (for example, secure or non-secure)
                that is used between an external Kafka and Fluentd.</div>

        </div>

        <div class="section"><h2 class="title sectiontitle">Sample external Kafka configuration file</h2>
            
            <p class="p">A sample of the Fluentd configuration file
                    (<span class="ph filepath">external-kafka-config.yaml</span>) is located in the
                    <span class="ph filepath">overrides/externalConfiguration/</span> directory of the Input
                Generator. The only supported file type is YAML and it accepts a key-value pair
                format. The key is <code class="ph codeph">config</code> and the value is the <span class="ph filepath">Fluentd
                    output directive format</span> consisting of the Fluentd Kafka output plugin
                in the form of string. For valid content of the configuration file, see the Fluentd
                docs <a class="xref" href="https://docs.fluentd.org/output" target="_blank" rel="noopener noreferrer">https://docs.fluentd.org/output</a>.</p>

            <p class="p">You must provide the connection FQDN and port of the external system.</p>

            <p class="p">You can configure the <code class="ph codeph">default_topic</code> name where the Fluentd logs are
                forwarded to the external system. If you do not provide a
                    <code class="ph codeph">default_name</code> value, <code class="ph codeph">trail1</code> is used for the
                topic name.</p>

            <div class="p">This example shows a sample Fluentd configuration file.
                <pre class="pre codeblock"><code>config: |
  &lt;match nokia.logging.*.{log,log2,authlog,auditlog,subscriber-tracing,provision-tracing,auditing,legacy}&gt;
    @type copy
     &lt;store&gt;
        @type kafka2
        output_data_type json
        brokers <strong class="ph b">FQDN:9092</strong> # You must change the FQDN and port to match your configuration.
        default_topic trail1
        &lt;format&gt;
          @type json
        &lt;/format&gt; 
        &lt;buffer&gt;
          flush_mode immediate
          queued_chunks_limit_size 6
          flush_thread_count 6
          chunk_limit_size 64M
          flush_at_shutdown true
          retry_timeout 30s
          retry_max_times 5
          retry_type periodic
          timekey 3600
          overflow_action block
          total_limit_size 512m
        &lt;/buffer&gt;
      &lt;/store&gt;
      &lt;store&gt;
        @type rewrite_tag_filter
        &lt;rule&gt;
           key type
          pattern .+
          tag ${tag}.kafka
        &lt;/rule&gt;
      &lt;/store&gt;
  &lt;/match&gt;</code></pre>
            </div>

        </div>

    </div>
<div class="footer"><hr /><p>Operations, Administration, and Maintenance Guide • P556766-DN1000055092-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>