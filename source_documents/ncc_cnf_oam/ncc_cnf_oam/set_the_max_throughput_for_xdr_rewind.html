<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Set the max-throughput for xdr-rewind" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="set_the_max_throughput_for_xdr_rewind" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Set the max-throughput for xdr-rewind</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="set_the_max_throughput_for_xdr_rewind">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Set the max-throughput for xdr-rewind</h1>
<div class="body conbody">
        <div class="p">During xdr-rewind, the disaster-recovery-helper.py tool starts the rewind for three
            namespaces. For example, in case of CHF 1+1 pair or 2+2 quad, if rewind begins from
            mate/secondary ME subsystem, it starts to rewind two partitions and dscglobal, all at
            the same time. This increases the network and CPU utilization on the recovering system's
            XDR proxy and Aerospike pods.. In order to restrict this network and CPU utilization
            within the available limit, you can set the parameter <code class="ph codeph">max-throughput</code>,
            which is the number of records per second to ship via XDR. Set the parameter as per your
            network bandwidth.<div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> The default and recommended max-throughput is 10000. You must
                tune the max-throughput based on testing in your network deployment.</div>
</div>

        <p class="p">Need to run on all sits except recovering sites based on your bandwidth.</p>

        <div class="p">
            <pre class="pre codeblock" id="set_the_max_throughput_for_xdr_rewind__codeblock_gxj_2f2_4qb"><code># Restart the xdrproxy pods on the recovery system, so the replicated namespace can be restored.
## Use this command, where $XDRPROXY_DEPLOYMENT is the name of xdrproxy deployment in your installation
kubectl -n $NAMESPACE scale --replicas=1 deploy $XDRPROXY_DEPLOYMENT

# Get the value of max throughput from current system toward recovering system.
/opt/tpa/bin/db-prepare-rewind -s &lt;site-id or site-name&gt; -t ?
 
# Set the value of max throughput from current system toward recovering system.
# NOTE: you have to set max throughput For all partition
/opt/tpa/bin/db-prepare-rewind -s &lt;site-id or site-name&gt; -n &lt;namespace&gt;  -t &lt; max-throughput&gt;</code></pre>
        </div>

        <p class="p">This shows an example output.</p>

        <div class="p">
            <pre class="pre codeblock" id="set_the_max_throughput_for_xdr_rewind__codeblock_ixw_ff2_4qb"><code>[tpaadmin@nc0313me-admincli-6cd89b7d7c-zkdlw bin]$ ./db-prepare-rewind -t ? -s me5
11:26 INFO: Site name 'me5' exists with site id '5'.
11:26 INFO: Common namespaces between me5 and me7 are : ['dscglobal', 'spspd7', 'spspd5']
11:26 INFO: Getting max-throughput for namespace dscglobal between 'me7' and 'me5'.
11:26 INFO: max-throughput=100000
11:26 INFO: Getting max-throughput for namespace spspd7 between 'me7' and 'me5'.
11:26 INFO: max-throughput=100000
11:26 INFO: Getting max-throughput for namespace spspd5 between 'me7' and 'me5'.
11:26 INFO: max-throughput=100000
[tpaadmin@nc0313me-admincli-6cd89b7d7c-zkdlw bin]$

[tpaadmin@me7me-admincli-8c796745c-b5rcd /]$ /opt/tpa/bin/db-prepare-rewind -s me5 -n spspd7 -t 5000
05:51 INFO: Site name 'me5' exists with site id '5'.
05:51 INFO: Namespace 'spspd7' is common between sites 'me7' and 'me5'.
05:51 INFO: Setting max-throughput for namespace spspd7.
Seed: [('me-aerospike-service.sps-btel-me7.svc.cluster.local', 3010, '*.dyn.nesc.nokia.net')]
Config_file: /opt/tpa/users/tpaadmin/.aerospike/astools.conf, /etc/aerospike/astools.conf
me7me-aerospike-rk2-0.me-aerospike-service.sps-btel-me7.svc.cluster.local:3010 (192.168.111.18) returned:
ok

me7me-aerospike-rk2-1.me-aerospike-service.sps-btel-me7.svc.cluster.local:3010 (192.168.58.78) returned:
ok

me7me-aerospike-rk1-1.me-aerospike-service.sps-btel-me7.svc.cluster.local:3010 (192.168.62.134) returned:
ok

me7me-aerospike-rk1-0.me-aerospike-service.sps-btel-me7.svc.cluster.local:3010 (192.168.49.213) returned:
ok

[tpaadmin@me7me-admincli-8c796745c-b5rcd /]$</code></pre>
        </div>

    </div>
<div class="footer"><hr /><p>Operations, Administration, and Maintenance Guide • P556766-DN1000055092-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>