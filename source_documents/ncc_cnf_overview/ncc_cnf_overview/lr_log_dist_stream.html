<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Late rating log distributor stream" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="lr_log_dist_stream" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Late rating log distributor stream</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="lr_log_dist_stream">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Late rating log distributor stream</h1>
<div class="body conbody">
        <p class="p">Late rating log distributor stream handles records that Late rating Diameter distributor
            stream has failed to distribute, as well as the input records that the Late Rating Input
            fails to parse. When Late Rating Diameter Distributor Node fails to distribute a record,
            it saves it back into the database. The node then sends a message to a given log queue
            to notify Late Rating Log Distributor Node that it needs to pick up the failed record
            and store it to a remote location. Therefore it is important that node parameter
                <code class="ph codeph">LogQueueName</code> is set to the same value in Late Rating Diameter
            Distributor Node and Late Rating Log Distributor Node.</p>

        <div class="section" id="lr_log_dist_stream__section_lph_2vb_v4b"><h2 class="title sectiontitle">SFTP server and connection parameters</h2>
            
            <p class="p">The address of the SFTP server is configured with node parameters
                    <code class="ph codeph">SFTPHost</code> and <code class="ph codeph">SFTPPort</code>. The target directory on
                the SFTP server is defined with node parameter <code class="ph codeph">SFTPRemoteDirectory</code>.
                Authentication on the remote server is configured using node parameters
                    <code class="ph codeph">SFTPUsername</code>, <code class="ph codeph">SFTPPassword</code> and
                    <code class="ph codeph">SFTPPrivateKey</code>, which specify the local path to the private key
                file. The encryption and compression algorithms are specified with node parameters
                    <code class="ph codeph">SFTPCipher</code>, <code class="ph codeph">SFTPKex</code>, <code class="ph codeph">SFTPMac</code>
                and <code class="ph codeph">SFTPCompression</code></p>

        </div>

        <div class="section" id="lr_log_dist_stream__section_u1q_fvb_v4b"><h2 class="title sectiontitle">Format of the remote file</h2>
            
            <p class="p">Late rating log distributor stream aggregates the failed records into batches and
                stores each batch as a separate file on the SFTP server. The number of records in a
                batch is defined with Late Rating Log Distributor Node parameter
                    <code class="ph codeph">RecordsPerBatch</code>. In addition to the count rule, a (potentially
                smaller) file is generated after a specified timeout since receiving the first
                rejected record. The timeout is specified with node parameter
                    <code class="ph codeph">SecondsPerBatch</code>. Inside the files, records are stored as
                received from the input file. The files can be stored either as they are or in
                compressed format on the target host. For more information, see the <cite class="cite">Operation,
                    Administration and Maintenance Guide</cite> in the NCC documentation set.</p>

        </div>

        <div class="section" id="lr_log_dist_stream__section_m2k_hvb_v4b"><h2 class="title sectiontitle">Scaling</h2>
            
            <p class="p">Late Rating Log Distributor Node can be scaled by increasing the number of worker
                threads transferring files to the SFTP server. The number of worker threads is
                defined with node parameter <code class="ph codeph">WorkerThreads</code>. Each worker thread
                transfers a separate file and uses a separate SFTP connection.</p>

        </div>

        <div class="section" id="lr_log_dist_stream__section_pbl_1wb_v4b"><h2 class="title sectiontitle">Failover procedure</h2>
            
            <p class="p">Failed records are transferred reliably to a given remote location, which means that
                there is no data loss or duplication in case of node failure. The generation of
                duplicates is prevented using per-file and per-record locks which are stored in the
                database. If a stream holding a lock fails, the lock will expire after the timeout
                specified by node parameter <code class="ph codeph">SFTPFileTTLInProgress</code>. After the lock
                has expired, the unprocessed records in the file are processed again.</p>

        </div>

    </div>
<div class="footer"><hr /><p>Overview Guide • P556766-DN1000054925-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>