<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Secondary monetary balance" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="secondary_balance" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Secondary monetary balance</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="secondary_balance">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Secondary monetary balance </h1>
<div class="body conbody">
        <p class="p">NCC allows service providers to have a secondary monetary balance in addition to the main
            account balance. The secondary balance gets consumed before the main account balance
            irrespective of their priority. However, NCC recommends service providers to keep
            priority of secondary balance higher than main balance. The secondary balance can be
            subscribed by a bundle with no tariff/rules/rate application.</p>

        <p class="p">The main account balance is consumed only after the secondary balance is completely
            exhausted. If either the secondary balance, or main account balance is insufficient to
            fund the fee, then the fee gets deducted (depending on the Rate granularity
            configuration and Skip granularity flag settings) from a combination of secondary
            balance, and main account balance. </p>

        <p class="p">Consider the following examples to better understand this feature. </p>

        <p class="p"><strong class="ph b">Example 1</strong>: The following figure shows a case where Bob's device has two balances
            namely main and secondary balance. On execution of the call, the call cost is covered by
            consuming the money from secondary balance. In this case, the secondary balance has
            sufficient balance to fund the call.</p>

        <img class="image imageleft break" id="secondary_balance__image_cdb_ypm_1rb" src="../images/bob1.png" />
        <p class="p"><strong class="ph b">Example 2</strong>: The following figure shows a case where Bob's device has two balances
            namely main and secondary balance. On execution of the call, the call cost is covered by
            consuming the money from secondary balance followed by main balance. In this case, the
            secondary balance has insufficient balance to fund the call. Hence, a combination of
            secondary and main balance is used for funding the call.</p>

        <div class="p">
            <img class="image imageleft break" id="secondary_balance__image_vsd_mqm_1rb" src="../images/bob2.png" />
        </div>

        <div class="p">Note the following important points:<ul class="ul" id="secondary_balance__ul_e3j_npl_1rb">
                <li class="li">In the secondary balance feature implementation, the exhaustion of secondary
                    balance exhaustion and then usage of main balance depends on the configuration
                    of rate applied on the main balance with specific granularity and skip
                    granularity for low balance configuration. It also depends on these
                    configurations which may result to some money units remaining in secondary
                    balance and then movement to main balance for consumption. </li>

                <li class="li">The terms "secondary monetary balance" and "secondary balance", "main account
                    balance" and "main balance" are used interchangeably in the document.</li>

                <li class="li">The secondary balance is also known as a cost bucket, that is, money bucket. To
                    avail this feature, the device/group has to subscribe to a secondary balance
                    bundle. To create a secondary balance bundle, a service provider has to first
                    create a bucket/allowance limit and then create a charging logic/service with
                    usage_type as secondary_balance with  bucket/allowance limit that is already
                    created.  </li>

                <li class="li">The cost bucket consumption can be updated in a counter of cost type with Call
                    usage and consumption Type as ALL. However, the cost bucket consumption cannot
                    be updated in a counter with BOA activation Fee deduction for any consumption
                    Type (All/Account and Bucket). The Step Fee deductions from the cost bucket can
                    be added in the counter of cost Type and consumption Type as ALL.</li>

                <li class="li">Do not create the secondary balance in the middle of an upgrade. You can create
                    it when the upgrade is committed, that is, when the SM, ME, and database upgrade is
                    completed.</li>

                <li class="li">During the BOU bundle activation or consumption from step bucket, if the BOU
                    subscription type or Step subscription type is Device, then only the Device
                    specific secondary balances are considered for BOU Fee and Step fee
                    deduction.</li>

                <li class="li">During the BOU bundle activation or consumption from step bucket, if the BOU
                    subscription type or Step subscription type is Group, then only the Group
                    specific secondary balances are considered for BOU Fee and Step fee
                    deduction.</li>

                <li class="li">A new tag <em class="ph i">additionalBalanceInfo</em> is added in the CDRs. The
                        <em class="ph i">additionalBalanceInfo</em> tag is available only for BOU Activation on
                    commit in SCUR calls and dumps in on commit CDR. Single CDR, IEC call CDR does
                    not contain this information.</li>

                <li class="li">From the NCC GUI, this feature can be configured using the <strong class="ph b">Balances</strong>
                    entity. Service providers can mention the balance name and secondary balance
                    amount with priority as mandatory inputs. The applicability condition is
                    optional as per usecases. When a secondary balance is created from NCC UI front
                    end internally, the following configurations happen:<ul class="ul" id="secondary_balance__ul_dss_rhm_brb">
                        <li class="li">A charging logic/service is created with Usage_Type as
                            SECONDARY_BALANCE.</li>

                        <li class="li">A bucket/allowance_limit is created with secondary balance value as
                            initial value and its name as suffix.</li>

                    </ul>
For example, secondary balance as GOLDBALANCE, charging logic/service as
                    GoldBalance, Bucket/allowance limit as BalanceAllowanceLimit-GoldBalance.</li>

                <li class="li">
                    <p class="p">In case of soft/hard stop, the first resource on which the action is applied
                        is considered.</p>

                    <p class="p">For example: If soft/hard stop threshold action is applied on a counter with
                        scope as "ALL", and counter incrementation type as "Charging Service"
                        (secondary balance). Then, the first applicable resource is Secondary
                        Balance, and the next resource is the account main balance.</p>

                </li>

                <li class="li">
                    <p class="p">For sending notification in case of hard/soft stop for provisioning at
                        threshold value, send notification action should be configured in Threshold
                        Profile Group (TPG).</p>

                </li>

                <li class="li">
                    <p class="p">If the allowance bucket has higher priority than secondary Balance, then
                        allowance limit is used for consumption. When the bucket is accumulated, the
                        secondary balance is used for consumption and counter starts incrementing
                        (counter scope="ALL" &amp; counter incrementation type="Charging
                        Service"(Secondary Balance)).</p>

                </li>

                <li class="li">In case of hard stop, if an allowance bucket is added for 10 bytes and has slice
                    size of 25, minimum slice size of 15, and threshold configured at 10 money
                    absolute from start, then while executing CCR-I, 10 is reserved from allowance
                    bucket and 5 from secondary balance. While executing CCR-T, 10 is deducted from
                    allowance bucket, and 10 from secondary balance (counter value = 10). </li>

            </ul>
</div>

        <div class="section" id="secondary_balance__section_btn_qkl_1rb"><h2 class="title sectiontitle">Secondary balance applicability</h2>
            
            <div class="p">The secondary monetary balance is consumed before the main balance in following
                    cases:<ul class="ul" id="secondary_balance__ul_y4z_qdl_1rb">
                    <li class="li"><strong class="ph b">BOU Activation fees</strong>: When the <strong class="ph b">BundleOnUse</strong> type (only for BOU
                        On Commit) of bundle is activated during a call, the Bundle Activation Fee
                        is deducted from the secondary monetary balance first and then main account
                        balance. Note the following assumptions considered for secondary balance
                        implementation: <ul class="ul" id="secondary_balance__ul_bzy_cjl_1rb">
                            <li class="li">The secondary balance is supported for BOU with activation priority
                                such as ON_COMMIT. BOU on default or  ON_RESERVATION is not
                                supported for BOU Activation fee deduction from the secondary
                                balance.</li>

                            <li class="li">If the BOU fee reservations are done by multiple devices, then the
                                BOU bundle is activated when any of the device commits the
                                reservation.</li>

                            <li class="li">If the BOU fee reservation is done from a low priority secondary
                                balance bucket, and a high priority secondary balance bucket is
                                renewed/Get Balance through Update bucket Instance API before the
                                CCR-U, all the balance in high priority bucket is consumed first,
                                and the reservation of low priority bucket is cancelled.</li>

                            <li class="li">The BOU Activation fee feature supports accumulation in a counter
                                only for the configuration when the Consumption Type is ALL. But, in
                                case of secondary balance feature, whenever a BOU Activation fee is
                                deducted from the secondary balance, irrespective of whether the
                                Consumption Type is ALL, the counter is not accumulated. The BOU
                                Activation fee deducted from secondary balance with any Consumption
                                Type is not supported.</li>

                            <li class="li">The BOU fee gets committed from where it has been reserved when BOU1
                                and BOU2 activation fee have been reserved from different resources
                                (Account/Secondary Balance).</li>

                            <li class="li">When USU=0, then the reserved activation fee is reverted back and
                                BOU is not activated.</li>

                        </ul>
</li>

                    <li class="li"><strong class="ph b">Step fees</strong>: The Step fee is deducted for the step up of a step-bucket
                        from the secondary balance. Once the secondary balance is exhausted, the
                        main balance is consumed. Note the following points related to the step fee
                            reservation:<ul class="ul" id="secondary_balance__ul_zqk_hrl_1rb">
                            <li class="li">If the step fee reservation is done from a low priority secondary
                                balance bucket, and a high priority secondary balance bucket is
                                renewed before the CCR-U, the balance in high priority bucket is
                                consumed, and the reservation of low priority bucket is
                                cancelled.</li>

                            <li class="li"> If the step fee reservation is done from the Account's previous
                                values and on commit, the secondary balance has sufficient balance
                                (Renew/Get Balance through Update bucket Instance API), then step
                                fee is deducted from the secondary balance rather than Account's
                                previous values and the reservation of account (from previous
                                values) is cancelled.</li>

                            <li class="li">If the step fee reservation is done from both secondary balance and
                                Account, then during Audit, step fee is canceled in the reserve
                                order, that is, first from Account and then from secondary
                                balances.</li>

                        </ul>

                    </li>

                    <li class="li"><strong class="ph b">Call usage</strong>: If a device has a secondary monetary balance, then during
                        a call, the secondary balance is consumed first. Once the secondary balance
                        is exhausted, the main balance is consumed. When a secondary balance is used
                        as a resource, it uses the tariff (rate/tax) applied on the main balance.
                        The secondary balance is consumed before the main balance irrespective of
                        the priority of the secondary balance charging service. The secondary
                        balance behavior is same as main balance. The secondary balance is
                        considered for call usage deduction only when rate is directly applied to
                        the main balance, that is, Rate as rating action in Tariff. NCC offers many
                        other types of call rate applications/no other type RATE action, that is,
                        threshold-Rate/Threshold-NextRate/NextRate (split charging) are applicable
                        for call cost deductions from secondary balance. </li>

                    <li class="li"><strong class="ph b">Rates</strong>: For normal rate, or any special rate applied for the
                        consumption of a call request, the secondary balance is consumed before main
                        balance. Rate with a specific rate rounding factor can be applied in the
                        tariff plan, and the rounded cost is deducted from the secondary balance
                        before the main balance. The external rate can also be applied to the
                        secondary balance as per its behavior in the current NCC system. The cost
                        received as external rate gets deducted from the secondary balance first and
                        then the main balance.</li>

                    <li class="li"><strong class="ph b">Bundle fee</strong>: To use secondary balance for bundle fee, a balance should
                        be created with <em class="ph i">Applicable to fee</em> flag enabled. Secondary balance is
                        not applicable to the following:<ul class="ul" id="secondary_balance__ul_pyt_2sy_svb">
                            <li class="li">If the bundle contains a balance (secondary balance), then secondary
                                balance bundle fee is deducted from the main balance.</li>

                        </ul>
</li>

                    <li class="li"><strong class="ph b">AdjustBalance API</strong>: Secondary balance can be used through adjust
                        balance API of the account.</li>

                    <li class="li"><strong class="ph b">Discount</strong>: When the discount is applied on the step up fee and call
                        usage, the discounted cost is deducted from secondary balance first and then
                        the main balance. The discount for the call cost is the Call-Discount
                        applied on the charging logic tariff. For example, RATING.Call-Discount =
                        50.</li>

                    <li class="li"><strong class="ph b">Taxation</strong>: When the taxation is applied on the rate of a call request,
                        the tax added on the call cost is deducted from the secondary balance before
                        the main balance.</li>

                </ul>
</div>

        </div>

        <div class="section" id="secondary_balance__section_xf1_4xl_1rb"><h2 class="title sectiontitle">Notes for feature implementation</h2>
            
            <div class="note notice"><div class="noticetitle"><img src="../../web/css/../images/notice.svg" title="notice-icon" class="noteicon" />Notice:</div> The following points are considered for implementation of the
                secondary balance feature:</div>
            <div class="p">
                <ul class="ul" id="secondary_balance__ul_h3k_zbj_1rb">
                    <li class="li">The Step Fee deductions from the cost bucket can be added in the counter of
                        cost Type and Consumption Type = ALL. </li>

                    <li class="li">Discount is applied based on the value of <strong class="ph b">Use all step first</strong>
                        parameter as follows:<ul class="ul" id="secondary_balance__ul_hql_hkc_crb">
                            <li class="li">When <strong class="ph b">Use all step first = true</strong>, then if the discount bundle
                                priority configured is less than step bucket, then discount is not
                                applied. If the discount bundle priority configured is more than
                                step bucket, then discount is applied.</li>

                            <li class="li">When <strong class="ph b">Use all step first = false</strong>, then it depends on the
                                configuration of discount at pass level, irrespective of discount
                                bundle priority. If the discount is at pass0, when the step is
                                parsed at step2, and pass is at pass1, then discount is applied
                                irrespective of bundle priority. This is because, the step2 is
                                always parsed after discount, thus discount gets applied.</li>

                        </ul>

                    </li>

                    <li class="li">When the step bucket and main/secondary balance get considered at the time
                        of call consumption, then connection cost is not considered.</li>

                    <li class="li">CDRs for secondary balance are logged only at CCR_U/T for StepCommit = TRUE.
                        See CDR/EDR Reference guide for more details.</li>

                    <li class="li">AV is not supported for secondary balance in case of free deduction.</li>

                    <li class="li">The secondary balance can be subscribed by a Device or Group through Bundle
                        and the Charging logic can contain only a single MONEY BUCKET as a secondary
                        balance. This charging logic must have no tariff/rate and no thresholds
                        applied to it.</li>

                    <li class="li">The secondary balance do not have tariffs/passes/rate directly applied to
                        the secondary balance configuration.</li>

                    <li class="li">Multiple buckets cannot be defined for the secondary balance which are of
                        Money type only.</li>

                    <li class="li">Any type of counters should not be configured to accumulate consumption from
                        the secondary balance.</li>

                    <li class="li">Virtual policy counter is not supported with the secondary balance.</li>

                    <li class="li">The BOU Bundle Activation Fee deducted from the secondary balance cannot be
                        accumulated in the counters.</li>

                    <li class="li">Any type of counter or spending limit must not be configured on the cost
                        bucket. If the cost bucket is configured with a counter or spending limit,
                        it does not accumulate the following:<div class="p">
                            <ul class="ul" id="secondary_balance__ul_i3k_zbj_1rb">
                                <li class="li">Call cost to be deducted from the secondary balance (cost
                                    bucket).</li>

                                <li class="li">BOU Activation Fee deducted from the cost bucket upon the
                                    activation of BOU bundle.</li>

                                <li class="li">Discount over Step Fee/BOU Activation fee deducted from the cost
                                    bucket.</li>

                                <li class="li">Step-Up Step Fee from the cost bucket while consuming the step
                                    bucket in the call request.</li>

                                <li class="li">Call cost applied by the special rate deducted from the
                                    secondary balance.</li>

                            </ul>

                        </div>
</li>

                    <li class="li">Any limit/threshold with hard-stop, and soft-stop must not be configured
                        over the secondary balance.</li>

                    <li class="li">Throttling QoS, and Send SNR use cases must not be configured on the
                        secondary balance.</li>

                    <li class="li">Any kind of spending limits/session limits or multi-bundle counter limits in
                        different features are not considered to be evaluated for secondary
                        balance/cost bucket consumptions.</li>

                    <li class="li">Threshold/Limit with a Notification-Continue action can be applied only to
                        the secondary balance in which the consumption notification can be received
                        by the device having the secondary balance bundle. This type of use of
                        threshold to send notification when money bucket/secondary balance is
                        exhausted, that is, threshold at 100%, can be configured using REST (not
                        through NCC UI) only. Threshold is not applicable to any secondary
                        balance/bucket.</li>

                    <li class="li">Split charging, Next-Rate/surcharge, pre-rating simulation, and application
                        of granularity with or without step features cannot consume from the
                        secondary balance (cost bucket).</li>

                    <li class="li">In a tariff rule configuration, a rate can be applied without any target. It
                        is known as the global rate. However, it is restricted to be used with the
                        secondary balance. NCC supports another feature <a class="xref" href="cost_bucket_enhancement.html">Cost Bucket: As additional balance for call usage through tariff rules</a>. It is recommended to use either
                        the secondary balance feature or the other cost bucket feature. Both cannot
                        be operational together.</li>

                    <li class="li">Currently, taxation can be applied over the Step-Up fee. However, the use
                        cases to charge the Step-Fee or BOU activation fee from the secondary
                        balance must not configure the taxation feature on fee deductions. Taxation
                        cost on fee cannot be deducted from the cost bucket.</li>

                    <li class="li">The fee deductions that are not supported from the secondary balance are as
                            follows:<ul class="ul" id="secondary_balance__ul_j3k_zbj_1rb">
                            <li class="li">Renewal Fee, Renew subscription/account with Fee Action, Prorate
                                with Fee activation and refund.</li>

                            <li class="li">Fee with any APIs is not deducted from the secondary balance.</li>

                        </ul>
</li>

                    <li class="li">BOU activation fee can be deducted from the secondary balance but discount
                        cannot be applied on it.</li>

                    <li class="li">Any debit operation API, for example E-commerce APIs, debit APIs on the main
                        balance cannot be deducted from the secondary balance.</li>

                    <li class="li">The <em class="ph i">BundleOnUse</em> and Step-Up logic are applicable for reservation,
                        commit, and default. However, for this feature only step up at commit and
                        BOU at commit are supported.</li>

                    <li class="li">Split charging functionality is not supported for the secondary
                        balance.</li>

                    <li class="li">Rate as per threshold and split charging with next threshold rate feature
                        (ThresholdRate/Threshold.NextRate) is not supported for the secondary
                        balance.</li>

                    <li class="li">The secondary balance bundle, that is, a bundle containing a secondary
                        balance charging logic with a money bucket cannot be subscribed as a BOU
                        bundle.</li>

                    <li class="li">The secondary balance bundle, that is, a bundle containing a secondary
                        balance charging logic with a money bucket cannot be subscribed as a Step Up
                        bundle. The secondary balance cannot be a tiered allowance or a step up
                        bucket.</li>

                </ul>

            </div>

        </div>

        <div class="section" id="secondary_balance__section_m1r_stl_1rb"><h2 class="title sectiontitle">Configuration</h2>
            
            <div class="p">Note the following important points related to secondary balance configuration:<ul class="ul" id="secondary_balance__ul_fhj_5yt_1rb">
                    <li class="li">To avail a secondary balance, service provide must create a bundle which is
                        a secondary balance. This bundle must contain a charging logic (charging
                        service) which is configured as a type <em class="ph i">secondary balance</em>. </li>

                    <li class="li">Service provider must create a charging logic with ENUM as
                        usageType:"SECONDARY_BALANCE" with a single money bucket. NCC determines the
                        resource in this charging logic as a secondary balance. Note that this
                        resource must be a Money type bucket only and do not have any charging
                        tariff plans.</li>

                    <li class="li">The bundle contains a charging logic of type Secondary_Balances. This
                        charging logic can have an applicability condition and priority across
                        charging logic.</li>

                    <li class="li">The charging logic contains only a single money type bucket.</li>

                    <li class="li">This charging logic does not contain definition of any tariff/charging
                        rules/pass/multi-pass/fall back rules.</li>

                    <li class="li">There is no selection of this Money Type bucket anywhere in the rule
                        configuration.</li>

                    <li class="li">To use secondary balance for bundle fee, a balance should be created with
                            <em class="ph i">Applicable to fee</em> flag enabled.</li>

                    <li class="li">Secondary balance should be created in a separate bundle. It should not be
                        combined with other charging logics.</li>

                    <li class="li">Secondary balance bundle can be renewed using the lifecycle action
                            <em class="ph i">RenewSecondaryBalanceSubscriptionAction</em>. It has the following
                            events:<ul class="ul" id="secondary_balance__ul_n3c_ttk_swb">
                            <li class="li">SecondaryBalanceSubscriptionRenewedEvent</li>

                            <li class="li"> NotEnoughFundsForSecondaryBalanceEvent </li>

                        </ul>
<p class="p">The secondary balance bundle renewal fee is deducted only from the
                            main balance. Renewal fee for normal bundles is deducted from the
                            secondary balance, if subscribed. Fee from the secondary balance is
                            deducted only if the secondary balance parameter <em class="ph i">Applicable for
                                fee</em> is enabled. If secondary balances are insufficient for
                            renewal of normal bundles, then main balance is used to fund the
                            remaining amount required for the renewal of normal bundles.</p>
</li>

                </ul>
Perform the following steps to create a secondary balance:<ol class="ol" id="secondary_balance__ol_nqh_nbm_1rb">
                    <li class="li">In the Charging configurator, create a secondary balance. Note that you must
                            <strong class="ph b">PUBLISH</strong> the record to an ME.<div class="fig fignone" id="secondary_balance__fig_w1w_zbm_1rb"><span class="figcap"><span class="fig--title-label">Figure: </span>Secondary balance</span>
                            
                        </div>
<a href="../images/secondary_balance12.png" class="image"><img class="image break scalefit" id="secondary_balance__image_kr5_zdm_1rb" src="../images/secondary_balance12.png" /></a>
                    </li>

                    <li class="li">Create a charging logic (charging service) using API with ENUM as
                            <strong class="ph b">usageType:SECONDARY_BALANCE</strong> with a single money bucket. NCC
                        determines the resource in this charging logic as a secondary balance.<div class="note" id="secondary_balance__note_vrx_ttk_swb"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> A single money type of bucket can be added in this
                            charging logic without threshold and counter. </div>
<p class="p">When a charging
                            logic is created using GUI, a bucket is automatically created. However,
                            while provisioning through API, a bucket definition must be created
                            first and then a charging logic of secondary balance type must be
                            created.</p>
</li>

                    <li class="li">Create a bundle (services) that contains a charging logic (charging service)
                        of type secondary_Balance. This charging logic can have applicability
                        condition and priority. The charging logic contains a single money type
                        bucket. No tariff or charging rules or pass or multi-pass or fall back rules
                        are defined in this charging logic. You can select the secondary balance
                        under the <strong class="ph b">Logics</strong> option.<div class="p">
                            <a href="../images/secondary_balance2.png" class="image"><img class="image break scalefit" id="secondary_balance__image_egj_pdm_1rb" src="../images/secondary_balance2.png" /></a>
                        </div>
</li>

                </ol>
<div class="note" id="secondary_balance__note_wrx_ttk_swb"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> 
                    <ul class="ul" id="secondary_balance__ul_twm_hr3_zqb">
                        <li class="li">The secondary balance (cost-bucket) is applied based on the charging
                            service priority, and applicability conditions. Secondary balance bundle
                            is of the highest priority but with no Pass/Tariff rules.</li>

                        <li class="li">Cost buckets must respect the priority of the bundles with rates, step
                            buckets, and BOU Activation Fee.</li>

                        <li class="li">The cost bucket follows the lifecycle of the bundle.</li>

                    </ul>

                </div>
</div>

        </div>

        <div class="section" id="secondary_balance__section_phn_n2m_1rb"><h2 class="title sectiontitle">Examples</h2>
            
            
        </div>

        <div class="section" id="secondary_balance__section_awn_42m_1rb"><h2 class="title sectiontitle">Case 1: BOU Activation Fee is charged from the
                secondary balance for parallel calls of device</h2>In this case, the BOU
            activation fee gets deducted successfully when the Device1 reserves BOU fees from the
            secondary balance, but the commit for Device2 comes prior to the Device1.<p class="p">Following is
                the configuration needed for this use case.</p>
<ol class="ol" id="secondary_balance__ol_kn1_fpy_1rb">
                <li class="li">Enable the application preferences - BOU Activation Priority, BOU Activation Fee
                    enabled for CDR, Granularity skip for low balance, and EDR Generation Flag.</li>

                <li class="li">Create a periodic lifecycle for BOU Bundle with <em class="ph i">Charge Fee Action Success</em>
                    event, <em class="ph i">Account Reservation Success</em> event, and <em class="ph i">Account Commit
                        Success</em> event.</li>

                <li class="li">Create a CS1 having secondary balance of SB15, cost bucket value of 15, and
                    priority as 1.</li>

                <li class="li">Create an Allowance Limit of type Byte with a value of 100 Bytes.</li>

                <li class="li">Create a CS2 having a Data Allowance Limit of value 100 Bytes.</li>

                <li class="li">Create Bundle1 having Secondary Balance of SB15.</li>

                <li class="li">Create Bundle2 having CS2 with bundle fee as 10, Activation Type as <em class="ph i">On
                        Use</em>, Activation Fee of 15, and Activation Event as
                        <em class="ph i">CallActivationEvent</em>.</li>

                <li class="li">Create an Account with Balance of 100.</li>

                <li class="li">Create a device D1, and device D2 with the Subscription Index as Group.</li>

                <li class="li">Attach the Bundle1, and Bundle2 to the Group.</li>

                <li class="li">Attach Device D1, and Device D2 to the Group.</li>

            </ol>
<div class="p">Configure the following ME application preferences:<ul class="ul" id="secondary_balance__ul_j1b_sgw_ptb">
                    <li class="li">Set <em class="ph i">BOU Activation Priority</em> to <em class="ph i">ON_COMMIT</em>.</li>

                    <li class="li">Set <em class="ph i">BOU Activation fee enabled in CDR</em> to <em class="ph i">true</em>.</li>

                    <li class="li">Set <em class="ph i">GRANULARITY SKIP FOR LOW BALANCE</em> to <em class="ph i">true</em>.</li>

                    <li class="li">Set <em class="ph i">EDR Generator Flag</em> to <em class="ph i">true</em>.</li>

                </ul>
<div class="note" id="secondary_balance__note_fpr_jfw_ptb"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> For details on configuring the ME application
                    preferences, see <em class="ph i">Managed Elements</em> section in <em class="ph i">Global Configuration
                        Guide</em>.)</div>
</div>
<p class="p"><img class="image" id="secondary_balance__image_ffr_m4n_zqb" height="192" src="../images/cost_bucket_config_u21.png" width="576" /><img class="image" id="secondary_balance__image_j4d_p4n_zqb" height="192" src="../images/cost_bucket_config_u22.png" width="576" /><img class="image" id="secondary_balance__image_s31_r4n_zqb" height="192" src="../images/cost_bucket_config_u23.png" width="576" /><img class="image" id="secondary_balance__image_iyx_s4n_zqb" height="192" src="../images/cost_bucket_config_u24.png" width="576" /><img class="image" id="secondary_balance__image_mgs_54n_zqb" height="192" src="../images/cost_bucket_config_u25.png" width="576" /><img class="image" id="secondary_balance__image_hyl_w4n_zqb" height="192" src="../images/cost_bucket_config_u26.png" width="576" /></p>
<p class="p">Following is the Group Overview which shows that
                the Group has two devices attached to it. The Secondary balance bundle has 15.00
                Money in it and a BOU bundle has a data bucket of 100 Bytes. The state of the BOU
                bundle is PreActive.</p>
<p class="p"><img class="image" id="secondary_balance__image_x2n_z4n_zqb" height="192" src="../images/cost_bucket_config_u27.png" width="576" /></p>
<p class="p">
                <img class="image" id="secondary_balance__image_hzk_bpn_zqb" height="192" src="../images/cost_bucket_config_u28.png" width="576" /></p>
<p class="p">When a call is executed (SCUR-I)
                from Device1 with RSU=10, then the BOU Activation Fee of 15 is reserved from cost
                bucket. The value of cost bucket becomes 0. The value 10 is reserved from the
                allowance limit. The BOU bundle state is still <strong class="ph b">PreActive</strong> as the fee is not
                yet deducted.</p>
<a href="../images/d1_bou1.png" class="image"><img class="image break scalefit" id="secondary_balance__image_zfq_yxy_1rb" src="../images/d1_bou1.png" /></a><p class="p">When a call is executed
                (SCUR-I) from Device2 with RSU=20, the reservation is done from data bucket only.
                The BOU Activation Fee is not reserved since its already reserved from Device1. The
                total reservation is D1(10)+D2(20) = 30, and allowance limit = 70.</p>
<a href="../images/d2_bou2.png" class="image"><img class="image break scalefit" id="secondary_balance__image_zcq_hyy_1rb" src="../images/d2_bou2.png" /></a><p class="p">When SCUR-U is received for Device 2 with USU=20, RSU=5, then it commits 20
                units and the activation fee also gets committed. The BOU bundle state becomes
                    <strong class="ph b">Active</strong> The total reservation is D1(10)+D2(5) = 15, allowance limit =
                65(80-15). </p>
<a href="../images/d2_scur_u.png" class="image"><img class="image break scalefit" id="secondary_balance__image_ayj_pzy_1rb" src="../images/d2_scur_u.png" /></a><p class="p">When the SCUR-U for Device
                1 is received with USU=10, RSU=10, it commits 10 and reserves 10.</p>
<a href="../images/d1_scur_u.png" class="image"><img class="image break scalefit" id="secondary_balance__image_l53_rzy_1rb" src="../images/d1_scur_u.png" /></a><p class="p">When the SCUR-T for Device 1 is received with USU = 20,
                it commits 20 units. </p>
<a href="../images/d1_scur_t.png" class="image"><img class="image break scalefit" id="secondary_balance__image_v1n_b1z_1rb" src="../images/d1_scur_t.png" /></a><p class="p">SCUR-T for Device2 is
                received with USU = 10, it commits 10 units. The commits happen from the data
                bucket.</p>
<div class="p">
                <a href="../images/d2_scur_t.png" class="image"><img class="image break scalefit" id="secondary_balance__image_pbq_c1z_1rb" src="../images/d2_scur_t.png" /></a>
            </div>
<div class="p">Following is the result of this use case:<ol class="ol" id="secondary_balance__ol_e5q_5kz_1rb">
                    <li class="li">At SCUR-I for Device1, the Activation fee is reserved from the secondary
                        balance.</li>

                    <li class="li">At SCUR-U for Device2, the Activation fee is deducted from the secondary
                        balance.</li>

                    <li class="li">The BOU bundle gets activated on Commit and the periodic state is changed
                        from <strong class="ph b">PreActive</strong> to <strong class="ph b">Active</strong>.</li>

                </ol>
</div>
</div>

        <div class="section" id="secondary_balance__section_rdh_r2m_1rb"><h2 class="title sectiontitle">Case 2: Secondary balance is charged for Step Fee deduction on Step up before
                charging from the main balance</h2>
            
            <div class="p"><ul class="ul" id="secondary_balance__ul_l4y_5n4_zqb">
                    <li class="li">Create a rate object as follows:<p class="p">Name = RatePS , RateType = Byte ,
                            Granularity Level = Byte, Cost/Quantity = 3/1 B, Step Size = 0 KB,
                            Connection Cost = 2.</p>
</li>

                    <li class="li">Create two step buckets having the following values:<p class="p">Name = stepbucket1,
                            step1 = step size 20, step2 = step size 12 and step fee 7, step3 =
                            stepsize 6 and step fee 8, step4 = stepsize 6 and step fee
                            5​.</p>
<p class="p">Name = stepbucket2 , step1 = step size 12, step2 = stepsize 6
                            and step fee 8, step3 = stepsize 6 and step fee 5.​</p>
</li>

                    <li class="li">Create three charging services (CS). CS1 should have a step bucket
                        (stepbucket1) applied at pass0 with a priority of 3000. Step bucket is
                        picked based on the <em class="ph i">3GPP_GGSN_MCC_MNC</em> value.</li>

                    <li class="li">CS2 (CSStepBucketwithMainBalance) should have a step bucket (stepbucket2)
                        along with the main balance. StepBucket2 is applied at pass2, and the main
                        balance is applied in another branch of pass2 with a priority of 20000.</li>

                    <li class="li">Create a secondary balance (SB) with the value of money ​as 50, and priority
                        as 200.</li>

                    <li class="li">Create three bundles (bundle1, bundle2, and bundle3) having CS1,
                        CSStepBucketwithMainBalance, and secondary balance (SB) respectively.</li>

                    <li class="li">Create an account, and device object.</li>

                    <li class="li">Create a group object having three subscriptions with all the three
                        bundles.</li>

                    <li class="li">Set the application preference <span class="ph uicontrol">Step-Up On Commit</span> to
                        true.</li>

                </ul>
<a href="../images/cost_bucket_config_uc41.png.jpg" class="image"><img class="image scalefit" id="secondary_balance__image_ojb_qt4_zqb" height="192" src="../images/cost_bucket_config_uc41.png.jpg" width="576" /></a><a href="../images/cost_bucket_config_uc42.png.jpg" class="image"><img class="image scalefit" id="secondary_balance__image_zcn_st4_zqb" height="192" src="../images/cost_bucket_config_uc42.png.jpg" width="576" /></a><a href="../images/cost_bucket_config_uc43.png.jpg" class="image"><img class="image scalefit" id="secondary_balance__image_qmq_f54_zqb" height="192" src="../images/cost_bucket_config_uc43.png.jpg" width="576" /></a><a href="../images/cost_bucket_config_uc44.png.jpg" class="image"><img class="image scalefit" id="secondary_balance__image_tm3_k54_zqb" height="192" src="../images/cost_bucket_config_uc44.png.jpg" width="576" /></a><a href="../images/cost_bucket_config_uc45.png.jpg" class="image"><img class="image scalefit" id="secondary_balance__image_w1f_n54_zqb" height="192" src="../images/cost_bucket_config_uc45.png.jpg" width="576" /></a><a href="../images/cost_bucket_config_uc46.png.jpg" class="image"><img class="image scalefit" id="secondary_balance__image_u2t_p54_zqb" height="192" src="../images/cost_bucket_config_uc46.png.jpg" width="576" /></a><a href="../images/cost_bucket_config_uc47.png" class="image"><img class="image scalefit" id="secondary_balance__image_yv3_t54_zqb" height="192" src="../images/cost_bucket_config_uc47.png" width="576" /></a><a href="../images/cost_bucket_config_uc48.png" class="image"><img class="image scalefit" id="secondary_balance__image_m42_w54_zqb" height="192" src="../images/cost_bucket_config_uc48.png" width="576" /></a><a href="../images/cost_bucket_config_uc49.png" class="image"><img class="image scalefit" id="secondary_balance__image_dwm_y54_zqb" height="192" src="../images/cost_bucket_config_uc49.png" width="576" /></a><a href="../images/cost_bucket_config_uc50.png" class="image"><img class="image scalefit" id="secondary_balance__image_mc5_1v4_zqb" height="192" src="../images/cost_bucket_config_uc50.png" width="576" /></a><a href="../images/cost_bucket_config_uc51.png" class="image"><img class="image scalefit" id="secondary_balance__image_dmj_fv4_zqb" height="192" src="../images/cost_bucket_config_uc51.png" width="576" /></a><a href="../images/cost_bucket_config_uc52.png" class="image"><img class="image scalefit" id="secondary_balance__image_pms_hv4_zqb" height="192" src="../images/cost_bucket_config_uc52.png" width="576" /></a><a href="../images/cost_bucket_config_uc53.png" class="image"><img class="image scalefit" id="secondary_balance__image_ewj_lv4_zqb" height="192" src="../images/cost_bucket_config_uc53.png" width="576" /></a><a href="../images/cost_bucket_config_uc54.png" class="image"><img class="image scalefit" id="secondary_balance__image_axc_mv4_zqb" height="192" src="../images/cost_bucket_config_uc54.png" width="576" /></a><a href="../images/cost_bucket_config_uc55.png.jpg" class="image"><img class="image scalefit" id="secondary_balance__image_ihh_rv4_zqb" height="192" src="../images/cost_bucket_config_uc55.png.jpg" width="576" /></a><a href="../images/cost_bucket_config_uc56.png" class="image"><img class="image scalefit" id="secondary_balance__image_vlx_rv4_zqb" height="192" src="../images/cost_bucket_config_uc56.png" width="576" /></a><a href="../images/cost_bucket_config_uc57.png.jpg" class="image"><img class="image scalefit" id="secondary_balance__image_qk4_vv4_zqb" height="192" src="../images/cost_bucket_config_uc57.png.jpg" width="576" /></a><a href="../images/cost_bucket_config_uc58.png" class="image"><img class="image scalefit" id="secondary_balance__image_rqf_wv4_zqb" height="192" src="../images/cost_bucket_config_uc58.png" width="576" /></a></div>

        </div>

        <div class="section" id="secondary_balance__section_wx3_g2f_swb"><h2 class="title sectiontitle">Exhaust secondary balances (SB) before main balance (MB)</h2>
            
            
            <p class="p">When a secondary balance does not have enough credit for the call types - <em class="ph i">SMS
                    IEC</em>, <em class="ph i">eCommerce</em>, data, and voice, NCC deducts the available balance
                from the secondary balance and the remaining from other available secondary balances
                or main balance. The secondary balance (<strong class="ph b">SB</strong>) resources are exhausted for a
                call even if there is not enough balance in the secondary balance resource to charge
                for the defined granularity. Once the highest priority defined secondary balance is
                exhausted then further deduction is allowed from next priority order secondary
                balance (SB) and main balance (<strong class="ph b">MB</strong>).</p>

            <p class="p">If the account and secondary balance together have sufficient combined balance to
                charge a direct debit/SCUR call, then the applicable call types (<em class="ph i">SMS IEC</em>,
                    <em class="ph i">eCommerce</em>, data, and voice) are successful. If secondary balance is low,
                then secondary balance is exhausted first and the rest is charged from the main
                balance.</p>

            <div class="div"><strong class="ph b">Examples with SB and MB</strong></div>
            <div class="p">For the multiple resources like secondary balance and main balance the call would be
                charged as shown in the screen shots:<div class="fig fignone" id="secondary_balance__fig_ghw_phf_swb"><span class="figcap"><span class="fig--title-label">Figure: </span>Rate</span>
                    
                    <div class="p">
                        <div class="fig fignone" id="secondary_balance__fig_clg_2fm_swb">
                            <img class="image break" id="secondary_balance__image_zbm_kyp_swb" height="144" src="../images/sb_rate1.png" width="480" />
                        </div>

                    </div>

                    <div class="p">
                        <div class="fig fignone" id="secondary_balance__fig_xs3_nfm_swb"><span class="figcap"><span class="fig--title-label">Figure: </span>Charging Logic</span>
                            
                            <img class="image imageleft break" id="secondary_balance__image_x2j_4yp_swb" height="192" src="../images/sb_chlogic2.png" />
                            <a href="../images/sb_bundle2.png" class="image"><img class="image break scalefit" id="secondary_balance__image_cvd_pyp_swb" height="192" src="../images/sb_bundle2.png" /></a>
                        </div>

                    </div>

                    <p class="p">Below details multiple secondary balance with their associated values and
                        priority order for a device. </p>

                    <p class="p">Scenario1: SB1-0.2, SB2-10, SB3-10 MB-10 Priority: SB1&gt; SB2&gt; SB3</p>

                    <div class="p">
                        <div class="fig fignone" id="secondary_balance__fig_r35_pfm_swb">
                            <a href="../images/before_call_account.png" class="image"><img class="image break scalefit" id="secondary_balance__image_oy2_typ_swb" src="../images/before_call_account.png" /></a>
                        </div>

                    </div>

                    <p class="p">For a direct debit call on this device with RSU-1, the call is charged across
                        multiple secondary balance in the defined priority order exhausting the top
                        priority items in the list.</p>

                    <div class="p">
                        <div class="fig fignone" id="secondary_balance__fig_ghm_mfm_swb">
                            <a href="../images/sb_call1_with_rsu1.png" class="image"><img class="image break scalefit" id="secondary_balance__image_gs2_5yp_swb" src="../images/sb_call1_with_rsu1.png" /></a>
                        </div>

                    </div>

                </div>
</div>

            <p class="p">Note the following points about this feature:</p>

            <ul class="ul" id="secondary_balance__ul_x3d_43f_swb">
                <li class="li">This feature is applicable only for the SB and not any other resource types. </li>

                <li class="li">This feature is applicable only to direct debit calls, data calls, and voice
                    calls.</li>

                <li class="li">This feature works as expected only with counter thresholds.</li>

                <li class="li"><em class="ph i">Next-Rate</em>, <em class="ph i">Threshold-Rate </em>and <em class="ph i">Threshold-Next-Rate</em> actions
                    in rules do not work currently with SB. <em class="ph i">Though Rate</em> and
                        <em class="ph i">Tiered-Rate</em> work as expected.</li>

                <li class="li">This is <em class="ph i">enabled</em> by default and cannot be controlled by any flag.</li>

                <li class="li">There is a consideration for <em class="ph i">Tiered Rate</em> with <em class="ph i">Primary</em> and
                        <em class="ph i">Secondary Rate</em> defined.<ul class="ul" id="secondary_balance__ul_ksg_nlf_swb">
                        <li class="li">It may not be able to use the equal granularity unit of both the primary
                            and secondary rate from SB. A little balance might be left in the
                            secondary balance SB1, and the remaining consumption for the call might
                            be charged from subsequent SB or MB.</li>

                        <li class="li">This remaining balance SB1 can be exhausted in further calls. </li>

                    </ul>
</li>

                <li class="li">Step size should be defined as multiples of granularity for a step. Defining
                    other values for step size can result in difference in cost while charging from
                    main balance only, and charging from secondary balance and main balance.</li>

                <li class="li">The fixed fees for a step is charged only from a single secondary balance or
                    main balance. It cannot be split across multiple secondary balances or main
                    balances.</li>

                <li class="li">GSU is granted in multiples of granularity.<p class="p">For example: Rate is defined as 1
                        Money for 10MB with a granularity of 10MB, and skip granularity flag is OFF.
                        If secondary balance and main balance combined are sufficient to charge for
                        15MB, then for an RSU of 20MB, 15MB is reserved for the call with GSU of
                        10MB (multiples of granularity). The remaining 5MB is released in the
                        following update or terminate call.</p>
</li>

            </ul>

        </div>

    </div>
<div class="footer"><hr /><p>Charging User Guide • P556766-DN1000054947-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>