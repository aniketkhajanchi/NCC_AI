<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="task" />
<meta name="DC.title" content="Replicating dscglobal namespace on a new networked pair of ME subsystems" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="replicating_dscglobal_namespace_on_new_mes" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Replicating dscglobal namespace on a new networked pair of ME subsystems</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="replicating_dscglobal_namespace_on_new_mes">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Replicating dscglobal namespace on a new networked pair of ME subsystems</h1>
<div class="body taskbody">
        <div class="section context"><div class="tasklabel"><h2 class="sectiontitle tasklabel"></h2></div>
            <p class="p">This procedure provides instructions on how to replicate the dscglobal namespace on
                the new ME subsystems so that the dscglobal namespace is shared between the two
                networked pairs of 1+1 ME subsystems. In this procedure, ME3 and ME4 are the new
                pair that is added to the existing ME1 and ME2 pair. </p>

            <p class="p">This figure shows dscglobal data replication between the two networked pairs of 1+1
                ME subsystems when this procedure succeeds.</p>

            <div class="fig fignone" id="replicating_dscglobal_namespace_on_new_mes__fig_xzj_spn_1qb"><span class="figcap"><span class="fig--title-label">Figure: </span>dscglobal data replication between two networked pairs of 1+1 ME
                    subsystems</span>
                
                <img class="image imagecenter break" id="replicating_dscglobal_namespace_on_new_mes__image_yzj_spn_1qb" src="../images/cnf_install_dscglobal_replication_between_two_networked_pairs.png" height="182" width="299" />
            </div>

            <p class="p">This procedure uses <code class="ph codeph">db-prepare-rewind</code>, <code class="ph codeph">db-rewind</code>,
                and <code class="ph codeph">db-check-rewind-status</code> tools. You can use these tools to debug
                the steps in this procedure. For more information about these tools, see the
                    <cite class="cite">Operation, Administration, and Maintenance Guide</cite>.</p>

        </div>

        <div class="tasklabel"><h2 class="sectiontitle tasklabel"></h2></div><ol class="ol steps"><li class="li step stepexpand">
                <span class="ph cmd">On ME1, remove the association for the dscglobal namespace for both new ME
                    subsystems, or ME3 and ME4:</span>
                <div class="itemgroup info">
                    <div class="p">From the <code class="ph codeph">admincli</code> pod, do the following:<ol class="ol" type="a" id="replicating_dscglobal_namespace_on_new_mes__ol_ynm_hrn_1qb">
                            <li class="li">For the first ME in the new pair,
                                enter:<pre class="pre codeblock"><code>kubectl exec -it &lt;&lt;admincli&gt;&gt; -n &lt;&lt;namespace&gt;&gt; -c &lt;application_main_container&gt; -- /opt/tpa/bin/db-prepare-rewind -s &lt;&lt;site id of first Growth ME&gt;&gt; -n dscglobal</code></pre></li>

                            <li class="li">For the second ME in the new pair,
                                    enter:<pre class="pre codeblock"><code>kubectl exec -it &lt;&lt;admincli&gt;&gt; -n &lt;&lt;namespace&gt;&gt; -c &lt;application_main_container&gt; -- /opt/tpa/bin/db-prepare-rewind -s &lt;&lt;site id of Second Growth ME&gt;&gt; -n dscglobal
</code></pre><p class="p">where the argument for <code class="ph codeph">-s</code> option
                                    is the ID of the remote ME subsystem as it appears in the
                                    topology data section (SPS site ID in the
                                        <span class="ph filepath">Inputs.xlsx</span>).</p>
</li>

                        </ol>
</div>

                    <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> This step prevents the updates on ME1 from reaching ME3 and ME4 allowing
                        you to keep empty the database of the new ME subsystems until you do the
                        rewind.</div>

                </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Rewind from ME1 to ME3 by entering:</span>
                <div class="itemgroup info">
                    <pre class="pre codeblock"><code>kubectl exec -it &lt;&lt;admincli&gt;&gt; -n &lt;&lt;namespace&gt;&gt; -c &lt;application_main_container&gt; -- /opt/tpa/bin/db-rewind -s 3 -n dscglobal</code></pre>
                    <p class="p">where the argument for <code class="ph codeph">-s</code> option is the ID of the remote ME
                        subsystem as it appears in the topology data section (SPS site ID in the
                            <span class="ph filepath">Inputs.xlsx</span>).</p>

                    <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> This step updates the XDR configuration for ME1 by adding the dscglobal
                        namespace. It also enables forwarding from ME1 to ME3, which means that
                        updates from ME2 to ME1 also go to ME3.</div>

                </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">On ME1, check the rewind status as follows:</span>
                <div class="itemgroup info"><div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> In a testing environment, the rewind for one million subscribers takes
                        five minutes. The duration of the rewind depends on the environment and
                        amount of data and will vary. Database rewind must be repeated if it does
                        not complete.</div>
From the <code class="ph codeph">admincli</code> pod,
                        enter:<pre class="pre codeblock"><code>kubectl exec -it &lt;&lt;admincli&gt;&gt; -n &lt;&lt;namespace&gt;&gt; -c &lt;application_main_container&gt; -- /opt/tpa/bin/db-check-rewind-status -s 3 -r 20
</code></pre><p class="p">where:</p>
<ul class="ul" id="replicating_dscglobal_namespace_on_new_mes__ul_arp_pj4_1qb">
                        <li class="li">The argument for <code class="ph codeph">-s</code> option is the ID of the remote ME
                            subsystem as it appears in the topology data section (SPS ID in the
                                <span class="ph filepath">Inputs.xlsx</span> file).</li>

                        <li class="li">The value of <code class="ph codeph">-r</code> is the maximum number of times that the
                            script checks the rewind status before exiting.</li>

                    </ul>
<div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> When the rewind completes, it then starts processing the in-memory
                        queue that has built up with writes, both locally and from cluster ME2,
                        during the rewind.</div>
</div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd"> If the rewind does not complete within a reasonable amount of time or the
                    script fails because one of the aerospike pods goes down during the rewind, do
                    the following: </span>
                <div class="itemgroup info">
                    <ol class="ol" type="a" id="replicating_dscglobal_namespace_on_new_mes__ol_gx3_hl4_1qb">
                        <li class="li">Identify the cause of failure and address the issue.</li>

                        <li class="li">Prepare for the rewind again by
                            entering:<pre class="pre codeblock"><code>kubectl exec -it &lt;&lt;admincli&gt;&gt; -n &lt;&lt;namespace&gt;&gt; -c &lt;application_main_container&gt; -- /opt/tpa/bin/db-prepare-rewind-me -s 3</code></pre></li>

                        <li class="li">Do the rewind again, as in step 2. </li>

                        <li class="li">If the rewind does not succeed, contact Nokia Technical Support
                            Team.</li>

                    </ol>

                </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">Once the rewind from ME1 to ME3 is completed, rewind from ME1 to ME4 by
                    entering:</span>
                <div class="itemgroup info">
                    <pre class="pre codeblock"><code>kubectl exec -it &lt;&lt;admincli&gt;&gt; -n &lt;&lt;namespace&gt;&gt; -c &lt;application_main_container&gt; -- /opt/tpa/bin/db-rewind -s 4 -n dscglobal</code></pre>
                    <p class="p">where the argument for <code class="ph codeph">-s</code> option is the ID of the remote ME
                        subssytem as it appears in the topology data section (SPS site ID in the
                            <span class="ph filepath">Inputs.xlsx</span>).</p>

                    <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> This step configures XDR by adding the dscglobal namespace for ME4. It
                        also enables forwarding from ME1 to ME4, which means that updates from ME2
                        also go to ME4.</div>

                </div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">On ME1, check the status of the rewind to ME4 as described in step 3.</span>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">After the rewind is complete, for all new ME subsystems, disable forwarding of
                    XDR by entering:</span>
                <div class="itemgroup info">For each ME in the new pair,
                    enter:<pre class="pre codeblock"><code>kubectl exec -it &lt;admincli&gt; -n &lt;namespace&gt; -- /opt/tpa/bin/db-prepare-rewind -s &lt;&lt;site Id of ME's&gt;&gt; -n dscglobal -f

</code></pre></div>
            </li>
<li class="li step stepexpand">
                <span class="ph cmd">If this is the last new networked pair of ME subsystems that you are adding to
                    the deployment, go back to step 7 in the procedure <a class="xref" href="adding_networked_pairs_of_1_1_mes.html">Adding networked pairs of 1+1 ME subsystems</a> and complete that
                    procedure.</span>
            </li>
</ol>

    </div>
<div class="footer"><hr /><p>Installation and Upgrade Guide • P556766-DN1000055103-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>