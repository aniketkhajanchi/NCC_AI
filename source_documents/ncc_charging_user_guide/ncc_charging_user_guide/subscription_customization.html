<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Subscription customization" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="id9yz-09126-ug01-pczza-sp1-d1e194903" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Subscription customization</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="id9yz-09126-ug01-pczza-sp1-d1e194903">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Subscription customization</h1>
<div class="body conbody">
        <div class="section">
            <p class="p">Subscription customization (template) provides the following capabilities:</p>

            <ul class="ul">
                <li class="li">While attaching a subscription to a device or group, the operators can customize
                    the subscription by overriding the parameters from the existing subscription.
                    This can be done by setting the <span class="ph uicontrol">subscriptionCustomise</span>
                    flag to <var class="keyword varname">True</var> in the <em class="ph i">create/Device</em> or
                        <em class="ph i">create/Group</em> API. The values not sent in the request are picked from
                    the bundle definition.</li>

                <li class="li">After creating a subscription, if an operator wants to update the bucket
                    instances in that subscription, then the <em class="ph i">update/BucketInstance</em> API is
                    used.</li>

            </ul>

            <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> The non-customized values are picked from the bundle definition.</div>

        </div>

        <div class="section" id="id9yz-09126-ug01-pczza-sp1-d1e194903__section_fst_npk_xqb"><h2 class="title sectiontitle">Template APIs
                </h2><div class="p">Template APIs allow bundle customization during a
                new subscription creation. They can create subscriptions overriding the values from
                catalog definitions. The following enhancements apply to the existing Template
                    APIs:<ul class="ul" id="id9yz-09126-ug01-pczza-sp1-d1e194903__ul_hsf_qcw_srb">
                    <li class="li">Override bucket and counter values by specifying buckets and counters
                        directly under bundle.</li>

                    <li class="li">Override bucket initial value with incremental and decremental mode.</li>

                    <li class="li">Override the values temporarily for a specified amount of billing
                        cycles.</li>

                    <li class="li">Override bucket carry-over parameters, such as carry over percentage, carry
                        over validity, maximum carry over amount, consumption order, and so on.</li>

                    <li class="li">Override service (bundle) custom data.</li>

                </ul>
</div>
<div class="p">Following are the template APIs for which bundle customization
                    applies:<ul class="ul" id="id9yz-09126-ug01-pczza-sp1-d1e194903__ul_jvp_2tr_vqb">
                    <li class="li"><strong class="ph b">Create Group API</strong>: This API allows creation of a Group with a
                        subscription. <div class="p">
                            <pre class="pre codeblock"><code>/services/ServiceManager/subscriber/create/Group</code></pre>
                        </div>
</li>

                    <li class="li"><strong class="ph b">Update Group API</strong>: This API allows you to update a Group with a
                        subscription. <div class="p">
                            <pre class="pre codeblock"><code>/services/ServiceManager/subscriber/update/Group</code></pre>
                        </div>
</li>

                    <li class="li"><strong class="ph b">Delta Update Group API</strong>: This API allows you to update of a Group with
                        a subscription. <div class="p">
                            <pre class="pre codeblock"><code>/services/ServiceManager/subscriber/deltaUpdate/Group</code></pre>
                        </div>
</li>

                    <li class="li"><strong class="ph b">Create Device API</strong>: This API allows creation of a Device with a
                        subscription. <div class="p">
                            <pre class="pre codeblock"><code>/services/ServiceManager/subscriber/create/Device</code></pre>
                        </div>
</li>

                    <li class="li"><strong class="ph b">Update Device API</strong>: This API allows you to update a Device with a
                        subscription. <div class="p">
                            <pre class="pre codeblock"><code>/services/ServiceManager/subscriber/update/Device</code></pre>
                        </div>
</li>

                    <li class="li"><strong class="ph b">Delta Update Device API</strong>: This API allows you to update a Device with
                        a subscription. <div class="p">
                            <pre class="pre codeblock"><code>/services/ServiceManager/subscriber/deltaUpdate/Device</code></pre>
                        </div>
</li>

                    <li class="li"><strong class="ph b">Create Subscription API</strong>: This API allows creation and addition a new
                        subscription and also allows bundle customization. It allows creation of
                        subscription with overridden values.<div class="p">
                            <pre class="pre codeblock"><code>/services/ServiceManager/subscriber/create/Subscription_v1</code></pre>
                        </div>
</li>

                    <li class="li"><strong class="ph b">Create Profile API</strong>: This API allows creation of the Subscriber
                        Profile. This API can be used to create an Account, a User, a list of
                        Devices or a Group, a list of subscriptions with overridden values
                        associated with each other. All the subscriptions are charged on the same
                        account that is also created with this API.<div class="p">
                            <pre class="pre codeblock"><code>/services/ServiceManager/subscriber/create/Profile</code></pre>
                        </div>
</li>

                    <li class="li"><strong class="ph b">Add Profile API</strong>: This API adds devices and subscriptions to a
                        Subscriber Profile for a given Account. It also allows creation of a device
                        and subscription with overridden values and associate it with existing
                        account. If groupId is present in the request, the newly created devices and
                        device in existingDeviceIds can be attached to the group.<div class="p">
                            <pre class="pre codeblock"><code>/services/ServiceManager/subscriber/add/Profile</code></pre>
                        </div>
</li>

                    <li class="li"><strong class="ph b">Update/Change Plan API</strong>: This API changes the plan (add new
                        subscription) to a device or group. It also allows you to replace an
                        existing subscription with a new subscription created with overridden values.<div class="p">
                            <pre class="pre codeblock"><code>/services/ServiceManager/subscriber/update/ChangePlan</code></pre>
                        </div>
</li>

                </ul>
</div>
<p class="p">NCC allows overriding <strong class="ph b">maxRenewals</strong> using
                the template APIs. Following example shows how the <strong class="ph b">maxRenewals</strong> attribute is
                specified in the template APIs:</p>
<div class="p">
                <pre class="pre codeblock" id="id9yz-09126-ug01-pczza-sp1-d1e194903__codeblock_n5z_sgn_wsb"><code>         .
         .
         .
"bundle": {
         "name": "Bundle1",
         "maxRenewals": 2,
         .
         .
         .</code></pre>
            </div>
<p class="p">If the <strong class="ph b">maxRenewals</strong> attribute is not specified in the template APIs, then
                the value of <strong class="ph b">maxRenewals</strong> is taken from the bundle catalog. If the
                    <strong class="ph b">maxRenewals</strong> is set to -1, then it is considered as unlimited
                value.</p>
<p class="p">NCC provides an option to override bucket and counter values. The
                buckets and counters can be specified directly under bundle without specifying the
                charging service. See the following example:</p>
<div class="p">
                <pre class="pre codeblock"><code>{ ​
...
...
    "subscriptions": [
        {
            "subscriptionCustomise": true,
            "bundle": {
                "name": "BundleTest",
                "buckets": [
                    {
                        "name": "Bucket1",
                        "initialValue": 800,
                        "currentValue": 800,
                        "thresholdProfileGroupIdList": [
                            "T2"
                        ]
                    }
                ],
                "counters": [
                    {
                        "name": "Counter1",
                        "thresholdProfileGroupIdList": [
                            "TPG2"
                        ],
                        "overageThresholdProfileGroupIdList": [
                            "OTPG2"
                        ],
                        "usageLimit": 25,
                        "overageLimit": 30
                   }
               ]
            }
        }
    ]
...
...​
}​​</code></pre>
            </div>
<div class="p">The field <strong class="ph b">initialValueAdjMode</strong> allows you to override bucket initial value
                with incremental/decremental modes. You can use this field to increment, decrement,
                or set the bucket initial value. Note that the <strong class="ph b">initialValueAdjMode</strong> is
                applicable only to buckets and not counters. This field can have the following
                    values:<ul class="ul" id="id9yz-09126-ug01-pczza-sp1-d1e194903__ul_lcl_ljw_srb">
                    <li class="li"><strong class="ph b">SET</strong>: Sets an absolute value</li>

                    <li class="li"><strong class="ph b">INCR</strong>: Increase the values by delta</li>

                    <li class="li"><strong class="ph b">DECR</strong>: Decrease the values by delta</li>

                    <li class="li"><strong class="ph b">NONE</strong>: No mode</li>

                </ul>
</div>
<p class="p">See the following example:</p>
<pre class="pre codeblock"><code>{ ​
...
...
    "subscriptions": [
        {
            "bundle": {
                "name": "BundleTest",
                "buckets": [
                    {
                        "name": "Bucket1",
                        "initialValue": 100,
                        "currentValue": 100,
                        "initialValueAdjMode": "INCR"
                    }
                ]
            }
        }
    ]
...
...​
}​</code></pre>The following GUI snapshots show the counter values that are
            overridden. <p class="p">Navigate to Devices or Groups and add a new subscription under
                    <strong class="ph b">Associations</strong>. From the bundles, select the bundle that contains a
                multi-bundle counter. In the following snapshot, <strong class="ph b">ServiceWMultiServiceCounter1</strong>
                is the selected bundle.</p>
<a href="../images/override1.png" class="image"><img class="image imagecenter break scalefit" id="id9yz-09126-ug01-pczza-sp1-d1e194903__image_mzq_jhj_xrb" src="../images/override1.png" height="467" width="679" /></a>Click <strong class="ph b">SELECT
                COUNTER</strong> and from the list select the counter. Here, <strong class="ph b">MultiServiceCounter1</strong>
            is selected. This counter is a multi-bundle counter found in a charging logic attached
            to the selected bundle.<a href="../images/override2.png" class="image"><img class="image imagecenter break scalefit" id="id9yz-09126-ug01-pczza-sp1-d1e194903__image_xbj_khj_xrb" src="../images/override2.png" height="476" width="680" /></a>You can override
            the values of selected counter. Here, <strong class="ph b">Overage Limit Override (Second)</strong> value is
                changed.<a href="../images/override3.png" class="image"><img class="image imagecenter break scalefit" id="id9yz-09126-ug01-pczza-sp1-d1e194903__image_zmx_khj_xrb" src="../images/override3.png" height="366" width="742" /></a>You can display the counter and
            its overridden value from the preview page as follows.<a href="../images/override4.png" class="image"><img class="image imagecenter break scalefit" id="id9yz-09126-ug01-pczza-sp1-d1e194903__image_zjk_lhj_xrb" src="../images/override4.png" height="325" width="693" /></a></div>

        <div class="section" id="id9yz-09126-ug01-pczza-sp1-d1e194903__section_hzl_x1n_n4b"><h2 class="title sectiontitle">create/Device or create/Group REST API</h2>
            
            <p class="p">The operators can customize a bundle using the <em class="ph i">create/Device</em> or
                    <em class="ph i">create/Group</em> API while attaching a subscription to a device or group. If
                the <span class="ph uicontrol">subscriptionCustomise</span> flag is set as
                    <var class="keyword varname">True</var>, then the operators customize only the lifecycle
                and charging service in a bundle.</p>

            <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> 
                <ul class="ul" id="id9yz-09126-ug01-pczza-sp1-d1e194903__ul_qg2_1mw_ysb">
                    <li class="li">You cannot add a new charging service but only use the existing charging
                        services from the original bundle definition.</li>

                    <li class="li">With customization, the bucket/counters values can be modified. As a result,
                        if a threshold is defined on absolute value, then it may not generate the
                        expected result. Therefore, it is recommended to define threshold levels in
                        percentage.</li>

                </ul>

            </div>

            <p class="p">The <em class="ph i">create/Device</em> or <em class="ph i">create/Group</em> API can modify the following
                data:</p>

            <ul class="ul" id="id9yz-09126-ug01-pczza-sp1-d1e194903__ul_fnh_z1n_n4b">
                <li class="li">
                    <p class="p">Lifecycle (entity or periodic) attached with a bundle definition.</p>

                </li>

                <li class="li">
                    <p class="p">Counter threshold profile group, overage threshold profile group, usage
                        limit, and overage limit present in the charging logic (charging service)
                        list.</p>

                </li>

                <li class="li">
                    <p class="p">InitialValue, CurrentValue, currentChargingStep, threshold for buckets, and
                        carry-over parameters present in the charging logic (charging service)
                        list.</p>

                </li>

                <li class="li">
                    <p class="p">All or certain charging service can be selected in the bundle definition.</p>

                </li>

            </ul>

            <p class="p">For the complete list of parameters and their descriptions, see the <em class="ph i">NOKIA
                    Converged Charging Service Manager API Reference Guide</em>.</p>

            
            <div class="sectiondiv">
                <p class="p"><strong class="ph b">Setting InitialValue, CurrentValue, and currentChargingStep for a bucket with
                        or without a Charging Step</strong></p>

                <ul class="ul" id="id9yz-09126-ug01-pczza-sp1-d1e194903__ul_vmq_hbn_n4b">
                    <li class="li">
                        <p class="p">If <var class="keyword varname">currentChargingStep</var> is provided in the request, but
                            bucket does not have a Charging Step, then the request is rejected with
                            an error.</p>

                    </li>

                    <li class="li">
                        <p class="p">If <var class="keyword varname">currentChargingStep</var> is not provided in the request
                            and bucket has a Charging Step, then CurrentValue and InitialValue are
                            set to the size in step 1 of the Charging Step.</p>

                    </li>

                    <li class="li">
                        <p class="p">If <var class="keyword varname">currentChargingStep</var> is provided in the request and
                            bucket has a Charging Step, then if the
                                <var class="keyword varname">currentChargingStep</var> is greater than the number of
                            steps in the Charging Step (with the last step as <em class="ph i">not unlimited</em>),
                            the request is rejected with an error. If
                                <var class="keyword varname">currentChargingStep</var> is less, then the following
                            logic is used:</p>

                        <ol class="ol" id="id9yz-09126-ug01-pczza-sp1-d1e194903__ol_l3v_ny1_tmb">
                            <li class="li">
                                <p class="p">If <var class="keyword varname">InitialValue</var> is available in the request,
                                    then the request is rejected with an error. The
                                        <var class="keyword varname">InitialValue</var> is calculated internally as
                                    follows:</p>

                                <ul class="ul" id="id9yz-09126-ug01-pczza-sp1-d1e194903__ul_m3v_ny1_tmb">
                                    <li class="li">
                                        <p class="p">For a Charging Step that has last step as not
                                                <em class="ph i">unlimited</em>: Sum of steps starting from step 1
                                            till currentCharging Step.</p>

                                    </li>

                                    <li class="li">
                                        <p class="p">For a Charging Step that has last step as unlimited: Sum
                                            of steps starting from 1 until step before unlimited
                                            step, plus the number of times unlimited step has been
                                            used.</p>

                                    </li>

                                </ul>

                            </li>

                            <li class="li">
                                <p class="p">If <var class="keyword varname">CurrentValue</var> is available in the request,
                                    then this value is set only when it is less than current
                                    charging step size.</p>

                            </li>

                            <li class="li">
                                <p class="p">If current value is not available in the request, then it is set
                                    as follows:</p>

                                <ul class="ul" id="id9yz-09126-ug01-pczza-sp1-d1e194903__ul_n3v_ny1_tmb">
                                    <li class="li">
                                        <p class="p">For a Charging Step that has last step as <em class="ph i">not
                                                unlimited:</em> current step size.</p>

                                    </li>

                                    <li class="li">
                                        <p class="p">For a Charging Step that has last step as
                                                <em class="ph i">unlimited</em>, it is set as follows:</p>

                                        <ul class="ul" id="id9yz-09126-ug01-pczza-sp1-d1e194903__ul_o3v_ny1_tmb">
                                            <li class="li">If current charging step &lt; number of steps:
                                                current charging step size.</li>

                                            <li class="li">If current charging step &gt;= number of steps: last
                                                step size.</li>

                                        </ul>

                                    </li>

                                </ul>

                            </li>

                        </ol>

                    </li>

                </ul>

                
            </div>
            <div class="sectiondiv">
                <p class="p"><strong class="ph b">Example: Creating a device and attaching a subscription</strong></p>

                <p class="p">The following figure shows an example where an iPhone device is created with two
                    buckets. The <em class="ph i">create/Device</em> API is used to change the initial value of the
                    existing bucket (<var class="keyword varname">Bucket1</var>) to 300 bytes. Note that the
                        <span class="ph uicontrol">subscriptionCustomise</span> flag is set as
                        <var class="keyword varname">True</var>.</p>

                <div class="fig fignone" id="id9yz-09126-ug01-pczza-sp1-d1e194903__fig_vh5_vbn_n4b">
                    <img class="image imageleft break" id="id9yz-09126-ug01-pczza-sp1-d1e194903__image_wh5_vbn_n4b" src="../images/img9yz-09126-ug01-pczza-sp1-bundle_customization_example_default.png" />
                </div>

            </div>
        </div>

        <div class="section" id="id9yz-09126-ug01-pczza-sp1-d1e194903__buckpara"><h2 class="title sectiontitle">update/BucketInstance REST API </h2>
            
            <p class="p">The operators can update the following bucket instance parameters using the
                    <em class="ph i">update/BucketInstance</em> API:</p>

            <ul class="ul" id="id9yz-09126-ug01-pczza-sp1-d1e194903__ul_kcl_scn_n4b">
                <li class="li">Bucket initial value</li>

                <li class="li">Bucket current value</li>

                <li class="li">Carry-over parameters</li>

                <li class="li">Current charging step </li>

            </ul>

            <p class="p">Previously, for temporary updates, the adjust mode and delta value existed in the
                database until the number of temporary cycles were reached. For permanent updates,
                the adjust mode exists as None and the delta value as 0 and the adjusted amount is
                stored in the original value field.</p>

            <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> 
                <ul class="ul" id="id9yz-09126-ug01-pczza-sp1-d1e194903__ul_ck2_ycn_n4b">
                    <li class="li">Bucket value cannot be higher than the initial bucket value. During a call,
                        if the charging step decreases, then this condition is disregarded, and the
                        bucket value gets adjusted. </li>

                    <li class="li">The charging step cannot move out of configured steps.
                        </li>

                    <li class="li">The charging step = 0 or negative value is not allowed.
                        </li>

                    <li class="li">
                        <p class="p">The new initial value can be greater or lesser than the original
                            value.</p>

                    </li>

                    <li class="li">
                        <p class="p">The new bucket initial value can be permanent (set
                                <span class="ph uicontrol">adjustAmountInitialValidity</span> parameter to
                            zero) or temporary (set
                                <span class="ph uicontrol">adjustAmountInitialValidity</span> to any positive
                            value greater than zero).</p>

                        <ul class="ul" id="id9yz-09126-ug01-pczza-sp1-d1e194903__ul_rwn_zcn_n4b">
                            <li class="li">
                                <p class="p">Zero indicates that the given initial value remains forever, this
                                    is also the default value.</p>

                            </li>

                            <li class="li">
                                <p class="p">Any positive value indicates the number of bill cycles (including
                                    the current bill cycle) for which the given initial value
                                    remains valid. A value of <var class="keyword varname">1</var> means that the
                                    given initial value is valid only for the ongoing bill cycle and
                                    is replaced by the original initial value at next BCR.</p>

                                <p class="p">For example, <em class="ph i">adjustAmountInitialValidity</em> =
                                        <var class="keyword varname">3</var>, <em class="ph i">initialValue</em> =
                                        <var class="keyword varname">1000</var>, and <em class="ph i">origInitialValue</em> =
                                        <var class="keyword varname">1200</var>. The initial value is valid for
                                    current bill cycle and two further bill cycles. After which, the
                                        <em class="ph i">initialValue</em> falls back to
                                    <var class="keyword varname">1200</var>.</p>

                            </li>

                        </ul>

                    </li>

                </ul>

            </div>

            <p class="p">For the complete list of parameters and their descriptions, see the NOKIA Converged
                Charging Service Manager API Reference Guide.</p>

            <div class="note notice"><div class="noticetitle"><img src="../../web/css/../images/notice.svg" title="notice-icon" class="noteicon" />Notice:</div> The maximum value allowed for initial bucket value or bucket current value is
                        <var class="keyword varname">922337203685477600</var>.</div>
            <p class="p">For the complete list of parameters and their descriptions, see the <em class="ph i">NOKIA
                    Converged Charging Service Manager API Reference Guide</em>.</p>

        </div>

        <div class="section" id="id9yz-09126-ug01-pczza-sp1-d1e194903__section_vby_qyw_5qb"><h2 class="title sectiontitle">update/Subscription and update/EntityCounterInstance REST API
                </h2>
            
            <p class="p">To update a counter instance in a given subscription,
                operators can use either of the following APIs:</p>

            <div class="p">
                <pre class="pre codeblock"><code>/services/ServiceManager/subscriber/update/Subscription</code></pre>
            </div>

            <div class="p">
                <pre class="pre codeblock"><code>/services/ServiceManager/subscriber/update/EntityCounterInstance</code></pre>
            </div>

            <p class="p">To retrieve the counter instance information, operators can use the following
                API:</p>

            <div class="p">
                <pre class="pre codeblock"><code>/services/ServiceManager/subscriber/getData/EntityCounterInstance</code></pre>
            </div>

            <p class="p">NCC considers the <strong class="ph b">remainingRenewals</strong> value with
                versioning and impact of its value to the max renewal. Following example shows the
                    <strong class="ph b">remainingRenewals</strong> value:</p>

            <div class="p">
                <pre class="pre codeblock" id="id9yz-09126-ug01-pczza-sp1-d1e194903__codeblock_tgg_3vn_wsb"><code>{
    "entityId": "group1",
    "entityType": "GROUP",
    "subscriptionId": "459e89bc-beb0-46bb-9559-090a1c4259b3",
    "remainingRenewals": 4
}</code></pre>
            </div>

            <p class="p">The update subscription API can update the <strong class="ph b">remainingRenewals</strong>
                for an existing subscription to be <em class="ph i">UNLIMITED</em>. That is, if the subscription is
                created with a defined number of renewal cycles, then NCC allows the
                    <strong class="ph b">remainingRenewals</strong> to be set to <em class="ph i">UNLIMITED</em>.</p>

            <p class="p"><strong class="ph b">Shortening the update subscription API cycle</strong></p>

            <div class="p">If the <em class="ph i">Input date</em> is updated, then the update takes effect immediately. If the
                updated input date causes shortening of the current cycle, then the existing end
                time is updated to align with the updated input date. <div class="note" id="id9yz-09126-ug01-pczza-sp1-d1e194903__note_ppc_pjl_ysb"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> 
                    <ul class="ul" id="id9yz-09126-ug01-pczza-sp1-d1e194903__ul_ldp_pjl_ysb">
                        <li class="li">In case of shortening of current cycle, RAR is processed to allow the
                            new renewal/expiration date to be considered while resetting the VT
                            values for any active data sessions.</li>

                        <li class="li">If the updated input date is not in the past, then the update
                            subscription API fails with an appropriate error message.</li>

                    </ul>

                </div>
</div>

            <p class="p">The update/create subscription API has been enhanced with an
                optional parameter to accept date in <em class="ph i">YYYYMMDDhhmm</em> format. In this parameter,
                hours and minutes are optional. The default value is <em class="ph i">0000</em>.</p>

            <div class="p">NCC allows operators to make temporary changes to some attributes of a counter
                instance such as ULI, TPG using the <em class="ph i">usgLmtTempChg</em> and <em class="ph i">thrhdTempChg</em>
                boolean attributes in the update request. In this case, the change is temporary and
                the values of ULI and TPG revert back to catalog definition values during
                subscription renewal. To make the change permanent for a few billing cycles,
                operators can use the <strong class="ph b">validityTime</strong> attribute. This attribute indicates the
                number of billing cycles (including the current) for which the changes to the
                following attributes remain valid:<ul class="ul" id="id9yz-09126-ug01-pczza-sp1-d1e194903__ul_rsl_ysx_5qb">
                    <li class="li">Usage limit (ULI)</li>

                    <li class="li">Overage limit (OLI)</li>

                    <li class="li">Threshold Profile Group (TPG)</li>

                    <li class="li">Overage Threshold Profile Group (OTPG)</li>

                </ul>
 For permanent change, pass the value 0, which is also the default value of
                    <strong class="ph b">validityTime</strong> attribute. </div>

            <div class="p">
                <pre class="pre codeblock"><code>{
  ...
  "usageLimit": 100,
  "overageLimit": 50,
  "thresholdProfileGroupIdList": [
    {
      "thPrfGrpDfName": "...",
      "operation": "ADD/REMOVE"
    }
  ],
  "overageThresholdProfileGroupIdList": [
    {
      "thPrfGrpDfName": "...",
      "operation": "ADD/REMOVE"
    }
  ],
  "validityTime": 2
}</code></pre>
            </div>

            <p class="p">For temporary overrides, a positive integer value must be provided for
                        <strong class="ph b"><em class="ph i">validityTime</em></strong> in each of the template APIs. 0 means default and
                indicates permanent change. If a value is not provided, the override will be
                permanent by default. Negative values are not allowed for
                <strong class="ph b"><em class="ph i">validityTime</em></strong>. See the following example:</p>

            <div class="p">
                <pre class="pre codeblock"><code>{ ​
...
...
    "subscriptions": [
        {
            "bundle": {
                "name": "BundleTest",
                "validityTime": 2,
                "buckets": [
                    ...
                    ...
                ],
                "counters": [
                    ...
                    ...
                ],
            }
        }
    ]
...
...​
}​</code></pre>
            </div>

            <div class="p">The validityTime is separated for all four attributes and stored in the database
                    separately:<ul class="ul" id="id9yz-09126-ug01-pczza-sp1-d1e194903__ul_cnc_55x_5qb">
                    <li class="li">usgLimitValidityTime</li>

                    <li class="li">ovgLimitValidityTime</li>

                    <li class="li">usgTpgValidityTime</li>

                    <li class="li">ovgTpgValidityTime</li>

                </ul>

            </div>

            <p class="p">If <em class="ph i">OLI</em> is being updated, then <em class="ph i">usgLimitValidityTime</em> is set to the value
                of <em class="ph i">validityTime</em>, and similarly for the other attributes. For example, if
                    <em class="ph i">OLI</em> is not being updated, then <em class="ph i">ovgLimitValidityTime</em> does not get
                updated.</p>

            <p class="p">For backward compatibility, <em class="ph i">usgLmtTempChg </em>and <em class="ph i">thrhdTempChg</em> boolean
                attributes are allowed in the request. They are not saved in the database, instead, they
                are mapped to the corresponding validity time attribute. If <em class="ph i">usgLmtTempChg</em> is
                true, then <em class="ph i">usgLimitValidityTime</em> is set to 1, if false, then 0. Similarly, if
                    <em class="ph i">thrhdTempChg </em> is true, then <em class="ph i">usgTpgValidityTime</em> is set to 1, if
                false, then 0.</p>

            <p class="p">Both the <em class="ph i">validityTime</em> and temporary change flags cannot be set in the same
                request. If both are present, then the request gets rejected.</p>

            <p class="p">Following is the API response:</p>

            <div class="p">
                <pre class="pre codeblock"><code>{
  "responseStatus": {
    "message": "Success",
    "data": [
      {
        ...
        "thresholdProfileGroupInstList": [...],
        "overageThresholdProfileGroupIdList": [...],
        "usageLimit": 500,
        "overageLimit": 100,
        "usgLmtTempChg": true,
        "thrhdTempChg": false,
        "usgLimitValidityTime": 3,
        "ovgLimitValidityTime": 3,
        "usgTpgValidityTime": 0,
        "ovgTpgValidityTime": -1
      }
    ]
  }
}</code></pre>
            </div>

            <p class="p">The <em class="ph i">usgLmtTempChg</em> and <em class="ph i">thrhdTempChg</em> do not represent the database values. They
                are a reflection of the corresponding validity time attribute. If the
                    <em class="ph i">usgLimitValidityTime </em> is greater than 0, then <em class="ph i">usgLmtTempChg </em> is
                set as true in the response. If it is 0 or -1, then it is set as false. The same
                logic applies to <em class="ph i">thrhdTempChg</em>. Note that the validity time in the response
                can be -1. It is the default value when a new subscription is created.</p>

            <div class="p">When a permanent change is made to one of the four attributes (ULI, OLI, TPG, OTPG),
                the permanent value is saved in a separate field. The following database fields store the
                permanent changes:<ul class="ul" id="id9yz-09126-ug01-pczza-sp1-d1e194903__ul_kr4_1mr_vqb">
                    <li class="li">permUsgLimit</li>

                    <li class="li">permOvgLimit</li>

                    <li class="li">permUsgTpg</li>

                    <li class="li">permOvgTpg</li>

                </ul>
These fields are not displayed in REST APIs. When the validity time of one of
                the four attributes expires, its value is reverted back. If there was a prior
                permanent change, then the corresponding permanent change value is used to revert
                the value. If no prior permanent changes were made, then the catalog definition
                value is used to revert the value.</div>

        </div>

        <div class="section" id="id9yz-09126-ug01-pczza-sp1-d1e194903__section_ssy_vjl_rpb"><h2 class="title sectiontitle">Examples for <em class="ph i">currentChargingStep</em> parameter </h2>
            
            <p class="p"><strong class="ph b">Pre-requisite:</strong> Consider that a bucket has 3 steps (200, 100, 100 bytes). </p>

            <p class="p"><strong class="ph b">Example 1:</strong> Consider that a subscriber has bucket at step 1 with 50 bytes. When
                the REST API <strong class="ph b">update/BucketInstance</strong> is executed with currentChargingStep = 2,
                then the bucket is at step 2 and bucket value is 150, and initial bucket value is
                300.</p>

            <p class="p"><strong class="ph b">Example 2:</strong> Consider that a subscriber has bucket at step 2 with 70 bytes. When
                the REST API <strong class="ph b">update/BucketInstance</strong> is executed with currentChargingStep = 2,
                then the bucket is at step 2 and bucket value is 70, and initial bucket value is
                300.</p>

            <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> The same behavior is applicable to <strong class="ph b">update/Subscription</strong> REST API.</div>

        </div>

    </div>
<div class="topic concept nested1" aria-labelledby="ariaid-title2" id="concept_tgh_cml_r4b"><h2 class="title topictitle2" id="ariaid-title2">Additional information</h2>
<div class="body conbody">
            <div class="section" id="concept_tgh_cml_r4b__section_ohv_cml_r4b">
                <p class="p">Following are some important points related to this feature performed by the
                    operators:</p>

                <ul class="ul" id="concept_tgh_cml_r4b__ul_zb2_1fn_n4b">
                    <li class="li">
                        <p class="p">Modify a bundle while attaching a subscription to a device or group.</p>

                    </li>

                    <li class="li">
                        <p class="p">Modify the objects in a bundle entity.</p>

                    </li>

                    <li class="li">
                        <p class="p">Do not modify the bucket name and unit type.</p>

                    </li>

                    <li class="li">
                        <p class="p">Do not attach extra charging service other than those present in the
                            selected bundle.</p>

                    </li>

                    <li class="li">
                        <p class="p">Do not attach extra buckets or counters other than those present in the
                            selected bundle.</p>

                    </li>

                    <li class="li">
                        <p class="p">If the bucket initial value, bucket current value, and bucket unused
                            value are updated using the <em class="ph i">update/BucketInstance</em> API and
                                <em class="ph i">updateSubscription</em> API, then the following points are
                            considered:</p>

                        <ul class="ul" id="concept_tgh_cml_r4b__ul_mvf_hdn_n4b">
                            <li class="li">
                                <p class="p"><em class="ph i">initialValueAdjustAmount</em> updates only the first step
                                    size.</p>

                            </li>

                            <li class="li">
                                <p class="p">The new size of the first step cannot be less than zero. However,
                                    if this value gets less than zero, then the
                                        <em class="ph i">update/BucketInstance</em> API returns an error. For
                                    example:</p>

                                <div class="p">
                                    <pre class="pre codeblock"><code>CHARGING_STEP_00018: While decreasing the first step value, the value cannot be less than zero.</code></pre>
                                </div>

                            </li>

                            <li class="li">
                                <p class="p">If some reservations are done from step bucket, then those
                                    reservations or the anticipated step index must be
                                    considered.</p>

                            </li>

                            <li class="li">
                                <p class="p">If any changes are done in the initial value, current value, or
                                    unused value of the step bucket, then the current step is not
                                    changed irrespective of the modification.</p>

                            </li>

                            <li class="li">
                                <p class="p">The logic of reading step-bucket and determining its initial
                                    value as well as current value during call requests are enhanced
                                    to consider any updation done using the REST APIs.</p>

                            </li>

                            <li class="li">
                                <p class="p">If the values of initial value, current value, or unused value
                                    are changed, then the modified values are preserved while
                                    updating with the Charging Step data or while performing the
                                    step-ups.</p>

                            </li>

                            <li class="li">
                                <p class="p">The updated initial value, current value, or unused value are
                                    considered while resetting the step bucket and initializing the
                                    initial value and current value of the bucket during reset or
                                    renewed are enhanced to consider any updation using the REST
                                    APIs.</p>

                            </li>

                        </ul>

                    </li>

                </ul>

            </div>

        </div>
</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title3" id="concept_xyy_mll_r4b"><h2 class="title topictitle2" id="ariaid-title3">Examples</h2>
<div class="body conbody">
            <div class="section" id="concept_xyy_mll_r4b__section_py3_qll_r4b">
                <p class="p">Consider the following examples for better understanding of this feature:</p>

            </div>

            <div class="section" id="concept_xyy_mll_r4b__section_xf2_1ml_r4b"><h3 class="title sectiontitle">Example 1: Changing bucket values (permanent update) using
                    update/BucketInstance API</h3>
                
                <p class="p"><strong class="ph b">Provisioning:</strong></p>

                <p class="p">At the start of a billing cycle (11/2018), create a group with two devices has a
                    bucket initial value = 600 Bytes and current value = 400 Bytes.</p>

                <p class="p"><strong class="ph b">Result:</strong></p>

                <p class="p">If a new device is attached to the group with bucket initial value = 300 Bytes,
                    then current value = 100 Bytes. The bucket values are adjusted using the
                        <em class="ph i">update/BucketInstance</em> API. The
                        <span class="ph uicontrol">InitialvalueAdjustAmount</span> is used to set the value.
                    The new device is added to the group with initial value = 600 + 300 = 900 Bytes
                    and current value = 400 + 100 = 500 Bytes. After reset or renewal of bundle
                    (12/2018), the group has three devices with initial value = 900 Bytes and
                    current value = 900 Bytes.</p>

                <p class="p">The following figure provides details on permanent update scenario. Note that the
                        <span class="ph uicontrol">adjustAmountInitialValidity</span> is set to
                        <var class="keyword varname">0</var>, where 0 indicates that the update is permanent.</p>

                <div class="fig fignone" id="concept_xyy_mll_r4b__fig_okd_yc5_pnb"><span class="figcap"><span class="fig--title-label">Figure: </span>Subscription customization - permanent update</span>
                    
                    <a href="../images/img9yz-09126-ug01-pczza-sp1-subscription_permanent_update_default.png" class="image"><img class="image break scalefit" id="concept_xyy_mll_r4b__image_pkd_yc5_pnb" src="../images/img9yz-09126-ug01-pczza-sp1-subscription_permanent_update_default.png" /></a>
                </div>

                <p class="p">The following figure from SM GUI shows the bucket values before using the
                        <em class="ph i">update/BucketInstance</em> API:</p>

                <div class="fig fignone" id="concept_xyy_mll_r4b__fig_qkd_yc5_pnb">
                    <a href="../images/img9yz-09126-ug01-pczza-sp1-subscription_custom_ex4_1_default.png" class="image"><img class="image break scalefit" id="concept_xyy_mll_r4b__image_rkd_yc5_pnb" src="../images/img9yz-09126-ug01-pczza-sp1-subscription_custom_ex4_1_default.png" height="217" width="646" /></a>
                </div>

                <p class="p">The following figure from SM GUI shows the bucket values after executing the
                        <em class="ph i">update/BucketInstance</em> API:</p>

                <div class="fig fignone" id="concept_xyy_mll_r4b__fig_skd_yc5_pnb">
                    <a href="../images/img9yz-09126-ug01-pczza-sp1-subscription_custom_ex4_2_default.png" class="image"><img class="image break scalefit" id="concept_xyy_mll_r4b__image_tkd_yc5_pnb" src="../images/img9yz-09126-ug01-pczza-sp1-subscription_custom_ex4_2_default.png" height="226" width="650" /></a>
                </div>

                <p class="p">The following figure from SM GUI shows the bucket values after the billing cycle
                    is reset:</p>

                <div class="fig fignone" id="concept_xyy_mll_r4b__fig_ukd_yc5_pnb">
                    <a href="../images/img9yz-09126-ug01-pczza-sp1-subscription_custom_ex4_3_default.png" class="image"><img class="image break scalefit" id="concept_xyy_mll_r4b__image_vkd_yc5_pnb" src="../images/img9yz-09126-ug01-pczza-sp1-subscription_custom_ex4_3_default.png" height="211" width="647" /></a>
                </div>

            </div>

            <div class="section" id="concept_xyy_mll_r4b__section_mx1_yll_r4b"><h3 class="title sectiontitle">Example 2: Changing bucket values (temporary update) using REST API</h3>
                
                <p class="p">The following figure provides details on the temporary update scenario. Note that
                    the <span class="ph uicontrol">adjustAmountInitialValidity</span> is set to 1, where 1
                    indicates that the update is temporary. In the current example, the value 1 is
                    used, but you can add any positive value greater than 1 to indicate that the
                    update is temporary.</p>

                <div class="fig fignone" id="concept_xyy_mll_r4b__fig_wkd_yc5_pnb"><span class="figcap"><span class="fig--title-label">Figure: </span>Subscription customization - temporary update</span>
                    
                    <img class="image break" id="concept_xyy_mll_r4b__image_xkd_yc5_pnb" src="../images/img9yz-09126-ug01-pczza-sp1-subscription_custom_temporary_update_default.png" />
                </div>

                <p class="p">The following figure from SM GUI shows the bucket values before using the
                        <em class="ph i">update/BucketInstance</em> API:</p>

                <div class="fig fignone" id="concept_xyy_mll_r4b__fig_ykd_yc5_pnb">
                    <a href="../images/img9yz-09126-ug01-pczza-sp1-subscription_custom_ex5_1_default.png" class="image"><img class="image break scalefit" id="concept_xyy_mll_r4b__image_zkd_yc5_pnb" src="../images/img9yz-09126-ug01-pczza-sp1-subscription_custom_ex5_1_default.png" height="226" width="648" /></a>
                </div>

                <p class="p">The following figure from SM GUI shows the bucket values after executing the
                        <em class="ph i">update/BucketInstance</em> API:</p>

                <div class="fig fignone" id="concept_xyy_mll_r4b__fig_ald_yc5_pnb">
                    <a href="../images/img9yz-09126-ug01-pczza-sp1-subscription_custom_ex5_2_default.png" class="image"><img class="image break scalefit" id="concept_xyy_mll_r4b__image_bld_yc5_pnb" src="../images/img9yz-09126-ug01-pczza-sp1-subscription_custom_ex5_2_default.png" height="221" width="651" /></a>
                </div>

                <p class="p">The following figure from SM GUI shows the bucket values after the billing cycle
                    is reset.</p>

                <div class="fig fignone" id="concept_xyy_mll_r4b__fig_cld_yc5_pnb">
                    <a href="../images/img9yz-09126-ug01-pczza-sp1-subscription_custom_ex5_3_default.png" class="image"><img class="image break scalefit" id="concept_xyy_mll_r4b__image_dld_yc5_pnb" src="../images/img9yz-09126-ug01-pczza-sp1-subscription_custom_ex5_3_default.png" height="226" width="652" /></a>
                </div>

            </div>

            <div class="section" id="concept_xyy_mll_r4b__section_efn_rll_r4b"><h3 class="title sectiontitle">Example 3</h3>
                
                <div class="sectiondiv">
                    <p class="p"><strong class="ph b">Carry over update - variant 1:</strong></p>

                    <p class="p">The following figure provides details on the carry over update scenario where
                        the carry over flag is set to false. Since the carry over flag is disabled,
                        the carry over logic is not executed from the next renewal cycle. The
                        current balance of carry over value is available for use in the current bill
                        cycle.</p>

                    <div class="fig fignone" id="concept_xyy_mll_r4b__fig_eld_yc5_pnb">
                        <a href="../images/img9yz-09126-ug01-pczza-sp1-carryover_ex6_default.png" class="image"><img class="image imageleft break scalefit" id="concept_xyy_mll_r4b__image_fld_yc5_pnb" src="../images/img9yz-09126-ug01-pczza-sp1-carryover_ex6_default.png" /></a>
                    </div>

                    <p class="p">The following figure from SM GUI shows the bucket values before using the
                            <em class="ph i">update/BucketInstance</em> API:</p>

                    <div class="fig fignone" id="concept_xyy_mll_r4b__fig_gld_yc5_pnb">
                        <a href="../images/img9yz-09126-ug01-pczza-sp1-carryover_ex6_v1_default.png" class="image"><img class="image break scalefit" id="concept_xyy_mll_r4b__image_hld_yc5_pnb" src="../images/img9yz-09126-ug01-pczza-sp1-carryover_ex6_v1_default.png" height="219" width="648" /></a>
                    </div>

                    <p class="p">The following figure from SM GUI shows the bucket values after the billing
                        cycle is reset. In the current scenario, since the carry over flag is set to
                        false, the carry over values are removed.</p>

                    <div class="fig fignone" id="concept_xyy_mll_r4b__fig_ild_yc5_pnb">
                        <a href="../images/img9yz-09126-ug01-pczza-sp1-carryover_ex6_v2_default.png" class="image"><img class="image break scalefit" id="concept_xyy_mll_r4b__image_jld_yc5_pnb" src="../images/img9yz-09126-ug01-pczza-sp1-carryover_ex6_v2_default.png" height="229" width="648" /></a>
                    </div>

                    
                </div>
                <div class="sectiondiv">
                    <p class="p"><strong class="ph b">Carry over update - variant 2:</strong></p>

                </div>
                <p class="p">The following figure provides details on the carry over update scenario where the
                    carry over flag is set to true. Since the carry over flag is enabled, the carry
                    over logic is executed from the next renewal cycle. When the
                        <em class="ph i">update/BucketInstance</em> API is executed in the current bill cycle, an
                    empty carry over bucket instance gets created but the values are filled in the
                    next bill cycle reset. In this case, the carry over value is 50. Therefore, 50%
                    of the bucket initial and current value is carried over, that is 50% of 5000 =
                    2500.</p>

                <div class="fig fignone" id="concept_xyy_mll_r4b__fig_kld_yc5_pnb">
                    <a href="../images/img9yz-09126-ug01-pczza-sp1-carryover_ex7_1_default.png" class="image"><img class="image imageleft break scalefit" id="concept_xyy_mll_r4b__image_lld_yc5_pnb" src="../images/img9yz-09126-ug01-pczza-sp1-carryover_ex7_1_default.png" /></a>
                </div>

            </div>

        </div>
</div>
<div class="footer"><hr /><p>Charging User Guide • P556766-DN1000054947-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>