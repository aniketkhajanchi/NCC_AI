<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Roaming" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="id9yz-09126-ug01-pczza-sp1-d1e192931" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Roaming</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="id9yz-09126-ug01-pczza-sp1-d1e192931">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Roaming</h1>
<div class="body conbody">
        <div class="section" id="id9yz-09126-ug01-pczza-sp1-d1e192931__section_wfp_db5_pnb">
            <p class="p">Roaming refers to a situation where a subscriber accesses services while it is
                attached to a visited network, or VPLMN, but it is charged by its home network (the
                network where the account(s) of the subscriber are managed). Roaming allows you to
                adapt the charging and rating applied to the user when located in a visited network
                that the home operator has a roaming agreement. </p>

            <p class="p">Roamer handling is similar to the way users in their home PLMN are handled. The users
                trigger the data service, whether they are in their home PLMN or in a visited PLMN
                and the location of the user is identified by the MCC (Mobile Country Code) and MNC
                (Mobile Network Code) or (if the MCC/MNC is missing) by the IP address of the
                SGSN.</p>

            <p class="p">The <em class="ph i">PS-Information</em> AVP value in incoming requests received by the External
                Equipment is used for roaming identification in the following order:</p>

            <ul class="ul" id="id9yz-09126-ug01-pczza-sp1-d1e192931__ul_mbs_2b5_pnb">
                <li class="li">
                    <p class="p">
                        <em class="ph i">PS-Information\3GPP-SGSN-MCC-MNC</em>
                    </p>

                </li>

                <li class="li">
                    <p class="p">
                        <em class="ph i">PS-Information\SGSN-Address</em>
                    </p>

                </li>

                <li class="li">
                    <p class="p">
                        <em class="ph i">PS-Information\3GPP-SGSN-Address</em>
                    </p>

                </li>

            </ul>

            <p class="p">If the location matches a foreign network with a roaming agreement, the service
                allows for the configuration of a specific Event Type for this service that
                identifies it as a roaming trigger (<em class="ph i">MCC-MNC</em> equals <var class="keyword varname">Visited
                    PLMN</var> and <em class="ph i">networkType</em> equals <var class="keyword varname">ROAMING</var>). Then
                the Rating Engine provides a specific rating, tariff, and charging policy for the
                service.</p>

            <p class="p">If an incoming MCC-MNC location matches a visited network configured with no roaming
                agreement, the user is considered as being attached to the Home PLMN (HPLMN).</p>

            <p class="p">If an incoming MCC-MNC location matches no configured visited network, then the
                request is rejected with the appropriate Result-Code.</p>

            <p class="p">The call controller roaming decision as to whether or not the call is a roaming
                scenario, is made internally using configured rules.</p>

            <p class="p">The following figure illustrates the flow for roaming status.</p>

            <div class="fig fignone" id="id9yz-09126-ug01-pczza-sp1-d1e192931__fig_nbs_2b5_pnb"><span class="figcap"><span class="fig--title-label">Figure: </span>Roaming decision flow</span>
                
                <img class="image break" id="id9yz-09126-ug01-pczza-sp1-d1e192931__image_obs_2b5_pnb" src="../images/img9yz-09126-ug01-pczza-sp1-roamingdecision_default.png" />
            </div>

            <div class="p">Using the rule configuration, a rule can be included to determine the roaming
                decision as follows:<table cellpadding="4" cellspacing="0" summary="" id="id9yz-09126-ug01-pczza-sp1-d1e192931__table_pbs_2b5_pnb" class="table" width="100%" frame="border" border="1" rules="all"><colgroup><col style="width:45.04504504504505%" /><col style="width:54.95495495495496%" /></colgroup><thead class="thead" style="text-align:left;">
                            <tr class="row">
                                <th class="entry cellrowborder" style="vertical-align:top;" id="d49302e119">
                                    <p class="p">If...</p>

                               </th>

                                <th class="entry cellrowborder" style="vertical-align:top;" id="d49302e125">
                                    <p class="p">Then...</p>

                               </th>

                            </tr>

                        </thead>
<tbody class="tbody">
                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d49302e119 ">The <em class="ph i">GY_MESSAGE.Service-Context-Id</em> =
                                        <var class="keyword varname">32274@3gpp.org</var>,</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d49302e125 ">The <em class="ph i">CALL_RESULT.Default-Roaming-Decision</em> =
                                        <var class="keyword varname">RoamingDecision HOME</var>
                               </td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d49302e119 ">The value is <var class="keyword varname">REJECT</var>
                               </td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d49302e125 ">The request is rejected with result code <samp class="ph systemoutput">5012
                                        - DIAMETER_UNABLE_TO_COMPLY</samp> with the error
                                    message: <samp class="ph systemoutput">Rejected because the system cannot get
                                        roaming status</samp>.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d49302e119 ">The value is <var class="keyword varname">ROAMING</var> or
                                        <var class="keyword varname">HOME</var>,</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d49302e125 ">The call controller sets the roaming status.</td>

                            </tr>

                            <tr class="row">
                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d49302e119 ">The action does not exist,</td>

                                <td class="entry cellrowborder" style="vertical-align:top;" headers="d49302e125 ">The default value is <var class="keyword varname">REJECT</var>.</td>

                            </tr>

                        </tbody>
</table>
</div>

        </div>

        <div class="section" id="id9yz-09126-ug01-pczza-sp1-d1e192931__section_atb_gb5_pnb"><h2 class="title sectiontitle">Configuring roaming attributes</h2>
            
            <p class="p">Roaming attributes can be configured using the complex map, that is, mapping tables
                entity in the SM GUI.</p>

            <p class="p">The default roaming decision can be configured in the SM GUI. Navigate to
                    <span class="ph uicontrol">Charging configurator</span> &gt;
                    <span class="ph uicontrol">Charging</span> tab and select <span class="ph uicontrol">Rules And
                    Variables</span> from the hamburger menu (☰).</p>

            <div class="fig fignone" id="id9yz-09126-ug01-pczza-sp1-d1e192931__fig_nsw_hb5_pnb"><span class="figcap"><span class="fig--title-label">Figure: </span>RSV configured for default roaming decision</span>
                
                <img class="image imageleft break" id="id9yz-09126-ug01-pczza-sp1-d1e192931__image_osw_hb5_pnb" height="384" src="../images/img9yz-09126-ug01-pczza-sp1-rsv_charging_default.png" width="384" />
            </div>

        </div>

<div class="section"><h2 class="title sectiontitle">Timing determination</h2>
<p class="p">The timing determination is the definition of time delay for roaming cases based on either the code of the country where the end-user is calling from (if provided) or on the address of the IP SGSN provided by the network from where the end user is calling. A table is hosted by the service data to associate a time difference with the country codes. You can configure the service to rate either on the timing of the visited network or on the timing of the home network. </p>

</div>

<div class="section"><h2 class="title sectiontitle">Notification for specific roaming cases</h2>
<p class="p">Subscribers can subscribe international roaming subscriptions that are active when subscriber is in a particular zone and uses a specific operator. Notifications can be sent once the subscriber tries to use the subscription when in a different zone or uses a different operator. Note that, MCC-MNC or SGSN IP can be used to determine the location of a subscriber. This can be configured in the Mapping tables.</p>

<p class="p">For example, consider that a subscriber has a subscription of day pass bundle that is active only for zone1 and ABC operator. An SMS notification is sent in the following cases:</p>
<ul class="ul">
<li class="li">
<p class="p">If the subscriber tries to use the subscription when not in zone1, then the call is rejected.</p>

</li>

<li class="li">
<p class="p">If a subscriber is in a valid network but not allowed to make calls in this network, then the call is rejected.</p>

</li>

</ul>

<p class="p">The notification includes the data defined in the notification template that can indicate that the subscriber is in wrong network. </p>

<p class="p">Whenever there is an error in MCC-MNC or SGSN IP match, the notification can be sent to a subscriber using the rule set RATING_POST_PROCESSING. See the subsequent section with examples for more information.</p>

<div class="sectiondiv"><p class="p"><strong class="ph b">Common configuration examples:</strong></p>
<p class="p">Ensure that the following entities are
                    configured:</p>
<ul class="ul">
                    <li class="li"><p class="p">Create a charging service as shown in the following figure.</p>
<a href="../images/img9yz-09126-ug01-pczza-sp1-mod-449_cs1_default.png" class="image"><img class="image scalefit" src="../images/img9yz-09126-ug01-pczza-sp1-mod-449_cs1_default.png" height="204" width="537" /></a><a href="../images/img9yz-09126-ug01-pczza-sp1-mod-449_cs2_default.png" class="image"><img class="image scalefit" src="../images/img9yz-09126-ug01-pczza-sp1-mod-449_cs2_default.png" height="292" width="520" /></a>
                        <a href="../images/img9yz-09126-ug01-pczza-sp1-mod-449_cs3_default.png" class="image"><img class="image scalefit" src="../images/img9yz-09126-ug01-pczza-sp1-mod-449_cs3_default.png" /></a><a href="../images/img9yz-09126-ug01-pczza-sp1-mod449-cs4_default.png" class="image"><img class="image scalefit" src="../images/img9yz-09126-ug01-pczza-sp1-mod449-cs4_default.png" /></a><a href="../images/img9yz-09126-ug01-pczza-sp1-mod-449_cs5_default.png" class="image"><img class="image scalefit" src="../images/img9yz-09126-ug01-pczza-sp1-mod-449_cs5_default.png" /></a>
                    </li>

                    <li class="li"><p class="p">Create the following mapping tables.</p>
<a href="../images/img9yz-09126-ug01-pczza-sp1-mod-449_map1_default.png" class="image"><img class="image scalefit" src="../images/img9yz-09126-ug01-pczza-sp1-mod-449_map1_default.png" height="216" width="535" /></a>
                        <p class="p">
                            <span class="ph uicontrol">Mapping table 1</span>
                        </p>
<a href="../images/img9yz-09126-ug01-pczza-sp1-mod-449_map2_default.png" class="image"><img class="image scalefit" src="../images/img9yz-09126-ug01-pczza-sp1-mod-449_map2_default.png" height="245" width="649" /></a><a href="../images/img9yz-09126-ug01-pczza-sp1-mod-449_map3_default.png" class="image"><img class="image scalefit" src="../images/img9yz-09126-ug01-pczza-sp1-mod-449_map3_default.png" height="257" width="594" /></a>
                        <p class="p">
                            <span class="ph uicontrol">Mapping table 2</span>
                        </p>
<a href="../images/img9yz-09126-ug01-pczza-sp1-mod-449_map4_default.png" class="image"><img class="image scalefit" src="../images/img9yz-09126-ug01-pczza-sp1-mod-449_map4_default.png" /></a>
                        <a href="../images/img9yz-09126-ug01-pczza-sp1-mod-449_map5_default.png" class="image"><img class="image scalefit" src="../images/img9yz-09126-ug01-pczza-sp1-mod-449_map5_default.png" /></a>
                    </li>

                    <li class="li">
                        <p class="p">Create the notification templates.</p>

                    </li>

                    <li class="li">
                        <p class="p">Create a subscription lifecycle to be linked to the bundle.</p>

                    </li>

                    <li class="li">
                        <p class="p">Create a bundle and attach the previously created charging service and
                            lifecycle.</p>

                    </li>

                    <li class="li">
                        <p class="p">Create a device and account.</p>

                    </li>

                </ul>
Apply the above configuration to following examples:</div>
<div class="sectiondiv">
<p class="p"><strong class="ph b">Example 1: MCC collected from network has null value</strong></p>

<p class="p">If the MCC is null, the result code 40010 (RULE_NOT_APPLICABLE) is returned and a notification is sent. Following is the rule configuration for <span class="ph uicontrol">RATING_POST_PROCESSING</span> trigger:</p>

<div class="fig fignone">
                    <img class="image break" height="288" src="../images/img9yz-09126-ug01-pczza-sp1-mod449_mccnotpresent_default.png" width="576" />
                </div>

                
</div>
<div class="sectiondiv">
<p class="p"><strong class="ph b">Example 2: Roaming to wrong PLMN</strong></p>

<p class="p">If a subscriber tries to make calls when in wrong network, the result code 40010 is returned and a notification is sent and the call is terminated. Following is the rule configuration for <span class="ph uicontrol">RATING_POST_PROCESSING</span> trigger:</p>

<div class="fig fignone">
                    <img class="image break" height="288" src="../images/img9yz-09126-ug01-pczza-sp1-mod449_unknown1_default.png" width="288" />
                </div>

                
</div>
<div class="sectiondiv">
<p class="p"><strong class="ph b">Example 3: Roaming to correct PLMN without a valid bundle</strong></p>

<p class="p">If a subscriber is in the correct network but has no bundle to be used for the call, then the defined result code is returned and a notification is sent and the call is terminated. Following is the rule configuration for <span class="ph uicontrol">RATING_POST_PROCESSING</span> trigger:</p>

<div class="fig fignone">
                    <img class="image break" height="288" src="../images/img9yz-09126-ug01-pczza-sp1-mod449_ratingfailed1_default.png" width="384" />
                </div>

                
<div class="fig fignone">
                    <img class="image break" height="240" src="../images/img9yz-09126-ug01-pczza-sp1-mod449_ratingfailed2_default.png" width="288" />
                </div>

</div>
</div>

</div>
<div class="footer"><hr /><p>Charging User Guide • P556766-DN1000054947-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>