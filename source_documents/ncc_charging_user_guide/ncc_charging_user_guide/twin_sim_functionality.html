<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Twin SIM functionality" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="twin_sim_functionality" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Twin SIM functionality</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="twin_sim_functionality">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Twin SIM functionality</h1>
<div class="body conbody">
        <div class="section" id="twin_sim_functionality__section_gqc_vj3_v4b">
            <p class="p">Before this feature, NCC supported notification to be sent only to the first E164
                identifier of a device.</p>

            <p class="p">With this feature, the Notification Server (NS) is enhanced to send notifications to
                the primary MSISDN, which can be taken from the phone number (E164) configured in a
                user entity, thus supporting multiple device identities, such as one <em class="ph i">Device
                    ID</em> , two <em class="ph i">E164</em>, and one <em class="ph i">IMSI</em> for a device.</p>

            <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> For this feature, the provisioning system must ensure the following:<ul class="ul" id="twin_sim_functionality__ul_m2g_qk3_v4b">
                    <li class="li">
                        <p class="p">MSISDN configured in a user entity is the <strong class="ph b">Primary MSISDN</strong>.</p>

                    </li>

                    <li class="li">
                        <p class="p">Device should be created with a <em class="ph i">DeviceID</em> same as the <strong class="ph b">Primary
                                MSISDN</strong> for twin SIM devices.</p>

                    </li>

                    <li class="li">
                        <p class="p">The user entity should be always be configured and with only MSISDN and
                            not multiple MSISDNs.</p>

                    </li>

                </ul>
</div>

            <p class="p">Following APIs are supported for this feature:</p>

            <ul class="ul" id="twin_sim_functionality__ul_frh_2m3_v4b">
                <li class="li">
                    <p class="p"><em class="ph i">createDevice</em> API</p>

                </li>

                <li class="li">
                    <p class="p"><em class="ph i">createProfile</em> API</p>

                </li>

                <li class="li">
                    <p class="p"><em class="ph i">/services/ServiceManager/subscriber/updateByIdentifier/Device</em></p>

                </li>

                <li class="li">
                    <p class="p"><em class="ph i">/services/ServiceManager/subscriber/update/Identities</em></p>

                </li>

                <li class="li">
                    <p class="p"><em class="ph i">/services/ServiceManager/subscriber/deltaUpdate/Device?subAction=(add,modify,remove)</em></p>

                </li>

                <li class="li">
                    <p class="p"><em class="ph i">/services/ServiceManager/subscriber/update/Device</em></p>

                </li>

            </ul>

        </div>

    </div>
<div class="topic concept nested1" aria-labelledby="ariaid-title2" id="concept_mbh_1k3_v4b"><h2 class="title topictitle2" id="ariaid-title2">Configuration</h2>
<div class="body conbody">
            <p class="p">To enable this functionality, set the application preference  <strong class="ph b">Send Notification
                    MSISDN</strong> as <var class="keyword varname">USER_PRIMARY_MSISDN</var>.</p>

            <p class="p">However, if the <strong class="ph b">Send Notification MSISDN</strong> is set as <var class="keyword varname">DEVICE</var>,
                then the notification is sent to the device E164 identifier.</p>

            <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> 
                <ul class="ul" id="concept_mbh_1k3_v4b__ul_wdv_dn3_v4b">
                    <li class="li">
                        <p class="p">If a user entity is configured with multiple phone numbers, then the
                            notification is sent randomly.</p>

                    </li>

                    <li class="li">
                        <p class="p">If a user entity is configured with a phone number, which is not the
                            MSISDN (that is, E164 identifier of the device), then the notification
                            is sent to the E164 identifier defined in the <em class="ph i">Device ID</em>.</p>

                    </li>

                </ul>

            </div>

        </div>
</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title3" id="concept_y3t_mq3_v4b"><h2 class="title topictitle2" id="ariaid-title3">EDR enhancement</h2>
<div class="body conbody">
            <p class="p">When a device is being provisioned or updated with multiple device identities, such
                as one <em class="ph i">Device ID</em>, two <em class="ph i">E164</em>, and one <em class="ph i">IMSI</em>, the EDR for the
                device states all the provisioned E164 and IMSI identifiers.</p>

            <p class="p">Only Provisioning EDRs related to device contains the tags and it is required to have
                a separate distinct tag for each identifier, that is E164 multiple times in an
                EDR.</p>

            <p class="p">Configure the following application preferences:</p>

            <ul class="ul" id="concept_y3t_mq3_v4b__ul_s1t_tp3_v4b">
                <li class="li">
                    <p class="p">Set the <strong class="ph b">EDR Enhancement Enabled</strong> as
                        <var class="keyword varname">DEVICE_UPDATE</var>.</p>

                </li>

                <li class="li">
                    <p class="p">Set the <strong class="ph b">EDR Generator Flag</strong> as <var class="keyword varname">true</var>.</p>

                </li>

                <li class="li">
                    <p class="p">Set the <strong class="ph b">EDR Enabled</strong> as <var class="keyword varname">true</var>.</p>

                </li>

            </ul>

            <p class="p">For more information on EDR details, refer to the <cite class="cite">NCC CDR/EDR Reference
                Guide</cite>.</p>

            <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> Backward compatibility of EDR for a device update is maintained.</div>

        </div>
</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title4" id="concept_avd_xq3_v4b"><h2 class="title topictitle2" id="ariaid-title4">Landing Gateway API</h2>
<div class="body conbody">
            <p class="p">The <em class="ph i">/services/ServiceManager/getRefData/ChargingSession</em> API is used to fetch
                the Gy session with multiple E164 identifiers. For example, consider the following
                images wherein we fetch Gy session with multiple E164:</p>

            <ul class="ul" id="concept_avd_xq3_v4b__ul_hkg_mr3_v4b">
                <li class="li">
                    <p class="p">First <em class="ph i">E164</em> set as <var class="keyword varname">1234567890</var>.</p>

                </li>

                <li class="li">
                    <p class="p">Second <em class="ph i">E164</em> set as <var class="keyword varname">1234567891</var>.</p>

                </li>

            </ul>

            <img class="image break" id="concept_avd_xq3_v4b__image_pz1_ps3_v4b" src="../images/landing_gateway_api_img1.PNG" />
            
            <img class="image break" id="concept_avd_xq3_v4b__image_bgt_ps3_v4b" src="../images/landing_gateway_api_img2.PNG" />
            <p class="p">Sessions related to <var class="keyword varname">Device-1</var> are fetched in this example:</p>

            <img class="image break" id="concept_avd_xq3_v4b__image_ks3_qs3_v4b" src="../images/landing_gateway_api_img3.PNG" height="205" width="894" />
            
            <img class="image break" id="concept_avd_xq3_v4b__image_sz1_rs3_v4b" src="../images/landing_gateway_api_img4.PNG" height="231" width="715" />
            <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> This scenario is also applicable to IMS, Sy, N40, and N28 sessions.</div>

            <p class="p">The execution of parallel Gy calls with configuration of different APN or location,
                and with two E164 <em class="ph i">Subscription-Id</em> is populated in the CDR tag from the device
                (E164 or IMSI as per call request); as, in general,  all <em class="ph i">Subscription-Id</em>
                reported in a CCR request are dumped in CDR.</p>

            <p class="p">Multiple Sy sessions support for both E164 identifiers provisioned in the device.
                There can be a dedicated Gy and Sy session for each E164 configured in the device;
                therefore, with respect to the device, it is multiple Gy or Sy for twin E164
                sessions.</p>

            <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> 
                <ul class="ul" id="concept_avd_xq3_v4b__ol_z1y_xt3_v4b">
                    <li class="li">
                        <p class="p">To fetch RAR from API to all Gy sessions of  a device having two E164
                            identifiers:</p>

                        <p class="p"><em class="ph i">services/ServiceManager/sendRARForSubscriber/GySession?</em></p>

                    </li>

                    <li class="li">
                        <p class="p">To fetch ASR from API to all Gy, Ro, or N40 sessions of a device:</p>

                        <p class="p"><em class="ph i">services/ServiceManager/sendASRForSubscriber/GySession?</em></p>

                    </li>

                    <li class="li">
                        <p class="p">Use <em class="ph i">/services/ServiceManager/subscriber/getData/Subscription</em> in
                            twin SIM functionality for <em class="ph i">getData/Subscription</em> API; whereas, use
                                <em class="ph i">getData/Subscription</em> for multiple Identifiers for twin SIM
                            functionality.</p>

                    </li>

                    <li class="li">As sessions contain internal information used by charging logic, not all
                        attributes are returned in the getRefData/ChargingSession API response.</li>

                </ul>

            </div>

        </div>
</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title5" id="concept_a31_bk3_v4b"><h2 class="title topictitle2" id="ariaid-title5">Additional information</h2>
<div class="body conbody">
            <div class="section" id="concept_a31_bk3_v4b__section_rwr_pn3_v4b">
                <p class="p">Consider the following points for this feature:</p>

                <ul class="ul" id="concept_a31_bk3_v4b__ul_nd4_qn3_v4b">
                    <li class="li">
                        <p class="p">In NCC, a device can be provisioned with E164s attached to another
                            device. The application preference <strong class="ph b">Restrict duplicate E164 in
                                device</strong> restricts provisioning of devices with duplicate E164
                            (that is, device with an E164 that is already attached to another
                            device).</p>

                        <p class="p">If this flag is enabled (= 1) then only unique E164 is provisioned.</p>

                        <p class="p">If the user is supposed to create a device with existing E164, then an
                            exception is thrown.</p>

                    </li>

                    <li class="li">
                        <p class="p">If two devices have the same E164 and the request from network contains
                            input E164, then the call is rejected with an error.</p>

                    </li>

                    <li class="li">
                        <p class="p">This feature supports configuring a device identifier with ONLY two E164s
                            and one IMSI. It is NOT recommended to use more than two E164s and more
                            than one IMSI. </p>

                    </li>

                    <li class="li">
                        <p class="p">Call execution is dependent on the <em class="ph i">Input Subscription ID</em> AVP.</p>

                    </li>

                </ul>

            </div>

        </div>
</div>
<div class="footer"><hr /><p>Charging User Guide • P556766-DN1000054947-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>