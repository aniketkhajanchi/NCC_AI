<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Showing the actual policy counter status in SLA" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="actual_policy_counter_status_in_sla" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Showing the actual policy counter status in SLA</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="actual_policy_counter_status_in_sla">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Showing the actual policy counter status in
        SLA</h1>
<div class="body conbody">
        <div class="section" id="actual_policy_counter_status_in_sla__section_pzl_hsr_ymb">
            <p class="p">Before this feature, when a subscriber was created and a subscription was purchased
                or already associated to a group but the resource was empty at the time of
                subscriber creation, the policy counter status being sent to PCRF by the OCS server
                was the default value (as <var class="keyword varname">-99</var>) in the initial SLA as response.
                However, the expected policy counter state was the actual policy counter state after
                evaluation of its policy threshold as configured by the operator.</p>

            <p class="p">This feature provides the actual policy counter status as a result in SLA when a
                newly provisioned prepaid subscriber subscribes to a bundle, a bucket resource is
                created with zero volume, or a subscription is offered through
                <em class="ph i">ChangePlan</em>.</p>

            <p class="p">For example, create a group with 4 bundles and attach a policy counter to the group.
                Apply an Aggregate View (AV) to the group, which has SO threshold applied on it. A
                group policy counter, which is a resource-based counter has a threshold applied for
                the first data consumption (<var class="keyword varname">Absolute from Start</var>) at zero. The
                threshold at zero for provisioning as <var class="keyword varname">Absolute from Start</var> with
                policy counter state as <var class="keyword varname">validVolume</var> and the threshold at zero for
                Diameter request as <var class="keyword varname">Absolute from End</var> with policy counter state
                as <var class="keyword varname">NoValidVolume</var>.</p>

            <p class="p">As per the previous behavior, if a device was attached to the group and the group had
                a subscription but there was no volume in the group, which meant that subscription
                had buckets with zero initial value, then the policy counter state being returned
                was <var class="keyword varname">-99</var>, which was mapped at PCRF as <var class="keyword varname">HIGH</var>.
                Therefore, when PGW sent a Gy CCR at OCS, no volume was there on the group
                subscription, a CLR is returned back to the network, and subscriber was never
                redirected to the portal for top-up.</p>

            <p class="p">With this feature, if a device is attached to the group and the group has a
                subscription but there is no volume in the group, which means subscription has
                buckets with zero initial value, then the policy counter state is returned as
                defined, which is <var class="keyword varname">noValidVolume</var> because bucket though exists but
                has zero initial value mapped at PCRF as <var class="keyword varname">REDIRECT</var>. Therefore, PGW
                results to Gy CCR-I request after the redirect and accordingly, the call flow
                continues.</p>

        </div>

        <div class="section" id="actual_policy_counter_status_in_sla__section_j5x_nwr_ymb"><h2 class="title sectiontitle">Additional information</h2>
            
            <p class="p">Consider the following points for this feature:</p>

            <ul class="ul" id="actual_policy_counter_status_in_sla__ul_j1f_pwr_ymb">
                <li class="li">
                    <p class="p">This functionality is applicable to:</p>

                    <ul class="ul" id="actual_policy_counter_status_in_sla__ul_hgk_ptr_ymb">
                        <li class="li">
                            <p class="p">AV on device, group, or both.</p>

                        </li>

                        <li class="li">
                            <p class="p"><em class="ph i">create Bucket</em>, <em class="ph i">ChangePlan</em>, and a new subscription
                                created particularly for a new subscriber.</p>

                        </li>

                    </ul>

                </li>

                <li class="li">
                    <p class="p">AV is of <em class="ph i">Charging Service</em> type and applied to a group.</p>

                </li>

                <li class="li">
                    <p class="p">There are no adaptation for counter resources.</p>

                </li>

                <li class="li">
                    <p class="p">Bucket is always created in the subscription.</p>

                </li>

                <li class="li">
                    <p class="p">During a subscription add or update, if an AV or bucket has both old unused
                        value (before subscription add or update) and new unused value (after
                        subscription add or update) as zero, then thresholds of type
                            <var class="keyword varname">Absolute from End</var> is evaluated.</p>

                </li>

            </ul>

        </div>

        <div class="section" id="actual_policy_counter_status_in_sla__section_yqf_vds_ymb"><h2 class="title sectiontitle">Example</h2>
            
            <p class="p">With this example, it is verified that the actual policy counter state in SLA and SNR
                are sent when a threshold is attached to a policy counter and AV.</p>

            <p class="p"><strong class="ph b">Provisioning:</strong></p>

            <ol class="ol" id="actual_policy_counter_status_in_sla__ol_hgm_12s_ymb">
                <li class="li">
                    <p class="p">Set the <em class="ph i">Default Signaling State in SLA (Initial)</em> as
                            <var class="keyword varname">false</var>.</p>

                </li>

                <li class="li">
                    <p class="p">Create a charging service <var class="keyword varname">CS1</var> with a bucket
                            <var class="keyword varname">Bucket1</var> and bucket balance as zero. Associate
                            <var class="keyword varname">CS1</var> to a bundle <var class="keyword varname">Bundle1</var>.</p>

                </li>

                <li class="li">
                    <p class="p">Create two thresholds <var class="keyword varname">TPG_teeth003091</var> of <var class="keyword varname">Absolute
                            from End</var> type and <var class="keyword varname">TPG_ABS003091</var> of
                            <var class="keyword varname">Absolute from Start</var> type:</p>

                    <p class="p">For <var class="keyword varname">Absolute from End</var> threshold:</p>

                    <img class="image break" id="actual_policy_counter_status_in_sla__image_mph_lxy_ymb" src="../images/abethreshold1.png" height="162" width="279" />
                    
                    <p class="p">For <var class="keyword varname">Absolute from Start</var> threshold:</p>

                    <img class="image break" id="actual_policy_counter_status_in_sla__image_kkh_pyy_ymb" src="../images/absthreshold1.png" height="162" width="271" />
                    
                </li>

                <li class="li">
                    <p class="p">Create an AV of <em class="ph i">Charging Service</em> type and attach the
                            <var class="keyword varname">TPG_teeth003091</var> and <var class="keyword varname">TPG_ABS003091</var>
                        thresholds to that AV.</p>

                </li>

                <li class="li">
                    <p class="p">Create a resource-based policy counter and attach the counter threshold
                            (<var class="keyword varname">Absolute from Start</var>) to it with following
                        conditions:</p>

                    <ol class="ol" type="a" id="actual_policy_counter_status_in_sla__ol_qts_n2s_ymb">
                        <li class="li">
                            <p class="p">If charging is done from a device, then set the policy counter state
                                as <var class="keyword varname">HIGH</var>.</p>

                        </li>

                        <li class="li">
                            <p class="p">If charging is done from a group, then set the policy counter state
                                as <var class="keyword varname">LOW</var>.</p>

                        </li>

                    </ol>

                    <img class="image break" id="actual_policy_counter_status_in_sla__image_hnf_rgs_ymb" src="../images/absthreshold.png" height="178" width="299" />
                    
                </li>

                <li class="li">
                    <p class="p">Create an account, device (with charging group first), and a group.</p>

                </li>

                <li class="li">
                    <p class="p">Attach AV and counter to the group.</p>

                </li>

                <li class="li">
                    <p class="p">Attach subscription to the group.</p>

                </li>

            </ol>

            <p class="p"><strong class="ph b">Call processing:</strong></p>

            <ol class="ol" id="actual_policy_counter_status_in_sla__ol_p4y_x2s_ymb">
                <li class="li">
                    <p class="p">Execute a Gx initial and terminate call.</p>

                </li>

                <li class="li">
                    <p class="p">Update the bucket balance using <em class="ph i">Bucket Update Instance</em> API set to
                            <var class="keyword varname">20</var>.</p>

                </li>

                <li class="li">
                    <p class="p">Execute a Gx initial call.</p>

                </li>

                <li class="li">
                    <p class="p">Execute a Gy call:</p>

                    <p class="p"><var class="keyword varname">CCR(I): RSU = 10</var></p>

                    <p class="p"><var class="keyword varname">CCR(U): USU=10, RSU = 10</var></p>

                    <p class="p"><var class="keyword varname">CCR(T): USU = 10</var></p>

                </li>

                <li class="li">
                    <p class="p">Execute a Gx terminate call.</p>

                </li>

            </ol>

            <p class="p"><strong class="ph b">Verification:</strong></p>

            <ol class="ol" id="actual_policy_counter_status_in_sla__ol_skd_3fs_ymb">
                <li class="li">
                    <p class="p">When the first Gx initial and terminate calls are triggered (when bucket
                        balance is zero), the policy counter state is returned as
                            <var class="keyword varname">LOW</var> in SLA.</p>

                </li>

                <li class="li">
                    <p class="p">After the bucket update, when Gx initial call is executed, the policy counter
                        state is returned as <var class="keyword varname">HIGH</var> in SLA.</p>

                </li>

                <li class="li">
                    <p class="p">When a Gy call is initiated and CCR(I) request is triggered, SNR is sent with
                        policy counter state is returned as <var class="keyword varname">LOW</var> in SLA as
                        charging is done from group.</p>

                </li>

            </ol>

        </div>

    </div>
<div class="footer"><hr /><p>Charging User Guide • P556766-DN1000054947-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>