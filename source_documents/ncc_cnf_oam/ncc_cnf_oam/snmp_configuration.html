<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="SNMP configuration" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="snmp_configuration" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>SNMP configuration</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="snmp_configuration">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">SNMP configuration</h1>
<div class="body conbody">
        <p class="p">NCC may be configured to send alarm notifications to an external Simple Network
            Management Protocol (SNMP) manager. The external SNMP manager may then handle operations
            such as alarm acknowledgement, clearing, and table dumping. This section discusses the
            required configurations to utilize an external SNMP manager with an <span class="ph">NCC</span> deployment.</p>

        <p class="p">This information assumes that the Net-SNMP suite of applications on a Maestro VM are
            installed as the external SNMP manager. Other external SNMP managers may also be used.
            For information regarding other external SNMP manager setups, contact Nokia Professional
            Services.</p>

        <div class="section" id="snmp_configuration__section_hd1_tr2_qnb"><h2 class="title sectiontitle">Prepare the external SNMP manager</h2>
            
            <div class="p">
                <ol class="ol" id="snmp_configuration__ol_pfk_rs2_qnb">
                    <li class="li">Ensure a Maestro VM has been installed. For more information regarding
                        installing the Maestro VM, contact Nokia Professional Services.</li>

                    <li class="li">
                        <p class="p">On the Maestro VM, run this command to ensure the Net-SNMP packages are
                            installed.</p>

                        <pre class="pre codeblock"><code>yum list net-snmp*</code></pre>
                        <p class="p">This output is expected, if Net-SNMP is installed.</p>

                        <pre class="pre codeblock"><code>-bash-4.2# yum list net-snmp*
Loaded plugins: fastestmirror, product-id, search-disabled-repos, subscription-manager
 
This system is not registered with an entitlement server. You can use subscription-manager to register.
 
Loading mirror speeds from cached hostfile
Installed Packages
net-snmp.x86_64                        1:5.7.2-37.el7            installed
net-snmp-agent-libs.x86_64             1:5.7.2-37.el7            installed
net-snmp-libs.x86_64                   1:5.7.2-37.el7            installed
net-snmp-utils.x86_64                  1:5.7.2-37.el7            installed</code></pre>
                        <p class="p">If the Net-SNMP packages are not installed, run the following command to
                            install them.</p>

                        <pre class="pre codeblock"><code>yum install net-snmp*</code></pre>
                    </li>

                    <li class="li">
                        <p class="p">Update the MIB files on the Maestro VM, available on the Alarm Manager
                            pod(s) in the <code class="ph codeph">/usr/lib/alma/mibs/ne3s/</code> directory.</p>

                        <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> Nokia recommends the MIB files obtained and used are always up-to-date
                            and aligned between the Alarm Manager pod(s) and the SNMP manager of the
                            NMS.</div>

                        <ol class="ol" type="a" id="snmp_configuration__ol_w3c_hv2_qnb">
                            <li class="li">Copy the entirety of the <code class="ph codeph">/usr/lib/alma/mibs/ne3s/</code>
                                directory's files on the Alarm Manager pod to some external
                                location. </li>

                            <li class="li">Use the utilities <code class="ph codeph">tar</code> and <code class="ph codeph">gzip</code> to
                                combine all copies MIB files to a tarfile
                                    <code class="ph codeph">CHF-MIBs.tgz</code>. </li>

                            <li class="li">Move the <code class="ph codeph">CHF-MIBs.tgz</code> tarfile under the root user's
                                home directory on the Maestro VM. </li>

                            <li class="li">Login as root on the Maestro VM. </li>

                            <li class="li">Using the <code class="ph codeph">tar</code> utility, extract the MIB files from
                                the <code class="ph codeph">CHF-MIBs.tgz</code> tarfile in the root user's home
                                directory on the Maestro VM. </li>

                            <li class="li">
                                <p class="p">Ensure the user and usergroup for each of the newly extracted MIB
                                    files are set to <code class="ph codeph">root:root</code>.</p>

                            </li>

                            <li class="li">Verify that the Maestro VM <code class="ph codeph">/usr/share/snmp/mibs/</code>
                                directory does not already have the MIB files. If there are older
                                copies of the MIB files in the Maestro VM
                                    <code class="ph codeph">/usr/share/snmp/mibs/</code> directory, then remove
                                them. </li>

                            <li class="li">Move all of the newly extracted MIB files from the root user's home
                                directory to the Maestro VM <code class="ph codeph">/usr/share/snmp/mibs/</code>
                                directory. </li>

                        </ol>

                    </li>

                    <li class="li">
                        <p class="p">Update the <code class="ph codeph">/etc/snmp/snmptrapd.conf</code> file on the Maestro
                            VM.</p>

                        <ol class="ol" type="a" id="snmp_configuration__ol_uwb_yw2_qnb">
                            <li class="li">Backup the existing Maestro VM
                                    <code class="ph codeph">/etc/snmp/snmptrapd.conf</code> file. </li>

                            <li class="li">
                                <p class="p">Use the following command to get the Alarm Manager engine ID.</p>

                                <pre class="pre codeblock"><code>echo -n "CALMDefaultEngineID" | od -A n -t x1 | sed "s/ //g</code></pre>
                                <p class="p">If the output of the above command is two lines of string output,
                                    use the concatenated result of the two lines as the final Alarm
                                    Manager engine ID. This is an example of what the output may
                                    look like.</p>

                                <pre class="pre codeblock"><code>43414c4d44656661756c74456e67696e
654944</code></pre>
                                <div class="p">In this example, the final Alarm Manager engine ID would
                                    be:<pre class="pre codeblock"><code>43414c4d44656661756c74456e67696e654944</code></pre></div>

                                <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> 3rd party client software such as Net-SNMP typically accept
                                    un-encrypted passwords, so the <code class="ph codeph">createUser</code> line
                                    must use the un-encrypted value that the <code class="ph codeph">Northbound OSS
                                        Related Settings</code> section captures under the Alarm
                                    Service subchart in the <span class="ph">NCC</span>
                                    Telemetry <code class="ph codeph">values_btel_sps_xxx.yaml</code> file.</div>

                            </li>

                            <li class="li">Edit the <code class="ph codeph">authuser log</code> line of the Maestro VM
                                    <code class="ph codeph">/etc/snmp/snmptrapd.conf</code> file to contain the
                                same data as the <code class="ph codeph">Northbound OSS Related Settings</code>
                                section. </li>

                            <li class="li">
                                <p class="p">Edit the <code class="ph codeph">createUser</code> line of the Maestro VM
                                        <code class="ph codeph">/etc/snmp/snmptrapd.conf</code> file to container
                                    the same data as the <code class="ph codeph">Northbound OSS Related
                                        Settings</code> section. The line should look like this
                                    example.</p>

                                <pre class="pre codeblock"><code>createUser -e &lt;CALM_Engine_ID&gt; initial_snm MD5 &lt;password&gt; DES</code></pre>
                                <div class="p">Where:<ul class="ul" id="snmp_configuration__ul_ykc_z1f_qnb">
                                        <li class="li"><code class="ph codeph">&lt;CALM_Engine_ID&gt;</code> is the Alarm
                                            Service engine ID as found in the prior step. </li>

                                        <li class="li"><code class="ph codeph">&lt;password&gt;</code> is the password for the
                                            user. </li>

                                    </ul>
With respect to the prior example, the Maestro VM
                                        <code class="ph codeph">/etc/snmp/snmptrapd.conf</code> file might look
                                    like this example.</div>

                                <pre class="pre codeblock"><code># Example configuration file for snmptrapd
#
# No traps are handled by default, you must edit this file!
#
# authCommunity   log,execute,net public
# traphandle SNMPv2-MIB::coldStart    /usr/bin/bin/my_great_script cold
createUser -e 43414c4d44656661756c74456e67696e654944 initial_snm MD5 Ma!n5treet DES
authuser log initial_snm</code></pre>
                            </li>

                        </ol>

                    </li>

                    <li class="li">
                        <p class="p">Update the firewall of the Maestro VM with the following commands.</p>

                        <pre class="pre codeblock"><code>firewall-cmd --permanent --add-port=161/udp
firewall-cmd --permanent --add-port=162/udp
firewall-cmd --reload</code></pre>
                    </li>

                    <li class="li">
                        <p class="p">Start the snmpd service with the following command.</p>

                        <pre class="pre codeblock"><code>systemctl start snmpd</code></pre>
                    </li>

                    <li class="li">
                        <p class="p">Start the snmptrapd service with the following command.</p>

                        <pre class="pre codeblock"><code>snmptrapd -Lsd -f</code></pre>
                    </li>

                    <li class="li">
                        <p class="p">Monitor the snmptrapd service with the following command.</p>

                        <pre class="pre codeblock"><code>journalctl -fu snmptrapd</code></pre>
                    </li>

                </ol>

            </div>

        </div>

        <div class="section" id="snmp_configuration__section_str_sz2_qnb"><h2 class="title sectiontitle">Prepare an encrypted password with the fpm-password tool</h2>
            
            <p class="p">A tool is needed in order to encrypt and decrypt the <code class="ph codeph">authPassword</code>
                and <code class="ph codeph">privPassword</code> parameters that are part of the <code class="ph codeph">Northbound
                    OSS Related Settings</code> section that must be included under the Alarm
                Service sub-chart in the <span class="ph">NCC</span> Telemetry
                    <code class="ph codeph">values_btel_sps_xxx.yaml</code> file of each site. This procedure
                shows how to do this with the fpm-password tool.</p>

            <ol class="ol" id="snmp_configuration__ol_sd4_b1f_qnb">
                <li class="li">
                    <p class="p">The fpm-password tool is located inside the <code class="ph codeph">spsinstantiate</code>
                        docker container. Execute the command as shown here inside the container
                        environment before running the fpm-password tool.</p>

                    <pre class="pre codeblock"><code>maestro ace develop</code></pre>
                </li>

                <li class="li">
                    <p class="p">To encrypt a password using the fpm-password tool, use the following
                        command.</p>

                    <pre class="pre codeblock"><code>fpm-password en '&lt;password&gt;' &lt;passPhrase&gt;</code></pre>
                    <div class="p">Where:<ul class="ul" id="snmp_configuration__ul_axh_k1f_qnb">
                            <li class="li"><code class="ph codeph">&lt;password&gt;</code> is the un-encrypted password to be
                                added as the <code class="ph codeph">authPassword</code> and
                                    <code class="ph codeph">privPassword</code> in
                                    <code class="ph codeph">values_btel_sps_xxx.yaml</code> file. </li>

                            <li class="li"><code class="ph codeph">&lt;passPhrase&gt;</code> is the value defined in the
                                    <code class="ph codeph">passPhrase</code> line of the
                                    <code class="ph codeph">values_btel_sps_xxx.yaml</code> file. </li>

                        </ul>
</div>

                </li>

                <li class="li">
                    <p class="p">To decrypt a password using the fpm-password tool, use the following
                        command.</p>

                    <pre class="pre codeblock"><code>fpm-password de '&lt;password&gt;' &lt;passPhrase&gt;</code></pre>
                    <div class="p">Where:<ul class="ul" id="snmp_configuration__ul_t4p_s1f_qnb">
                            <li class="li"><code class="ph codeph">&lt;password&gt;</code> is the encrypted password used for
                                    <code class="ph codeph">authPassword</code> and <code class="ph codeph">privPassword</code>
                                in <code class="ph codeph">values_btel_sps_xxx.yaml</code> file. </li>

                            <li class="li"><code class="ph codeph">&lt;passPhrase&gt;</code> is the value defined in the
                                    <code class="ph codeph">passPhrase</code> line of the
                                    <code class="ph codeph">values_btel_sps_xxx.yaml</code> file. </li>

                        </ul>
</div>

                </li>

            </ol>

        </div>

        <div class="section" id="snmp_configuration__section_p2k_gbf_qnb"><h2 class="title sectiontitle">Prepare and apply the SNMP configuration for the site(s) under <span class="ph">NCC</span> Telemetry helm charts</h2>
            
            <p class="p">Once the SNMP configurations have been set, use the following procedure to finalize
                and apply these configurations to the site or sites under <span class="ph">NCC</span> Telemetry helm charts.</p>

            <ol class="ol" id="snmp_configuration__ol_q5d_kbf_qnb">
                <li class="li">
                    <p class="p">Install everything for NCC. For more information regarding <span class="ph">NCC</span> installation,
                        see the <cite class="cite">Installation and Upgrade Guide</cite>.</p>

                </li>

                <li class="li">
                    <p class="p">Ensure the fpm-password tool has been used to prepare an encrypted password
                        for the <code class="ph codeph">authPassword</code> and <code class="ph codeph">privPassword</code>
                        parameters found in the <code class="ph codeph">Northbound OSS Related Settings</code>
                        section which must be included under the Alarm Service sub-chart in the <span class="ph">NCC</span> Telemetry
                            <code class="ph codeph">values_btel_sps_xxx.yaml</code> file of each site. For more
                        information, see <a class="xref" href="#snmp_configuration__section_str_sz2_qnb">Prepare an encrypted password with the fpm-password tool</a>.</p>

                </li>

                <li class="li">
                    <p class="p">Verify that the Alarm Service pod has applied the SNMP configuration by using
                        the this command run from the Alarm Service pod.</p>

                    <pre class="pre codeblock"><code>cat /etc/alma/alma.snmp4j.properties</code></pre>
                </li>

            </ol>

        </div>

        <div class="section" id="snmp_configuration__section_z4c_pcf_qnb"><h2 class="title sectiontitle">Access active and archived alarm history</h2>
            
            <p class="p">If <span class="ph">NCC</span> is integrated to any NMS or NetAct, engineId and
                heartBeatInterval are important parameters in the Northbound OSS Related Settings
                section which must be included under the Alarm Service sub-chart in the <span class="ph">NCC</span> Telemetry <code class="ph codeph">values_btel_sps_xxx.yaml</code>
                file of each site. To check more details, refer to the <code class="ph codeph">README.md</code> or
                    <code class="ph codeph">values.yaml</code> files in the <code class="ph codeph">../btel/charts/Alarm
                    Service/</code> directory.</p>

            <p class="p">The following procedure shows the general methodology to gain access to the recorded
                history of active and archived alarms.</p>

            <ol class="ol" id="snmp_configuration__ol_lfl_vcf_qnb">
                <li class="li">On the Alarm Service pod, retrieve the active and archived history of alarms
                    from MariaDB by using the Alarm Service RESTful APIs. </li>

                <li class="li">Save the data to files under the <code class="ph codeph">/tmp/</code> directory of the Alarm
                    Service pod. </li>

                <li class="li">Copy the files out of the Alarm Service pod. </li>

                <li class="li">Copy the files to outside of the BCMT or Kubernetes control node. </li>

            </ol>

        </div>

        <div class="section" id="snmp_configuration__section_ykq_kdf_qnb"><h2 class="title sectiontitle">Validate alarm notifications to the external SNMP manager</h2>
            
            <p class="p">Validation of alarm notifications to the external SNMP manager may be done by viewing
                and comparing the active and archived alarm history on both the Maestro VM and the
                external SNMP manager.</p>

            <p class="p">On the Maestro VM, this is an example of a command which can be used to print to
                terminal alarm notification logs.</p>

            <pre class="pre codeblock"><code>egrep -n  '"id":|"noiAdditionalText":|"noiProbableCause":|"text":|"sourceObject":|"sourceProblem"' &lt;alarms_file&gt;</code></pre>
            <p class="p">Where <code class="ph codeph">&lt;alarms_file&gt;</code> is the file containing alarm logs as found in
                    <a class="xref" href="#snmp_configuration__section_z4c_pcf_qnb">Access active and archived alarm history</a>.</p>

            <p class="p">On the external SNMP manager, the following is an example of a command which may be
                used to print to terminal alarm notification logs.</p>

            <pre class="pre codeblock"><code>snmpwalk -v 3 -n "" -a MD5 -A Ma\!n5treet -x DES -X  Ma\!n5treet -l authPriv -u initial_snm -e 0x43414c4d44656661756c74456e67696e654944 10.10.180.56:30018 .1.3.6.1.4.1.94.7.1.4.2.1</code></pre>
        </div>

    </div>
<div class="footer"><hr /><p>Operations, Administration, and Maintenance Guide • P556766-DN1000055092-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>