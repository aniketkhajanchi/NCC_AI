<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="SNR action and QoS handling when charging resources are exhausted or updated" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="id9yz-09126-ug01-pczza-sp1-snraction" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>SNR action and QoS handling when charging resources are exhausted or updated</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="id9yz-09126-ug01-pczza-sp1-snraction">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">SNR action and QoS handling when charging resources are exhausted or updated</h1>
<div class="body conbody">
<div class="section">
<p class="p">The <samp class="ph systemoutput">Send-SNR</samp> action on exhaustion of Aggregate Value (AV) can be achieved by configuring a threshold on AV exhaustion using an optional rule parameter that conveys the policy counter name within the <samp class="ph systemoutput">Send-SNR</samp> action with the existing rule parameter of the policy counter status using the SM GUI or REST API.</p>

<p class="p">The AV can be either of the following types:</p>
<ul class="ul">
<li class="li">
<p class="p">Charging service</p>

</li>

<li class="li">
<p class="p">Charging service and Cap</p>

</li>

<li class="li">
<p class="p">Counter</p>

</li>

</ul>

<div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> <ul class="ul">
<li class="li">
<p class="p">The <samp class="ph systemoutput">Send-SNR</samp> action scenario is applicable to AV and buckets. If AV is not used, then apply the same threshold configuration on the buckets. For buckets with <em class="ph i">ChargingStep</em>, the thresholds are configured only on zero value (as <var class="keyword varname">THRESHOLD_PROFILE.has-More-Steps</var> is computed and set in the source context only when the unused value of the AV is zero).</p>

</li>

<li class="li">
<p class="p">This feature can be configured for a policy counter when the <em class="ph i">Resource Based Flag</em> is set to <var class="keyword varname">True</var> in the counter definition. No threshold should be attached to the policy counter, which is attached to a group or device.</p>

</li>

<li class="li">
<p class="p">The policy counter name defined within the <samp class="ph systemoutput">Send-SNR</samp> action of the threshold action must be attached either to a device or group depending on whether the AV or bucket is attached to a device or group.</p>

</li>

<li class="li">
<p class="p">The <em class="ph i">Policy Threshold Flag</em> should be checked in a threshold attached to the AV.</p>

</li>

</ul>

</div>

<p class="p">This feature allows AV or bucket to send an SNR during the provisioning or during a Diameter call
                when AV or bucket balance is updated.</p>

<p class="p">If a CCR-U or CCR-T request is received, then at commit, a <samp class="ph systemoutput">Send-SNR</samp> action is sent from the AV or bucket to throttle the speed to low when the committed value on the bucket or AV (accumulating charging services having single or multiple buckets or counters) is exhausted.</p>

<p class="p">For information on step-charge scenario while handling a <samp class="ph systemoutput">Send-SNR</samp>
                action for an AV, see the <a class="xref" href="scf.html#Stepchargescenario">Step-charge scenario while handling Send-SNR action for AV</a> section.</p>

</div>

<div class="section" id="id9yz-09126-ug01-pczza-sp1-snraction__SendingSNRprov"><h2 class="title sectiontitle">Sending an SNR during provisioning or call</h2>
<p class="p">To send an SNR when AV is exhausted or incremented during provisioning or during a call, configure a threshold on AV updates. The threshold is configured with a rule attribute <em class="ph i">SY.SEND-SNR</em> with the following format:</p>
<ul class="ul">
<li class="li">
<p class="p">The policy counter name and its state is configured for the <samp class="ph systemoutput">Send-SNR</samp> action as <var class="keyword varname">C1,Low</var> where <var class="keyword varname">C1</var> is the policy counter name and <var class="keyword varname">Low</var> is the counter state.</p>

</li>

<li class="li">
<p class="p">However, if you need to configure two counters, then it is configured as <samp class="ph systemoutput">Send-SNR</samp> action as <var class="keyword varname">C1,Low;C2,High</var> where <var class="keyword varname">C1,C2</var> indicate the policy counter names with <var class="keyword varname">Low</var> and <var class="keyword varname">High</var> as the counter states.</p>

</li>

</ul>
</div>

</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title2" id="concept_kyn_m2m_r4b"><h2 class="title topictitle2" id="ariaid-title2">Examples</h2>
<div class="body conbody">
            <div class="section" id="concept_kyn_m2m_r4b__Stepchargeexample"><h3 class="title sectiontitle">Example 1: Sending an SNR during provisioning when AV balance is
                    updated</h3>
                
                <p class="p">This example indicates that a QoS is set from low to high and vice-versa when an
                    AV has a step-charge bucket and the last step is consumed in commit. It also
                    indicates an SNR on provisioning when the AV is incremented or decremented using
                    REST API.</p>

                <p class="p">
                    <strong class="ph b">Prerequisites:</strong>
                </p>

                <ol class="ol" id="concept_kyn_m2m_r4b__ol_o2h_t2m_r4b">
                    <li class="li">
                        <p class="p">Create two charging services:</p>

                        <ol class="ol" type="a" id="concept_kyn_m2m_r4b__ol_p2h_t2m_r4b">
                            <li class="li">
                                <p class="p">Create the first charging service <var class="keyword varname">CS1</var> having a
                                    bucket with initial value 100 MB and a policy usage counter
                                        <var class="keyword varname">C4</var>.</p>

                            </li>

                            <li class="li">
                                <p class="p">Create the second charging service <var class="keyword varname">CS2</var> with a
                                    step bucket having 2 steps of 50 MB each, and no charge in the
                                    next pass.</p>

                            </li>

                        </ol>

                    </li>

                    <li class="li">
                        <p class="p">Create a bundle with the two charging services <var class="keyword varname">CS1</var> and
                                <var class="keyword varname">CS2</var>.</p>

                    </li>

                    <li class="li">
                        <p class="p">Create a volume type threshold profile group (TPG) with the
                                <em class="ph i">OCSPolicyThreshold</em> flag set as <var class="keyword varname">True</var> and
                            rule with <samp class="ph systemoutput">Send-SNR</samp> action
                                (<var class="keyword varname">C1,Low;C2,High;C3,Low;C5,High;C4,Low</var>).</p>

                    </li>

                    <li class="li">
                        <p class="p">The threshold value is set as <var class="keyword varname">0 MB</var> -<em class="ph i">Absolute from
                                end</em> and is used during the call.</p>

                        <p class="p">Create two more thresholds <var class="keyword varname">ABS</var> and
                                <var class="keyword varname">ABE</var> for provisioning the SNR with action
                            condition <var class="keyword varname">isDiameterCall=false</var> and result context
                            with action <var class="keyword varname">triggerType=provisioning</var>, which triggers
                            the <samp class="ph systemoutput">Send-SNR</samp> action to toggle all
                            counters.</p>

                        <p class="p">The two thresholds <var class="keyword varname">ABS</var> and <var class="keyword varname">ABE</var> have
                            threshold configured on value <var class="keyword varname">0</var>.</p>

                    </li>

                    <li class="li">
                        <p class="p">Create an AV of type <var class="keyword varname">Byte</var> accumulating both the
                            charging services created before and the TPGs.</p>

                    </li>

                    <li class="li">
                        <p class="p">Create counters <var class="keyword varname">C1</var>, <var class="keyword varname">C2</var>,
                                <var class="keyword varname">C3</var>, <var class="keyword varname">C5</var>, and
                                <var class="keyword varname">C6</var> of type <var class="keyword varname">MByte,usage/all/all</var>
                            with an <em class="ph i">OCSPolicyCounter</em> and <em class="ph i">resourceBased</em> flags set as
                                <var class="keyword varname">True</var>.</p>

                    </li>

                    <li class="li">
                        <p class="p">Create a device and a group having that device. Associate the above
                            created counters <var class="keyword varname">C1</var>, <var class="keyword varname">C5</var>, and
                                <var class="keyword varname">C6</var> to the group, <var class="keyword varname">C2</var> to the
                            device-group, and <var class="keyword varname">C3</var> to the device. Add the
                            previously created AV to this group and subscribe the bundle to this
                            group.</p>

                    </li>

                    <li class="li">
                        <p class="p">Set the default signalling state in the <em class="ph i">SLA (initial)</em> flag as
                                <var class="keyword varname">False</var>.</p>

                    </li>

                    <li class="li">
                        <p class="p">Create a quota management (slicing profile) with <em class="ph i">Slice
                                Size</em> set as <var class="keyword varname">104857600 bytes</var> or <var class="keyword varname">10
                                MB</var>, <em class="ph i">SAF</em> set as <var class="keyword varname">100%</var> and
                                <em class="ph i">Minimum Slice Size</em> set as <var class="keyword varname">2097152 bytes</var> or
                                <var class="keyword varname">2 MB</var>.</p>

                    </li>

                </ol>

                <p class="p">
                    <strong class="ph b">Scenario:</strong>
                </p>

                <ol class="ol" id="concept_kyn_m2m_r4b__ol_q2h_t2m_r4b">
                    <li class="li">
                        <p class="p">Execute a centralized SCUR call such that:</p>

                        <p class="p">CCR-I: RSU = empty and GSU = 10 MB</p>

                        <p class="p">CCR-U1: USU = 100 MB, RSU = empty, and GSU = 10 MB</p>

                        <p class="p">CCR-U2: USU = 50 MB, RSU = empty and GSU = 10 MB</p>

                        <p class="p">CCR-T: USU= 100 MB</p>

                    </li>

                    <li class="li">
                        <p class="p">Update bucket1 to 50 MB so that AV is incremented.</p>

                    </li>

                    <li class="li">
                        <p class="p">Update bucket1 to 0 MB so that AV is decremented.</p>

                    </li>

                </ol>

                <p class="p">
                    <strong class="ph b">Result:</strong>
                </p>

                <ol class="ol" id="concept_kyn_m2m_r4b__ol_r2h_t2m_r4b">
                    <li class="li">
                        <p class="p">Before receiving the CCR-U1 request, all counters state were set to
                            default, which is <var class="keyword varname">-99</var>. When the CCR-U2 request is
                            received, threshold is triggered but given that we have a step bucket,
                            SNR is not triggered. The SNR is triggered on receiving a CCR-T request
                            when the AV gets exhausted and an SNR is sent with the values of
                                <var class="keyword varname">C1</var>, <var class="keyword varname">C3</var>, and
                                <var class="keyword varname">C4</var> set as <var class="keyword varname">Low</var>, and the values
                            of <var class="keyword varname">C2</var> and <var class="keyword varname">C5</var> set as
                                <var class="keyword varname">High</var>.</p>

                    </li>

                    <li class="li">
                        <p class="p">If a bucket is incremented after the call, then the
                                <var class="keyword varname">ABS</var> provisioning threshold is triggered and an
                            SNR is sent with updated counter value as per the configuration.</p>

                    </li>

                    <li class="li">
                        <p class="p">If a bucket is decremented after increment, then the
                                <var class="keyword varname">ABE</var> provisioning threshold is triggered and an
                            SNR is sent with updated counter value as per the configuration.</p>

                    </li>

                </ol>

                <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> During provisioning, <var class="keyword varname">ABE</var> threshold is considered for
                        sending SNR in case of decrement in value and <var class="keyword varname">ABS</var>
                        threshold is considered for sending SNR in case of increment in value.</div>

            </div>

            <div class="section" id="concept_kyn_m2m_r4b__section_tvq_n2m_r4b"><h3 class="title sectiontitle">Example 2: Sending an SNR through Diameter
                    call</h3>
                <strong class="ph b">Prerequisites:</strong>
                <ol class="ol" id="concept_kyn_m2m_r4b__ol_uvq_n2m_r4b">
                    <li class="li">
                        <p class="p">Create two charging services <var class="keyword varname">CS1</var> and
                                <var class="keyword varname">CS3</var> having individual buckets with initial value
                            of <var class="keyword varname">100 MB</var> each.</p>

                    </li>

                    <li class="li">
                        <p class="p">Create another charging service <var class="keyword varname">CS2</var> with no
                            charge.</p>

                    </li>

                    <li class="li">
                        <p class="p">Create a bundle with the charging services <var class="keyword varname">CS1</var>,
                                <var class="keyword varname">CS2</var>, and <var class="keyword varname">CS3</var>.</p>

                    </li>

                    <li class="li">
                        <p class="p">Create a volume type TPG with the <em class="ph i">OCSPolicyThreshold</em> flag set as
                                <var class="keyword varname">True</var> and rule with
                                <samp class="ph systemoutput">Send-SNR</samp> action
                                (<var class="keyword varname">C1,Low</var>). The threshold value is set as
                                <var class="keyword varname">0 MB</var> -<em class="ph i">Absolute from end</em>.</p>

                    </li>

                    <li class="li">
                        <p class="p">Create an AV of type <var class="keyword varname">MByte</var> accumulating all the
                            charging services created before and the TPG.</p>

                    </li>

                    <li class="li">
                        <p class="p">Create a counter of type <var class="keyword varname">MByte, usage/all/all</var> having
                            the <em class="ph i">OCSPolicyCounter</em> and <em class="ph i">resourceBased</em> flags set as
                                <var class="keyword varname">True</var>.</p>

                    </li>

                    <li class="li">
                        <p class="p">Create a device and a group having that device. Associate the above
                            created counter to group and add above created AV to this group and
                            subscribe the bundle to this group.</p>

                    </li>

                    <li class="li">
                        <p class="p">Create a quota management (slicing profile) with <em class="ph i">Slice
                                Size</em> set as <var class="keyword varname">104857600 bytes</var> or <var class="keyword varname">10
                                MB</var>, <em class="ph i">SAF</em> set as <var class="keyword varname">100%</var> and
                                <em class="ph i">Minimum Slice Size</em> set as <var class="keyword varname">2097152 bytes</var> or
                                <var class="keyword varname">2 MB</var>.</p>

                    </li>

                </ol>
<p class="p">
                    <strong class="ph b">Scenario:</strong>
                </p>
<p class="p">Execute a centralized SCUR call such that:</p>
<p class="p">CCR-I: RSU = empty and GSU =
                    100 MB</p>
<p class="p">CCR-U1: USU = 100 MB, RSU = empty, and GSU = 100 MB</p>
<p class="p">CCR-U2:
                    USU = 99 MB, RSU = empty, and GSU = 2 MB</p>
<p class="p">CCR-T: USU = 100 MB</p>
<p class="p">
                    <strong class="ph b">Result:</strong>
                </p>
<ol class="ol" id="concept_kyn_m2m_r4b__ol_vvq_n2m_r4b">
                    <li class="li">
                        <p class="p">In CCR(U1) and CCR(U2), the counter state is set as <var class="keyword varname">default(
                                -99)</var> given that in CCR(U1), complete reservation is done
                            from AV and in CCR(U2), 1 MB is reserved from AV. In CCR(T), QoS is set
                            to low and SNR is sent with counter value set as <var class="keyword varname">Low</var>
                            because AV becomes <var class="keyword varname">0</var> in terminate.</p>

                    </li>

                    <li class="li">
                        <p class="p">In CCR(U2) as after commit, remaining value in AV is 1 MB. Therefore, 1
                            MB is reserved from AV as slice reduction is done as per the
                            configuration and remaining 1 from no charge as min slice is 2 MB.</p>

                    </li>

                </ol>

            </div>

        </div>
</div>
<div class="footer"><hr /><p>Charging User Guide • P556766-DN1000054947-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>