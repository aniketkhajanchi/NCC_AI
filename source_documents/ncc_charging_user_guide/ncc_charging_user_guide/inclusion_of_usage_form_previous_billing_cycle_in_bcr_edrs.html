<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

<meta name="copyright" content="(C) Copyright 2023" />
<meta name="DC.rights.owner" content="(C) Copyright 2023" />
<meta name="generator" content="DITA-OT" /><meta name="DC.type" content="concept" />
<meta name="DC.title" content="Include usage from previous billing cycle in BCR EDRs" />
<meta name="prodname" content="Nokia Converged Charging" />
<meta name="version" content="Release 23.8" />
<meta name="DC.format" content="XHTML" />
<meta name="DC.identifier" content="inclusion_of_usage_form_previous_billing_cycle_in_bcr_edrs" />
<link rel="stylesheet" type="text/css" href="../../web/css/commonltr.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/styles.min.css" />
<link rel="stylesheet" type="text/css" href="../../web/css/common-extended.css" /><title>Include usage from previous billing cycle in BCR EDRs</title>
<script src="../web/js/nswtc.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
<script src="../../web/css/../js/script.min.js" language="javascript" type="text/javascript">/*(◎_◎;)*/</script>
</head>
<body id="inclusion_of_usage_form_previous_billing_cycle_in_bcr_edrs">
<div class="header"><div id="feedback-link-placeholder" class="feedback-link"></div><hr /></div><h1 class="title topictitle1" id="ariaid-title1">Include usage from previous billing cycle in BCR EDRs</h1>
<div class="body conbody">
        <div class="section" id="inclusion_of_usage_form_previous_billing_cycle_in_bcr_edrs__section_lyk_bkk_r4b">
            <p class="p">In order to derive monthly billing from the Billing Cycle Reset (BCR) EDRs
                appropriately, all quota allocated from the previous billing cycles (for active
                voice and data sessions when a BCR occurs) must be factored in when a BCR EDR is
                generated. This quota is applicable to account BCR and bundle renewal or expiration.
                This also includes quota for an account BCR date, as well as the quota for
                subscriptions in which the renewal/expiration date is controlled by their own period
                lifecycle (that is, when subscriptions not linked to the account BCR date). This is
                termed as <em class="ph i">standalone subscription event</em>, that is, the renewal or expiration
                date for subscriptions is controlled by the subscription’s period lifecycle.</p>

            <p class="p">When an account's billing information is updated and BCR period is also modified due
                to <strong class="ph b">Immediate BCR</strong>, NCC updates the <strong class="ph b">callTTC</strong> in ratingSession and
                    <strong class="ph b">preReservedValue</strong> in reservation-map:</p>

            <ul class="ul" id="inclusion_of_usage_form_previous_billing_cycle_in_bcr_edrs__ul_abh_c4n_xnb">
                <li class="li">
                    <p class="p">Reservation in account/bucket/counter with <strong class="ph b">preReservedValue</strong>
                        (calculated from <em class="ph i">AccountBCR</em> time) is greater than zero, and</p>

                </li>

                <li class="li">
                    <p class="p">Corresponding <em class="ph i">ratingSession</em> has <strong class="ph b">callTTC</strong> derived from the
                        account entity.</p>

                    <p class="p">For more information, see <a class="xref" href="#concept_tht_35l_p4b__example2mod">Example 2: Modification to account BCR date using API during ongoing BCR</a>.</p>

                </li>

            </ul>

        </div>

    </div>
<div class="topic concept nested1" aria-labelledby="ariaid-title2" id="concept_ccb_dlk_ymb"><h2 class="title topictitle2" id="ariaid-title2">Configuring this functionality</h2>
<div class="body conbody">
            <p class="p">The application preference <span class="ph uicontrol">Include Final Usage in BCR EDRs</span> is
                used to configure whether and how to generate final BCR before first call of the
                day. The default value is <var class="keyword varname">DISABLED</var>.</p>

            <p class="p">Following are some other possible values for this application preference.</p>

            <p class="p">Different scenarios for each value is described in this section.</p>

            <div class="section" id="concept_ccb_dlk_ymb__section_b1h_wnk_ymb"><h3 class="title sectiontitle">FIRST_CALL</h3>
                
                <ul class="ul" id="concept_ccb_dlk_ymb__ol_rwc_cnk_ymb">
                    <li class="li">
                        <p class="p"><strong class="ph b">Postpone TEM based on VT</strong></p>

                        <p class="p">To ensure that lifecycle is not triggered by TEM scheduled regularly and
                            thus final BCR is not generated before first call of the day, turn on
                            the following parameters:</p>

                        <ul class="ul" id="concept_ccb_dlk_ymb__ol_swc_cnk_ymb">
                            <li class="li">Set this application preference to
                                <var class="keyword varname">FIRST_CALL</var>.</li>

                            <li class="li">Set the application preferences <strong class="ph b">VT Adjustment Factor
                                    (seconds)</strong> and <strong class="ph b">TTC Adjustment Factor (seconds)</strong> to a
                                value greater than 0.</li>

                            <li class="li">Set the <strong class="ph b">Is-TTC-Enabled</strong> flag to <var class="keyword varname">true</var>. See
                                section <a class="xref" href="ttchandling.html#id9yz-09126-ug01-pczza-sp1-ttchandling__ttcconfig">Configuring TTC</a> for more details.</li>

                        </ul>

                    </li>

                    <li class="li">
                        <p class="p"><strong class="ph b">Final BCR EDR processing has to wait for the first call of the day
                                after BCR time</strong></p>

                        <p class="p">If active session is in progress, and the account/subscription BCR time
                            is crossed by the allocated slice (VT exceeds BCR time), then lifecycle
                            is not triggered by TEM scheduled regularly. But, TEM gets triggered by
                            the first call of the day. This helps to include the total usage of
                            billing cycle in related BCR EDRs.</p>

                    </li>

                </ul>

            </div>

            <div class="section" id="concept_ccb_dlk_ymb__section_hlp_xnk_ymb"><h3 class="title sectiontitle">LAST_DATA_CALL</h3>
                
                <ul class="ul" id="concept_ccb_dlk_ymb__ol_twc_cnk_ymb">
                    <li class="li"><strong class="ph b">Postpone TEM based on VT</strong><p class="p">To ensure that lifecycle is not triggered
                            by TEM scheduled regularly and thus final BCR is not generated before
                            first call of the day, configure the following parameters:</p>
<ul class="ul" id="concept_ccb_dlk_ymb__ol_uwc_cnk_ymb">
                            <li class="li">
                                <p class="p">Set this application preference to
                                        <var class="keyword varname">LAST_DATA_CALL</var>.</p>

                            </li>

                            <li class="li">
                                <p class="p">Set the application preferences <strong class="ph b">VT Adjustment Factor
                                        (seconds)</strong> and <strong class="ph b">TTC Adjustment Factor (seconds)</strong> to
                                    a value greater than 0.</p>

                            </li>

                            <li class="li">
                                <p class="p">Set the <strong class="ph b">Is-TTC-Enabled</strong> flag to <var class="keyword varname">true</var>.
                                    See section <a class="xref" href="ttchandling.html#id9yz-09126-ug01-pczza-sp1-ttchandling__ttcconfig">Configuring TTC</a> for more details.</p>

                            </li>

                        </ul>
</li>

                    <li class="li">
                        <p class="p"><strong class="ph b">Final BCR EDR processing has to wait for the final usage for all the
                                active data sessions</strong></p>

                        <ul class="ul" id="concept_ccb_dlk_ymb__ol_vwc_cnk_ymb">
                            <li class="li">
                                <p class="p">If there are any active data sessions at the time of BCR, then
                                    the BCR EDR is not logged at the time of BCR. It is saved to be
                                    dumped when all quota allocated from the previous billing cycle
                                    has been accounted for, either when usage is reported in a
                                    CCR-U/T after BCR or when the sessions are cleared via
                                    Audit.</p>

                            </li>

                            <li class="li">
                                <p class="p">If there are active voice sessions at the time of BCR, then the
                                    voice usage till BCR is accounted for in the BCR EDR, by
                                    deriving the usage based on the interval from the last reported
                                    usage through the BCR time.</p>

                                <ul class="ul" id="concept_ccb_dlk_ymb__ol_wwc_cnk_ymb">
                                    <li class="li">
                                        <p class="p">If TTC is not enabled, then the virtual TTC is enabled to
                                            calculate the TTC time (without any adjustments).</p>

                                    </li>

                                    <li class="li">
                                        <p class="p">Using the TTC time, units before TTC and cost (final
                                            usage) for the same are calculated.</p>

                                    </li>

                                    <li class="li">
                                        <p class="p">At the time of BCR, the BCR EDRs are updated with the
                                            calculated cost (final usage) for the voice usage till
                                            BCR.</p>

                                    </li>

                                    <li class="li">
                                        <p class="p">If the session is cleared via audit, then the voice usage
                                            till BCR is calculated.</p>

                                    </li>

                                </ul>

                            </li>

                            <li class="li">
                                <p class="p">If there are any active fee reservations (step fee reservation or
                                    BOU fee reservation), then it is accounted for in the final BCR
                                    EDR as follows:</p>

                                <ul class="ul" id="concept_ccb_dlk_ymb__ol_xwc_cnk_ymb">
                                    <li class="li">Fee reserved for data sessions is treated like an active
                                        data session, and BCR EDR is dumped only when all quota
                                        allocated from the previous billing cycle has been accounted
                                        for, either when usage is reported in a CCR-U/T after BCR or
                                        when the sessions are cleared via audit, and the fee
                                        reserved is charged.</li>

                                    <li class="li">Fee reserved for voice sessions is treated like an active
                                        voice session, and the fee for the voice usage till BCR is
                                        accounted for in the BCR EDR, by deriving the fee for the
                                        usage based on the interval from the last reported usage
                                        till the BCR time.</li>

                                </ul>

                            </li>

                        </ul>

                    </li>

                </ul>

            </div>

            <div class="section" id="concept_ccb_dlk_ymb__section_fly_xnk_ymb"><h3 class="title sectiontitle">LAST_CALL</h3>
                
                <ul class="ul" id="concept_ccb_dlk_ymb__ol_ywc_cnk_ymb">
                    <li class="li">
                        <p class="p"><strong class="ph b">Postpone TEM based on VT</strong></p>

                        <p class="p">To ensure that lifecycle is not triggered by TEM scheduled regularly, and
                            thus final BCR is not generated before first call of the day, configure
                            the following parameters:</p>

                        <ul class="ul" id="concept_ccb_dlk_ymb__ol_zwc_cnk_ymb">
                            <li class="li">
                                <p class="p">Set this application preference to
                                    <var class="keyword varname">LAST_CALL</var>.</p>

                            </li>

                            <li class="li">
                                <p class="p">Set the application preferences <strong class="ph b">VT Adjustment Factor
                                        (seconds)</strong> and <strong class="ph b">TTC Adjustment Factor (seconds)</strong> to
                                    a value greater than 0.</p>

                            </li>

                            <li class="li">
                                <p class="p">Set the <strong class="ph b">Is-TTC-Enabled</strong> flag to <var class="keyword varname">true</var>.
                                    See section <a class="xref" href="ttchandling.html#id9yz-09126-ug01-pczza-sp1-ttchandling__ttcconfig">Configuring TTC</a> for more details.</p>

                            </li>

                        </ul>

                    </li>

                    <li class="li">
                        <p class="p"><strong class="ph b">Final BCR EDR processing has to wait for the final usage for all the
                                active sessions</strong></p>

                        <ul class="ul" id="concept_ccb_dlk_ymb__ol_axc_cnk_ymb">
                            <li class="li">
                                <p class="p">If there are any active sessions at the time of BCR, the BCR EDR
                                    is not logged at the time of BCR; instead the same is saved,
                                    only to be dumped when all quota allocated from the previous
                                    billing cycle has been accounted for, either when usage is
                                    reported in a CCR-U/T after BCR or when the sessions are cleared
                                    via Audit.</p>

                            </li>

                            <li class="li">
                                <p class="p">If there are any active fee reservations (Step Fee reservation or
                                    BOU Fee reservation), the same is accounted for in the final BCR
                                    EDR. Fee reserved for sessions shall be treated like an active
                                    session, and BCR EDR shall be dumped only when all quota
                                    allocated from the previous billing cycle has been accounted
                                    for, either when usage is reported in a CCR-U/T after BCR or
                                    when the sessions are cleared via Audit, and the fee reserved is
                                    charged.</p>

                            </li>

                        </ul>

                    </li>

                </ul>

            </div>

        </div>
</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title3" id="concept_fnh_1hl_ymb"><h2 class="title topictitle2" id="ariaid-title3">Applicability</h2>
<div class="body conbody">
            <p class="p">This feature is applicable for BCR EDRs for the following lifecycle actions:</p>

            <ul class="ul" id="concept_fnh_1hl_ymb__ul_mch_phl_ymb">
                <li class="li">Reset account</li>

                <li class="li">Renew subscription</li>

                <li class="li">Reset subscription</li>

                <li class="li">Empty subscription</li>

                <li class="li">Account BCR</li>

                <li class="li">Bundle renewals/expirations</li>

            </ul>

        </div>
</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title4" id="concept_p1d_p3l_ymb"><h2 class="title topictitle2" id="ariaid-title4">Additional information</h2>
<div class="body conbody">
            <ul class="ul" id="concept_p1d_p3l_ymb__ol_dkk_p3l_ymb">
                <li class="li">
                    <p class="p">The <var class="keyword varname">RecordEventResult</var> tag value (15), overwrites the
                        actual <var class="keyword varname">recordEventResult</var> value.</p>

                </li>

                <li class="li">
                    <p class="p">It is assumed that BCR is triggered via lifecycle audit or
                            <em class="ph i">On-Call-Pending-PLC</em> execution.</p>

                    <p class="p">If BCR is triggered before scheduled BCR via lifecycle REST APIs, then values
                        in EDR may not be correct.</p>

                </li>

                <li class="li">
                    <p class="p">As TTC is not supported for VoLTE sessions, if <strong class="ph b">Include Final Usage In BCR
                            EDRs</strong> is set to <var class="keyword varname">LAST_DATA_CALL</var> then a virtual TTC
                        is enabled. The TTC time is calculated without adjustments. This time is
                        then used to calclulate the amount to be accounted in previous cycle.</p>

                </li>

                <li class="li">
                    <p class="p">If <strong class="ph b">Include Final Usage In BCR EDRs</strong> is set to
                            <var class="keyword varname">LAST_DATA_CALL</var> and a VoLTE session is cleared via
                        Audit:</p>

                    <ul class="ul" id="concept_p1d_p3l_ymb__ol_ekk_p3l_ymb">
                        <li class="li">
                            <p class="p">The VoLTE usage till BCR is used in previous values.</p>

                        </li>

                        <li class="li">
                            <p class="p">Session audit CDR accounts for the committed usage till BCR.</p>

                        </li>

                    </ul>

                </li>

                <li class="li">
                    <p class="p">If <strong class="ph b">Include Final Usage In BCR EDRs</strong> is set to
                            <var class="keyword varname">LAST_CALL</var>, then BCR EDR is logged after accounting
                        usage for all sessions (both voice and data).</p>

                </li>

                <li class="li">
                    <p class="p">If <strong class="ph b">Include Final Usage In BCR EDRs</strong> is set to
                            <var class="keyword varname">LAST_DATA_CALL</var>/<var class="keyword varname">LAST_CALL</var>, then the
                        functionality to postpone TEM based on VT continues to work.</p>

                </li>

                <li class="li">
                    <p class="p">If <strong class="ph b">Include Final Usage In BCR EDRs</strong> is set to
                            <var class="keyword varname">LAST_DATA_CALL</var>/<var class="keyword varname">LAST_CALL</var> and if
                        neither usage is reported for the active sessions via CCR-U/T, nor the
                        sessions are cleared by audit, within the current bill cycle, then at next
                        BCR the following logic is applied:</p>

                    <ul class="ul" id="concept_p1d_p3l_ymb__ol_fkk_p3l_ymb">
                        <li class="li">
                            <p class="p">The previous BCR already stored is logged first.</p>

                            <ul class="ul" id="concept_p1d_p3l_ymb__ol_gkk_p3l_ymb">
                                <li class="li">
                                    <p class="p">The <em class="ph i">triggeredAtTime</em> tag gets the time when the
                                        previous BCR was triggered, and <em class="ph i">timestamp</em> tag gets
                                        the time when the BCR EDR was dumped.</p>

                                </li>

                                <li class="li">
                                    <p class="p">Since usage is not reported, the logged EDR may not have the
                                        accurate usage from previous cycle.</p>

                                </li>

                            </ul>

                        </li>

                        <li class="li">
                            <p class="p">The current BCR is processed and logged or stored based on active
                                sessions.</p>

                        </li>

                    </ul>

                </li>

                <li class="li">
                    <p class="p">If <strong class="ph b">Include Final Usage In BCR EDRs</strong> is set to
                            <var class="keyword varname">LAST_DATA_CALL</var>, then account balance tags in BCR EDR
                        are generated with the following logic:</p>

                    <ul class="ul" id="concept_p1d_p3l_ymb__ol_hkk_p3l_ymb">
                        <li class="li">
                            <p class="p">The <em class="ph i">accountBalanceBeforeReset </em>tag in ResetAccountAction EDR,
                                accounts for the voice usage till BCR, by deriving the usage based
                                on the interval from the last reported usage through the BCR time
                                along with any applicable fees for the usage till BCR.</p>

                        </li>

                        <li class="li">
                            <p class="p">If the account is not reset in the current cycle, then
                                    <em class="ph i">accountBalanceBeforeRenew</em> and
                                    <em class="ph i">accountBalanceAfterRenew</em> tags in
                                    <em class="ph i">RenewSubscriptionAction</em> EDR, account for the voice usage
                                till BCR, by deriving the usage based on the interval from the last
                                reported usage through the BCR time along with any applicable fees
                                for the usage till BCR.</p>

                        </li>

                    </ul>

                </li>

                <li class="li">
                    <p class="p">If a user subscribes to booster bundle again before BCR:</p>

                    <ul class="ul" id="concept_p1d_p3l_ymb__ul_lnp_nwb_zmb">
                        <li class="li">
                            <p class="p">In EDR, <var class="keyword varname">CustomData</var> appears twice</p>

                        </li>

                        <li class="li">
                            <p class="p">Policy counter info appears twice</p>

                        </li>

                    </ul>

                </li>

                <li class="li">
                    <p class="p">VT time is calculated with adjustments.</p>

                </li>

                <li class="li">
                    <p class="p">For pending BCR EDRs, previous values are not adjusted (that is, no CCR/audit
                        is done within the current cycle of the resource).</p>

                </li>

                <li class="li">
                    <p class="p">Lifecycle actions must be configured in the following order:</p>

                    <ol class="ol" id="concept_p1d_p3l_ymb__ol_et5_ywb_zmb">
                        <li class="li">ResetAccountAction</li>

                        <li class="li">RenewSubscriptionAction</li>

                        <li class="li">ResetPeriodAction</li>

                    </ol>

                </li>

            </ul>

            <p class="p">If the application preference <strong class="ph b">Include Final Usage in BCR EDRs</strong> is set to
                    <var class="keyword varname">LAST_DATA_CALL</var> and active IMS sessions are present at BCR,
                then any different order may result in incorrect account balance in
                    <em class="ph i">RenewSubscriptionAction</em> EDRs. However, <em class="ph i">ResetAccountAction</em> contains
                correct values.</p>

        </div>
</div>
<div class="topic concept nested1" aria-labelledby="ariaid-title5" id="concept_tht_35l_p4b"><h2 class="title topictitle2" id="ariaid-title5">Examples</h2>
<div class="body conbody">
            <div class="section" id="concept_tht_35l_p4b__section_mtd_k5l_p4b"><h3 class="title sectiontitle">Example 1</h3>
                
                <p class="p"><strong class="ph b">Preconditions:</strong></p>

                <ul class="ul" id="concept_tht_35l_p4b__ol_xcs_spl_ymb">
                    <li class="li">
                        <p class="p"><strong class="ph b">Include Final Usage In BCR EDRs</strong> is set to
                                <var class="keyword varname">LAST_DATA_CALL</var>.</p>

                    </li>

                    <li class="li">
                        <p class="p">A single postpaid account has the following subscriptions mapped to a
                            single device:</p>

                        <ul class="ul" id="concept_tht_35l_p4b__ol_ycs_spl_ymb">
                            <li class="li">
                                <p class="p">A <em class="ph i">Base</em> subscription includes:</p>

                                <ul class="ul" id="concept_tht_35l_p4b__ol_zcs_spl_ymb">
                                    <li class="li">
                                        <p class="p">A domestic data counter <var class="keyword varname">ABY</var> (all
                                            RG=3300, RG=3303, and RG=100 usage is applicable to the
                                                <var class="keyword varname">ABY</var> counter).</p>

                                    </li>

                                    <li class="li">
                                        <p class="p">A tethered data counter <var class="keyword varname">TBY</var> (RG=3303
                                            usage is applicable to TBY, unless there is a tethered
                                            databoost bundle available for tethered usage).</p>

                                    </li>

                                    <li class="li">
                                        <p class="p">An unlimited <var class="keyword varname">VOICE</var> (minutes)
                                            counter.</p>

                                    </li>

                                    <li class="li">
                                        <p class="p">A base bundle does not have a period lifecycle, it is
                                            renewed on the account’s BCR date.</p>

                                    </li>

                                </ul>

                            </li>

                            <li class="li">
                                <p class="p">A tethered databoost subscription including a single high-speed
                                    bucket <var class="keyword varname">TBB</var> (RG=3303 usage is applicable to
                                    the TBB bucket),</p>

                                <ul class="ul" id="concept_tht_35l_p4b__ol_ads_spl_ymb">
                                    <li class="li">
                                        <p class="p">The tethered databoost bundle is a <em class="ph i">one shot</em> bundle
                                            without renewals, it expires on the account’s BCR
                                            date.</p>

                                    </li>

                                    <li class="li">
                                        <p class="p">The charging service for the tethered databoost bundle is
                                            of higher priority than the base bundle’s charging
                                            service containing the <var class="keyword varname">TBY</var>
                                            counter.</p>

                                    </li>

                                </ul>

                            </li>

                        </ul>

                    </li>

                    <li class="li">
                        <p class="p">Few other configurations:</p>

                        <ul class="ul" id="concept_tht_35l_p4b__ol_cds_spl_ymb">
                            <li class="li">
                                <p class="p">The <var class="keyword varname">ABY</var> counter is mapped to a policy counter
                                    ID <var class="keyword varname">PC1</var> and has not yet reached its threshold
                                    value so its associated PC status is currently
                                        <var class="keyword varname">unthrottled</var>.</p>

                            </li>

                            <li class="li">
                                <p class="p">Both the <var class="keyword varname">TBY</var> counter and
                                        <var class="keyword varname">TBB</var> bucket are mapped to a virtual policy
                                    counter ID <var class="keyword varname">PC2</var> with a current PC status of
                                        <var class="keyword varname">unthrottled</var>, as long as the
                                        <var class="keyword varname">TBB</var> bucket is not exhausted.</p>

                            </li>

                            <li class="li">
                                <p class="p">Current day is the day before the account’s BCR date, and the BCR
                                    is scheduled to occur at midnight (12:00 AM).</p>

                            </li>

                            <li class="li">
                                <p class="p">There is one active Gy session and one active Sy session in
                                    progress for the device, including both a mobile data flow
                                    (RG=3300) and a tethered data flow (RG-3303).</p>

                            </li>

                            <li class="li">
                                <p class="p">The quota management (slicing profile) is configured to
                                    use a standard VT value of 12 hours for RGs 3300, 3303, and
                                    100.</p>

                            </li>

                        </ul>

                    </li>

                    <li class="li">
                        <p class="p">Following features are enabled:</p>

                        <ul class="ul" id="concept_tht_35l_p4b__ol_dds_spl_ymb">
                            <li class="li">
                                <p class="p">Support aggregate counters within subscriptions/bundles and
                                    multiple charging service support for a single
                                    counter/bucket/threshold object.</p>

                            </li>

                            <li class="li">
                                <p class="p">PC IDs for buckets, SNR for added/dropped policy counters,
                                    virtual PCs, and inclusion of all PC IDs in all
                                    SNRs/notifications.</p>

                            </li>

                            <li class="li">
                                <p class="p">Disable TTC for prepaid and Force VT to align to TTC and a short
                                    interval if PC status changes at BCR.</p>

                                <p class="p">The following parameters are configured:</p>

                                <ul class="ul" id="concept_tht_35l_p4b__ul_eds_spl_ymb">
                                    <li class="li">VTAF: 4 hours</li>

                                    <li class="li">TTCAF: 5 minutes</li>

                                    <li class="li">TTCAFlarge: 45 minutes</li>

                                    <li class="li">MINspread: 1 minute</li>

                                </ul>

                            </li>

                            <li class="li">
                                <p class="p">VolTE and VilTE correlation support</p>

                            </li>

                        </ul>

                    </li>

                </ul>

                
                <p class="p"><strong class="ph b">Scenario:</strong></p>

                <ul class="ul" id="concept_tht_35l_p4b__ol_afq_rtl_ymb">
                    <li class="li">
                        <p class="p">At <strong class="ph b">10 PM</strong>, an Ro VoLTE voice session starts (no RG or VT is
                            applicable to the VoLTE voice sessions).</p>

                        <p class="p">As the BCR is within the standard VT interval, a virtual TTC time is
                            computed and stored, but not sent to the network. then, the virtual TTC
                            is set to 12:00:00 AM (= BCR Time without any adjustment).</p>

                    </li>

                    <li class="li">
                        <p class="p">At <strong class="ph b">10:30 PM</strong>, a CCR-U is received for the active Gy session
                            including usage applicable to RG 3300.</p>

                        <ul class="ul" id="concept_tht_35l_p4b__ol_dfq_rtl_ymb">
                            <li class="li">
                                <p class="p">The usage is applied to the base subscription’s
                                        <var class="keyword varname">ABY</var> counter and a 5G CDR is
                                    generated.</p>

                            </li>

                            <li class="li">
                                <p class="p">As the current time is within the standard VT (12 hours) of the
                                    account’s BCR time, and neither <var class="keyword varname">PC1</var> nor
                                        <var class="keyword varname">PC2</var> are expected to change PC status
                                    during account BCR processing, the computation of VT and TTC
                                    values are returned to the network as follows:</p>

                                <ul class="ul" id="concept_tht_35l_p4b__ol_efq_rtl_ymb">
                                    <li class="li">
                                        <p class="p">TTC is set to 12:03:30 AM (= 12:00 AM + RAND[1 second, 5
                                            minutes)</p>

                                    </li>

                                    <li class="li">
                                        <p class="p">VT is set to 4.5 hours (= time to BCR + RAND[TTC – time
                                            to BCR + MINspread, VTAF] = 1.5 hours + RAND[3 minutes
                                            and 30 seconds + 1 minute, 4 hours])</p>

                                    </li>

                                </ul>

                            </li>

                        </ul>

                    </li>

                    <li class="li">
                        <p class="p">At <strong class="ph b">11 PM</strong>, a CCR-U is received for the active Gy session including
                            usage applicable to RG 3303.</p>

                        <ul class="ul" id="concept_tht_35l_p4b__ol_ffq_rtl_ymb">
                            <li class="li">
                                <p class="p">The usage is applied to BOTH the tethered databoost
                                    subscription’s TBB bucket and the base subscription’s ABY
                                    counter and a 5G CDR is generated.</p>

                            </li>

                            <li class="li">
                                <p class="p">In this case, the <var class="keyword varname">ABY</var> counter reaches its
                                    threshold triggering a PC status change. An SNR is sent on the
                                    active Sy session with a PC status of <em class="ph i">throttled</em> for PC ID
                                        <var class="keyword varname">PC1</var> (associated with the ABY
                                    counter).</p>

                            </li>

                            <li class="li">
                                <p class="p">As the PC status for PC ID <var class="keyword varname">PC1</var> is now expected
                                    to change during the account’s BCR processing, and the BCR is
                                    within the standard VT interval, the computation of VT and TTC
                                    values to be returned to the network as follows:</p>

                                <ul class="ul" id="concept_tht_35l_p4b__ol_gfq_rtl_ymb">
                                    <li class="li">
                                        <p class="p">TTC is set to 12:29 AM (= 12:00 AM + RAND[1 second,
                                            VTAFlarge] = 12:00 AM + RAND[1 second, 45 minutes])</p>

                                    </li>

                                    <li class="li">
                                        <p class="p">VT is set to 90 minutes (= time to TTC + MINspread = 1
                                            hour and 29 minutes + 1 minute)</p>

                                    </li>

                                </ul>

                            </li>

                        </ul>

                    </li>

                    <li class="li">
                        <p class="p">At <strong class="ph b">12:10 AM</strong>, the end-user converts the media in their VoLTE call
                            from voice to video, triggering a CCR-I for a new (second) data session,
                            with an RG of 100. As this is the first event received on or after the
                            account’s BCR, it triggers the CHF to take the following actions:</p>

                        <ul class="ul" id="concept_tht_35l_p4b__ol_hfq_rtl_ymb">
                            <li class="li">
                                <p class="p">The current usage &amp; state info associated with the previous
                                    billing cycle is saved so that it can be maintained until all
                                    outstanding (data) quota associated with the previous billing
                                    cycle is reported resulting in an accurate summary of cumulative
                                    usage in the account’s BCR EDR.</p>

                                <div class="p">
                                    <div class="note"><div class="notetitle"><img src="../../web/css/../images/note.svg" title="note-icon" class="noteicon" />Note:</div> For accounts with balance management enabled (for example,
                                        prepaid accounts), the pre- and post-event balance value
                                        reported in the BCR EDR must be stored as well, including
                                        subscription renewal charges and any <em class="ph i">pay go</em> charges
                                        for the 120 voice minutes up through 12:00 for the VoLTE
                                        session which spans the BCR but excluding subsequent charges
                                        associated with the new billing cycle. For example, if there
                                        are subsequent charges applicable to the new billing cycle
                                        applied before all final usage is reported and the final BCR
                                        EDR is generated, those charges should NOT be deducted from
                                        the balance amount included in the BCR EDR.</div>

                                </div>

                            </li>

                            <li class="li">
                                <p class="p">The outstanding 120 minutes for the VoLTE voice call from the
                                    previous billing cycle (prior to the virtual TTC or BCR time at
                                    12:00 AM), is added to the previous billing cycle info for the
                                    base subscription’s voice counter.</p>

                            </li>

                            <li class="li">
                                <p class="p">Separate state information is created for the subscriptions
                                    applicable to the new bundle. This includes resetting
                                        the<var class="keyword varname"> ABY</var>, <var class="keyword varname">TBY</var>, and
                                        <var class="keyword varname">VOICE</var> counters to zero and the removal of
                                    the tethered databoost bundle from the account/device as it has
                                    expired and is no longer available for usage in the new billing
                                    cycle.</p>

                            </li>

                            <li class="li">
                                <p class="p">As <var class="keyword varname">ABY</var> has been reset to 0, and is below its
                                    throttle threshold, an SNR is sent over the active Sy session
                                    including PC ID <var class="keyword varname">PC1</var> with a PC status
                                        <var class="keyword varname">unthrottled</var>.</p>

                            </li>

                            <li class="li">
                                <p class="p">GSU and VQT are returned to the network based on the current (0)
                                    value of ABY for the new billing cycle.</p>

                            </li>

                            <li class="li">
                                <p class="p">A VT value of 12 hours is returned as no account BCR or
                                    subscription renewal/expiration events would occur within the
                                    next 12 hours.</p>

                            </li>

                        </ul>

                    </li>

                    <li class="li">
                        <p class="p">At <strong class="ph b">12:30 AM</strong>, a CCR-U is received for data session 1 reporting
                            usage for RG 3303. In this case, since TTC was previously set, both
                            usage before the TTC (up through 12:29 AM) and after the TTC (from 12:29
                            AM through 12:30 AM) are reported. The CHF takes the following
                            actions:</p>

                        <ul class="ul" id="concept_tht_35l_p4b__ol_ifq_rtl_ymb">
                            <li class="li">
                                <p class="p">The <em class="ph i">BEFORE</em> usage is applied to the saved values of the
                                    tethered databoost subscription’s <var class="keyword varname">TBY</var> bucket
                                    and the base subscription’s <var class="keyword varname">ABY</var> counter from
                                    the previous billing cycle. This results in a 5G CDR record.</p>

                            </li>

                            <li class="li">
                                <p class="p">The <em class="ph i">AFTER</em> usage is applied to the base subscription’s
                                        <var class="keyword varname">ABY</var> and <var class="keyword varname">TBY</var> counters.
                                    This results in a separate 5G CDR.</p>

                            </li>

                            <li class="li">
                                <p class="p">New GSU/VQT values are based on the current state of the new
                                    billing cycle’s <var class="keyword varname">ABY</var> and
                                        <var class="keyword varname">TBY</var> counters.</p>

                            </li>

                            <li class="li">
                                <p class="p">VT is a set to 12 hours as there is no BCR or standalone
                                    subscription event within that interval.</p>

                            </li>

                        </ul>

                    </li>

                    <li class="li">
                        <p class="p">At <strong class="ph b">12:45 AM</strong>, the end user terminates it's video call and VoLTE
                            session resulting in the receipt of two network events:</p>

                        <ul class="ul" id="concept_tht_35l_p4b__ol_jfq_rtl_ymb">
                            <li class="li">
                                <p class="p">A CCR-T received for the second Gy data session. The usage
                                    reported is applied to the ABY counter value for the new billing
                                    cycle and a 5G CDR will be generated.</p>

                            </li>

                            <li class="li">
                                <p class="p">A CCR-T received from the Ro VoLTE session. This results in 45
                                    minutes of usage being applied to the base subscription’s VOICE
                                    counter for the new billing cycle. A Ro VoLTE CDR is generated,
                                    which includes the following:</p>

                                <ul class="ul" id="concept_tht_35l_p4b__ol_kfq_rtl_ymb">
                                    <li class="li">
                                        <p class="p">Start time of 10 PM the previous day.</p>

                                    </li>

                                    <li class="li">
                                        <p class="p">The full call duration of 2 hours and 45 minutes.</p>

                                    </li>

                                    <li class="li">
                                        <p class="p">An indicator that the VoLTE session spanned the BCR
                                            (recordEventResult = 15).</p>

                                    </li>

                                </ul>

                            </li>

                        </ul>

                    </li>

                    <li class="li">
                        <p class="p">At <strong class="ph b">3 AM</strong>, <em class="ph i">data session 1</em> returns a CCR-U for RG 3300 and the
                            CHF takes the following actions:</p>

                        <ul class="ul" id="concept_tht_35l_p4b__ol_lfq_rtl_ymb">
                            <li class="li">
                                <p class="p">The <em class="ph i">BEFORE</em> usage (up through 12:03:30 AM) is applied to
                                    the saved values of the base subscription’s ABY counter from the
                                    previous billing cycle. This results in a 5G CDR record.</p>

                            </li>

                            <li class="li">
                                <p class="p">All usage allocated from the previous billing cycle is accounted
                                    for and the CHF will generate the BCR EDR including all final
                                    usage, which includes the 120 minutes of voice from the VoLTE
                                    call that started at 10 PM. After generating the final EDR the
                                    stored information from the previous billing cycle is no longer
                                    needed and can be removed from the system.</p>

                            </li>

                            <li class="li">
                                <p class="p">The <em class="ph i">AFTER</em> usage (recorded after 12:03:30) is applied to
                                    the base subscription’s <var class="keyword varname">ABY</var> counters. This
                                    results in a separate 5G CDR.</p>

                            </li>

                            <li class="li">
                                <p class="p">New GSU/VQT values are based on the current state of the new
                                    billing cycle’s <var class="keyword varname">ABY</var> counter.</p>

                            </li>

                            <li class="li">
                                <p class="p">VT is set to 12 hours as there is no BCR event within that
                                    interval.</p>

                            </li>

                        </ul>

                    </li>

                </ul>

            </div>

            <div class="section" id="concept_tht_35l_p4b__example2mod"><h3 class="title sectiontitle">Example 2: Modification to account BCR date using API during ongoing
                    BCR</h3>
                
                <p class="p"><strong class="ph b">Preconditions:</strong></p>

                <p class="p">An account has a periodic lifeycle of 1 day, that is, periodicity is 1 day (1 day
                    data bundle). The billing information (DayOfMonth is 30). Bundle has a charging
                    service with a bucket of 50000 seconds. Device subscribes to bundle that is
                    linked to account. <strong class="ph b">Include Final Usage in BCR EDRs</strong> is set to
                        <strong class="ph b">LAST_DATA_CALL</strong>.</p>

                
                <p class="p"><strong class="ph b">Scenario:</strong></p>

                <ol class="ol" id="concept_tht_35l_p4b__ol_dc3_jwl_p4b">
                    <li class="li">
                        <p class="p">A <em class="ph i">CCR-Initial</em> call is received.</p>

                    </li>

                    <li class="li">
                        <p class="p">A <em class="ph i">CCR-Update</em> call is received and <strong class="ph b">CallTTC</strong> is present in
                                <em class="ph i">ratingSession</em> and <em class="ph i">BucketInstance</em> has reservation map
                            in which <strong class="ph b">preReservedValue</strong> is present.</p>

                        <p class="p">The Preserved value in reservation-map = 44275 and <strong class="ph b">CallTTC</strong> in
                                <em class="ph i">ratingSession</em> = 1602181800000. Patch API with
                                <strong class="ph b">updateTransition</strong> set to <var class="keyword varname">true</var> is used to
                            update the billing information for Account, where, the current HourOfDay
                            is 23 [11:00 PM] is to be decreased by 2 hours. That is, the HourOfDay
                            must be changed from 11:00 PM to 9:00 PM.</p>

                    </li>

                </ol>

                
                <p class="p"><strong class="ph b">Result:</strong></p>

                <p class="p">Following changes take place:</p>

                <ul class="ul" id="concept_tht_35l_p4b__ul_ibr_h34_xnb">
                    <li class="li">The billing information is updated.</li>

                    <li class="li"><strong class="ph b">TEMEntity</strong> is rescheduled to new endTime. </li>

                    <li class="li"><strong class="ph b">preReservedValue</strong> [decreased by 2 hours] and callTTC value [set to new
                        endTime] is updated. [Preserved = 37075 and callTTC = 1602174600000]</li>

                </ul>

            </div>

        </div>
</div>
<div class="footer"><hr /><p>Charging User Guide • P556766-DN1000054947-R23.8 • 1 • <a href="../home.html">Cover</a> • ©2023 Nokia. Nokia Confidential Information • Use subject to agreed restrictions on disclosure and use.</p></div></body>
</html>